import { Curve } from '../../../core/math/curve.js';
import { CurveSet } from '../../../core/math/curve-set.js';
import { Vec3 } from '../../../core/math/vec3.js';
import { Asset } from '../../asset/asset.js';
import { Component } from '../component.js';
import { ComponentSystem } from '../system.js';
import { ParticleSystemComponent } from './component.js';
import { ParticleSystemComponentData } from './data.js';

const _schema = ['enabled', 'autoPlay', 'numParticles', 'lifetime', 'rate', 'rate2', 'startAngle', 'startAngle2', 'loop', 'preWarm', 'lighting', 'halfLambert', 'intensity', 'depthWrite', 'noFog', 'depthSoftening', 'sort', 'blendType', 'stretch', 'alignToMotion', 'emitterShape', 'emitterExtents', 'emitterExtentsInner', 'emitterRadius', 'emitterRadiusInner', 'initialVelocity', 'wrap', 'wrapBounds', 'localSpace', 'screenSpace', 'colorMapAsset', 'normalMapAsset', 'mesh', 'meshAsset', 'renderAsset', 'orientation', 'particleNormal', 'localVelocityGraph', 'localVelocityGraph2', 'velocityGraph', 'velocityGraph2', 'rotationSpeedGraph', 'rotationSpeedGraph2', 'radialSpeedGraph', 'radialSpeedGraph2', 'scaleGraph', 'scaleGraph2', 'colorGraph', 'colorGraph2', 'alphaGraph', 'alphaGraph2', 'colorMap', 'normalMap', 'animTilesX', 'animTilesY', 'animStartFrame', 'animNumFrames', 'animNumAnimations', 'animIndex', 'randomizeAnimIndex', 'animSpeed', 'animLoop', 'layers'];

/**
 * Allows an Entity to render a particle system.
 *
 * @augments ComponentSystem
 * @category Graphics
 */
class ParticleSystemComponentSystem extends ComponentSystem {
  /**
   * Create a new ParticleSystemComponentSystem.
   *
   * @param {import('../../app-base.js').AppBase} app - The Application.
   * @hideconstructor
   */
  constructor(app) {
    super(app);
    this.id = 'particlesystem';
    this.ComponentType = ParticleSystemComponent;
    this.DataType = ParticleSystemComponentData;
    this.schema = _schema;
    this.propertyTypes = {
      emitterExtents: 'vec3',
      emitterExtentsInner: 'vec3',
      particleNormal: 'vec3',
      wrapBounds: 'vec3',
      localVelocityGraph: 'curveset',
      localVelocityGraph2: 'curveset',
      velocityGraph: 'curveset',
      velocityGraph2: 'curveset',
      colorGraph: 'curveset',
      colorGraph2: 'curveset',
      alphaGraph: 'curve',
      alphaGraph2: 'curve',
      rotationSpeedGraph: 'curve',
      rotationSpeedGraph2: 'curve',
      radialSpeedGraph: 'curve',
      radialSpeedGraph2: 'curve',
      scaleGraph: 'curve',
      scaleGraph2: 'curve'
    };
    this.on('beforeremove', this.onBeforeRemove, this);
    this.app.systems.on('update', this.onUpdate, this);
  }
  initializeComponentData(component, _data, properties) {
    const data = {};
    properties = [];
    const types = this.propertyTypes;

    // we store the mesh asset id as "mesh" (it should be "meshAsset")
    // this re-maps "mesh" into "meshAsset" if it is an asset or an asset id
    if (_data.mesh instanceof Asset || typeof _data.mesh === 'number') {
      // migrate into meshAsset property
      _data.meshAsset = _data.mesh;
      delete _data.mesh;
    }
    for (const prop in _data) {
      if (_data.hasOwnProperty(prop)) {
        properties.push(prop);
        // duplicate input data as we are modifying it
        data[prop] = _data[prop];
      }
      if (types[prop] === 'vec3') {
        if (Array.isArray(data[prop])) {
          data[prop] = new Vec3(data[prop][0], data[prop][1], data[prop][2]);
        }
      } else if (types[prop] === 'curve') {
        if (!(data[prop] instanceof Curve)) {
          const t = data[prop].type;
          data[prop] = new Curve(data[prop].keys);
          data[prop].type = t;
        }
      } else if (types[prop] === 'curveset') {
        if (!(data[prop] instanceof CurveSet)) {
          const t = data[prop].type;
          data[prop] = new CurveSet(data[prop].keys);
          data[prop].type = t;
        }
      }

      // duplicate layer list
      if (data.layers && Array.isArray(data.layers)) {
        data.layers = data.layers.slice(0);
      }
    }
    super.initializeComponentData(component, data, properties);
  }
  cloneComponent(entity, clone) {
    const source = entity.particlesystem.data;
    const schema = this.schema;
    const data = {};
    for (let i = 0, len = schema.length; i < len; i++) {
      const prop = schema[i];
      let sourceProp = source[prop];
      if (sourceProp instanceof Vec3 || sourceProp instanceof Curve || sourceProp instanceof CurveSet) {
        sourceProp = sourceProp.clone();
        data[prop] = sourceProp;
      } else if (prop === 'layers') {
        data.layers = source.layers.slice(0);
      } else {
        if (sourceProp !== null && sourceProp !== undefined) {
          data[prop] = sourceProp;
        }
      }
    }
    return this.addComponent(clone, data);
  }
  onUpdate(dt) {
    const components = this.store;
    let numSteps;
    const stats = this.app.stats.particles;
    const composition = this.app.scene.layers;

    // disable light cube on all layers first
    for (let i = 0; i < composition.layerList.length; i++) {
      composition.layerList[i].requiresLightCube = false;
    }
    for (const id in components) {
      if (components.hasOwnProperty(id)) {
        const component = components[id];
        const entity = component.entity;
        const data = component.data;
        if (data.enabled && entity.enabled) {
          const emitter = entity.particlesystem.emitter;
          if (!(emitter != null && emitter.meshInstance.visible)) continue;

          // if emitter is using lighting, enable light cube on all layers it is assigned to
          if (emitter.lighting) {
            const layers = data.layers;
            for (let i = 0; i < layers.length; i++) {
              const layer = composition.getLayerById(layers[i]);
              if (layer) layer.requiresLightCube = true;
            }
          }
          if (!data.paused) {
            emitter.simTime += dt;
            if (emitter.simTime > emitter.fixedTimeStep) {
              numSteps = Math.floor(emitter.simTime / emitter.fixedTimeStep);
              emitter.simTime -= numSteps * emitter.fixedTimeStep;
            }
            if (numSteps) {
              numSteps = Math.min(numSteps, emitter.maxSubSteps);
              for (let i = 0; i < numSteps; i++) {
                emitter.addTime(emitter.fixedTimeStep, false);
              }
              stats._updatesPerFrame += numSteps;
              stats._frameTime += emitter._addTimeTime;
              emitter._addTimeTime = 0;
            }
            emitter.finishFrame();
          }
        }
      }
    }
  }
  onBeforeRemove(entity, component) {
    component.onBeforeRemove();
  }
  destroy() {
    super.destroy();
    this.app.systems.off('update', this.onUpdate, this);
  }
}
Component._buildAccessors(ParticleSystemComponent.prototype, _schema);

export { ParticleSystemComponentSystem };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3lzdGVtLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2NvbXBvbmVudHMvcGFydGljbGUtc3lzdGVtL3N5c3RlbS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDdXJ2ZSB9IGZyb20gJy4uLy4uLy4uL2NvcmUvbWF0aC9jdXJ2ZS5qcyc7XG5pbXBvcnQgeyBDdXJ2ZVNldCB9IGZyb20gJy4uLy4uLy4uL2NvcmUvbWF0aC9jdXJ2ZS1zZXQuanMnO1xuaW1wb3J0IHsgVmVjMyB9IGZyb20gJy4uLy4uLy4uL2NvcmUvbWF0aC92ZWMzLmpzJztcblxuaW1wb3J0IHsgQXNzZXQgfSBmcm9tICcuLi8uLi9hc3NldC9hc3NldC5qcyc7XG5cbmltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJy4uL2NvbXBvbmVudC5qcyc7XG5pbXBvcnQgeyBDb21wb25lbnRTeXN0ZW0gfSBmcm9tICcuLi9zeXN0ZW0uanMnO1xuXG5pbXBvcnQgeyBQYXJ0aWNsZVN5c3RlbUNvbXBvbmVudCB9IGZyb20gJy4vY29tcG9uZW50LmpzJztcbmltcG9ydCB7IFBhcnRpY2xlU3lzdGVtQ29tcG9uZW50RGF0YSB9IGZyb20gJy4vZGF0YS5qcyc7XG5cbmNvbnN0IF9zY2hlbWEgPSBbXG4gICAgJ2VuYWJsZWQnLFxuICAgICdhdXRvUGxheScsXG4gICAgJ251bVBhcnRpY2xlcycsXG4gICAgJ2xpZmV0aW1lJyxcbiAgICAncmF0ZScsXG4gICAgJ3JhdGUyJyxcbiAgICAnc3RhcnRBbmdsZScsXG4gICAgJ3N0YXJ0QW5nbGUyJyxcbiAgICAnbG9vcCcsXG4gICAgJ3ByZVdhcm0nLFxuICAgICdsaWdodGluZycsXG4gICAgJ2hhbGZMYW1iZXJ0JyxcbiAgICAnaW50ZW5zaXR5JyxcbiAgICAnZGVwdGhXcml0ZScsXG4gICAgJ25vRm9nJyxcbiAgICAnZGVwdGhTb2Z0ZW5pbmcnLFxuICAgICdzb3J0JyxcbiAgICAnYmxlbmRUeXBlJyxcbiAgICAnc3RyZXRjaCcsXG4gICAgJ2FsaWduVG9Nb3Rpb24nLFxuICAgICdlbWl0dGVyU2hhcGUnLFxuICAgICdlbWl0dGVyRXh0ZW50cycsXG4gICAgJ2VtaXR0ZXJFeHRlbnRzSW5uZXInLFxuICAgICdlbWl0dGVyUmFkaXVzJyxcbiAgICAnZW1pdHRlclJhZGl1c0lubmVyJyxcbiAgICAnaW5pdGlhbFZlbG9jaXR5JyxcbiAgICAnd3JhcCcsXG4gICAgJ3dyYXBCb3VuZHMnLFxuICAgICdsb2NhbFNwYWNlJyxcbiAgICAnc2NyZWVuU3BhY2UnLFxuICAgICdjb2xvck1hcEFzc2V0JyxcbiAgICAnbm9ybWFsTWFwQXNzZXQnLFxuICAgICdtZXNoJyxcbiAgICAnbWVzaEFzc2V0JyxcbiAgICAncmVuZGVyQXNzZXQnLFxuICAgICdvcmllbnRhdGlvbicsXG4gICAgJ3BhcnRpY2xlTm9ybWFsJyxcbiAgICAnbG9jYWxWZWxvY2l0eUdyYXBoJyxcbiAgICAnbG9jYWxWZWxvY2l0eUdyYXBoMicsXG4gICAgJ3ZlbG9jaXR5R3JhcGgnLFxuICAgICd2ZWxvY2l0eUdyYXBoMicsXG4gICAgJ3JvdGF0aW9uU3BlZWRHcmFwaCcsXG4gICAgJ3JvdGF0aW9uU3BlZWRHcmFwaDInLFxuICAgICdyYWRpYWxTcGVlZEdyYXBoJyxcbiAgICAncmFkaWFsU3BlZWRHcmFwaDInLFxuICAgICdzY2FsZUdyYXBoJyxcbiAgICAnc2NhbGVHcmFwaDInLFxuICAgICdjb2xvckdyYXBoJyxcbiAgICAnY29sb3JHcmFwaDInLFxuICAgICdhbHBoYUdyYXBoJyxcbiAgICAnYWxwaGFHcmFwaDInLFxuICAgICdjb2xvck1hcCcsXG4gICAgJ25vcm1hbE1hcCcsXG4gICAgJ2FuaW1UaWxlc1gnLFxuICAgICdhbmltVGlsZXNZJyxcbiAgICAnYW5pbVN0YXJ0RnJhbWUnLFxuICAgICdhbmltTnVtRnJhbWVzJyxcbiAgICAnYW5pbU51bUFuaW1hdGlvbnMnLFxuICAgICdhbmltSW5kZXgnLFxuICAgICdyYW5kb21pemVBbmltSW5kZXgnLFxuICAgICdhbmltU3BlZWQnLFxuICAgICdhbmltTG9vcCcsXG4gICAgJ2xheWVycydcbl07XG5cbi8qKlxuICogQWxsb3dzIGFuIEVudGl0eSB0byByZW5kZXIgYSBwYXJ0aWNsZSBzeXN0ZW0uXG4gKlxuICogQGF1Z21lbnRzIENvbXBvbmVudFN5c3RlbVxuICogQGNhdGVnb3J5IEdyYXBoaWNzXG4gKi9cbmNsYXNzIFBhcnRpY2xlU3lzdGVtQ29tcG9uZW50U3lzdGVtIGV4dGVuZHMgQ29tcG9uZW50U3lzdGVtIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgUGFydGljbGVTeXN0ZW1Db21wb25lbnRTeXN0ZW0uXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vLi4vYXBwLWJhc2UuanMnKS5BcHBCYXNlfSBhcHAgLSBUaGUgQXBwbGljYXRpb24uXG4gICAgICogQGhpZGVjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGFwcCkge1xuICAgICAgICBzdXBlcihhcHApO1xuXG4gICAgICAgIHRoaXMuaWQgPSAncGFydGljbGVzeXN0ZW0nO1xuXG4gICAgICAgIHRoaXMuQ29tcG9uZW50VHlwZSA9IFBhcnRpY2xlU3lzdGVtQ29tcG9uZW50O1xuICAgICAgICB0aGlzLkRhdGFUeXBlID0gUGFydGljbGVTeXN0ZW1Db21wb25lbnREYXRhO1xuXG4gICAgICAgIHRoaXMuc2NoZW1hID0gX3NjaGVtYTtcblxuICAgICAgICB0aGlzLnByb3BlcnR5VHlwZXMgPSB7XG4gICAgICAgICAgICBlbWl0dGVyRXh0ZW50czogJ3ZlYzMnLFxuICAgICAgICAgICAgZW1pdHRlckV4dGVudHNJbm5lcjogJ3ZlYzMnLFxuICAgICAgICAgICAgcGFydGljbGVOb3JtYWw6ICd2ZWMzJyxcbiAgICAgICAgICAgIHdyYXBCb3VuZHM6ICd2ZWMzJyxcbiAgICAgICAgICAgIGxvY2FsVmVsb2NpdHlHcmFwaDogJ2N1cnZlc2V0JyxcbiAgICAgICAgICAgIGxvY2FsVmVsb2NpdHlHcmFwaDI6ICdjdXJ2ZXNldCcsXG4gICAgICAgICAgICB2ZWxvY2l0eUdyYXBoOiAnY3VydmVzZXQnLFxuICAgICAgICAgICAgdmVsb2NpdHlHcmFwaDI6ICdjdXJ2ZXNldCcsXG4gICAgICAgICAgICBjb2xvckdyYXBoOiAnY3VydmVzZXQnLFxuICAgICAgICAgICAgY29sb3JHcmFwaDI6ICdjdXJ2ZXNldCcsXG4gICAgICAgICAgICBhbHBoYUdyYXBoOiAnY3VydmUnLFxuICAgICAgICAgICAgYWxwaGFHcmFwaDI6ICdjdXJ2ZScsXG4gICAgICAgICAgICByb3RhdGlvblNwZWVkR3JhcGg6ICdjdXJ2ZScsXG4gICAgICAgICAgICByb3RhdGlvblNwZWVkR3JhcGgyOiAnY3VydmUnLFxuICAgICAgICAgICAgcmFkaWFsU3BlZWRHcmFwaDogJ2N1cnZlJyxcbiAgICAgICAgICAgIHJhZGlhbFNwZWVkR3JhcGgyOiAnY3VydmUnLFxuICAgICAgICAgICAgc2NhbGVHcmFwaDogJ2N1cnZlJyxcbiAgICAgICAgICAgIHNjYWxlR3JhcGgyOiAnY3VydmUnXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5vbignYmVmb3JlcmVtb3ZlJywgdGhpcy5vbkJlZm9yZVJlbW92ZSwgdGhpcyk7XG4gICAgICAgIHRoaXMuYXBwLnN5c3RlbXMub24oJ3VwZGF0ZScsIHRoaXMub25VcGRhdGUsIHRoaXMpO1xuICAgIH1cblxuICAgIGluaXRpYWxpemVDb21wb25lbnREYXRhKGNvbXBvbmVudCwgX2RhdGEsIHByb3BlcnRpZXMpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHt9O1xuXG4gICAgICAgIHByb3BlcnRpZXMgPSBbXTtcbiAgICAgICAgY29uc3QgdHlwZXMgPSB0aGlzLnByb3BlcnR5VHlwZXM7XG5cbiAgICAgICAgLy8gd2Ugc3RvcmUgdGhlIG1lc2ggYXNzZXQgaWQgYXMgXCJtZXNoXCIgKGl0IHNob3VsZCBiZSBcIm1lc2hBc3NldFwiKVxuICAgICAgICAvLyB0aGlzIHJlLW1hcHMgXCJtZXNoXCIgaW50byBcIm1lc2hBc3NldFwiIGlmIGl0IGlzIGFuIGFzc2V0IG9yIGFuIGFzc2V0IGlkXG4gICAgICAgIGlmIChfZGF0YS5tZXNoIGluc3RhbmNlb2YgQXNzZXQgfHwgdHlwZW9mIF9kYXRhLm1lc2ggPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICAvLyBtaWdyYXRlIGludG8gbWVzaEFzc2V0IHByb3BlcnR5XG4gICAgICAgICAgICBfZGF0YS5tZXNoQXNzZXQgPSBfZGF0YS5tZXNoO1xuICAgICAgICAgICAgZGVsZXRlIF9kYXRhLm1lc2g7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGNvbnN0IHByb3AgaW4gX2RhdGEpIHtcbiAgICAgICAgICAgIGlmIChfZGF0YS5oYXNPd25Qcm9wZXJ0eShwcm9wKSkge1xuICAgICAgICAgICAgICAgIHByb3BlcnRpZXMucHVzaChwcm9wKTtcbiAgICAgICAgICAgICAgICAvLyBkdXBsaWNhdGUgaW5wdXQgZGF0YSBhcyB3ZSBhcmUgbW9kaWZ5aW5nIGl0XG4gICAgICAgICAgICAgICAgZGF0YVtwcm9wXSA9IF9kYXRhW3Byb3BdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodHlwZXNbcHJvcF0gPT09ICd2ZWMzJykge1xuICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGRhdGFbcHJvcF0pKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbcHJvcF0gPSBuZXcgVmVjMyhkYXRhW3Byb3BdWzBdLCBkYXRhW3Byb3BdWzFdLCBkYXRhW3Byb3BdWzJdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVzW3Byb3BdID09PSAnY3VydmUnKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEoZGF0YVtwcm9wXSBpbnN0YW5jZW9mIEN1cnZlKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gZGF0YVtwcm9wXS50eXBlO1xuICAgICAgICAgICAgICAgICAgICBkYXRhW3Byb3BdID0gbmV3IEN1cnZlKGRhdGFbcHJvcF0ua2V5cyk7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbcHJvcF0udHlwZSA9IHQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlc1twcm9wXSA9PT0gJ2N1cnZlc2V0Jykge1xuICAgICAgICAgICAgICAgIGlmICghKGRhdGFbcHJvcF0gaW5zdGFuY2VvZiBDdXJ2ZVNldCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IGRhdGFbcHJvcF0udHlwZTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtwcm9wXSA9IG5ldyBDdXJ2ZVNldChkYXRhW3Byb3BdLmtleXMpO1xuICAgICAgICAgICAgICAgICAgICBkYXRhW3Byb3BdLnR5cGUgPSB0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gZHVwbGljYXRlIGxheWVyIGxpc3RcbiAgICAgICAgICAgIGlmIChkYXRhLmxheWVycyAmJiBBcnJheS5pc0FycmF5KGRhdGEubGF5ZXJzKSkge1xuICAgICAgICAgICAgICAgIGRhdGEubGF5ZXJzID0gZGF0YS5sYXllcnMuc2xpY2UoMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBzdXBlci5pbml0aWFsaXplQ29tcG9uZW50RGF0YShjb21wb25lbnQsIGRhdGEsIHByb3BlcnRpZXMpO1xuICAgIH1cblxuICAgIGNsb25lQ29tcG9uZW50KGVudGl0eSwgY2xvbmUpIHtcbiAgICAgICAgY29uc3Qgc291cmNlID0gZW50aXR5LnBhcnRpY2xlc3lzdGVtLmRhdGE7XG4gICAgICAgIGNvbnN0IHNjaGVtYSA9IHRoaXMuc2NoZW1hO1xuXG4gICAgICAgIGNvbnN0IGRhdGEgPSB7fTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gc2NoZW1hLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBwcm9wID0gc2NoZW1hW2ldO1xuICAgICAgICAgICAgbGV0IHNvdXJjZVByb3AgPSBzb3VyY2VbcHJvcF07XG4gICAgICAgICAgICBpZiAoc291cmNlUHJvcCBpbnN0YW5jZW9mIFZlYzMgfHxcbiAgICAgICAgICAgICAgICBzb3VyY2VQcm9wIGluc3RhbmNlb2YgQ3VydmUgfHxcbiAgICAgICAgICAgICAgICBzb3VyY2VQcm9wIGluc3RhbmNlb2YgQ3VydmVTZXQpIHtcblxuICAgICAgICAgICAgICAgIHNvdXJjZVByb3AgPSBzb3VyY2VQcm9wLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgZGF0YVtwcm9wXSA9IHNvdXJjZVByb3A7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHByb3AgPT09ICdsYXllcnMnKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5sYXllcnMgPSBzb3VyY2UubGF5ZXJzLnNsaWNlKDApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoc291cmNlUHJvcCAhPT0gbnVsbCAmJiBzb3VyY2VQcm9wICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtwcm9wXSA9IHNvdXJjZVByb3A7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkQ29tcG9uZW50KGNsb25lLCBkYXRhKTtcbiAgICB9XG5cbiAgICBvblVwZGF0ZShkdCkge1xuICAgICAgICBjb25zdCBjb21wb25lbnRzID0gdGhpcy5zdG9yZTtcbiAgICAgICAgbGV0IG51bVN0ZXBzO1xuICAgICAgICBjb25zdCBzdGF0cyA9IHRoaXMuYXBwLnN0YXRzLnBhcnRpY2xlcztcbiAgICAgICAgY29uc3QgY29tcG9zaXRpb24gPSB0aGlzLmFwcC5zY2VuZS5sYXllcnM7XG5cbiAgICAgICAgLy8gZGlzYWJsZSBsaWdodCBjdWJlIG9uIGFsbCBsYXllcnMgZmlyc3RcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb21wb3NpdGlvbi5sYXllckxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbXBvc2l0aW9uLmxheWVyTGlzdFtpXS5yZXF1aXJlc0xpZ2h0Q3ViZSA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChjb25zdCBpZCBpbiBjb21wb25lbnRzKSB7XG4gICAgICAgICAgICBpZiAoY29tcG9uZW50cy5oYXNPd25Qcm9wZXJ0eShpZCkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSBjb21wb25lbnRzW2lkXTtcbiAgICAgICAgICAgICAgICBjb25zdCBlbnRpdHkgPSBjb21wb25lbnQuZW50aXR5O1xuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBjb21wb25lbnQuZGF0YTtcblxuICAgICAgICAgICAgICAgIGlmIChkYXRhLmVuYWJsZWQgJiYgZW50aXR5LmVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW1pdHRlciA9IGVudGl0eS5wYXJ0aWNsZXN5c3RlbS5lbWl0dGVyO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWVtaXR0ZXI/Lm1lc2hJbnN0YW5jZS52aXNpYmxlKSBjb250aW51ZTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBpZiBlbWl0dGVyIGlzIHVzaW5nIGxpZ2h0aW5nLCBlbmFibGUgbGlnaHQgY3ViZSBvbiBhbGwgbGF5ZXJzIGl0IGlzIGFzc2lnbmVkIHRvXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbWl0dGVyLmxpZ2h0aW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXllcnMgPSBkYXRhLmxheWVycztcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGF5ZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSBjb21wb3NpdGlvbi5nZXRMYXllckJ5SWQobGF5ZXJzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGF5ZXIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheWVyLnJlcXVpcmVzTGlnaHRDdWJlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICghZGF0YS5wYXVzZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtaXR0ZXIuc2ltVGltZSArPSBkdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbWl0dGVyLnNpbVRpbWUgPiBlbWl0dGVyLmZpeGVkVGltZVN0ZXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1TdGVwcyA9IE1hdGguZmxvb3IoZW1pdHRlci5zaW1UaW1lIC8gZW1pdHRlci5maXhlZFRpbWVTdGVwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0dGVyLnNpbVRpbWUgLT0gbnVtU3RlcHMgKiBlbWl0dGVyLmZpeGVkVGltZVN0ZXA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVtU3RlcHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1TdGVwcyA9IE1hdGgubWluKG51bVN0ZXBzLCBlbWl0dGVyLm1heFN1YlN0ZXBzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVN0ZXBzOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdHRlci5hZGRUaW1lKGVtaXR0ZXIuZml4ZWRUaW1lU3RlcCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0cy5fdXBkYXRlc1BlckZyYW1lICs9IG51bVN0ZXBzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRzLl9mcmFtZVRpbWUgKz0gZW1pdHRlci5fYWRkVGltZVRpbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdHRlci5fYWRkVGltZVRpbWUgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZW1pdHRlci5maW5pc2hGcmFtZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgb25CZWZvcmVSZW1vdmUoZW50aXR5LCBjb21wb25lbnQpIHtcbiAgICAgICAgY29tcG9uZW50Lm9uQmVmb3JlUmVtb3ZlKCk7XG4gICAgfVxuXG4gICAgZGVzdHJveSgpIHtcbiAgICAgICAgc3VwZXIuZGVzdHJveSgpO1xuXG4gICAgICAgIHRoaXMuYXBwLnN5c3RlbXMub2ZmKCd1cGRhdGUnLCB0aGlzLm9uVXBkYXRlLCB0aGlzKTtcbiAgICB9XG59XG5cbkNvbXBvbmVudC5fYnVpbGRBY2Nlc3NvcnMoUGFydGljbGVTeXN0ZW1Db21wb25lbnQucHJvdG90eXBlLCBfc2NoZW1hKTtcblxuZXhwb3J0IHsgUGFydGljbGVTeXN0ZW1Db21wb25lbnRTeXN0ZW0gfTtcbiJdLCJuYW1lcyI6WyJfc2NoZW1hIiwiUGFydGljbGVTeXN0ZW1Db21wb25lbnRTeXN0ZW0iLCJDb21wb25lbnRTeXN0ZW0iLCJjb25zdHJ1Y3RvciIsImFwcCIsImlkIiwiQ29tcG9uZW50VHlwZSIsIlBhcnRpY2xlU3lzdGVtQ29tcG9uZW50IiwiRGF0YVR5cGUiLCJQYXJ0aWNsZVN5c3RlbUNvbXBvbmVudERhdGEiLCJzY2hlbWEiLCJwcm9wZXJ0eVR5cGVzIiwiZW1pdHRlckV4dGVudHMiLCJlbWl0dGVyRXh0ZW50c0lubmVyIiwicGFydGljbGVOb3JtYWwiLCJ3cmFwQm91bmRzIiwibG9jYWxWZWxvY2l0eUdyYXBoIiwibG9jYWxWZWxvY2l0eUdyYXBoMiIsInZlbG9jaXR5R3JhcGgiLCJ2ZWxvY2l0eUdyYXBoMiIsImNvbG9yR3JhcGgiLCJjb2xvckdyYXBoMiIsImFscGhhR3JhcGgiLCJhbHBoYUdyYXBoMiIsInJvdGF0aW9uU3BlZWRHcmFwaCIsInJvdGF0aW9uU3BlZWRHcmFwaDIiLCJyYWRpYWxTcGVlZEdyYXBoIiwicmFkaWFsU3BlZWRHcmFwaDIiLCJzY2FsZUdyYXBoIiwic2NhbGVHcmFwaDIiLCJvbiIsIm9uQmVmb3JlUmVtb3ZlIiwic3lzdGVtcyIsIm9uVXBkYXRlIiwiaW5pdGlhbGl6ZUNvbXBvbmVudERhdGEiLCJjb21wb25lbnQiLCJfZGF0YSIsInByb3BlcnRpZXMiLCJkYXRhIiwidHlwZXMiLCJtZXNoIiwiQXNzZXQiLCJtZXNoQXNzZXQiLCJwcm9wIiwiaGFzT3duUHJvcGVydHkiLCJwdXNoIiwiQXJyYXkiLCJpc0FycmF5IiwiVmVjMyIsIkN1cnZlIiwidCIsInR5cGUiLCJrZXlzIiwiQ3VydmVTZXQiLCJsYXllcnMiLCJzbGljZSIsImNsb25lQ29tcG9uZW50IiwiZW50aXR5IiwiY2xvbmUiLCJzb3VyY2UiLCJwYXJ0aWNsZXN5c3RlbSIsImkiLCJsZW4iLCJsZW5ndGgiLCJzb3VyY2VQcm9wIiwidW5kZWZpbmVkIiwiYWRkQ29tcG9uZW50IiwiZHQiLCJjb21wb25lbnRzIiwic3RvcmUiLCJudW1TdGVwcyIsInN0YXRzIiwicGFydGljbGVzIiwiY29tcG9zaXRpb24iLCJzY2VuZSIsImxheWVyTGlzdCIsInJlcXVpcmVzTGlnaHRDdWJlIiwiZW5hYmxlZCIsImVtaXR0ZXIiLCJtZXNoSW5zdGFuY2UiLCJ2aXNpYmxlIiwibGlnaHRpbmciLCJsYXllciIsImdldExheWVyQnlJZCIsInBhdXNlZCIsInNpbVRpbWUiLCJmaXhlZFRpbWVTdGVwIiwiTWF0aCIsImZsb29yIiwibWluIiwibWF4U3ViU3RlcHMiLCJhZGRUaW1lIiwiX3VwZGF0ZXNQZXJGcmFtZSIsIl9mcmFtZVRpbWUiLCJfYWRkVGltZVRpbWUiLCJmaW5pc2hGcmFtZSIsImRl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
