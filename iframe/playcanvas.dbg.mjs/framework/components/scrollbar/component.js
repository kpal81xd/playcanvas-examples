import { math } from '../../../core/math/math.js';
import { ORIENTATION_HORIZONTAL } from '../../../scene/constants.js';
import { Component } from '../component.js';
import { ElementDragHelper } from '../element/element-drag-helper.js';
import { EntityReference } from '../../utils/entity-reference.js';

/**
 * A ScrollbarComponent enables a group of entities to behave like a draggable scrollbar.
 *
 * @property {number} orientation Whether the scrollbar moves horizontally or vertically. Can be:
 *
 * - {@link ORIENTATION_HORIZONTAL}: The scrollbar animates in the horizontal axis.
 * - {@link ORIENTATION_VERTICAL}: The scrollbar animates in the vertical axis.
 *
 * Defaults to {@link ORIENTATION_HORIZONTAL}.
 * @property {number} value The current position value of the scrollbar, in the range 0 to 1.
 * Defaults to 0.
 * @property {number} handleSize The size of the handle relative to the size of the track, in the
 * range 0 to 1. For a vertical scrollbar, a value of 1 means that the handle will take up the full
 * height of the track.
 * @property {import('../../entity.js').Entity} handleEntity The entity to be used as the scrollbar
 * handle. This entity must have a Scrollbar component.
 * @augments Component
 * @category User Interface
 */
class ScrollbarComponent extends Component {
  /**
   * Create a new ScrollbarComponent.
   *
   * @param {import('./system.js').ScrollbarComponentSystem} system - The ComponentSystem that
   * created this Component.
   * @param {import('../../entity.js').Entity} entity - The Entity that this Component is
   * attached to.
   */
  constructor(system, entity) {
    super(system, entity);
    this._handleReference = new EntityReference(this, 'handleEntity', {
      'element#gain': this._onHandleElementGain,
      'element#lose': this._onHandleElementLose,
      'element#set:anchor': this._onSetHandleAlignment,
      'element#set:margin': this._onSetHandleAlignment,
      'element#set:pivot': this._onSetHandleAlignment
    });
    this._toggleLifecycleListeners('on');
  }

  /**
   * @param {string} onOrOff - 'on' or 'off'.
   * @private
   */
  _toggleLifecycleListeners(onOrOff) {
    this[onOrOff]('set_value', this._onSetValue, this);
    this[onOrOff]('set_handleSize', this._onSetHandleSize, this);
    this[onOrOff]('set_orientation', this._onSetOrientation, this);

    // TODO Handle scrollwheel events
  }

  _onHandleElementGain() {
    this._destroyDragHelper();
    this._handleDragHelper = new ElementDragHelper(this._handleReference.entity.element, this._getAxis());
    this._handleDragHelper.on('drag:move', this._onHandleDrag, this);
    this._updateHandlePositionAndSize();
  }
  _onHandleElementLose() {
    this._destroyDragHelper();
  }
  _onHandleDrag(position) {
    if (this._handleReference.entity && this.enabled && this.entity.enabled) {
      this.value = this._handlePositionToScrollValue(position[this._getAxis()]);
    }
  }
  _onSetValue(name, oldValue, newValue) {
    if (Math.abs(newValue - oldValue) > 1e-5) {
      this.data.value = math.clamp(newValue, 0, 1);
      this._updateHandlePositionAndSize();
      this.fire('set:value', this.data.value);
    }
  }
  _onSetHandleSize(name, oldValue, newValue) {
    if (Math.abs(newValue - oldValue) > 1e-5) {
      this.data.handleSize = math.clamp(newValue, 0, 1);
      this._updateHandlePositionAndSize();
    }
  }
  _onSetHandleAlignment() {
    this._updateHandlePositionAndSize();
  }
  _onSetOrientation(name, oldValue, newValue) {
    if (newValue !== oldValue && this._handleReference.hasComponent('element')) {
      this._handleReference.entity.element[this._getOppositeDimension()] = 0;
    }
  }
  _updateHandlePositionAndSize() {
    const handleEntity = this._handleReference.entity;
    const handleElement = handleEntity && handleEntity.element;
    if (handleEntity) {
      const position = handleEntity.getLocalPosition();
      position[this._getAxis()] = this._getHandlePosition();
      this._handleReference.entity.setLocalPosition(position);
    }
    if (handleElement) {
      handleElement[this._getDimension()] = this._getHandleLength();
    }
  }
  _handlePositionToScrollValue(handlePosition) {
    return handlePosition * this._getSign() / this._getUsableTrackLength();
  }
  _scrollValueToHandlePosition(value) {
    return value * this._getSign() * this._getUsableTrackLength();
  }
  _getUsableTrackLength() {
    return Math.max(this._getTrackLength() - this._getHandleLength(), 0.001);
  }
  _getTrackLength() {
    if (this.entity.element) {
      return this.orientation === ORIENTATION_HORIZONTAL ? this.entity.element.calculatedWidth : this.entity.element.calculatedHeight;
    }
    return 0;
  }
  _getHandleLength() {
    return this._getTrackLength() * this.handleSize;
  }
  _getHandlePosition() {
    return this._scrollValueToHandlePosition(this.value);
  }
  _getSign() {
    return this.orientation === ORIENTATION_HORIZONTAL ? 1 : -1;
  }
  _getAxis() {
    return this.orientation === ORIENTATION_HORIZONTAL ? 'x' : 'y';
  }
  _getDimension() {
    return this.orientation === ORIENTATION_HORIZONTAL ? 'width' : 'height';
  }
  _getOppositeDimension() {
    return this.orientation === ORIENTATION_HORIZONTAL ? 'height' : 'width';
  }
  _destroyDragHelper() {
    if (this._handleDragHelper) {
      this._handleDragHelper.destroy();
    }
  }
  _setHandleDraggingEnabled(enabled) {
    if (this._handleDragHelper) {
      this._handleDragHelper.enabled = enabled;
    }
  }
  onEnable() {
    this._handleReference.onParentComponentEnable();
    this._setHandleDraggingEnabled(true);
  }
  onDisable() {
    this._setHandleDraggingEnabled(false);
  }
  onRemove() {
    this._destroyDragHelper();
    this._toggleLifecycleListeners('off');
  }
}
/**
 * Fired whenever the scroll value changes. The handler is passed a number representing the
 * current scroll value.
 *
 * @event
 * @example
 * entity.scrollbar.on('set:value', (value) => {
 *     console.log(`Scroll value is now ${value}`);
 * });
 */
ScrollbarComponent.EVENT_SETVALUE = 'set:value';

export { ScrollbarComponent };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2NvbXBvbmVudHMvc2Nyb2xsYmFyL2NvbXBvbmVudC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBtYXRoIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9tYXRoL21hdGguanMnO1xuXG5pbXBvcnQgeyBPUklFTlRBVElPTl9IT1JJWk9OVEFMIH0gZnJvbSAnLi4vLi4vLi4vc2NlbmUvY29uc3RhbnRzLmpzJztcblxuaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnLi4vY29tcG9uZW50LmpzJztcblxuaW1wb3J0IHsgRWxlbWVudERyYWdIZWxwZXIgfSBmcm9tICcuLi9lbGVtZW50L2VsZW1lbnQtZHJhZy1oZWxwZXIuanMnO1xuXG5pbXBvcnQgeyBFbnRpdHlSZWZlcmVuY2UgfSBmcm9tICcuLi8uLi91dGlscy9lbnRpdHktcmVmZXJlbmNlLmpzJztcblxuLyoqXG4gKiBBIFNjcm9sbGJhckNvbXBvbmVudCBlbmFibGVzIGEgZ3JvdXAgb2YgZW50aXRpZXMgdG8gYmVoYXZlIGxpa2UgYSBkcmFnZ2FibGUgc2Nyb2xsYmFyLlxuICpcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBvcmllbnRhdGlvbiBXaGV0aGVyIHRoZSBzY3JvbGxiYXIgbW92ZXMgaG9yaXpvbnRhbGx5IG9yIHZlcnRpY2FsbHkuIENhbiBiZTpcbiAqXG4gKiAtIHtAbGluayBPUklFTlRBVElPTl9IT1JJWk9OVEFMfTogVGhlIHNjcm9sbGJhciBhbmltYXRlcyBpbiB0aGUgaG9yaXpvbnRhbCBheGlzLlxuICogLSB7QGxpbmsgT1JJRU5UQVRJT05fVkVSVElDQUx9OiBUaGUgc2Nyb2xsYmFyIGFuaW1hdGVzIGluIHRoZSB2ZXJ0aWNhbCBheGlzLlxuICpcbiAqIERlZmF1bHRzIHRvIHtAbGluayBPUklFTlRBVElPTl9IT1JJWk9OVEFMfS5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB2YWx1ZSBUaGUgY3VycmVudCBwb3NpdGlvbiB2YWx1ZSBvZiB0aGUgc2Nyb2xsYmFyLCBpbiB0aGUgcmFuZ2UgMCB0byAxLlxuICogRGVmYXVsdHMgdG8gMC5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBoYW5kbGVTaXplIFRoZSBzaXplIG9mIHRoZSBoYW5kbGUgcmVsYXRpdmUgdG8gdGhlIHNpemUgb2YgdGhlIHRyYWNrLCBpbiB0aGVcbiAqIHJhbmdlIDAgdG8gMS4gRm9yIGEgdmVydGljYWwgc2Nyb2xsYmFyLCBhIHZhbHVlIG9mIDEgbWVhbnMgdGhhdCB0aGUgaGFuZGxlIHdpbGwgdGFrZSB1cCB0aGUgZnVsbFxuICogaGVpZ2h0IG9mIHRoZSB0cmFjay5cbiAqIEBwcm9wZXJ0eSB7aW1wb3J0KCcuLi8uLi9lbnRpdHkuanMnKS5FbnRpdHl9IGhhbmRsZUVudGl0eSBUaGUgZW50aXR5IHRvIGJlIHVzZWQgYXMgdGhlIHNjcm9sbGJhclxuICogaGFuZGxlLiBUaGlzIGVudGl0eSBtdXN0IGhhdmUgYSBTY3JvbGxiYXIgY29tcG9uZW50LlxuICogQGF1Z21lbnRzIENvbXBvbmVudFxuICogQGNhdGVnb3J5IFVzZXIgSW50ZXJmYWNlXG4gKi9cbmNsYXNzIFNjcm9sbGJhckNvbXBvbmVudCBleHRlbmRzIENvbXBvbmVudCB7XG4gICAgLyoqXG4gICAgICogRmlyZWQgd2hlbmV2ZXIgdGhlIHNjcm9sbCB2YWx1ZSBjaGFuZ2VzLiBUaGUgaGFuZGxlciBpcyBwYXNzZWQgYSBudW1iZXIgcmVwcmVzZW50aW5nIHRoZVxuICAgICAqIGN1cnJlbnQgc2Nyb2xsIHZhbHVlLlxuICAgICAqXG4gICAgICogQGV2ZW50XG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBlbnRpdHkuc2Nyb2xsYmFyLm9uKCdzZXQ6dmFsdWUnLCAodmFsdWUpID0+IHtcbiAgICAgKiAgICAgY29uc29sZS5sb2coYFNjcm9sbCB2YWx1ZSBpcyBub3cgJHt2YWx1ZX1gKTtcbiAgICAgKiB9KTtcbiAgICAgKi9cbiAgICBzdGF0aWMgRVZFTlRfU0VUVkFMVUUgPSAnc2V0OnZhbHVlJztcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBTY3JvbGxiYXJDb21wb25lbnQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi9zeXN0ZW0uanMnKS5TY3JvbGxiYXJDb21wb25lbnRTeXN0ZW19IHN5c3RlbSAtIFRoZSBDb21wb25lbnRTeXN0ZW0gdGhhdFxuICAgICAqIGNyZWF0ZWQgdGhpcyBDb21wb25lbnQuXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uLy4uL2VudGl0eS5qcycpLkVudGl0eX0gZW50aXR5IC0gVGhlIEVudGl0eSB0aGF0IHRoaXMgQ29tcG9uZW50IGlzXG4gICAgICogYXR0YWNoZWQgdG8uXG4gICAgICovXG4gICAgY29uc3RydWN0b3Ioc3lzdGVtLCBlbnRpdHkpIHtcbiAgICAgICAgc3VwZXIoc3lzdGVtLCBlbnRpdHkpO1xuXG4gICAgICAgIHRoaXMuX2hhbmRsZVJlZmVyZW5jZSA9IG5ldyBFbnRpdHlSZWZlcmVuY2UodGhpcywgJ2hhbmRsZUVudGl0eScsIHtcbiAgICAgICAgICAgICdlbGVtZW50I2dhaW4nOiB0aGlzLl9vbkhhbmRsZUVsZW1lbnRHYWluLFxuICAgICAgICAgICAgJ2VsZW1lbnQjbG9zZSc6IHRoaXMuX29uSGFuZGxlRWxlbWVudExvc2UsXG4gICAgICAgICAgICAnZWxlbWVudCNzZXQ6YW5jaG9yJzogdGhpcy5fb25TZXRIYW5kbGVBbGlnbm1lbnQsXG4gICAgICAgICAgICAnZWxlbWVudCNzZXQ6bWFyZ2luJzogdGhpcy5fb25TZXRIYW5kbGVBbGlnbm1lbnQsXG4gICAgICAgICAgICAnZWxlbWVudCNzZXQ6cGl2b3QnOiB0aGlzLl9vblNldEhhbmRsZUFsaWdubWVudFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLl90b2dnbGVMaWZlY3ljbGVMaXN0ZW5lcnMoJ29uJyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG9uT3JPZmYgLSAnb24nIG9yICdvZmYnLlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3RvZ2dsZUxpZmVjeWNsZUxpc3RlbmVycyhvbk9yT2ZmKSB7XG4gICAgICAgIHRoaXNbb25Pck9mZl0oJ3NldF92YWx1ZScsIHRoaXMuX29uU2V0VmFsdWUsIHRoaXMpO1xuICAgICAgICB0aGlzW29uT3JPZmZdKCdzZXRfaGFuZGxlU2l6ZScsIHRoaXMuX29uU2V0SGFuZGxlU2l6ZSwgdGhpcyk7XG4gICAgICAgIHRoaXNbb25Pck9mZl0oJ3NldF9vcmllbnRhdGlvbicsIHRoaXMuX29uU2V0T3JpZW50YXRpb24sIHRoaXMpO1xuXG4gICAgICAgIC8vIFRPRE8gSGFuZGxlIHNjcm9sbHdoZWVsIGV2ZW50c1xuICAgIH1cblxuICAgIF9vbkhhbmRsZUVsZW1lbnRHYWluKCkge1xuICAgICAgICB0aGlzLl9kZXN0cm95RHJhZ0hlbHBlcigpO1xuICAgICAgICB0aGlzLl9oYW5kbGVEcmFnSGVscGVyID0gbmV3IEVsZW1lbnREcmFnSGVscGVyKHRoaXMuX2hhbmRsZVJlZmVyZW5jZS5lbnRpdHkuZWxlbWVudCwgdGhpcy5fZ2V0QXhpcygpKTtcbiAgICAgICAgdGhpcy5faGFuZGxlRHJhZ0hlbHBlci5vbignZHJhZzptb3ZlJywgdGhpcy5fb25IYW5kbGVEcmFnLCB0aGlzKTtcblxuICAgICAgICB0aGlzLl91cGRhdGVIYW5kbGVQb3NpdGlvbkFuZFNpemUoKTtcbiAgICB9XG5cbiAgICBfb25IYW5kbGVFbGVtZW50TG9zZSgpIHtcbiAgICAgICAgdGhpcy5fZGVzdHJveURyYWdIZWxwZXIoKTtcbiAgICB9XG5cbiAgICBfb25IYW5kbGVEcmFnKHBvc2l0aW9uKSB7XG4gICAgICAgIGlmICh0aGlzLl9oYW5kbGVSZWZlcmVuY2UuZW50aXR5ICYmIHRoaXMuZW5hYmxlZCAmJiB0aGlzLmVudGl0eS5lbmFibGVkKSB7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5faGFuZGxlUG9zaXRpb25Ub1Njcm9sbFZhbHVlKHBvc2l0aW9uW3RoaXMuX2dldEF4aXMoKV0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX29uU2V0VmFsdWUobmFtZSwgb2xkVmFsdWUsIG5ld1ZhbHVlKSB7XG4gICAgICAgIGlmIChNYXRoLmFicyhuZXdWYWx1ZSAtIG9sZFZhbHVlKSA+IDFlLTUpIHtcbiAgICAgICAgICAgIHRoaXMuZGF0YS52YWx1ZSA9IG1hdGguY2xhbXAobmV3VmFsdWUsIDAsIDEpO1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlSGFuZGxlUG9zaXRpb25BbmRTaXplKCk7XG4gICAgICAgICAgICB0aGlzLmZpcmUoJ3NldDp2YWx1ZScsIHRoaXMuZGF0YS52YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfb25TZXRIYW5kbGVTaXplKG5hbWUsIG9sZFZhbHVlLCBuZXdWYWx1ZSkge1xuICAgICAgICBpZiAoTWF0aC5hYnMobmV3VmFsdWUgLSBvbGRWYWx1ZSkgPiAxZS01KSB7XG4gICAgICAgICAgICB0aGlzLmRhdGEuaGFuZGxlU2l6ZSA9IG1hdGguY2xhbXAobmV3VmFsdWUsIDAsIDEpO1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlSGFuZGxlUG9zaXRpb25BbmRTaXplKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfb25TZXRIYW5kbGVBbGlnbm1lbnQoKSB7XG4gICAgICAgIHRoaXMuX3VwZGF0ZUhhbmRsZVBvc2l0aW9uQW5kU2l6ZSgpO1xuICAgIH1cblxuICAgIF9vblNldE9yaWVudGF0aW9uKG5hbWUsIG9sZFZhbHVlLCBuZXdWYWx1ZSkge1xuICAgICAgICBpZiAobmV3VmFsdWUgIT09IG9sZFZhbHVlICYmIHRoaXMuX2hhbmRsZVJlZmVyZW5jZS5oYXNDb21wb25lbnQoJ2VsZW1lbnQnKSkge1xuICAgICAgICAgICAgdGhpcy5faGFuZGxlUmVmZXJlbmNlLmVudGl0eS5lbGVtZW50W3RoaXMuX2dldE9wcG9zaXRlRGltZW5zaW9uKCldID0gMDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF91cGRhdGVIYW5kbGVQb3NpdGlvbkFuZFNpemUoKSB7XG4gICAgICAgIGNvbnN0IGhhbmRsZUVudGl0eSA9IHRoaXMuX2hhbmRsZVJlZmVyZW5jZS5lbnRpdHk7XG4gICAgICAgIGNvbnN0IGhhbmRsZUVsZW1lbnQgPSBoYW5kbGVFbnRpdHkgJiYgaGFuZGxlRW50aXR5LmVsZW1lbnQ7XG5cbiAgICAgICAgaWYgKGhhbmRsZUVudGl0eSkge1xuICAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSBoYW5kbGVFbnRpdHkuZ2V0TG9jYWxQb3NpdGlvbigpO1xuICAgICAgICAgICAgcG9zaXRpb25bdGhpcy5fZ2V0QXhpcygpXSA9IHRoaXMuX2dldEhhbmRsZVBvc2l0aW9uKCk7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVSZWZlcmVuY2UuZW50aXR5LnNldExvY2FsUG9zaXRpb24ocG9zaXRpb24pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGhhbmRsZUVsZW1lbnQpIHtcbiAgICAgICAgICAgIGhhbmRsZUVsZW1lbnRbdGhpcy5fZ2V0RGltZW5zaW9uKCldID0gdGhpcy5fZ2V0SGFuZGxlTGVuZ3RoKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfaGFuZGxlUG9zaXRpb25Ub1Njcm9sbFZhbHVlKGhhbmRsZVBvc2l0aW9uKSB7XG4gICAgICAgIHJldHVybiBoYW5kbGVQb3NpdGlvbiAqIHRoaXMuX2dldFNpZ24oKSAvIHRoaXMuX2dldFVzYWJsZVRyYWNrTGVuZ3RoKCk7XG4gICAgfVxuXG4gICAgX3Njcm9sbFZhbHVlVG9IYW5kbGVQb3NpdGlvbih2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdmFsdWUgKiB0aGlzLl9nZXRTaWduKCkgKiB0aGlzLl9nZXRVc2FibGVUcmFja0xlbmd0aCgpO1xuICAgIH1cblxuICAgIF9nZXRVc2FibGVUcmFja0xlbmd0aCgpIHtcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KHRoaXMuX2dldFRyYWNrTGVuZ3RoKCkgLSB0aGlzLl9nZXRIYW5kbGVMZW5ndGgoKSwgMC4wMDEpO1xuICAgIH1cblxuICAgIF9nZXRUcmFja0xlbmd0aCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZW50aXR5LmVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm9yaWVudGF0aW9uID09PSBPUklFTlRBVElPTl9IT1JJWk9OVEFMID8gdGhpcy5lbnRpdHkuZWxlbWVudC5jYWxjdWxhdGVkV2lkdGggOiB0aGlzLmVudGl0eS5lbGVtZW50LmNhbGN1bGF0ZWRIZWlnaHQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG5cbiAgICBfZ2V0SGFuZGxlTGVuZ3RoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZ2V0VHJhY2tMZW5ndGgoKSAqIHRoaXMuaGFuZGxlU2l6ZTtcbiAgICB9XG5cbiAgICBfZ2V0SGFuZGxlUG9zaXRpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zY3JvbGxWYWx1ZVRvSGFuZGxlUG9zaXRpb24odGhpcy52YWx1ZSk7XG4gICAgfVxuXG4gICAgX2dldFNpZ24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9yaWVudGF0aW9uID09PSBPUklFTlRBVElPTl9IT1JJWk9OVEFMID8gMSA6IC0xO1xuICAgIH1cblxuICAgIF9nZXRBeGlzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcmllbnRhdGlvbiA9PT0gT1JJRU5UQVRJT05fSE9SSVpPTlRBTCA/ICd4JyA6ICd5JztcbiAgICB9XG5cbiAgICBfZ2V0RGltZW5zaW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcmllbnRhdGlvbiA9PT0gT1JJRU5UQVRJT05fSE9SSVpPTlRBTCA/ICd3aWR0aCcgOiAnaGVpZ2h0JztcbiAgICB9XG5cbiAgICBfZ2V0T3Bwb3NpdGVEaW1lbnNpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9yaWVudGF0aW9uID09PSBPUklFTlRBVElPTl9IT1JJWk9OVEFMID8gJ2hlaWdodCcgOiAnd2lkdGgnO1xuICAgIH1cblxuICAgIF9kZXN0cm95RHJhZ0hlbHBlcigpIHtcbiAgICAgICAgaWYgKHRoaXMuX2hhbmRsZURyYWdIZWxwZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZURyYWdIZWxwZXIuZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX3NldEhhbmRsZURyYWdnaW5nRW5hYmxlZChlbmFibGVkKSB7XG4gICAgICAgIGlmICh0aGlzLl9oYW5kbGVEcmFnSGVscGVyKSB7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVEcmFnSGVscGVyLmVuYWJsZWQgPSBlbmFibGVkO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb25FbmFibGUoKSB7XG4gICAgICAgIHRoaXMuX2hhbmRsZVJlZmVyZW5jZS5vblBhcmVudENvbXBvbmVudEVuYWJsZSgpO1xuICAgICAgICB0aGlzLl9zZXRIYW5kbGVEcmFnZ2luZ0VuYWJsZWQodHJ1ZSk7XG4gICAgfVxuXG4gICAgb25EaXNhYmxlKCkge1xuICAgICAgICB0aGlzLl9zZXRIYW5kbGVEcmFnZ2luZ0VuYWJsZWQoZmFsc2UpO1xuICAgIH1cblxuICAgIG9uUmVtb3ZlKCkge1xuICAgICAgICB0aGlzLl9kZXN0cm95RHJhZ0hlbHBlcigpO1xuICAgICAgICB0aGlzLl90b2dnbGVMaWZlY3ljbGVMaXN0ZW5lcnMoJ29mZicpO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgU2Nyb2xsYmFyQ29tcG9uZW50IH07XG4iXSwibmFtZXMiOlsiU2Nyb2xsYmFyQ29tcG9uZW50IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJzeXN0ZW0iLCJlbnRpdHkiLCJfaGFuZGxlUmVmZXJlbmNlIiwiRW50aXR5UmVmZXJlbmNlIiwiX29uSGFuZGxlRWxlbWVudEdhaW4iLCJfb25IYW5kbGVFbGVtZW50TG9zZSIsIl9vblNldEhhbmRsZUFsaWdubWVudCIsIl90b2dnbGVMaWZlY3ljbGVMaXN0ZW5lcnMiLCJvbk9yT2ZmIiwiX29uU2V0VmFsdWUiLCJfb25TZXRIYW5kbGVTaXplIiwiX29uU2V0T3JpZW50YXRpb24iLCJfZGVzdHJveURyYWdIZWxwZXIiLCJfaGFuZGxlRHJhZ0hlbHBlciIsIkVsZW1lbnREcmFnSGVscGVyIiwiZWxlbWVudCIsIl9nZXRBeGlzIiwib24iLCJfb25IYW5kbGVEcmFnIiwiX3VwZGF0ZUhhbmRsZVBvc2l0aW9uQW5kU2l6ZSIsInBvc2l0aW9uIiwiZW5hYmxlZCIsInZhbHVlIiwiX2hhbmRsZVBvc2l0aW9uVG9TY3JvbGxWYWx1ZSIsIm5hbWUiLCJvbGRWYWx1ZSIsIm5ld1ZhbHVlIiwiTWF0aCIsImFicyIsImRhdGEiLCJtYXRoIiwiY2xhbXAiLCJmaXJlIiwiaGFuZGxlU2l6ZSIsImhhc0NvbXBvbmVudCIsIl9nZXRPcHBvc2l0ZURpbWVuc2lvbiIsImhhbmRsZUVudGl0eSIsImhhbmRsZUVsZW1lbnQiLCJnZXRMb2NhbFBvc2l0aW9uIiwiX2dldEhhbmRsZVBvc2l0aW9uIiwic2V0TG9jYWxQb3NpdGlvbiIsIl9nZXREaW1lbnNpb24iLCJfZ2V0SGFuZGxlTGVuZ3RoIiwiaGFuZGxlUG9zaXRpb24iLCJfZ2V0U2lnbiIsIl9nZXRVc2FibGVUcmFja0xlbmd0aCIsIl9zY3JvbGxWYWx1ZVRvSGFuZGxlUG9zaXRpb24iLCJtYXgiLCJfZ2V0VHJhY2tMZW5ndGgiLCJvcmllbnRhdGlvbiIsIk9SSUVOVEFUSU9OX0hPUklaT05UQUwiLCJjYWxjdWxhdGVkV2lkdGgiLCJjYWxjdWxhdGVkSGVpZ2h0IiwiZGVzdHJveSIsIl9zZXRIYW5kbGVEcmFnZ2luZ0VuYWJsZWQiLCJvbkVuYWJsZSIsIm9uUGFyZW50Q29tcG9uZW50RW5hYmxlIiwib25EaXNhYmxlIiwib25SZW1vdmUiLCJFVkVOVF9TRVRWQUxVRSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNQSxrQkFBa0IsU0FBU0MsU0FBUyxDQUFD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
