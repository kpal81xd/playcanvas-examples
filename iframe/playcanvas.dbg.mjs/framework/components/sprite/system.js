import { Color } from '../../../core/math/color.js';
import { PIXELFORMAT_RGBA8, CULLFACE_NONE } from '../../../platform/graphics/constants.js';
import { Texture } from '../../../platform/graphics/texture.js';
import { BLEND_PREMULTIPLIED, SPRITE_RENDERMODE_SLICED, SPRITE_RENDERMODE_TILED } from '../../../scene/constants.js';
import { StandardMaterial } from '../../../scene/materials/standard-material.js';
import { Component } from '../component.js';
import { ComponentSystem } from '../system.js';
import { SpriteComponent } from './component.js';
import { SpriteComponentData } from './data.js';

const _schema = ['enabled'];

/**
 * Manages creation of {@link SpriteComponent}s.
 *
 * @augments ComponentSystem
 * @category Graphics
 */
class SpriteComponentSystem extends ComponentSystem {
  /**
   * Create a new SpriteComponentSystem instance.
   *
   * @param {import('../../app-base.js').AppBase} app - The application.
   * @hideconstructor
   */
  constructor(app) {
    super(app);
    this.id = 'sprite';
    this.ComponentType = SpriteComponent;
    this.DataType = SpriteComponentData;
    this.schema = _schema;

    // default texture - make white so we can tint it with emissive color
    this._defaultTexture = null;

    // default material used by sprites
    this._defaultMaterial = null;

    // material used for 9-slicing in sliced mode
    this._default9SlicedMaterialSlicedMode = null;

    // material used for 9-slicing in tiled mode
    this._default9SlicedMaterialTiledMode = null;
    this.app.systems.on('update', this.onUpdate, this);
    this.on('beforeremove', this.onBeforeRemove, this);
  }
  set defaultMaterial(material) {
    this._defaultMaterial = material;
  }
  get defaultMaterial() {
    if (!this._defaultMaterial) {
      const texture = new Texture(this.app.graphicsDevice, {
        width: 1,
        height: 1,
        format: PIXELFORMAT_RGBA8,
        name: 'sprite'
      });
      const pixels = new Uint8Array(texture.lock());
      pixels[0] = pixels[1] = pixels[2] = pixels[3] = 255;
      texture.unlock();
      const material = new StandardMaterial();
      material.diffuse.set(0, 0, 0); // black diffuse color to prevent ambient light being included
      material.emissive.set(0.5, 0.5, 0.5); // use non-white to compile shader correctly
      material.emissiveMap = texture;
      material.emissiveTint = true;
      material.opacityMap = texture;
      material.opacityMapChannel = 'a';
      material.opacityTint = true;
      material.opacity = 0; // use non-1 opacity to compile shader correctly
      material.useLighting = false;
      material.useGammaTonemap = false;
      material.useFog = false;
      material.useSkybox = false;
      material.blendType = BLEND_PREMULTIPLIED;
      material.depthWrite = false;
      material.pixelSnap = false;
      material.cull = CULLFACE_NONE; // don't cull because we might flipX or flipY which uses negative scale on the graph node
      material.update();
      this._defaultTexture = texture;
      this._defaultMaterial = material;
    }
    return this._defaultMaterial;
  }
  set default9SlicedMaterialSlicedMode(material) {
    this._default9SlicedMaterialSlicedMode = material;
  }
  get default9SlicedMaterialSlicedMode() {
    if (!this._default9SlicedMaterialSlicedMode) {
      const material = this.defaultMaterial.clone();
      material.nineSlicedMode = SPRITE_RENDERMODE_SLICED;
      material.update();
      this._default9SlicedMaterialSlicedMode = material;
    }
    return this._default9SlicedMaterialSlicedMode;
  }
  set default9SlicedMaterialTiledMode(material) {
    this._default9SlicedMaterialTiledMode = material;
  }
  get default9SlicedMaterialTiledMode() {
    if (!this._default9SlicedMaterialTiledMode) {
      const material = this.defaultMaterial.clone();
      material.nineSlicedMode = SPRITE_RENDERMODE_TILED;
      material.update();
      this._default9SlicedMaterialTiledMode = material;
    }
    return this._default9SlicedMaterialTiledMode;
  }
  destroy() {
    super.destroy();
    this.app.systems.off('update', this.onUpdate, this);
    if (this._defaultTexture) {
      this._defaultTexture.destroy();
      this._defaultTexture = null;
    }
  }
  initializeComponentData(component, data, properties) {
    if (data.enabled !== undefined) {
      component.enabled = data.enabled;
    }
    component.type = data.type;
    if (data.layers && Array.isArray(data.layers)) {
      component.layers = data.layers.slice(0);
    }
    if (data.drawOrder !== undefined) {
      component.drawOrder = data.drawOrder;
    }
    if (data.color !== undefined) {
      if (data.color instanceof Color) {
        var _data$opacity;
        component.color.set(data.color.r, data.color.g, data.color.b, (_data$opacity = data.opacity) != null ? _data$opacity : 1);
      } else {
        var _data$opacity2;
        component.color.set(data.color[0], data.color[1], data.color[2], (_data$opacity2 = data.opacity) != null ? _data$opacity2 : 1);
      }

      /* eslint-disable no-self-assign */
      // force update
      component.color = component.color;
      /* eslint-enable no-self-assign */
    }

    if (data.opacity !== undefined) {
      component.opacity = data.opacity;
    }
    if (data.flipX !== undefined) {
      component.flipX = data.flipX;
    }
    if (data.flipY !== undefined) {
      component.flipY = data.flipY;
    }
    if (data.width !== undefined) {
      component.width = data.width;
    }
    if (data.height !== undefined) {
      component.height = data.height;
    }
    if (data.spriteAsset !== undefined) {
      component.spriteAsset = data.spriteAsset;
    }
    if (data.sprite) {
      component.sprite = data.sprite;
    }
    if (data.frame !== undefined) {
      component.frame = data.frame;
    }
    if (data.clips) {
      for (const name in data.clips) {
        component.addClip(data.clips[name]);
      }
    }
    if (data.speed !== undefined) {
      component.speed = data.speed;
    }
    if (data.autoPlayClip) {
      component.autoPlayClip = data.autoPlayClip;
    }
    component.batchGroupId = data.batchGroupId === undefined || data.batchGroupId === null ? -1 : data.batchGroupId;
    super.initializeComponentData(component, data, properties);
  }
  cloneComponent(entity, clone) {
    const source = entity.sprite;
    return this.addComponent(clone, {
      enabled: source.enabled,
      type: source.type,
      spriteAsset: source.spriteAsset,
      sprite: source.sprite,
      width: source.width,
      height: source.height,
      frame: source.frame,
      color: source.color.clone(),
      opacity: source.opacity,
      flipX: source.flipX,
      flipY: source.flipY,
      speed: source.speed,
      clips: source.clips,
      autoPlayClip: source.autoPlayClip,
      batchGroupId: source.batchGroupId,
      drawOrder: source.drawOrder,
      layers: source.layers.slice(0)
    });
  }
  onUpdate(dt) {
    const components = this.store;
    for (const id in components) {
      if (components.hasOwnProperty(id)) {
        const component = components[id];
        // if sprite component is enabled advance its current clip
        if (component.data.enabled && component.entity.enabled) {
          const sprite = component.entity.sprite;
          if (sprite._currentClip) {
            sprite._currentClip._update(dt);
          }
        }
      }
    }
  }
  onBeforeRemove(entity, component) {
    component.onDestroy();
  }
}
Component._buildAccessors(SpriteComponent.prototype, _schema);

export { SpriteComponentSystem };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3lzdGVtLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2NvbXBvbmVudHMvc3ByaXRlL3N5c3RlbS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb2xvciB9IGZyb20gJy4uLy4uLy4uL2NvcmUvbWF0aC9jb2xvci5qcyc7XG5cbmltcG9ydCB7XG4gICAgQ1VMTEZBQ0VfTk9ORSxcbiAgICBQSVhFTEZPUk1BVF9SR0JBOFxufSBmcm9tICcuLi8uLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgVGV4dHVyZSB9IGZyb20gJy4uLy4uLy4uL3BsYXRmb3JtL2dyYXBoaWNzL3RleHR1cmUuanMnO1xuXG5pbXBvcnQgeyBCTEVORF9QUkVNVUxUSVBMSUVELCBTUFJJVEVfUkVOREVSTU9ERV9TTElDRUQsIFNQUklURV9SRU5ERVJNT0RFX1RJTEVEIH0gZnJvbSAnLi4vLi4vLi4vc2NlbmUvY29uc3RhbnRzLmpzJztcbmltcG9ydCB7IFN0YW5kYXJkTWF0ZXJpYWwgfSBmcm9tICcuLi8uLi8uLi9zY2VuZS9tYXRlcmlhbHMvc3RhbmRhcmQtbWF0ZXJpYWwuanMnO1xuXG5pbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tICcuLi9jb21wb25lbnQuanMnO1xuaW1wb3J0IHsgQ29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi4vc3lzdGVtLmpzJztcblxuaW1wb3J0IHsgU3ByaXRlQ29tcG9uZW50IH0gZnJvbSAnLi9jb21wb25lbnQuanMnO1xuaW1wb3J0IHsgU3ByaXRlQ29tcG9uZW50RGF0YSB9IGZyb20gJy4vZGF0YS5qcyc7XG5cbmNvbnN0IF9zY2hlbWEgPSBbJ2VuYWJsZWQnXTtcblxuLyoqXG4gKiBNYW5hZ2VzIGNyZWF0aW9uIG9mIHtAbGluayBTcHJpdGVDb21wb25lbnR9cy5cbiAqXG4gKiBAYXVnbWVudHMgQ29tcG9uZW50U3lzdGVtXG4gKiBAY2F0ZWdvcnkgR3JhcGhpY3NcbiAqL1xuY2xhc3MgU3ByaXRlQ29tcG9uZW50U3lzdGVtIGV4dGVuZHMgQ29tcG9uZW50U3lzdGVtIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgU3ByaXRlQ29tcG9uZW50U3lzdGVtIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uLy4uL2FwcC1iYXNlLmpzJykuQXBwQmFzZX0gYXBwIC0gVGhlIGFwcGxpY2F0aW9uLlxuICAgICAqIEBoaWRlY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihhcHApIHtcbiAgICAgICAgc3VwZXIoYXBwKTtcblxuICAgICAgICB0aGlzLmlkID0gJ3Nwcml0ZSc7XG5cbiAgICAgICAgdGhpcy5Db21wb25lbnRUeXBlID0gU3ByaXRlQ29tcG9uZW50O1xuICAgICAgICB0aGlzLkRhdGFUeXBlID0gU3ByaXRlQ29tcG9uZW50RGF0YTtcblxuICAgICAgICB0aGlzLnNjaGVtYSA9IF9zY2hlbWE7XG5cbiAgICAgICAgLy8gZGVmYXVsdCB0ZXh0dXJlIC0gbWFrZSB3aGl0ZSBzbyB3ZSBjYW4gdGludCBpdCB3aXRoIGVtaXNzaXZlIGNvbG9yXG4gICAgICAgIHRoaXMuX2RlZmF1bHRUZXh0dXJlID0gbnVsbDtcblxuICAgICAgICAvLyBkZWZhdWx0IG1hdGVyaWFsIHVzZWQgYnkgc3ByaXRlc1xuICAgICAgICB0aGlzLl9kZWZhdWx0TWF0ZXJpYWwgPSBudWxsO1xuXG4gICAgICAgIC8vIG1hdGVyaWFsIHVzZWQgZm9yIDktc2xpY2luZyBpbiBzbGljZWQgbW9kZVxuICAgICAgICB0aGlzLl9kZWZhdWx0OVNsaWNlZE1hdGVyaWFsU2xpY2VkTW9kZSA9IG51bGw7XG5cbiAgICAgICAgLy8gbWF0ZXJpYWwgdXNlZCBmb3IgOS1zbGljaW5nIGluIHRpbGVkIG1vZGVcbiAgICAgICAgdGhpcy5fZGVmYXVsdDlTbGljZWRNYXRlcmlhbFRpbGVkTW9kZSA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5hcHAuc3lzdGVtcy5vbigndXBkYXRlJywgdGhpcy5vblVwZGF0ZSwgdGhpcyk7XG4gICAgICAgIHRoaXMub24oJ2JlZm9yZXJlbW92ZScsIHRoaXMub25CZWZvcmVSZW1vdmUsIHRoaXMpO1xuICAgIH1cblxuICAgIHNldCBkZWZhdWx0TWF0ZXJpYWwobWF0ZXJpYWwpIHtcbiAgICAgICAgdGhpcy5fZGVmYXVsdE1hdGVyaWFsID0gbWF0ZXJpYWw7XG4gICAgfVxuXG4gICAgZ2V0IGRlZmF1bHRNYXRlcmlhbCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9kZWZhdWx0TWF0ZXJpYWwpIHtcbiAgICAgICAgICAgIGNvbnN0IHRleHR1cmUgPSBuZXcgVGV4dHVyZSh0aGlzLmFwcC5ncmFwaGljc0RldmljZSwge1xuICAgICAgICAgICAgICAgIHdpZHRoOiAxLFxuICAgICAgICAgICAgICAgIGhlaWdodDogMSxcbiAgICAgICAgICAgICAgICBmb3JtYXQ6IFBJWEVMRk9STUFUX1JHQkE4LFxuICAgICAgICAgICAgICAgIG5hbWU6ICdzcHJpdGUnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IHBpeGVscyA9IG5ldyBVaW50OEFycmF5KHRleHR1cmUubG9jaygpKTtcbiAgICAgICAgICAgIHBpeGVsc1swXSA9IHBpeGVsc1sxXSA9IHBpeGVsc1syXSA9IHBpeGVsc1szXSA9IDI1NTtcbiAgICAgICAgICAgIHRleHR1cmUudW5sb2NrKCk7XG5cbiAgICAgICAgICAgIGNvbnN0IG1hdGVyaWFsID0gbmV3IFN0YW5kYXJkTWF0ZXJpYWwoKTtcbiAgICAgICAgICAgIG1hdGVyaWFsLmRpZmZ1c2Uuc2V0KDAsIDAsIDApOyAvLyBibGFjayBkaWZmdXNlIGNvbG9yIHRvIHByZXZlbnQgYW1iaWVudCBsaWdodCBiZWluZyBpbmNsdWRlZFxuICAgICAgICAgICAgbWF0ZXJpYWwuZW1pc3NpdmUuc2V0KDAuNSwgMC41LCAwLjUpOyAvLyB1c2Ugbm9uLXdoaXRlIHRvIGNvbXBpbGUgc2hhZGVyIGNvcnJlY3RseVxuICAgICAgICAgICAgbWF0ZXJpYWwuZW1pc3NpdmVNYXAgPSB0ZXh0dXJlO1xuICAgICAgICAgICAgbWF0ZXJpYWwuZW1pc3NpdmVUaW50ID0gdHJ1ZTtcbiAgICAgICAgICAgIG1hdGVyaWFsLm9wYWNpdHlNYXAgPSB0ZXh0dXJlO1xuICAgICAgICAgICAgbWF0ZXJpYWwub3BhY2l0eU1hcENoYW5uZWwgPSAnYSc7XG4gICAgICAgICAgICBtYXRlcmlhbC5vcGFjaXR5VGludCA9IHRydWU7XG4gICAgICAgICAgICBtYXRlcmlhbC5vcGFjaXR5ID0gMDsgLy8gdXNlIG5vbi0xIG9wYWNpdHkgdG8gY29tcGlsZSBzaGFkZXIgY29ycmVjdGx5XG4gICAgICAgICAgICBtYXRlcmlhbC51c2VMaWdodGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgbWF0ZXJpYWwudXNlR2FtbWFUb25lbWFwID0gZmFsc2U7XG4gICAgICAgICAgICBtYXRlcmlhbC51c2VGb2cgPSBmYWxzZTtcbiAgICAgICAgICAgIG1hdGVyaWFsLnVzZVNreWJveCA9IGZhbHNlO1xuICAgICAgICAgICAgbWF0ZXJpYWwuYmxlbmRUeXBlID0gQkxFTkRfUFJFTVVMVElQTElFRDtcbiAgICAgICAgICAgIG1hdGVyaWFsLmRlcHRoV3JpdGUgPSBmYWxzZTtcbiAgICAgICAgICAgIG1hdGVyaWFsLnBpeGVsU25hcCA9IGZhbHNlO1xuICAgICAgICAgICAgbWF0ZXJpYWwuY3VsbCA9IENVTExGQUNFX05PTkU7IC8vIGRvbid0IGN1bGwgYmVjYXVzZSB3ZSBtaWdodCBmbGlwWCBvciBmbGlwWSB3aGljaCB1c2VzIG5lZ2F0aXZlIHNjYWxlIG9uIHRoZSBncmFwaCBub2RlXG4gICAgICAgICAgICBtYXRlcmlhbC51cGRhdGUoKTtcblxuICAgICAgICAgICAgdGhpcy5fZGVmYXVsdFRleHR1cmUgPSB0ZXh0dXJlO1xuICAgICAgICAgICAgdGhpcy5fZGVmYXVsdE1hdGVyaWFsID0gbWF0ZXJpYWw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2RlZmF1bHRNYXRlcmlhbDtcbiAgICB9XG5cbiAgICBzZXQgZGVmYXVsdDlTbGljZWRNYXRlcmlhbFNsaWNlZE1vZGUobWF0ZXJpYWwpIHtcbiAgICAgICAgdGhpcy5fZGVmYXVsdDlTbGljZWRNYXRlcmlhbFNsaWNlZE1vZGUgPSBtYXRlcmlhbDtcbiAgICB9XG5cbiAgICBnZXQgZGVmYXVsdDlTbGljZWRNYXRlcmlhbFNsaWNlZE1vZGUoKSB7XG4gICAgICAgIGlmICghdGhpcy5fZGVmYXVsdDlTbGljZWRNYXRlcmlhbFNsaWNlZE1vZGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGVyaWFsID0gdGhpcy5kZWZhdWx0TWF0ZXJpYWwuY2xvbmUoKTtcbiAgICAgICAgICAgIG1hdGVyaWFsLm5pbmVTbGljZWRNb2RlID0gU1BSSVRFX1JFTkRFUk1PREVfU0xJQ0VEO1xuICAgICAgICAgICAgbWF0ZXJpYWwudXBkYXRlKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2RlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxTbGljZWRNb2RlID0gbWF0ZXJpYWw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2RlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxTbGljZWRNb2RlO1xuICAgIH1cblxuICAgIHNldCBkZWZhdWx0OVNsaWNlZE1hdGVyaWFsVGlsZWRNb2RlKG1hdGVyaWFsKSB7XG4gICAgICAgIHRoaXMuX2RlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxUaWxlZE1vZGUgPSBtYXRlcmlhbDtcbiAgICB9XG5cbiAgICBnZXQgZGVmYXVsdDlTbGljZWRNYXRlcmlhbFRpbGVkTW9kZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9kZWZhdWx0OVNsaWNlZE1hdGVyaWFsVGlsZWRNb2RlKSB7XG4gICAgICAgICAgICBjb25zdCBtYXRlcmlhbCA9IHRoaXMuZGVmYXVsdE1hdGVyaWFsLmNsb25lKCk7XG4gICAgICAgICAgICBtYXRlcmlhbC5uaW5lU2xpY2VkTW9kZSA9IFNQUklURV9SRU5ERVJNT0RFX1RJTEVEO1xuICAgICAgICAgICAgbWF0ZXJpYWwudXBkYXRlKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2RlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxUaWxlZE1vZGUgPSBtYXRlcmlhbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fZGVmYXVsdDlTbGljZWRNYXRlcmlhbFRpbGVkTW9kZTtcbiAgICB9XG5cbiAgICBkZXN0cm95KCkge1xuICAgICAgICBzdXBlci5kZXN0cm95KCk7XG5cbiAgICAgICAgdGhpcy5hcHAuc3lzdGVtcy5vZmYoJ3VwZGF0ZScsIHRoaXMub25VcGRhdGUsIHRoaXMpO1xuXG4gICAgICAgIGlmICh0aGlzLl9kZWZhdWx0VGV4dHVyZSkge1xuICAgICAgICAgICAgdGhpcy5fZGVmYXVsdFRleHR1cmUuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5fZGVmYXVsdFRleHR1cmUgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaW5pdGlhbGl6ZUNvbXBvbmVudERhdGEoY29tcG9uZW50LCBkYXRhLCBwcm9wZXJ0aWVzKSB7XG4gICAgICAgIGlmIChkYXRhLmVuYWJsZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29tcG9uZW50LmVuYWJsZWQgPSBkYXRhLmVuYWJsZWQ7XG4gICAgICAgIH1cblxuICAgICAgICBjb21wb25lbnQudHlwZSA9IGRhdGEudHlwZTtcblxuICAgICAgICBpZiAoZGF0YS5sYXllcnMgJiYgQXJyYXkuaXNBcnJheShkYXRhLmxheWVycykpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5sYXllcnMgPSBkYXRhLmxheWVycy5zbGljZSgwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhLmRyYXdPcmRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb21wb25lbnQuZHJhd09yZGVyID0gZGF0YS5kcmF3T3JkZXI7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YS5jb2xvciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZiAoZGF0YS5jb2xvciBpbnN0YW5jZW9mIENvbG9yKSB7XG4gICAgICAgICAgICAgICAgY29tcG9uZW50LmNvbG9yLnNldChkYXRhLmNvbG9yLnIsIGRhdGEuY29sb3IuZywgZGF0YS5jb2xvci5iLCBkYXRhLm9wYWNpdHkgPz8gMSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbXBvbmVudC5jb2xvci5zZXQoZGF0YS5jb2xvclswXSwgZGF0YS5jb2xvclsxXSwgZGF0YS5jb2xvclsyXSwgZGF0YS5vcGFjaXR5ID8/IDEpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1zZWxmLWFzc2lnbiAqL1xuICAgICAgICAgICAgLy8gZm9yY2UgdXBkYXRlXG4gICAgICAgICAgICBjb21wb25lbnQuY29sb3IgPSBjb21wb25lbnQuY29sb3I7XG4gICAgICAgICAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLXNlbGYtYXNzaWduICovXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YS5vcGFjaXR5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5vcGFjaXR5ID0gZGF0YS5vcGFjaXR5O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRhdGEuZmxpcFggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29tcG9uZW50LmZsaXBYID0gZGF0YS5mbGlwWDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhLmZsaXBZICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5mbGlwWSA9IGRhdGEuZmxpcFk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YS53aWR0aCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb21wb25lbnQud2lkdGggPSBkYXRhLndpZHRoO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRhdGEuaGVpZ2h0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5oZWlnaHQgPSBkYXRhLmhlaWdodDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhLnNwcml0ZUFzc2V0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5zcHJpdGVBc3NldCA9IGRhdGEuc3ByaXRlQXNzZXQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YS5zcHJpdGUpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5zcHJpdGUgPSBkYXRhLnNwcml0ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhLmZyYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5mcmFtZSA9IGRhdGEuZnJhbWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YS5jbGlwcykge1xuICAgICAgICAgICAgZm9yIChjb25zdCBuYW1lIGluIGRhdGEuY2xpcHMpIHtcbiAgICAgICAgICAgICAgICBjb21wb25lbnQuYWRkQ2xpcChkYXRhLmNsaXBzW25hbWVdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhLnNwZWVkICE9PSB1bmRlZmluZWQpICB7XG4gICAgICAgICAgICBjb21wb25lbnQuc3BlZWQgPSBkYXRhLnNwZWVkO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRhdGEuYXV0b1BsYXlDbGlwKSB7XG4gICAgICAgICAgICBjb21wb25lbnQuYXV0b1BsYXlDbGlwID0gZGF0YS5hdXRvUGxheUNsaXA7XG4gICAgICAgIH1cblxuICAgICAgICBjb21wb25lbnQuYmF0Y2hHcm91cElkID0gZGF0YS5iYXRjaEdyb3VwSWQgPT09IHVuZGVmaW5lZCB8fCBkYXRhLmJhdGNoR3JvdXBJZCA9PT0gbnVsbCA/IC0xIDogZGF0YS5iYXRjaEdyb3VwSWQ7XG5cbiAgICAgICAgc3VwZXIuaW5pdGlhbGl6ZUNvbXBvbmVudERhdGEoY29tcG9uZW50LCBkYXRhLCBwcm9wZXJ0aWVzKTtcbiAgICB9XG5cbiAgICBjbG9uZUNvbXBvbmVudChlbnRpdHksIGNsb25lKSB7XG4gICAgICAgIGNvbnN0IHNvdXJjZSA9IGVudGl0eS5zcHJpdGU7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkQ29tcG9uZW50KGNsb25lLCB7XG4gICAgICAgICAgICBlbmFibGVkOiBzb3VyY2UuZW5hYmxlZCxcbiAgICAgICAgICAgIHR5cGU6IHNvdXJjZS50eXBlLFxuICAgICAgICAgICAgc3ByaXRlQXNzZXQ6IHNvdXJjZS5zcHJpdGVBc3NldCxcbiAgICAgICAgICAgIHNwcml0ZTogc291cmNlLnNwcml0ZSxcbiAgICAgICAgICAgIHdpZHRoOiBzb3VyY2Uud2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IHNvdXJjZS5oZWlnaHQsXG4gICAgICAgICAgICBmcmFtZTogc291cmNlLmZyYW1lLFxuICAgICAgICAgICAgY29sb3I6IHNvdXJjZS5jb2xvci5jbG9uZSgpLFxuICAgICAgICAgICAgb3BhY2l0eTogc291cmNlLm9wYWNpdHksXG4gICAgICAgICAgICBmbGlwWDogc291cmNlLmZsaXBYLFxuICAgICAgICAgICAgZmxpcFk6IHNvdXJjZS5mbGlwWSxcbiAgICAgICAgICAgIHNwZWVkOiBzb3VyY2Uuc3BlZWQsXG4gICAgICAgICAgICBjbGlwczogc291cmNlLmNsaXBzLFxuICAgICAgICAgICAgYXV0b1BsYXlDbGlwOiBzb3VyY2UuYXV0b1BsYXlDbGlwLFxuICAgICAgICAgICAgYmF0Y2hHcm91cElkOiBzb3VyY2UuYmF0Y2hHcm91cElkLFxuICAgICAgICAgICAgZHJhd09yZGVyOiBzb3VyY2UuZHJhd09yZGVyLFxuICAgICAgICAgICAgbGF5ZXJzOiBzb3VyY2UubGF5ZXJzLnNsaWNlKDApXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG9uVXBkYXRlKGR0KSB7XG4gICAgICAgIGNvbnN0IGNvbXBvbmVudHMgPSB0aGlzLnN0b3JlO1xuXG4gICAgICAgIGZvciAoY29uc3QgaWQgaW4gY29tcG9uZW50cykge1xuICAgICAgICAgICAgaWYgKGNvbXBvbmVudHMuaGFzT3duUHJvcGVydHkoaWQpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29tcG9uZW50ID0gY29tcG9uZW50c1tpZF07XG4gICAgICAgICAgICAgICAgLy8gaWYgc3ByaXRlIGNvbXBvbmVudCBpcyBlbmFibGVkIGFkdmFuY2UgaXRzIGN1cnJlbnQgY2xpcFxuICAgICAgICAgICAgICAgIGlmIChjb21wb25lbnQuZGF0YS5lbmFibGVkICYmIGNvbXBvbmVudC5lbnRpdHkuZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzcHJpdGUgPSBjb21wb25lbnQuZW50aXR5LnNwcml0ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNwcml0ZS5fY3VycmVudENsaXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNwcml0ZS5fY3VycmVudENsaXAuX3VwZGF0ZShkdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbkJlZm9yZVJlbW92ZShlbnRpdHksIGNvbXBvbmVudCkge1xuICAgICAgICBjb21wb25lbnQub25EZXN0cm95KCk7XG4gICAgfVxufVxuXG5Db21wb25lbnQuX2J1aWxkQWNjZXNzb3JzKFNwcml0ZUNvbXBvbmVudC5wcm90b3R5cGUsIF9zY2hlbWEpO1xuXG5leHBvcnQgeyBTcHJpdGVDb21wb25lbnRTeXN0ZW0gfTtcbiJdLCJuYW1lcyI6WyJfc2NoZW1hIiwiU3ByaXRlQ29tcG9uZW50U3lzdGVtIiwiQ29tcG9uZW50U3lzdGVtIiwiY29uc3RydWN0b3IiLCJhcHAiLCJpZCIsIkNvbXBvbmVudFR5cGUiLCJTcHJpdGVDb21wb25lbnQiLCJEYXRhVHlwZSIsIlNwcml0ZUNvbXBvbmVudERhdGEiLCJzY2hlbWEiLCJfZGVmYXVsdFRleHR1cmUiLCJfZGVmYXVsdE1hdGVyaWFsIiwiX2RlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxTbGljZWRNb2RlIiwiX2RlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxUaWxlZE1vZGUiLCJzeXN0ZW1zIiwib24iLCJvblVwZGF0ZSIsIm9uQmVmb3JlUmVtb3ZlIiwiZGVmYXVsdE1hdGVyaWFsIiwibWF0ZXJpYWwiLCJ0ZXh0dXJlIiwiVGV4dHVyZSIsImdyYXBoaWNzRGV2aWNlIiwid2lkdGgiLCJoZWlnaHQiLCJmb3JtYXQiLCJQSVhFTEZPUk1BVF9SR0JBOCIsIm5hbWUiLCJwaXhlbHMiLCJVaW50OEFycmF5IiwibG9jayIsInVubG9jayIsIlN0YW5kYXJkTWF0ZXJpYWwiLCJkaWZmdXNlIiwic2V0IiwiZW1pc3NpdmUiLCJlbWlzc2l2ZU1hcCIsImVtaXNzaXZlVGludCIsIm9wYWNpdHlNYXAiLCJvcGFjaXR5TWFwQ2hhbm5lbCIsIm9wYWNpdHlUaW50Iiwib3BhY2l0eSIsInVzZUxpZ2h0aW5nIiwidXNlR2FtbWFUb25lbWFwIiwidXNlRm9nIiwidXNlU2t5Ym94IiwiYmxlbmRUeXBlIiwiQkxFTkRfUFJFTVVMVElQTElFRCIsImRlcHRoV3JpdGUiLCJwaXhlbFNuYXAiLCJjdWxsIiwiQ1VMTEZBQ0VfTk9ORSIsInVwZGF0ZSIsImRlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxTbGljZWRNb2RlIiwiY2xvbmUiLCJuaW5lU2xpY2VkTW9kZSIsIlNQUklURV9SRU5ERVJNT0RFX1NMSUNFRCIsImRlZmF1bHQ5U2xpY2VkTWF0ZXJpYWxUaWxlZE1vZGUiLCJTUFJJVEVfUkVOREVSTU9ERV9USUxFRCIsImRlc3Ryb3kiLCJvZmYiLCJpbml0aWFsaXplQ29tcG9uZW50RGF0YSIsImNvbXBvbmVudCIsImRhdGEiLCJwcm9wZXJ0aWVzIiwiZW5hYmxlZCIsInVuZGVmaW5lZCIsInR5cGUiLCJsYXllcnMiLCJBcnJheSIsImlzQXJyYXkiLCJzbGljZSIsImRyYXdPcmRlciIsImNvbG9yIiwiQ29sb3IiLCJfZGF0YSRvcGFjaXR5IiwiciIsImciLCJiIiwiX2RhdGEkb3BhY2l0eTIiLCJmbGlwWCIsImZsaXBZIiwic3ByaXRlQXNzZXQiLCJzcHJpdGUiLCJmcmFtZSIsImNsaXBzIiwiYWRkQ2xpcCIsInNwZWVkIiwiYXV0b1BsYXlDbGlwIiwiYmF0Y2hHcm91cElkIiwiY2xvbmVDb21wb25lbnQiLCJlbnRpdHkiLCJzb3VyY2UiLCJhZGRDb21wb25lbnQiLCJkdCIsImNvbXBvbmVudHMiLCJzdG9yZSIsImhhc093blByb3BlcnR5IiwiX2N1cnJlbnRDbGlwIiwiX3VwZGF0ZSIsIm9uRGVzdHJveSIsIkNvbXBvbmVudCIsIl9idWlsZEFjY2Vzc29ycyIsInByb3RvdHlwZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQWlCQSxNQUFNQSxPQUFPLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQTs7QUFFM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUMscUJBQXFCLFNBQVNDLGVBQWUsQ0FBQztBQUNoRDtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDSUMsV0FBV0EsQ0FBQ0MsR0FBRyxFQUFFO0lBQ2IsS0FBSyxDQUFDQSxHQUFHLENBQUMsQ0FBQTtJQUVWLElBQUksQ0FBQ0MsRUFBRSxHQUFHLFFBQVEsQ0FBQTtJQUVsQixJQUFJLENBQUNDLGFBQWEsR0FBR0MsZUFBZSxDQUFBO0lBQ3BDLElBQUksQ0FBQ0MsUUFBUSxHQUFHQyxtQkFBbUIsQ0FBQTtJQUVuQyxJQUFJLENBQUNDLE1BQU0sR0FBR1YsT0FBTyxDQUFBOztBQUVyQjtJQUNBLElBQUksQ0FBQ1csZUFBZSxHQUFHLElBQUksQ0FBQTs7QUFFM0I7SUFDQSxJQUFJLENBQUNDLGdCQUFnQixHQUFHLElBQUksQ0FBQTs7QUFFNUI7SUFDQSxJQUFJLENBQUNDLGlDQUFpQyxHQUFHLElBQUksQ0FBQTs7QUFFN0M7SUFDQSxJQUFJLENBQUNDLGdDQUFnQyxHQUFHLElBQUksQ0FBQTtBQUU1QyxJQUFBLElBQUksQ0FBQ1YsR0FBRyxDQUFDVyxPQUFPLENBQUNDLEVBQUUsQ0FBQyxRQUFR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
