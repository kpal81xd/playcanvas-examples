import { extend } from '../../../core/core.js';
import { Vec3 } from '../../../core/math/vec3.js';
import { BoundingBox } from '../../../core/shape/bounding-box.js';
import { getDefaultMaterial } from '../../../scene/materials/default-material.js';
import { Asset } from '../../asset/asset.js';
import { Component } from '../component.js';
import { ComponentSystem } from '../system.js';
import { ModelComponent } from './component.js';
import { ModelComponentData } from './data.js';

const _schema = ['enabled'];

/**
 * Allows an Entity to render a model or a primitive shape like a box, capsule, sphere, cylinder,
 * cone etc.
 *
 * @augments ComponentSystem
 * @category Graphics
 */
class ModelComponentSystem extends ComponentSystem {
  /**
   * Create a new ModelComponentSystem instance.
   *
   * @param {import('../../app-base.js').AppBase} app - The Application.
   * @hideconstructor
   */
  constructor(app) {
    super(app);
    this.id = 'model';
    this.ComponentType = ModelComponent;
    this.DataType = ModelComponentData;
    this.schema = _schema;
    this.defaultMaterial = getDefaultMaterial(app.graphicsDevice);
    this.on('beforeremove', this.onRemove, this);
  }
  initializeComponentData(component, _data, properties) {
    // order matters here
    properties = ['material', 'materialAsset', 'asset', 'castShadows', 'receiveShadows', 'castShadowsLightmap', 'lightmapped', 'lightmapSizeMultiplier', 'type', 'mapping', 'layers', 'isStatic', 'batchGroupId'];
    if (_data.batchGroupId === null || _data.batchGroupId === undefined) {
      _data.batchGroupId = -1;
    }

    // duplicate layer list
    if (_data.layers && _data.layers.length) {
      _data.layers = _data.layers.slice(0);
    }
    for (let i = 0; i < properties.length; i++) {
      if (_data.hasOwnProperty(properties[i])) {
        component[properties[i]] = _data[properties[i]];
      }
    }
    if (_data.aabbCenter && _data.aabbHalfExtents) {
      component.customAabb = new BoundingBox(new Vec3(_data.aabbCenter), new Vec3(_data.aabbHalfExtents));
    }
    super.initializeComponentData(component, _data, ['enabled']);
  }
  cloneComponent(entity, clone) {
    const data = {
      type: entity.model.type,
      asset: entity.model.asset,
      castShadows: entity.model.castShadows,
      receiveShadows: entity.model.receiveShadows,
      castShadowsLightmap: entity.model.castShadowsLightmap,
      lightmapped: entity.model.lightmapped,
      lightmapSizeMultiplier: entity.model.lightmapSizeMultiplier,
      isStatic: entity.model.isStatic,
      enabled: entity.model.enabled,
      layers: entity.model.layers,
      batchGroupId: entity.model.batchGroupId,
      mapping: extend({}, entity.model.mapping)
    };

    // if original has a different material
    // than the assigned materialAsset then make sure we
    // clone that one instead of the materialAsset one
    let materialAsset = entity.model.materialAsset;
    if (!(materialAsset instanceof Asset) && materialAsset != null) {
      materialAsset = this.app.assets.get(materialAsset);
    }
    const material = entity.model.material;
    if (!material || material === this.defaultMaterial || !materialAsset || material === materialAsset.resource) {
      data.materialAsset = materialAsset;
    }
    const component = this.addComponent(clone, data);

    // clone the original model if the original model component is of type asset but
    // has no specified asset
    if (entity.model.model && entity.model.type === 'asset' && !entity.model.asset) {
      component.model = entity.model.model.clone();
      component._clonedModel = true;
    }
    if (!data.materialAsset) component.material = material;

    // TODO: we should copy all relevant mesh instance properties here
    if (entity.model.model) {
      const meshInstances = entity.model.model.meshInstances;
      const meshInstancesClone = component.model.meshInstances;
      for (let i = 0; i < meshInstances.length; i++) {
        meshInstancesClone[i].mask = meshInstances[i].mask;
        meshInstancesClone[i].material = meshInstances[i].material;
        meshInstancesClone[i].layer = meshInstances[i].layer;
        meshInstancesClone[i].receiveShadow = meshInstances[i].receiveShadow;
      }
    }
    if (entity.model.customAabb) {
      component.customAabb = entity.model.customAabb.clone();
    }
    return component;
  }
  onRemove(entity, component) {
    component.onRemove();
  }
}
Component._buildAccessors(ModelComponent.prototype, _schema);

export { ModelComponentSystem };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3lzdGVtLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2NvbXBvbmVudHMvbW9kZWwvc3lzdGVtLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGV4dGVuZCB9IGZyb20gJy4uLy4uLy4uL2NvcmUvY29yZS5qcyc7XG5cbmltcG9ydCB7IFZlYzMgfSBmcm9tICcuLi8uLi8uLi9jb3JlL21hdGgvdmVjMy5qcyc7XG5cbmltcG9ydCB7IEJvdW5kaW5nQm94IH0gZnJvbSAnLi4vLi4vLi4vY29yZS9zaGFwZS9ib3VuZGluZy1ib3guanMnO1xuXG5pbXBvcnQgeyBnZXREZWZhdWx0TWF0ZXJpYWwgfSBmcm9tICcuLi8uLi8uLi9zY2VuZS9tYXRlcmlhbHMvZGVmYXVsdC1tYXRlcmlhbC5qcyc7XG5cbmltcG9ydCB7IEFzc2V0IH0gZnJvbSAnLi4vLi4vYXNzZXQvYXNzZXQuanMnO1xuXG5pbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tICcuLi9jb21wb25lbnQuanMnO1xuaW1wb3J0IHsgQ29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi4vc3lzdGVtLmpzJztcblxuaW1wb3J0IHsgTW9kZWxDb21wb25lbnQgfSBmcm9tICcuL2NvbXBvbmVudC5qcyc7XG5pbXBvcnQgeyBNb2RlbENvbXBvbmVudERhdGEgfSBmcm9tICcuL2RhdGEuanMnO1xuXG5jb25zdCBfc2NoZW1hID0gWydlbmFibGVkJ107XG5cbi8qKlxuICogQWxsb3dzIGFuIEVudGl0eSB0byByZW5kZXIgYSBtb2RlbCBvciBhIHByaW1pdGl2ZSBzaGFwZSBsaWtlIGEgYm94LCBjYXBzdWxlLCBzcGhlcmUsIGN5bGluZGVyLFxuICogY29uZSBldGMuXG4gKlxuICogQGF1Z21lbnRzIENvbXBvbmVudFN5c3RlbVxuICogQGNhdGVnb3J5IEdyYXBoaWNzXG4gKi9cbmNsYXNzIE1vZGVsQ29tcG9uZW50U3lzdGVtIGV4dGVuZHMgQ29tcG9uZW50U3lzdGVtIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgTW9kZWxDb21wb25lbnRTeXN0ZW0gaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vLi4vYXBwLWJhc2UuanMnKS5BcHBCYXNlfSBhcHAgLSBUaGUgQXBwbGljYXRpb24uXG4gICAgICogQGhpZGVjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGFwcCkge1xuICAgICAgICBzdXBlcihhcHApO1xuXG4gICAgICAgIHRoaXMuaWQgPSAnbW9kZWwnO1xuXG4gICAgICAgIHRoaXMuQ29tcG9uZW50VHlwZSA9IE1vZGVsQ29tcG9uZW50O1xuICAgICAgICB0aGlzLkRhdGFUeXBlID0gTW9kZWxDb21wb25lbnREYXRhO1xuXG4gICAgICAgIHRoaXMuc2NoZW1hID0gX3NjaGVtYTtcbiAgICAgICAgdGhpcy5kZWZhdWx0TWF0ZXJpYWwgPSBnZXREZWZhdWx0TWF0ZXJpYWwoYXBwLmdyYXBoaWNzRGV2aWNlKTtcblxuICAgICAgICB0aGlzLm9uKCdiZWZvcmVyZW1vdmUnLCB0aGlzLm9uUmVtb3ZlLCB0aGlzKTtcbiAgICB9XG5cbiAgICBpbml0aWFsaXplQ29tcG9uZW50RGF0YShjb21wb25lbnQsIF9kYXRhLCBwcm9wZXJ0aWVzKSB7XG4gICAgICAgIC8vIG9yZGVyIG1hdHRlcnMgaGVyZVxuICAgICAgICBwcm9wZXJ0aWVzID0gW1xuICAgICAgICAgICAgJ21hdGVyaWFsJyxcbiAgICAgICAgICAgICdtYXRlcmlhbEFzc2V0JyxcbiAgICAgICAgICAgICdhc3NldCcsXG4gICAgICAgICAgICAnY2FzdFNoYWRvd3MnLFxuICAgICAgICAgICAgJ3JlY2VpdmVTaGFkb3dzJyxcbiAgICAgICAgICAgICdjYXN0U2hhZG93c0xpZ2h0bWFwJyxcbiAgICAgICAgICAgICdsaWdodG1hcHBlZCcsXG4gICAgICAgICAgICAnbGlnaHRtYXBTaXplTXVsdGlwbGllcicsXG4gICAgICAgICAgICAndHlwZScsXG4gICAgICAgICAgICAnbWFwcGluZycsXG4gICAgICAgICAgICAnbGF5ZXJzJyxcbiAgICAgICAgICAgICdpc1N0YXRpYycsXG4gICAgICAgICAgICAnYmF0Y2hHcm91cElkJ1xuICAgICAgICBdO1xuXG4gICAgICAgIGlmIChfZGF0YS5iYXRjaEdyb3VwSWQgPT09IG51bGwgfHwgX2RhdGEuYmF0Y2hHcm91cElkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIF9kYXRhLmJhdGNoR3JvdXBJZCA9IC0xO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZHVwbGljYXRlIGxheWVyIGxpc3RcbiAgICAgICAgaWYgKF9kYXRhLmxheWVycyAmJiBfZGF0YS5sYXllcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICBfZGF0YS5sYXllcnMgPSBfZGF0YS5sYXllcnMuc2xpY2UoMCk7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHByb3BlcnRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChfZGF0YS5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0aWVzW2ldKSkge1xuICAgICAgICAgICAgICAgIGNvbXBvbmVudFtwcm9wZXJ0aWVzW2ldXSA9IF9kYXRhW3Byb3BlcnRpZXNbaV1dO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKF9kYXRhLmFhYmJDZW50ZXIgJiYgX2RhdGEuYWFiYkhhbGZFeHRlbnRzKSB7XG4gICAgICAgICAgICBjb21wb25lbnQuY3VzdG9tQWFiYiA9IG5ldyBCb3VuZGluZ0JveChuZXcgVmVjMyhfZGF0YS5hYWJiQ2VudGVyKSwgbmV3IFZlYzMoX2RhdGEuYWFiYkhhbGZFeHRlbnRzKSk7XG4gICAgICAgIH1cblxuICAgICAgICBzdXBlci5pbml0aWFsaXplQ29tcG9uZW50RGF0YShjb21wb25lbnQsIF9kYXRhLCBbJ2VuYWJsZWQnXSk7XG4gICAgfVxuXG4gICAgY2xvbmVDb21wb25lbnQoZW50aXR5LCBjbG9uZSkge1xuICAgICAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICAgICAgdHlwZTogZW50aXR5Lm1vZGVsLnR5cGUsXG4gICAgICAgICAgICBhc3NldDogZW50aXR5Lm1vZGVsLmFzc2V0LFxuICAgICAgICAgICAgY2FzdFNoYWRvd3M6IGVudGl0eS5tb2RlbC5jYXN0U2hhZG93cyxcbiAgICAgICAgICAgIHJlY2VpdmVTaGFkb3dzOiBlbnRpdHkubW9kZWwucmVjZWl2ZVNoYWRvd3MsXG4gICAgICAgICAgICBjYXN0U2hhZG93c0xpZ2h0bWFwOiBlbnRpdHkubW9kZWwuY2FzdFNoYWRvd3NMaWdodG1hcCxcbiAgICAgICAgICAgIGxpZ2h0bWFwcGVkOiBlbnRpdHkubW9kZWwubGlnaHRtYXBwZWQsXG4gICAgICAgICAgICBsaWdodG1hcFNpemVNdWx0aXBsaWVyOiBlbnRpdHkubW9kZWwubGlnaHRtYXBTaXplTXVsdGlwbGllcixcbiAgICAgICAgICAgIGlzU3RhdGljOiBlbnRpdHkubW9kZWwuaXNTdGF0aWMsXG4gICAgICAgICAgICBlbmFibGVkOiBlbnRpdHkubW9kZWwuZW5hYmxlZCxcbiAgICAgICAgICAgIGxheWVyczogZW50aXR5Lm1vZGVsLmxheWVycyxcbiAgICAgICAgICAgIGJhdGNoR3JvdXBJZDogZW50aXR5Lm1vZGVsLmJhdGNoR3JvdXBJZCxcbiAgICAgICAgICAgIG1hcHBpbmc6IGV4dGVuZCh7fSwgZW50aXR5Lm1vZGVsLm1hcHBpbmcpXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gaWYgb3JpZ2luYWwgaGFzIGEgZGlmZmVyZW50IG1hdGVyaWFsXG4gICAgICAgIC8vIHRoYW4gdGhlIGFzc2lnbmVkIG1hdGVyaWFsQXNzZXQgdGhlbiBtYWtlIHN1cmUgd2VcbiAgICAgICAgLy8gY2xvbmUgdGhhdCBvbmUgaW5zdGVhZCBvZiB0aGUgbWF0ZXJpYWxBc3NldCBvbmVcbiAgICAgICAgbGV0IG1hdGVyaWFsQXNzZXQgPSBlbnRpdHkubW9kZWwubWF0ZXJpYWxBc3NldDtcbiAgICAgICAgaWYgKCEobWF0ZXJpYWxBc3NldCBpbnN0YW5jZW9mIEFzc2V0KSAmJiBtYXRlcmlhbEFzc2V0ICE9IG51bGwpIHtcbiAgICAgICAgICAgIG1hdGVyaWFsQXNzZXQgPSB0aGlzLmFwcC5hc3NldHMuZ2V0KG1hdGVyaWFsQXNzZXQpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbWF0ZXJpYWwgPSBlbnRpdHkubW9kZWwubWF0ZXJpYWw7XG4gICAgICAgIGlmICghbWF0ZXJpYWwgfHxcbiAgICAgICAgICAgIG1hdGVyaWFsID09PSB0aGlzLmRlZmF1bHRNYXRlcmlhbCB8fFxuICAgICAgICAgICAgIW1hdGVyaWFsQXNzZXQgfHxcbiAgICAgICAgICAgIG1hdGVyaWFsID09PSBtYXRlcmlhbEFzc2V0LnJlc291cmNlKSB7XG5cbiAgICAgICAgICAgIGRhdGEubWF0ZXJpYWxBc3NldCA9IG1hdGVyaWFsQXNzZXQ7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjb21wb25lbnQgPSB0aGlzLmFkZENvbXBvbmVudChjbG9uZSwgZGF0YSk7XG5cbiAgICAgICAgLy8gY2xvbmUgdGhlIG9yaWdpbmFsIG1vZGVsIGlmIHRoZSBvcmlnaW5hbCBtb2RlbCBjb21wb25lbnQgaXMgb2YgdHlwZSBhc3NldCBidXRcbiAgICAgICAgLy8gaGFzIG5vIHNwZWNpZmllZCBhc3NldFxuICAgICAgICBpZiAoZW50aXR5Lm1vZGVsLm1vZGVsICYmIGVudGl0eS5tb2RlbC50eXBlID09PSAnYXNzZXQnICYmICFlbnRpdHkubW9kZWwuYXNzZXQpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudC5tb2RlbCA9IGVudGl0eS5tb2RlbC5tb2RlbC5jbG9uZSgpO1xuICAgICAgICAgICAgY29tcG9uZW50Ll9jbG9uZWRNb2RlbCA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWRhdGEubWF0ZXJpYWxBc3NldClcbiAgICAgICAgICAgIGNvbXBvbmVudC5tYXRlcmlhbCA9IG1hdGVyaWFsO1xuXG4gICAgICAgIC8vIFRPRE86IHdlIHNob3VsZCBjb3B5IGFsbCByZWxldmFudCBtZXNoIGluc3RhbmNlIHByb3BlcnRpZXMgaGVyZVxuICAgICAgICBpZiAoZW50aXR5Lm1vZGVsLm1vZGVsKSB7XG4gICAgICAgICAgICBjb25zdCBtZXNoSW5zdGFuY2VzID0gZW50aXR5Lm1vZGVsLm1vZGVsLm1lc2hJbnN0YW5jZXM7XG4gICAgICAgICAgICBjb25zdCBtZXNoSW5zdGFuY2VzQ2xvbmUgPSBjb21wb25lbnQubW9kZWwubWVzaEluc3RhbmNlcztcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWVzaEluc3RhbmNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIG1lc2hJbnN0YW5jZXNDbG9uZVtpXS5tYXNrID0gbWVzaEluc3RhbmNlc1tpXS5tYXNrO1xuICAgICAgICAgICAgICAgIG1lc2hJbnN0YW5jZXNDbG9uZVtpXS5tYXRlcmlhbCA9IG1lc2hJbnN0YW5jZXNbaV0ubWF0ZXJpYWw7XG4gICAgICAgICAgICAgICAgbWVzaEluc3RhbmNlc0Nsb25lW2ldLmxheWVyID0gbWVzaEluc3RhbmNlc1tpXS5sYXllcjtcbiAgICAgICAgICAgICAgICBtZXNoSW5zdGFuY2VzQ2xvbmVbaV0ucmVjZWl2ZVNoYWRvdyA9IG1lc2hJbnN0YW5jZXNbaV0ucmVjZWl2ZVNoYWRvdztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlbnRpdHkubW9kZWwuY3VzdG9tQWFiYikge1xuICAgICAgICAgICAgY29tcG9uZW50LmN1c3RvbUFhYmIgPSBlbnRpdHkubW9kZWwuY3VzdG9tQWFiYi5jbG9uZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNvbXBvbmVudDtcbiAgICB9XG5cbiAgICBvblJlbW92ZShlbnRpdHksIGNvbXBvbmVudCkge1xuICAgICAgICBjb21wb25lbnQub25SZW1vdmUoKTtcbiAgICB9XG59XG5cbkNvbXBvbmVudC5fYnVpbGRBY2Nlc3NvcnMoTW9kZWxDb21wb25lbnQucHJvdG90eXBlLCBfc2NoZW1hKTtcblxuZXhwb3J0IHsgTW9kZWxDb21wb25lbnRTeXN0ZW0gfTtcbiJdLCJuYW1lcyI6WyJfc2NoZW1hIiwiTW9kZWxDb21wb25lbnRTeXN0ZW0iLCJDb21wb25lbnRTeXN0ZW0iLCJjb25zdHJ1Y3RvciIsImFwcCIsImlkIiwiQ29tcG9uZW50VHlwZSIsIk1vZGVsQ29tcG9uZW50IiwiRGF0YVR5cGUiLCJNb2RlbENvbXBvbmVudERhdGEiLCJzY2hlbWEiLCJkZWZhdWx0TWF0ZXJpYWwiLCJnZXREZWZhdWx0TWF0ZXJpYWwiLCJncmFwaGljc0RldmljZSIsIm9uIiwib25SZW1vdmUiLCJpbml0aWFsaXplQ29tcG9uZW50RGF0YSIsImNvbXBvbmVudCIsIl9kYXRhIiwicHJvcGVydGllcyIsImJhdGNoR3JvdXBJZCIsInVuZGVmaW5lZCIsImxheWVycyIsImxlbmd0aCIsInNsaWNlIiwiaSIsImhhc093blByb3BlcnR5IiwiYWFiYkNlbnRlciIsImFhYmJIYWxmRXh0ZW50cyIsImN1c3RvbUFhYmIiLCJCb3VuZGluZ0JveCIsIlZlYzMiLCJjbG9uZUNvbXBvbmVudCIsImVudGl0eSIsImNsb25lIiwiZGF0YSIsInR5cGUiLCJtb2RlbCIsImFzc2V0IiwiY2FzdFNoYWRvd3MiLCJyZWNlaXZlU2hhZG93cyIsImNhc3RTaGFkb3dzTGlnaHRtYXAiLCJsaWdodG1hcHBlZCIsImxpZ2h0bWFwU2l6ZU11bHRpcGxpZXIiLCJpc1N0YXRpYyIsImVuYWJsZWQiLCJtYXBwaW5nIiwiZXh0ZW5kIiwibWF0ZXJpYWxBc3NldCIsIkFzc2V0IiwiYXNzZXRzIiwiZ2V0IiwibWF0ZXJpYWwiLCJyZXNvdXJjZSIsImFkZENvbXBvbmVudCIsIl9jbG9uZWRNb2RlbCIsIm1lc2hJbnN0YW5jZXMiLCJtZXNoSW5zdGFuY2VzQ2xvbmUiLCJtYXNrIiwibGF5ZXIiLCJyZWNlaXZlU2hhZG93IiwiQ29tcG9uZW50IiwiX2J1aWxkQWNjZXNzb3JzIiwicHJvdG90eXBlIl0sIm1hcHBp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
