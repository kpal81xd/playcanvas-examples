import { EventHandler } from '../../core/event-handler.js';
import { Asset } from './asset.js';

/**
 * Used to load a group of assets and fires a callback when all assets are loaded.
 *
 * ```javascript
 * const assets = [
 *     new Asset('model', 'container', { url: `http://example.com/asset.glb` }),
 *     new Asset('styling', 'css', { url: `http://example.com/asset.css` })
 * ];
 * const assetListLoader = new AssetListLoader(assets, app.assets);
 * assetListLoader.load((err, failed) => {
 *     if (err) {
 *         console.error(`${failed.length} assets failed to load`);
 *     } else {
 *         console.log(`${assets.length} assets loaded`);
 *    }
 * });
 * ```
 *
 * @augments EventHandler
 * @category Asset
 */
class AssetListLoader extends EventHandler {
  /**
   * Create a new AssetListLoader using a list of assets to load and the asset registry used to load and manage them.
   *
   * @param {Asset[]|number[]} assetList - An array of {@link Asset} objects to load or an array of Asset IDs to load.
   * @param {import('./asset-registry.js').AssetRegistry} assetRegistry - The application's asset registry.
   * @example
   * const assetListLoader = new pc.AssetListLoader([
   *     new pc.Asset("texture1", "texture", { url: 'http://example.com/my/assets/here/texture1.png') }),
   *     new pc.Asset("texture2", "texture", { url: 'http://example.com/my/assets/here/texture2.png') })
   * ], pc.app.assets);
   */
  constructor(assetList, assetRegistry) {
    super();
    this._assets = new Set();
    this._loadingAssets = new Set();
    this._waitingAssets = new Set();
    this._registry = assetRegistry;
    this._loading = false;
    this._loaded = false;
    this._failed = []; // list of assets that failed to load

    assetList.forEach(a => {
      if (a instanceof Asset) {
        if (!a.registry) {
          a.registry = assetRegistry;
        }
        this._assets.add(a);
      } else {
        const asset = assetRegistry.get(a);
        if (asset) {
          this._assets.add(asset);
        } else {
          this._waitForAsset(a);
        }
      }
    });
  }

  /**
   * Removes all references to this asset list loader.
   */
  destroy() {
    // remove any outstanding listeners
    const self = this;
    this._registry.off("load", this._onLoad);
    this._registry.off("error", this._onError);
    this._waitingAssets.forEach(function (id) {
      self._registry.off("add:" + id, this._onAddAsset);
    });
    this.off("progress");
    this.off("load");
  }
  _assetHasDependencies(asset) {
    var _asset$file;
    return asset.type === 'model' && ((_asset$file = asset.file) == null ? void 0 : _asset$file.url) && asset.file.url && asset.file.url.match(/.json$/g);
  }

  /**
   * Start loading asset list, call done() when all assets have loaded or failed to load.
   *
   * @param {Function} done - Callback called when all assets in the list are loaded. Passed (err, failed) where err is the undefined if no errors are encountered and failed contains a list of assets that failed to load.
   * @param {object} [scope] - Scope to use when calling callback.
   */
  load(done, scope) {
    if (this._loading) {
      console.debug("AssetListLoader: Load function called multiple times.");
      return;
    }
    this._loading = true;
    this._callback = done;
    this._scope = scope;
    this._registry.on("load", this._onLoad, this);
    this._registry.on("error", this._onError, this);
    let loadingAssets = false;
    this._assets.forEach(asset => {
      // Track assets that are not loaded or are currently loading
      // as some assets may be loading by this call
      if (!asset.loaded) {
        loadingAssets = true;
        // json based models should be loaded with the loadFromUrl function so that their dependencies can be loaded too.
        if (this._assetHasDependencies(asset)) {
          this._registry.loadFromUrl(asset.file.url, asset.type, (err, loadedAsset) => {
            if (err) {
              this._onError(err, asset);
              return;
            }
            this._onLoad(asset);
          });
        }
        this._loadingAssets.add(asset);
        this._registry.add(asset);
      }
    });
    this._loadingAssets.forEach(asset => {
      if (!this._assetHasDependencies(asset)) {
        this._registry.load(asset);
      }
    });
    if (!loadingAssets && this._waitingAssets.size === 0) {
      this._loadingComplete();
    }
  }

  /**
   * Sets a callback which will be called when all assets in the list have been loaded.
   *
   * @param {Function} done - Callback called when all assets in the list are loaded.
   * @param {object} [scope] - Scope to use when calling callback.
   */
  ready(done, scope = this) {
    if (this._loaded) {
      done.call(scope, Array.from(this._assets));
    } else {
      this.once("load", function (assets) {
        done.call(scope, assets);
      });
    }
  }

  // called when all assets are loaded
  _loadingComplete() {
    if (this._loaded) return;
    this._loaded = true;
    this._registry.off("load", this._onLoad, this);
    this._registry.off("error", this._onError, this);
    if (this._failed.length) {
      if (this._callback) {
        this._callback.call(this._scope, "Failed to load some assets", this._failed);
      }
      this.fire("error", this._failed);
    } else {
      if (this._callback) {
        this._callback.call(this._scope);
      }
      this.fire("load", Array.from(this._assets));
    }
  }

  // called when an (any) asset is loaded
  _onLoad(asset) {
    // check this is an asset we care about
    if (this._loadingAssets.has(asset)) {
      this.fire("progress", asset);
      this._loadingAssets.delete(asset);
    }
    if (this._loadingAssets.size === 0) {
      // call next tick because we want
      // this to be fired after any other
      // asset load events
      setTimeout(() => {
        this._loadingComplete(this._failed);
      }, 0);
    }
  }

  // called when an asset fails to load
  _onError(err, asset) {
    // check this is an asset we care about
    if (this._loadingAssets.has(asset)) {
      this._failed.push(asset);
      this._loadingAssets.delete(asset);
    }
    if (this._loadingAssets.size === 0) {
      // call next tick because we want
      // this to be fired after any other
      // asset load events
      setTimeout(() => {
        this._loadingComplete(this._failed);
      }, 0);
    }
  }

  // called when a expected asset is added to the asset registry
  _onAddAsset(asset) {
    // remove from waiting list
    this._waitingAssets.delete(asset);
    this._assets.add(asset);
    if (!asset.loaded) {
      this._loadingAssets.add(asset);
      this._registry.load(asset);
    }
  }
  _waitForAsset(assetId) {
    this._waitingAssets.add(assetId);
    this._registry.once('add:' + assetId, this._onAddAsset, this);
  }
}

export { AssetListLoader };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzZXQtbGlzdC1sb2FkZXIuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9mcmFtZXdvcmsvYXNzZXQvYXNzZXQtbGlzdC1sb2FkZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnRIYW5kbGVyIH0gZnJvbSAnLi4vLi4vY29yZS9ldmVudC1oYW5kbGVyLmpzJztcblxuaW1wb3J0IHsgQXNzZXQgfSBmcm9tICcuL2Fzc2V0LmpzJztcblxuLyoqXG4gKiBVc2VkIHRvIGxvYWQgYSBncm91cCBvZiBhc3NldHMgYW5kIGZpcmVzIGEgY2FsbGJhY2sgd2hlbiBhbGwgYXNzZXRzIGFyZSBsb2FkZWQuXG4gKlxuICogYGBgamF2YXNjcmlwdFxuICogY29uc3QgYXNzZXRzID0gW1xuICogICAgIG5ldyBBc3NldCgnbW9kZWwnLCAnY29udGFpbmVyJywgeyB1cmw6IGBodHRwOi8vZXhhbXBsZS5jb20vYXNzZXQuZ2xiYCB9KSxcbiAqICAgICBuZXcgQXNzZXQoJ3N0eWxpbmcnLCAnY3NzJywgeyB1cmw6IGBodHRwOi8vZXhhbXBsZS5jb20vYXNzZXQuY3NzYCB9KVxuICogXTtcbiAqIGNvbnN0IGFzc2V0TGlzdExvYWRlciA9IG5ldyBBc3NldExpc3RMb2FkZXIoYXNzZXRzLCBhcHAuYXNzZXRzKTtcbiAqIGFzc2V0TGlzdExvYWRlci5sb2FkKChlcnIsIGZhaWxlZCkgPT4ge1xuICogICAgIGlmIChlcnIpIHtcbiAqICAgICAgICAgY29uc29sZS5lcnJvcihgJHtmYWlsZWQubGVuZ3RofSBhc3NldHMgZmFpbGVkIHRvIGxvYWRgKTtcbiAqICAgICB9IGVsc2Uge1xuICogICAgICAgICBjb25zb2xlLmxvZyhgJHthc3NldHMubGVuZ3RofSBhc3NldHMgbG9hZGVkYCk7XG4gKiAgICB9XG4gKiB9KTtcbiAqIGBgYFxuICpcbiAqIEBhdWdtZW50cyBFdmVudEhhbmRsZXJcbiAqIEBjYXRlZ29yeSBBc3NldFxuICovXG5jbGFzcyBBc3NldExpc3RMb2FkZXIgZXh0ZW5kcyBFdmVudEhhbmRsZXIge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBBc3NldExpc3RMb2FkZXIgdXNpbmcgYSBsaXN0IG9mIGFzc2V0cyB0byBsb2FkIGFuZCB0aGUgYXNzZXQgcmVnaXN0cnkgdXNlZCB0byBsb2FkIGFuZCBtYW5hZ2UgdGhlbS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7QXNzZXRbXXxudW1iZXJbXX0gYXNzZXRMaXN0IC0gQW4gYXJyYXkgb2Yge0BsaW5rIEFzc2V0fSBvYmplY3RzIHRvIGxvYWQgb3IgYW4gYXJyYXkgb2YgQXNzZXQgSURzIHRvIGxvYWQuXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4vYXNzZXQtcmVnaXN0cnkuanMnKS5Bc3NldFJlZ2lzdHJ5fSBhc3NldFJlZ2lzdHJ5IC0gVGhlIGFwcGxpY2F0aW9uJ3MgYXNzZXQgcmVnaXN0cnkuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBjb25zdCBhc3NldExpc3RMb2FkZXIgPSBuZXcgcGMuQXNzZXRMaXN0TG9hZGVyKFtcbiAgICAgKiAgICAgbmV3IHBjLkFzc2V0KFwidGV4dHVyZTFcIiwgXCJ0ZXh0dXJlXCIsIHsgdXJsOiAnaHR0cDovL2V4YW1wbGUuY29tL215L2Fzc2V0cy9oZXJlL3RleHR1cmUxLnBuZycpIH0pLFxuICAgICAqICAgICBuZXcgcGMuQXNzZXQoXCJ0ZXh0dXJlMlwiLCBcInRleHR1cmVcIiwgeyB1cmw6ICdodHRwOi8vZXhhbXBsZS5jb20vbXkvYXNzZXRzL2hlcmUvdGV4dHVyZTIucG5nJykgfSlcbiAgICAgKiBdLCBwYy5hcHAuYXNzZXRzKTtcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihhc3NldExpc3QsIGFzc2V0UmVnaXN0cnkpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5fYXNzZXRzID0gbmV3IFNldCgpO1xuICAgICAgICB0aGlzLl9sb2FkaW5nQXNzZXRzID0gbmV3IFNldCgpO1xuICAgICAgICB0aGlzLl93YWl0aW5nQXNzZXRzID0gbmV3IFNldCgpO1xuICAgICAgICB0aGlzLl9yZWdpc3RyeSA9IGFzc2V0UmVnaXN0cnk7XG4gICAgICAgIHRoaXMuX2xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fbG9hZGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2ZhaWxlZCA9IFtdOyAvLyBsaXN0IG9mIGFzc2V0cyB0aGF0IGZhaWxlZCB0byBsb2FkXG5cbiAgICAgICAgYXNzZXRMaXN0LmZvckVhY2goKGEpID0+IHtcbiAgICAgICAgICAgIGlmIChhIGluc3RhbmNlb2YgQXNzZXQpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWEucmVnaXN0cnkpIHtcbiAgICAgICAgICAgICAgICAgICAgYS5yZWdpc3RyeSA9IGFzc2V0UmVnaXN0cnk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX2Fzc2V0cy5hZGQoYSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFzc2V0ID0gYXNzZXRSZWdpc3RyeS5nZXQoYSk7XG4gICAgICAgICAgICAgICAgaWYgKGFzc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2Fzc2V0cy5hZGQoYXNzZXQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3dhaXRGb3JBc3NldChhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgYWxsIHJlZmVyZW5jZXMgdG8gdGhpcyBhc3NldCBsaXN0IGxvYWRlci5cbiAgICAgKi9cbiAgICBkZXN0cm95KCkge1xuICAgICAgICAvLyByZW1vdmUgYW55IG91dHN0YW5kaW5nIGxpc3RlbmVyc1xuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICB0aGlzLl9yZWdpc3RyeS5vZmYoXCJsb2FkXCIsIHRoaXMuX29uTG9hZCk7XG4gICAgICAgIHRoaXMuX3JlZ2lzdHJ5Lm9mZihcImVycm9yXCIsIHRoaXMuX29uRXJyb3IpO1xuXG4gICAgICAgIHRoaXMuX3dhaXRpbmdBc3NldHMuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHNlbGYuX3JlZ2lzdHJ5Lm9mZihcImFkZDpcIiArIGlkLCB0aGlzLl9vbkFkZEFzc2V0KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5vZmYoXCJwcm9ncmVzc1wiKTtcbiAgICAgICAgdGhpcy5vZmYoXCJsb2FkXCIpO1xuICAgIH1cblxuICAgIF9hc3NldEhhc0RlcGVuZGVuY2llcyhhc3NldCkge1xuICAgICAgICByZXR1cm4gKGFzc2V0LnR5cGUgPT09ICdtb2RlbCcgJiYgYXNzZXQuZmlsZT8udXJsICYmIGFzc2V0LmZpbGUudXJsICYmIGFzc2V0LmZpbGUudXJsLm1hdGNoKC8uanNvbiQvZykpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFN0YXJ0IGxvYWRpbmcgYXNzZXQgbGlzdCwgY2FsbCBkb25lKCkgd2hlbiBhbGwgYXNzZXRzIGhhdmUgbG9hZGVkIG9yIGZhaWxlZCB0byBsb2FkLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZG9uZSAtIENhbGxiYWNrIGNhbGxlZCB3aGVuIGFsbCBhc3NldHMgaW4gdGhlIGxpc3QgYXJlIGxvYWRlZC4gUGFzc2VkIChlcnIsIGZhaWxlZCkgd2hlcmUgZXJyIGlzIHRoZSB1bmRlZmluZWQgaWYgbm8gZXJyb3JzIGFyZSBlbmNvdW50ZXJlZCBhbmQgZmFpbGVkIGNvbnRhaW5zIGEgbGlzdCBvZiBhc3NldHMgdGhhdCBmYWlsZWQgdG8gbG9hZC5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gW3Njb3BlXSAtIFNjb3BlIHRvIHVzZSB3aGVuIGNhbGxpbmcgY2FsbGJhY2suXG4gICAgICovXG4gICAgbG9hZChkb25lLCBzY29wZSkge1xuICAgICAgICBpZiAodGhpcy5fbG9hZGluZykge1xuICAgICAgICAgICAgLy8gI2lmIF9ERUJVR1xuICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhcIkFzc2V0TGlzdExvYWRlcjogTG9hZCBmdW5jdGlvbiBjYWxsZWQgbXVsdGlwbGUgdGltZXMuXCIpO1xuICAgICAgICAgICAgLy8gI2VuZGlmXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fbG9hZGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuX2NhbGxiYWNrID0gZG9uZTtcbiAgICAgICAgdGhpcy5fc2NvcGUgPSBzY29wZTtcblxuICAgICAgICB0aGlzLl9yZWdpc3RyeS5vbihcImxvYWRcIiwgdGhpcy5fb25Mb2FkLCB0aGlzKTtcbiAgICAgICAgdGhpcy5fcmVnaXN0cnkub24oXCJlcnJvclwiLCB0aGlzLl9vbkVycm9yLCB0aGlzKTtcblxuICAgICAgICBsZXQgbG9hZGluZ0Fzc2V0cyA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9hc3NldHMuZm9yRWFjaCgoYXNzZXQpID0+IHtcbiAgICAgICAgICAgIC8vIFRyYWNrIGFzc2V0cyB0aGF0IGFyZSBub3QgbG9hZGVkIG9yIGFyZSBjdXJyZW50bHkgbG9hZGluZ1xuICAgICAgICAgICAgLy8gYXMgc29tZSBhc3NldHMgbWF5IGJlIGxvYWRpbmcgYnkgdGhpcyBjYWxsXG4gICAgICAgICAgICBpZiAoIWFzc2V0LmxvYWRlZCkge1xuICAgICAgICAgICAgICAgIGxvYWRpbmdBc3NldHMgPSB0cnVlO1xuICAgICAgICAgICAgICAgIC8vIGpzb24gYmFzZWQgbW9kZWxzIHNob3VsZCBiZSBsb2FkZWQgd2l0aCB0aGUgbG9hZEZyb21VcmwgZnVuY3Rpb24gc28gdGhhdCB0aGVpciBkZXBlbmRlbmNpZXMgY2FuIGJlIGxvYWRlZCB0b28uXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2Fzc2V0SGFzRGVwZW5kZW5jaWVzKGFzc2V0KSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWdpc3RyeS5sb2FkRnJvbVVybChhc3NldC5maWxlLnVybCwgYXNzZXQudHlwZSwgKGVyciwgbG9hZGVkQXNzZXQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbkVycm9yKGVyciwgYXNzZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX29uTG9hZChhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl9sb2FkaW5nQXNzZXRzLmFkZChhc3NldCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVnaXN0cnkuYWRkKGFzc2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX2xvYWRpbmdBc3NldHMuZm9yRWFjaCgoYXNzZXQpID0+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy5fYXNzZXRIYXNEZXBlbmRlbmNpZXMoYXNzZXQpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVnaXN0cnkubG9hZChhc3NldCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIWxvYWRpbmdBc3NldHMgJiYgdGhpcy5fd2FpdGluZ0Fzc2V0cy5zaXplID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLl9sb2FkaW5nQ29tcGxldGUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgYSBjYWxsYmFjayB3aGljaCB3aWxsIGJlIGNhbGxlZCB3aGVuIGFsbCBhc3NldHMgaW4gdGhlIGxpc3QgaGF2ZSBiZWVuIGxvYWRlZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGRvbmUgLSBDYWxsYmFjayBjYWxsZWQgd2hlbiBhbGwgYXNzZXRzIGluIHRoZSBsaXN0IGFyZSBsb2FkZWQuXG4gICAgICogQHBhcmFtIHtvYmplY3R9IFtzY29wZV0gLSBTY29wZSB0byB1c2Ugd2hlbiBjYWxsaW5nIGNhbGxiYWNrLlxuICAgICAqL1xuICAgIHJlYWR5KGRvbmUsIHNjb3BlID0gdGhpcykge1xuICAgICAgICBpZiAodGhpcy5fbG9hZGVkKSB7XG4gICAgICAgICAgICBkb25lLmNhbGwoc2NvcGUsIEFycmF5LmZyb20odGhpcy5fYXNzZXRzKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm9uY2UoXCJsb2FkXCIsIGZ1bmN0aW9uIChhc3NldHMpIHtcbiAgICAgICAgICAgICAgICBkb25lLmNhbGwoc2NvcGUsIGFzc2V0cyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIGNhbGxlZCB3aGVuIGFsbCBhc3NldHMgYXJlIGxvYWRlZFxuICAgIF9sb2FkaW5nQ29tcGxldGUoKSB7XG4gICAgICAgIGlmICh0aGlzLl9sb2FkZWQpIHJldHVybjtcbiAgICAgICAgdGhpcy5fbG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fcmVnaXN0cnkub2ZmKFwibG9hZFwiLCB0aGlzLl9vbkxvYWQsIHRoaXMpO1xuICAgICAgICB0aGlzLl9yZWdpc3RyeS5vZmYoXCJlcnJvclwiLCB0aGlzLl9vbkVycm9yLCB0aGlzKTtcblxuICAgICAgICBpZiAodGhpcy5fZmFpbGVkLmxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2NhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY2FsbGJhY2suY2FsbCh0aGlzLl9zY29wZSwgXCJGYWlsZWQgdG8gbG9hZCBzb21lIGFzc2V0c1wiLCB0aGlzLl9mYWlsZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5maXJlKFwiZXJyb3JcIiwgdGhpcy5fZmFpbGVkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9jYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NhbGxiYWNrLmNhbGwodGhpcy5fc2NvcGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5maXJlKFwibG9hZFwiLCBBcnJheS5mcm9tKHRoaXMuX2Fzc2V0cykpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gY2FsbGVkIHdoZW4gYW4gKGFueSkgYXNzZXQgaXMgbG9hZGVkXG4gICAgX29uTG9hZChhc3NldCkge1xuICAgICAgICAvLyBjaGVjayB0aGlzIGlzIGFuIGFzc2V0IHdlIGNhcmUgYWJvdXRcbiAgICAgICAgaWYgKHRoaXMuX2xvYWRpbmdBc3NldHMuaGFzKGFzc2V0KSkge1xuICAgICAgICAgICAgdGhpcy5maXJlKFwicHJvZ3Jlc3NcIiwgYXNzZXQpO1xuICAgICAgICAgICAgdGhpcy5fbG9hZGluZ0Fzc2V0cy5kZWxldGUoYXNzZXQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuX2xvYWRpbmdBc3NldHMuc2l6ZSA9PT0gMCkge1xuICAgICAgICAgICAgLy8gY2FsbCBuZXh0IHRpY2sgYmVjYXVzZSB3ZSB3YW50XG4gICAgICAgICAgICAvLyB0aGlzIHRvIGJlIGZpcmVkIGFmdGVyIGFueSBvdGhlclxuICAgICAgICAgICAgLy8gYXNzZXQgbG9hZCBldmVudHNcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuX2xvYWRpbmdDb21wbGV0ZSh0aGlzLl9mYWlsZWQpO1xuICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBjYWxsZWQgd2hlbiBhbiBhc3NldCBmYWlscyB0byBsb2FkXG4gICAgX29uRXJyb3IoZXJyLCBhc3NldCkge1xuICAgICAgICAvLyBjaGVjayB0aGlzIGlzIGFuIGFzc2V0IHdlIGNhcmUgYWJvdXRcbiAgICAgICAgaWYgKHRoaXMuX2xvYWRpbmdBc3NldHMuaGFzKGFzc2V0KSkge1xuICAgICAgICAgICAgdGhpcy5fZmFpbGVkLnB1c2goYXNzZXQpO1xuICAgICAgICAgICAgdGhpcy5fbG9hZGluZ0Fzc2V0cy5kZWxldGUoYXNzZXQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuX2xvYWRpbmdBc3NldHMuc2l6ZSA9PT0gMCkge1xuICAgICAgICAgICAgLy8gY2FsbCBuZXh0IHRpY2sgYmVjYXVzZSB3ZSB3YW50XG4gICAgICAgICAgICAvLyB0aGlzIHRvIGJlIGZpcmVkIGFmdGVyIGFueSBvdGhlclxuICAgICAgICAgICAgLy8gYXNzZXQgbG9hZCBldmVudHNcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuX2xvYWRpbmdDb21wbGV0ZSh0aGlzLl9mYWlsZWQpO1xuICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBjYWxsZWQgd2hlbiBhIGV4cGVjdGVkIGFzc2V0IGlzIGFkZGVkIHRvIHRoZSBhc3NldCByZWdpc3RyeVxuICAgIF9vbkFkZEFzc2V0KGFzc2V0KSB7XG4gICAgICAgIC8vIHJlbW92ZSBmcm9tIHdhaXRpbmcgbGlzdFxuICAgICAgICB0aGlzLl93YWl0aW5nQXNzZXRzLmRlbGV0ZShhc3NldCk7XG5cbiAgICAgICAgdGhpcy5fYXNzZXRzLmFkZChhc3NldCk7XG4gICAgICAgIGlmICghYXNzZXQubG9hZGVkKSB7XG4gICAgICAgICAgICB0aGlzLl9sb2FkaW5nQXNzZXRzLmFkZChhc3NldCk7XG4gICAgICAgICAgICB0aGlzLl9yZWdpc3RyeS5sb2FkKGFzc2V0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF93YWl0Rm9yQXNzZXQoYXNzZXRJZCkge1xuICAgICAgICB0aGlzLl93YWl0aW5nQXNzZXRzLmFkZChhc3NldElkKTtcbiAgICAgICAgdGhpcy5fcmVnaXN0cnkub25jZSgnYWRkOicgKyBhc3NldElkLCB0aGlzLl9vbkFkZEFzc2V0LCB0aGlzKTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IEFzc2V0TGlzdExvYWRlciB9O1xuIl0sIm5hbWVzIjpbIkFzc2V0TGlzdExvYWRlciIsIkV2ZW50SGFuZGxlciIsImNvbnN0cnVjdG9yIiwiYXNzZXRMaXN0IiwiYXNzZXRSZWdpc3RyeSIsIl9hc3NldHMiLCJTZXQiLCJfbG9hZGluZ0Fzc2V0cyIsIl93YWl0aW5nQXNzZXRzIiwiX3JlZ2lzdHJ5IiwiX2xvYWRpbmciLCJfbG9hZGVkIiwiX2ZhaWxlZCIsImZvckVhY2giLCJhIiwiQXNzZXQiLCJyZWdpc3RyeSIsImFkZCIsImFzc2V0IiwiZ2V0IiwiX3dhaXRGb3JBc3NldCIsImRlc3Ryb3kiLCJzZWxmIiwib2ZmIiwiX29uTG9hZCIsIl9vbkVycm9yIiwiaWQiLCJfb25BZGRBc3NldCIsIl9hc3NldEhhc0RlcGVuZGVuY2llcyIsIl9hc3NldCRmaWxlIiwidHlwZSIsImZpbGUiLCJ1cmwiLCJtYXRjaCIsImxvYWQiLCJkb25lIiwic2NvcGUiLCJjb25zb2xlIiwiZGVidWciLCJfY2FsbGJhY2siLCJfc2NvcGUiLCJvbiIsImxvYWRpbmdBc3NldHMiLCJsb2FkZWQiLCJsb2FkRnJvbVVybCIsImVyciIsImxvYWRlZEFzc2V0Iiwic2l6ZSIsIl9sb2FkaW5nQ29tcGxldGUiLCJyZWFkeSIsImNhbGwiLCJBcnJheSIsImZyb20iLCJvbmNlIiwiYXNzZXRzIiwibGVuZ3RoIiwiZmlyZSIsImhhcyIsImRlbGV0ZSIsInNldFRpbWVvdXQiLCJwdXNoIiwiYXNzZXRJZCJdLCJtYXBwaW5ncyI6Ijs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUEsZUFBZSxTQUFTQyxZQUFZLENBQUM7QUFDdkM7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNJQyxFQUFBQSxXQUFXQSxD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
