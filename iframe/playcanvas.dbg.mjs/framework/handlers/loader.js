import { Debug } from '../../core/debug.js';

/**
 * Callback used by {@link ResourceLoader#load} when a resource is loaded (or an error occurs).
 *
 * @callback ResourceLoaderCallback
 * @param {string|null} err - The error message in the case where the load fails.
 * @param {*} [resource] - The resource that has been successfully loaded.
 */

/**
 * Load resource data, potentially from remote sources. Caches resource on load to prevent multiple
 * requests. Add ResourceHandlers to handle different types of resources.
 */
class ResourceLoader {
  /**
   * Create a new ResourceLoader instance.
   *
   * @param {import('../app-base.js').AppBase} app - The application.
   */
  constructor(app) {
    this._handlers = {};
    this._requests = {};
    this._cache = {};
    this._app = app;
  }

  /**
   * Add a {@link ResourceHandler} for a resource type. Handler should support at least `load()`
   * and `open()`. Handlers can optionally support patch(asset, assets) to handle dependencies on
   * other assets.
   *
   * @param {string} type - The name of the resource type that the handler will be registered
   * with. Can be:
   *
   * - {@link ASSET_ANIMATION}
   * - {@link ASSET_AUDIO}
   * - {@link ASSET_IMAGE}
   * - {@link ASSET_JSON}
   * - {@link ASSET_MODEL}
   * - {@link ASSET_MATERIAL}
   * - {@link ASSET_TEXT}
   * - {@link ASSET_TEXTURE}
   * - {@link ASSET_CUBEMAP}
   * - {@link ASSET_SHADER}
   * - {@link ASSET_CSS}
   * - {@link ASSET_HTML}
   * - {@link ASSET_SCRIPT}
   * - {@link ASSET_CONTAINER}
   *
   * @param {import('./handler.js').ResourceHandler} handler - An instance of a resource handler
   * supporting at least `load()` and `open()`.
   * @example
   * const loader = new ResourceLoader();
   * loader.addHandler("json", new pc.JsonHandler());
   */
  addHandler(type, handler) {
    this._handlers[type] = handler;
    handler._loader = this;
  }

  /**
   * Remove a {@link ResourceHandler} for a resource type.
   *
   * @param {string} type - The name of the type that the handler will be removed.
   */
  removeHandler(type) {
    delete this._handlers[type];
  }

  /**
   * Get a {@link ResourceHandler} for a resource type.
   *
   * @param {string} type - The name of the resource type that the handler is registered with.
   * @returns {import('./handler.js').ResourceHandler|undefined} The registered handler, or
   * undefined if the requested handler is not registered.
   */
  getHandler(type) {
    return this._handlers[type];
  }
  static makeKey(url, type) {
    return `${url}-${type}`;
  }

  /**
   * Make a request for a resource from a remote URL. Parse the returned data using the handler
   * for the specified type. When loaded and parsed, use the callback to return an instance of
   * the resource.
   *
   * @param {string} url - The URL of the resource to load.
   * @param {string} type - The type of resource expected.
   * @param {ResourceLoaderCallback} callback - The callback used when the resource is loaded or
   * an error occurs. Passed (err, resource) where err is null if there are no errors.
   * @param {import('../asset/asset.js').Asset} [asset] - Optional asset that is passed into
   * handler.
   * @example
   * app.loader.load("../path/to/texture.png", "texture", function (err, texture) {
   *     // use texture here
   * });
   */
  load(url, type, callback, asset) {
    const handler = this._handlers[type];
    if (!handler) {
      const err = `No resource handler for asset type: '${type}' when loading [${url}]`;
      Debug.errorOnce(err);
      callback(err);
      return;
    }

    // handle requests with null file
    if (!url) {
      this._loadNull(handler, callback, asset);
      return;
    }
    const key = ResourceLoader.makeKey(url, type);
    if (this._cache[key] !== undefined) {
      // in cache
      callback(null, this._cache[key]);
    } else if (this._requests[key]) {
      // existing request
      this._requests[key].push(callback);
    } else {
      // new request
      this._requests[key] = [callback];
      const self = this;
      const handleLoad = function handleLoad(err, urlObj) {
        if (err) {
          self._onFailure(key, err);
          return;
        }
        handler.load(urlObj, function (err, data, extra) {
          // make sure key exists because loader
          // might have been destroyed by now
          if (!self._requests[key]) {
            return;
          }
          if (err) {
            self._onFailure(key, err);
            return;
          }
          try {
            self._onSuccess(key, handler.open(urlObj.original, data, asset), extra);
          } catch (e) {
            self._onFailure(key, e);
          }
        }, asset);
      };
      const normalizedUrl = url.split('?')[0];
      if (this._app.enableBundles && this._app.bundles.hasUrl(normalizedUrl)) {
        if (!this._app.bundles.canLoadUrl(normalizedUrl)) {
          handleLoad(`Bundle for ${url} not loaded yet`);
          return;
        }
        this._app.bundles.loadUrl(normalizedUrl, function (err, fileUrlFromBundle) {
          handleLoad(err, {
            load: fileUrlFromBundle,
            original: normalizedUrl
          });
        });
      } else {
        handleLoad(null, {
          load: url,
          original: asset && asset.file.filename || url
        });
      }
    }
  }

  // load an asset with no url, skipping bundles and caching
  _loadNull(handler, callback, asset) {
    const onLoad = function onLoad(err, data, extra) {
      if (err) {
        callback(err);
      } else {
        try {
          callback(null, handler.open(null, data, asset), extra);
        } catch (e) {
          callback(e);
        }
      }
    };
    handler.load(null, onLoad, asset);
  }
  _onSuccess(key, result, extra) {
    if (result !== null) {
      this._cache[key] = result;
    } else {
      delete this._cache[key];
    }
    for (let i = 0; i < this._requests[key].length; i++) {
      this._requests[key][i](null, result, extra);
    }
    delete this._requests[key];
  }
  _onFailure(key, err) {
    console.error(err);
    if (this._requests[key]) {
      for (let i = 0; i < this._requests[key].length; i++) {
        this._requests[key][i](err);
      }
      delete this._requests[key];
    }
  }

  /**
   * Convert raw resource data into a resource instance. E.g. Take 3D model format JSON and
   * return a {@link Model}.
   *
   * @param {string} type - The type of resource.
   * @param {*} data - The raw resource data.
   * @returns {*} The parsed resource data.
   */
  open(type, data) {
    const handler = this._handlers[type];
    if (!handler) {
      console.warn('No resource handler found for: ' + type);
      return data;
    }
    return handler.open(null, data);
  }

  /**
   * Perform any operations on a resource, that requires a dependency on its asset data or any
   * other asset data.
   *
   * @param {import('../asset/asset.js').Asset} asset - The asset to patch.
   * @param {import('../asset/asset-registry.js').AssetRegistry} assets - The asset registry.
   */
  patch(asset, assets) {
    const handler = this._handlers[asset.type];
    if (!handler) {
      console.warn('No resource handler found for: ' + asset.type);
      return;
    }
    if (handler.patch) {
      handler.patch(asset, assets);
    }
  }

  /**
   * Remove resource from cache.
   *
   * @param {string} url - The URL of the resource.
   * @param {string} type - The type of resource.
   */
  clearCache(url, type) {
    const key = ResourceLoader.makeKey(url, type);
    delete this._cache[key];
  }

  /**
   * Check cache for resource from a URL. If present, return the cached value.
   *
   * @param {string} url - The URL of the resource to get from the cache.
   * @param {string} type - The type of the resource.
   * @returns {*} The resource loaded from the cache.
   */
  getFromCache(url, type) {
    const key = ResourceLoader.makeKey(url, type);
    if (this._cache[key]) {
      return this._cache[key];
    }
    return undefined;
  }

  /**
   * Enables retrying of failed requests when loading assets.
   *
   * @param {number} maxRetries - The maximum number of times to retry loading an asset. Defaults
   * to 5.
   * @ignore
   */
  enableRetry(maxRetries = 5) {
    maxRetries = Math.max(0, maxRetries) || 0;
    for (const key in this._handlers) {
      this._handlers[key].maxRetries = maxRetries;
    }
  }

  /**
   * Disables retrying of failed requests when loading assets.
   *
   * @ignore
   */
  disableRetry() {
    for (const key in this._handlers) {
      this._handlers[key].maxRetries = 0;
    }
  }

  /**
   * Destroys the resource loader.
   */
  destroy() {
    this._handlers = {};
    this._requests = {};
    this._cache = {};
  }
}

export { ResourceLoader };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9hZGVyLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2hhbmRsZXJzL2xvYWRlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gJy4uLy4uL2NvcmUvZGVidWcuanMnO1xuXG4vKipcbiAqIENhbGxiYWNrIHVzZWQgYnkge0BsaW5rIFJlc291cmNlTG9hZGVyI2xvYWR9IHdoZW4gYSByZXNvdXJjZSBpcyBsb2FkZWQgKG9yIGFuIGVycm9yIG9jY3VycykuXG4gKlxuICogQGNhbGxiYWNrIFJlc291cmNlTG9hZGVyQ2FsbGJhY2tcbiAqIEBwYXJhbSB7c3RyaW5nfG51bGx9IGVyciAtIFRoZSBlcnJvciBtZXNzYWdlIGluIHRoZSBjYXNlIHdoZXJlIHRoZSBsb2FkIGZhaWxzLlxuICogQHBhcmFtIHsqfSBbcmVzb3VyY2VdIC0gVGhlIHJlc291cmNlIHRoYXQgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IGxvYWRlZC5cbiAqL1xuXG4vKipcbiAqIExvYWQgcmVzb3VyY2UgZGF0YSwgcG90ZW50aWFsbHkgZnJvbSByZW1vdGUgc291cmNlcy4gQ2FjaGVzIHJlc291cmNlIG9uIGxvYWQgdG8gcHJldmVudCBtdWx0aXBsZVxuICogcmVxdWVzdHMuIEFkZCBSZXNvdXJjZUhhbmRsZXJzIHRvIGhhbmRsZSBkaWZmZXJlbnQgdHlwZXMgb2YgcmVzb3VyY2VzLlxuICovXG5jbGFzcyBSZXNvdXJjZUxvYWRlciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IFJlc291cmNlTG9hZGVyIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uL2FwcC1iYXNlLmpzJykuQXBwQmFzZX0gYXBwIC0gVGhlIGFwcGxpY2F0aW9uLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGFwcCkge1xuICAgICAgICB0aGlzLl9oYW5kbGVycyA9IHt9O1xuICAgICAgICB0aGlzLl9yZXF1ZXN0cyA9IHt9O1xuICAgICAgICB0aGlzLl9jYWNoZSA9IHt9O1xuICAgICAgICB0aGlzLl9hcHAgPSBhcHA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkIGEge0BsaW5rIFJlc291cmNlSGFuZGxlcn0gZm9yIGEgcmVzb3VyY2UgdHlwZS4gSGFuZGxlciBzaG91bGQgc3VwcG9ydCBhdCBsZWFzdCBgbG9hZCgpYFxuICAgICAqIGFuZCBgb3BlbigpYC4gSGFuZGxlcnMgY2FuIG9wdGlvbmFsbHkgc3VwcG9ydCBwYXRjaChhc3NldCwgYXNzZXRzKSB0byBoYW5kbGUgZGVwZW5kZW5jaWVzIG9uXG4gICAgICogb3RoZXIgYXNzZXRzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBUaGUgbmFtZSBvZiB0aGUgcmVzb3VyY2UgdHlwZSB0aGF0IHRoZSBoYW5kbGVyIHdpbGwgYmUgcmVnaXN0ZXJlZFxuICAgICAqIHdpdGguIENhbiBiZTpcbiAgICAgKlxuICAgICAqIC0ge0BsaW5rIEFTU0VUX0FOSU1BVElPTn1cbiAgICAgKiAtIHtAbGluayBBU1NFVF9BVURJT31cbiAgICAgKiAtIHtAbGluayBBU1NFVF9JTUFHRX1cbiAgICAgKiAtIHtAbGluayBBU1NFVF9KU09OfVxuICAgICAqIC0ge0BsaW5rIEFTU0VUX01PREVMfVxuICAgICAqIC0ge0BsaW5rIEFTU0VUX01BVEVSSUFMfVxuICAgICAqIC0ge0BsaW5rIEFTU0VUX1RFWFR9XG4gICAgICogLSB7QGxpbmsgQVNTRVRfVEVYVFVSRX1cbiAgICAgKiAtIHtAbGluayBBU1NFVF9DVUJFTUFQfVxuICAgICAqIC0ge0BsaW5rIEFTU0VUX1NIQURFUn1cbiAgICAgKiAtIHtAbGluayBBU1NFVF9DU1N9XG4gICAgICogLSB7QGxpbmsgQVNTRVRfSFRNTH1cbiAgICAgKiAtIHtAbGluayBBU1NFVF9TQ1JJUFR9XG4gICAgICogLSB7QGxpbmsgQVNTRVRfQ09OVEFJTkVSfVxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4vaGFuZGxlci5qcycpLlJlc291cmNlSGFuZGxlcn0gaGFuZGxlciAtIEFuIGluc3RhbmNlIG9mIGEgcmVzb3VyY2UgaGFuZGxlclxuICAgICAqIHN1cHBvcnRpbmcgYXQgbGVhc3QgYGxvYWQoKWAgYW5kIGBvcGVuKClgLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogY29uc3QgbG9hZGVyID0gbmV3IFJlc291cmNlTG9hZGVyKCk7XG4gICAgICogbG9hZGVyLmFkZEhhbmRsZXIoXCJqc29uXCIsIG5ldyBwYy5Kc29uSGFuZGxlcigpKTtcbiAgICAgKi9cbiAgICBhZGRIYW5kbGVyKHR5cGUsIGhhbmRsZXIpIHtcbiAgICAgICAgdGhpcy5faGFuZGxlcnNbdHlwZV0gPSBoYW5kbGVyO1xuICAgICAgICBoYW5kbGVyLl9sb2FkZXIgPSB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBhIHtAbGluayBSZXNvdXJjZUhhbmRsZXJ9IGZvciBhIHJlc291cmNlIHR5cGUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZSAtIFRoZSBuYW1lIG9mIHRoZSB0eXBlIHRoYXQgdGhlIGhhbmRsZXIgd2lsbCBiZSByZW1vdmVkLlxuICAgICAqL1xuICAgIHJlbW92ZUhhbmRsZXIodHlwZSkge1xuICAgICAgICBkZWxldGUgdGhpcy5faGFuZGxlcnNbdHlwZV07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGEge0BsaW5rIFJlc291cmNlSGFuZGxlcn0gZm9yIGEgcmVzb3VyY2UgdHlwZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0gVGhlIG5hbWUgb2YgdGhlIHJlc291cmNlIHR5cGUgdGhhdCB0aGUgaGFuZGxlciBpcyByZWdpc3RlcmVkIHdpdGguXG4gICAgICogQHJldHVybnMge2ltcG9ydCgnLi9oYW5kbGVyLmpzJykuUmVzb3VyY2VIYW5kbGVyfHVuZGVmaW5lZH0gVGhlIHJlZ2lzdGVyZWQgaGFuZGxlciwgb3JcbiAgICAgKiB1bmRlZmluZWQgaWYgdGhlIHJlcXVlc3RlZCBoYW5kbGVyIGlzIG5vdCByZWdpc3RlcmVkLlxuICAgICAqL1xuICAgIGdldEhhbmRsZXIodHlwZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5faGFuZGxlcnNbdHlwZV07XG4gICAgfVxuXG4gICAgc3RhdGljIG1ha2VLZXkodXJsLCB0eXBlKSB7XG4gICAgICAgIHJldHVybiBgJHt1cmx9LSR7dHlwZX1gO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE1ha2UgYSByZXF1ZXN0IGZvciBhIHJlc291cmNlIGZyb20gYSByZW1vdGUgVVJMLiBQYXJzZSB0aGUgcmV0dXJuZWQgZGF0YSB1c2luZyB0aGUgaGFuZGxlclxuICAgICAqIGZvciB0aGUgc3BlY2lmaWVkIHR5cGUuIFdoZW4gbG9hZGVkIGFuZCBwYXJzZWQsIHVzZSB0aGUgY2FsbGJhY2sgdG8gcmV0dXJuIGFuIGluc3RhbmNlIG9mXG4gICAgICogdGhlIHJlc291cmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSBVUkwgb2YgdGhlIHJlc291cmNlIHRvIGxvYWQuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBUaGUgdHlwZSBvZiByZXNvdXJjZSBleHBlY3RlZC5cbiAgICAgKiBAcGFyYW0ge1Jlc291cmNlTG9hZGVyQ2FsbGJhY2t9IGNhbGxiYWNrIC0gVGhlIGNhbGxiYWNrIHVzZWQgd2hlbiB0aGUgcmVzb3VyY2UgaXMgbG9hZGVkIG9yXG4gICAgICogYW4gZXJyb3Igb2NjdXJzLiBQYXNzZWQgKGVyciwgcmVzb3VyY2UpIHdoZXJlIGVyciBpcyBudWxsIGlmIHRoZXJlIGFyZSBubyBlcnJvcnMuXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uL2Fzc2V0L2Fzc2V0LmpzJykuQXNzZXR9IFthc3NldF0gLSBPcHRpb25hbCBhc3NldCB0aGF0IGlzIHBhc3NlZCBpbnRvXG4gICAgICogaGFuZGxlci5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGFwcC5sb2FkZXIubG9hZChcIi4uL3BhdGgvdG8vdGV4dHVyZS5wbmdcIiwgXCJ0ZXh0dXJlXCIsIGZ1bmN0aW9uIChlcnIsIHRleHR1cmUpIHtcbiAgICAgKiAgICAgLy8gdXNlIHRleHR1cmUgaGVyZVxuICAgICAqIH0pO1xuICAgICAqL1xuICAgIGxvYWQodXJsLCB0eXBlLCBjYWxsYmFjaywgYXNzZXQpIHtcbiAgICAgICAgY29uc3QgaGFuZGxlciA9IHRoaXMuX2hhbmRsZXJzW3R5cGVdO1xuICAgICAgICBpZiAoIWhhbmRsZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IGVyciA9IGBObyByZXNvdXJjZSBoYW5kbGVyIGZvciBhc3NldCB0eXBlOiAnJHt0eXBlfScgd2hlbiBsb2FkaW5nIFske3VybH1dYDtcbiAgICAgICAgICAgIERlYnVnLmVycm9yT25jZShlcnIpO1xuICAgICAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGhhbmRsZSByZXF1ZXN0cyB3aXRoIG51bGwgZmlsZVxuICAgICAgICBpZiAoIXVybCkge1xuICAgICAgICAgICAgdGhpcy5fbG9hZE51bGwoaGFuZGxlciwgY2FsbGJhY2ssIGFzc2V0KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGtleSA9IFJlc291cmNlTG9hZGVyLm1ha2VLZXkodXJsLCB0eXBlKTtcblxuICAgICAgICBpZiAodGhpcy5fY2FjaGVba2V5XSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAvLyBpbiBjYWNoZVxuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgdGhpcy5fY2FjaGVba2V5XSk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fcmVxdWVzdHNba2V5XSkge1xuICAgICAgICAgICAgLy8gZXhpc3RpbmcgcmVxdWVzdFxuICAgICAgICAgICAgdGhpcy5fcmVxdWVzdHNba2V5XS5wdXNoKGNhbGxiYWNrKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIG5ldyByZXF1ZXN0XG4gICAgICAgICAgICB0aGlzLl9yZXF1ZXN0c1trZXldID0gW2NhbGxiYWNrXTtcblxuICAgICAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIGNvbnN0IGhhbmRsZUxvYWQgPSBmdW5jdGlvbiAoZXJyLCB1cmxPYmopIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX29uRmFpbHVyZShrZXksIGVycik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBoYW5kbGVyLmxvYWQodXJsT2JqLCBmdW5jdGlvbiAoZXJyLCBkYXRhLCBleHRyYSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUga2V5IGV4aXN0cyBiZWNhdXNlIGxvYWRlclxuICAgICAgICAgICAgICAgICAgICAvLyBtaWdodCBoYXZlIGJlZW4gZGVzdHJveWVkIGJ5IG5vd1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXNlbGYuX3JlcXVlc3RzW2tleV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29uRmFpbHVyZShrZXksIGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb25TdWNjZXNzKGtleSwgaGFuZGxlci5vcGVuKHVybE9iai5vcmlnaW5hbCwgZGF0YSwgYXNzZXQpLCBleHRyYSk7XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX29uRmFpbHVyZShrZXksIGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgYXNzZXQpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplZFVybCA9IHVybC5zcGxpdCgnPycpWzBdO1xuICAgICAgICAgICAgaWYgKHRoaXMuX2FwcC5lbmFibGVCdW5kbGVzICYmIHRoaXMuX2FwcC5idW5kbGVzLmhhc1VybChub3JtYWxpemVkVXJsKSkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fYXBwLmJ1bmRsZXMuY2FuTG9hZFVybChub3JtYWxpemVkVXJsKSkge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVMb2FkKGBCdW5kbGUgZm9yICR7dXJsfSBub3QgbG9hZGVkIHlldGApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5fYXBwLmJ1bmRsZXMubG9hZFVybChub3JtYWxpemVkVXJsLCBmdW5jdGlvbiAoZXJyLCBmaWxlVXJsRnJvbUJ1bmRsZSkge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVMb2FkKGVyciwge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9hZDogZmlsZVVybEZyb21CdW5kbGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbDogbm9ybWFsaXplZFVybFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlTG9hZChudWxsLCB7XG4gICAgICAgICAgICAgICAgICAgIGxvYWQ6IHVybCxcbiAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWw6IGFzc2V0ICYmIGFzc2V0LmZpbGUuZmlsZW5hbWUgfHwgdXJsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBsb2FkIGFuIGFzc2V0IHdpdGggbm8gdXJsLCBza2lwcGluZyBidW5kbGVzIGFuZCBjYWNoaW5nXG4gICAgX2xvYWROdWxsKGhhbmRsZXIsIGNhbGxiYWNrLCBhc3NldCkge1xuICAgICAgICBjb25zdCBvbkxvYWQgPSBmdW5jdGlvbiAoZXJyLCBkYXRhLCBleHRyYSkge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGhhbmRsZXIub3BlbihudWxsLCBkYXRhLCBhc3NldCksIGV4dHJhKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgaGFuZGxlci5sb2FkKG51bGwsIG9uTG9hZCwgYXNzZXQpO1xuICAgIH1cblxuICAgIF9vblN1Y2Nlc3Moa2V5LCByZXN1bHQsIGV4dHJhKSB7XG4gICAgICAgIGlmIChyZXN1bHQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuX2NhY2hlW2tleV0gPSByZXN1bHQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fY2FjaGVba2V5XTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX3JlcXVlc3RzW2tleV0ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RzW2tleV1baV0obnVsbCwgcmVzdWx0LCBleHRyYSk7XG4gICAgICAgIH1cbiAgICAgICAgZGVsZXRlIHRoaXMuX3JlcXVlc3RzW2tleV07XG4gICAgfVxuXG4gICAgX29uRmFpbHVyZShrZXksIGVycikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgIGlmICh0aGlzLl9yZXF1ZXN0c1trZXldKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX3JlcXVlc3RzW2tleV0ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZXF1ZXN0c1trZXldW2ldKGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fcmVxdWVzdHNba2V5XTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnQgcmF3IHJlc291cmNlIGRhdGEgaW50byBhIHJlc291cmNlIGluc3RhbmNlLiBFLmcuIFRha2UgM0QgbW9kZWwgZm9ybWF0IEpTT04gYW5kXG4gICAgICogcmV0dXJuIGEge0BsaW5rIE1vZGVsfS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0gVGhlIHR5cGUgb2YgcmVzb3VyY2UuXG4gICAgICogQHBhcmFtIHsqfSBkYXRhIC0gVGhlIHJhdyByZXNvdXJjZSBkYXRhLlxuICAgICAqIEByZXR1cm5zIHsqfSBUaGUgcGFyc2VkIHJlc291cmNlIGRhdGEuXG4gICAgICovXG4gICAgb3Blbih0eXBlLCBkYXRhKSB7XG4gICAgICAgIGNvbnN0IGhhbmRsZXIgPSB0aGlzLl9oYW5kbGVyc1t0eXBlXTtcbiAgICAgICAgaWYgKCFoYW5kbGVyKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ05vIHJlc291cmNlIGhhbmRsZXIgZm91bmQgZm9yOiAnICsgdHlwZSk7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBoYW5kbGVyLm9wZW4obnVsbCwgZGF0YSk7XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQZXJmb3JtIGFueSBvcGVyYXRpb25zIG9uIGEgcmVzb3VyY2UsIHRoYXQgcmVxdWlyZXMgYSBkZXBlbmRlbmN5IG9uIGl0cyBhc3NldCBkYXRhIG9yIGFueVxuICAgICAqIG90aGVyIGFzc2V0IGRhdGEuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vYXNzZXQvYXNzZXQuanMnKS5Bc3NldH0gYXNzZXQgLSBUaGUgYXNzZXQgdG8gcGF0Y2guXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uL2Fzc2V0L2Fzc2V0LXJlZ2lzdHJ5LmpzJykuQXNzZXRSZWdpc3RyeX0gYXNzZXRzIC0gVGhlIGFzc2V0IHJlZ2lzdHJ5LlxuICAgICAqL1xuICAgIHBhdGNoKGFzc2V0LCBhc3NldHMpIHtcbiAgICAgICAgY29uc3QgaGFuZGxlciA9IHRoaXMuX2hhbmRsZXJzW2Fzc2V0LnR5cGVdO1xuICAgICAgICBpZiAoIWhhbmRsZXIpICB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ05vIHJlc291cmNlIGhhbmRsZXIgZm91bmQgZm9yOiAnICsgYXNzZXQudHlwZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaGFuZGxlci5wYXRjaCkge1xuICAgICAgICAgICAgaGFuZGxlci5wYXRjaChhc3NldCwgYXNzZXRzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSByZXNvdXJjZSBmcm9tIGNhY2hlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSBVUkwgb2YgdGhlIHJlc291cmNlLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0gVGhlIHR5cGUgb2YgcmVzb3VyY2UuXG4gICAgICovXG4gICAgY2xlYXJDYWNoZSh1cmwsIHR5cGUpIHtcbiAgICAgICAgY29uc3Qga2V5ID0gUmVzb3VyY2VMb2FkZXIubWFrZUtleSh1cmwsIHR5cGUpO1xuICAgICAgICBkZWxldGUgdGhpcy5fY2FjaGVba2V5XTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBjYWNoZSBmb3IgcmVzb3VyY2UgZnJvbSBhIFVSTC4gSWYgcHJlc2VudCwgcmV0dXJuIHRoZSBjYWNoZWQgdmFsdWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIC0gVGhlIFVSTCBvZiB0aGUgcmVzb3VyY2UgdG8gZ2V0IGZyb20gdGhlIGNhY2hlLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0gVGhlIHR5cGUgb2YgdGhlIHJlc291cmNlLlxuICAgICAqIEByZXR1cm5zIHsqfSBUaGUgcmVzb3VyY2UgbG9hZGVkIGZyb20gdGhlIGNhY2hlLlxuICAgICAqL1xuICAgIGdldEZyb21DYWNoZSh1cmwsIHR5cGUpIHtcbiAgICAgICAgY29uc3Qga2V5ID0gUmVzb3VyY2VMb2FkZXIubWFrZUtleSh1cmwsIHR5cGUpO1xuICAgICAgICBpZiAodGhpcy5fY2FjaGVba2V5XSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhY2hlW2tleV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFbmFibGVzIHJldHJ5aW5nIG9mIGZhaWxlZCByZXF1ZXN0cyB3aGVuIGxvYWRpbmcgYXNzZXRzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IG1heFJldHJpZXMgLSBUaGUgbWF4aW11bSBudW1iZXIgb2YgdGltZXMgdG8gcmV0cnkgbG9hZGluZyBhbiBhc3NldC4gRGVmYXVsdHNcbiAgICAgKiB0byA1LlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBlbmFibGVSZXRyeShtYXhSZXRyaWVzID0gNSkge1xuICAgICAgICBtYXhSZXRyaWVzID0gTWF0aC5tYXgoMCwgbWF4UmV0cmllcykgfHwgMDtcblxuICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLl9oYW5kbGVycykge1xuICAgICAgICAgICAgdGhpcy5faGFuZGxlcnNba2V5XS5tYXhSZXRyaWVzID0gbWF4UmV0cmllcztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERpc2FibGVzIHJldHJ5aW5nIG9mIGZhaWxlZCByZXF1ZXN0cyB3aGVuIGxvYWRpbmcgYXNzZXRzLlxuICAgICAqXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIGRpc2FibGVSZXRyeSgpIHtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gdGhpcy5faGFuZGxlcnMpIHtcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZXJzW2tleV0ubWF4UmV0cmllcyA9IDA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZXN0cm95cyB0aGUgcmVzb3VyY2UgbG9hZGVyLlxuICAgICAqL1xuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuX2hhbmRsZXJzID0ge307XG4gICAgICAgIHRoaXMuX3JlcXVlc3RzID0ge307XG4gICAgICAgIHRoaXMuX2NhY2hlID0ge307XG4gICAgfVxufVxuXG5leHBvcnQgeyBSZXNvdXJjZUxvYWRlciB9O1xuIl0sIm5hbWVzIjpbIlJlc291cmNlTG9hZGVyIiwiY29uc3RydWN0b3IiLCJhcHAiLCJfaGFuZGxlcnMiLCJfcmVxdWVzdHMiLCJfY2FjaGUiLCJfYXBwIiwiYWRkSGFuZGxlciIsInR5cGUiLCJoYW5kbGVyIiwiX2xvYWRlciIsInJlbW92ZUhhbmRsZXIiLCJnZXRIYW5kbGVyIiwibWFrZUtleSIsInVybCIsImxvYWQiLCJjYWxsYmFjayIsImFzc2V0IiwiZXJyIiwiRGVidWciLCJlcnJvck9uY2UiLCJfbG9hZE51bGwiLCJrZXkiLCJ1bmRlZmluZWQiLCJwdXNoIiwic2VsZiIsImhhbmRsZUxvYWQiLCJ1cmxPYmoiLCJfb25GYWlsdXJlIiwiZGF0YSIsImV4dHJhIiwiX29uU3VjY2VzcyIsIm9wZW4iLCJvcmlnaW5hbCIsImUiLCJub3JtYWxpemVkVXJsIiwic3BsaXQiLCJlbmFibGVCdW5kbGVzIiwiYnVuZGxlcyIsImhhc1VybCIsImNhbkxvYWRVcmwiLCJsb2FkVXJsIiwiZmlsZVVybEZyb21CdW5kbGUiLCJmaWxlIiwiZmlsZW5hbWUiLCJvbkxvYWQiLCJyZXN1bHQiLCJpIiwibGVuZ3RoIiwiY29uc29sZSIsImVycm9yIiwid2FybiIsInBhdGNoIiwiYXNzZXRzIiwiY2xlYXJDYWNoZSIsImdldEZyb21DYWNoZSIsImVuYWJsZVJldHJ5IiwibWF4UmV0cmllcyIsIk1hdGgiLCJtYXgiLCJkaXNhYmxlUmV0cnkiLCJkZXN0cm95Il0sIm1hcHBpbmdzIjoiOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUEsY0FBYyxDQUFDO0FBQ2pCO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7RUFDSUMsV0FBV0EsQ0FBQ0MsR0FBRyxFQUFFO0FBQ2IsSUFBQSxJQUFJLENBQUNDLFNBQVMsR0FBRyxFQUFFLENBQUE7QUFDbkIsSUFBQSxJQUFJLENBQUNDLFNBQVMsR0FBRyxFQUFFLENBQUE7QUFDbkIsSUFBQSxJQUFJLENBQUNDLE1BQU0sR0FBRyxFQUFFLENBQUE7SUFDaEIsSUFBSSxDQUFDQyxJQUFJLEdBQUdKLEdBQUcsQ0FBQTtBQUNuQixHQUFBOztBQUVBO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDSUssRUFBQUEsVUFBVUEsQ0FBQ0MsSUFBSSxFQUFFQyxPQUFPLEVBQUU7QUFDdEIsSUFBQSxJQUFJLENBQUNOLFNBQVMsQ0FBQ0ssSUFBSSxDQUFDLEdBQUdDLE9BQU8sQ0FBQTtJQUM5QkEsT0FBTyxDQUFDQyxPQUFPLEdBQUcsSUFBSSxDQUFBO0FBQzFCLEdBQUE7O0FBRUE7QUFDSjtBQUNBO0FBQ0E7QUFDQTtFQUNJQyxhQUFhQSxDQUFDSCxJQUFJLEVBQUU7QUFDaEIsSUFBQSxPQUFPLElBQUksQ0FBQ0ws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
