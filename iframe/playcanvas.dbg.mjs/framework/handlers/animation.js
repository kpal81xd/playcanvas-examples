import { path } from '../../core/path.js';
import { Quat } from '../../core/math/quat.js';
import { Vec3 } from '../../core/math/vec3.js';
import { Http, http } from '../../platform/net/http.js';
import { Animation, Node, Key } from '../../scene/animation/animation.js';
import { AnimEvents } from '../anim/evaluator/anim-events.js';
import { GlbParser } from '../parsers/glb-parser.js';
import { ResourceHandler } from './handler.js';

/**
 * Resource handler used for loading {@link Animation} resources.
 *
 * @category Animation
 */
class AnimationHandler extends ResourceHandler {
  /**
   * @param {import('../app-base.js').AppBase} app - The running {@link AppBase}.
   * @ignore
   */
  constructor(app) {
    super(app, 'animation');
    this.device = app.graphicsDevice;
    this.assets = app.assets;
  }
  load(url, callback, asset) {
    if (typeof url === 'string') {
      url = {
        load: url,
        original: url
      };
    }

    // we need to specify JSON for blob URLs
    const options = {
      retry: this.maxRetries > 0,
      maxRetries: this.maxRetries
    };
    if (url.load.startsWith('blob:') || url.load.startsWith('data:')) {
      if (path.getExtension(url.original).toLowerCase() === '.glb') {
        options.responseType = Http.ResponseType.ARRAY_BUFFER;
      } else {
        options.responseType = Http.ResponseType.JSON;
      }
    }
    http.get(url.load, options, (err, response) => {
      if (err) {
        callback(`Error loading animation resource: ${url.original} [${err}]`);
      } else {
        // parse the result immediately (this used to happen during open)
        if (path.getExtension(url.original).toLowerCase() === '.glb') {
          var _asset$options;
          GlbParser.parse('filename.glb', '', response, this.device, this.assets, (_asset$options = asset == null ? void 0 : asset.options) != null ? _asset$options : {}, (err, parseResult) => {
            if (err) {
              callback(err);
            } else {
              var _asset$data;
              const animations = parseResult.animations;
              if (asset != null && (_asset$data = asset.data) != null && _asset$data.events) {
                for (let i = 0; i < animations.length; i++) {
                  animations[i].events = new AnimEvents(Object.values(asset.data.events));
                }
              }
              parseResult.destroy();
              callback(null, animations);
            }
          });
        } else {
          callback(null, this['_parseAnimationV' + response.animation.version](response));
        }
      }
    });
  }
  open(url, data, asset) {
    return data;
  }
  _parseAnimationV3(data) {
    const animData = data.animation;
    const anim = new Animation();
    anim.name = animData.name;
    anim.duration = animData.duration;
    for (let i = 0; i < animData.nodes.length; i++) {
      const node = new Node();
      const n = animData.nodes[i];
      node._name = n.name;
      for (let j = 0; j < n.keys.length; j++) {
        const k = n.keys[j];
        const t = k.time;
        const p = k.pos;
        const r = k.rot;
        const s = k.scale;
        const pos = new Vec3(p[0], p[1], p[2]);
        const rot = new Quat().setFromEulerAngles(r[0], r[1], r[2]);
        const scl = new Vec3(s[0], s[1], s[2]);
        const key = new Key(t, pos, rot, scl);
        node._keys.push(key);
      }
      anim.addNode(node);
    }
    return anim;
  }
  _parseAnimationV4(data) {
    const animData = data.animation;
    const anim = new Animation();
    anim.name = animData.name;
    anim.duration = animData.duration;
    for (let i = 0; i < animData.nodes.length; i++) {
      const node = new Node();
      const n = animData.nodes[i];
      node._name = n.name;
      const defPos = n.defaults.p;
      const defRot = n.defaults.r;
      const defScl = n.defaults.s;
      for (let j = 0; j < n.keys.length; j++) {
        const k = n.keys[j];
        const t = k.t;
        const p = defPos ? defPos : k.p;
        const r = defRot ? defRot : k.r;
        const s = defScl ? defScl : k.s;
        const pos = new Vec3(p[0], p[1], p[2]);
        const rot = new Quat().setFromEulerAngles(r[0], r[1], r[2]);
        const scl = new Vec3(s[0], s[1], s[2]);
        const key = new Key(t, pos, rot, scl);
        node._keys.push(key);
      }
      anim.addNode(node);
    }
    return anim;
  }
}

export { AnimationHandler };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5pbWF0aW9uLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2hhbmRsZXJzL2FuaW1hdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwYXRoIH0gZnJvbSAnLi4vLi4vY29yZS9wYXRoLmpzJztcblxuaW1wb3J0IHsgUXVhdCB9IGZyb20gJy4uLy4uL2NvcmUvbWF0aC9xdWF0LmpzJztcbmltcG9ydCB7IFZlYzMgfSBmcm9tICcuLi8uLi9jb3JlL21hdGgvdmVjMy5qcyc7XG5cbmltcG9ydCB7IGh0dHAsIEh0dHAgfSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9uZXQvaHR0cC5qcyc7XG5cbmltcG9ydCB7IEFuaW1hdGlvbiwgS2V5LCBOb2RlIH0gZnJvbSAnLi4vLi4vc2NlbmUvYW5pbWF0aW9uL2FuaW1hdGlvbi5qcyc7XG5pbXBvcnQgeyBBbmltRXZlbnRzIH0gZnJvbSAnLi4vYW5pbS9ldmFsdWF0b3IvYW5pbS1ldmVudHMuanMnO1xuXG5pbXBvcnQgeyBHbGJQYXJzZXIgfSBmcm9tICcuLi9wYXJzZXJzL2dsYi1wYXJzZXIuanMnO1xuXG5pbXBvcnQgeyBSZXNvdXJjZUhhbmRsZXIgfSBmcm9tICcuL2hhbmRsZXIuanMnO1xuXG4vKipcbiAqIFJlc291cmNlIGhhbmRsZXIgdXNlZCBmb3IgbG9hZGluZyB7QGxpbmsgQW5pbWF0aW9ufSByZXNvdXJjZXMuXG4gKlxuICogQGNhdGVnb3J5IEFuaW1hdGlvblxuICovXG5jbGFzcyBBbmltYXRpb25IYW5kbGVyIGV4dGVuZHMgUmVzb3VyY2VIYW5kbGVyIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vYXBwLWJhc2UuanMnKS5BcHBCYXNlfSBhcHAgLSBUaGUgcnVubmluZyB7QGxpbmsgQXBwQmFzZX0uXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGFwcCkge1xuICAgICAgICBzdXBlcihhcHAsICdhbmltYXRpb24nKTtcblxuICAgICAgICB0aGlzLmRldmljZSA9IGFwcC5ncmFwaGljc0RldmljZTtcbiAgICAgICAgdGhpcy5hc3NldHMgPSBhcHAuYXNzZXRzO1xuICAgIH1cblxuICAgIGxvYWQodXJsLCBjYWxsYmFjaywgYXNzZXQpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB1cmwgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICB1cmwgPSB7XG4gICAgICAgICAgICAgICAgbG9hZDogdXJsLFxuICAgICAgICAgICAgICAgIG9yaWdpbmFsOiB1cmxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyB3ZSBuZWVkIHRvIHNwZWNpZnkgSlNPTiBmb3IgYmxvYiBVUkxzXG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICByZXRyeTogdGhpcy5tYXhSZXRyaWVzID4gMCxcbiAgICAgICAgICAgIG1heFJldHJpZXM6IHRoaXMubWF4UmV0cmllc1xuICAgICAgICB9O1xuXG4gICAgICAgIGlmICh1cmwubG9hZC5zdGFydHNXaXRoKCdibG9iOicpIHx8IHVybC5sb2FkLnN0YXJ0c1dpdGgoJ2RhdGE6JykpIHtcbiAgICAgICAgICAgIGlmIChwYXRoLmdldEV4dGVuc2lvbih1cmwub3JpZ2luYWwpLnRvTG93ZXJDYXNlKCkgPT09ICcuZ2xiJykge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMucmVzcG9uc2VUeXBlID0gSHR0cC5SZXNwb25zZVR5cGUuQVJSQVlfQlVGRkVSO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLnJlc3BvbnNlVHlwZSA9IEh0dHAuUmVzcG9uc2VUeXBlLkpTT047XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBodHRwLmdldCh1cmwubG9hZCwgb3B0aW9ucywgKGVyciwgcmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhgRXJyb3IgbG9hZGluZyBhbmltYXRpb24gcmVzb3VyY2U6ICR7dXJsLm9yaWdpbmFsfSBbJHtlcnJ9XWApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBwYXJzZSB0aGUgcmVzdWx0IGltbWVkaWF0ZWx5ICh0aGlzIHVzZWQgdG8gaGFwcGVuIGR1cmluZyBvcGVuKVxuICAgICAgICAgICAgICAgIGlmIChwYXRoLmdldEV4dGVuc2lvbih1cmwub3JpZ2luYWwpLnRvTG93ZXJDYXNlKCkgPT09ICcuZ2xiJykge1xuICAgICAgICAgICAgICAgICAgICBHbGJQYXJzZXIucGFyc2UoJ2ZpbGVuYW1lLmdsYicsICcnLCByZXNwb25zZSwgdGhpcy5kZXZpY2UsIHRoaXMuYXNzZXRzLCBhc3NldD8ub3B0aW9ucyA/PyB7fSwgKGVyciwgcGFyc2VSZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhbmltYXRpb25zID0gcGFyc2VSZXN1bHQuYW5pbWF0aW9ucztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXNzZXQ/LmRhdGE/LmV2ZW50cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFuaW1hdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbnNbaV0uZXZlbnRzID0gbmV3IEFuaW1FdmVudHMoT2JqZWN0LnZhbHVlcyhhc3NldC5kYXRhLmV2ZW50cykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlUmVzdWx0LmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBhbmltYXRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgdGhpc1snX3BhcnNlQW5pbWF0aW9uVicgKyByZXNwb25zZS5hbmltYXRpb24udmVyc2lvbl0ocmVzcG9uc2UpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG9wZW4odXJsLCBkYXRhLCBhc3NldCkge1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG5cbiAgICBfcGFyc2VBbmltYXRpb25WMyhkYXRhKSB7XG4gICAgICAgIGNvbnN0IGFuaW1EYXRhID0gZGF0YS5hbmltYXRpb247XG5cbiAgICAgICAgY29uc3QgYW5pbSA9IG5ldyBBbmltYXRpb24oKTtcbiAgICAgICAgYW5pbS5uYW1lID0gYW5pbURhdGEubmFtZTtcbiAgICAgICAgYW5pbS5kdXJhdGlvbiA9IGFuaW1EYXRhLmR1cmF0aW9uO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYW5pbURhdGEubm9kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBuZXcgTm9kZSgpO1xuXG4gICAgICAgICAgICBjb25zdCBuID0gYW5pbURhdGEubm9kZXNbaV07XG4gICAgICAgICAgICBub2RlLl9uYW1lID0gbi5uYW1lO1xuXG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IG4ua2V5cy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGsgPSBuLmtleXNbal07XG5cbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gay50aW1lO1xuICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBrLnBvcztcbiAgICAgICAgICAgICAgICBjb25zdCByID0gay5yb3Q7XG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IGsuc2NhbGU7XG4gICAgICAgICAgICAgICAgY29uc3QgcG9zID0gbmV3IFZlYzMocFswXSwgcFsxXSwgcFsyXSk7XG4gICAgICAgICAgICAgICAgY29uc3Qgcm90ID0gbmV3IFF1YXQoKS5zZXRGcm9tRXVsZXJBbmdsZXMoclswXSwgclsxXSwgclsyXSk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2NsID0gbmV3IFZlYzMoc1swXSwgc1sxXSwgc1syXSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBuZXcgS2V5KHQsIHBvcywgcm90LCBzY2wpO1xuXG4gICAgICAgICAgICAgICAgbm9kZS5fa2V5cy5wdXNoKGtleSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFuaW0uYWRkTm9kZShub2RlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhbmltO1xuICAgIH1cblxuICAgIF9wYXJzZUFuaW1hdGlvblY0KGRhdGEpIHtcbiAgICAgICAgY29uc3QgYW5pbURhdGEgPSBkYXRhLmFuaW1hdGlvbjtcblxuICAgICAgICBjb25zdCBhbmltID0gbmV3IEFuaW1hdGlvbigpO1xuICAgICAgICBhbmltLm5hbWUgPSBhbmltRGF0YS5uYW1lO1xuICAgICAgICBhbmltLmR1cmF0aW9uID0gYW5pbURhdGEuZHVyYXRpb247XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhbmltRGF0YS5ub2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3Qgbm9kZSA9IG5ldyBOb2RlKCk7XG5cbiAgICAgICAgICAgIGNvbnN0IG4gPSBhbmltRGF0YS5ub2Rlc1tpXTtcbiAgICAgICAgICAgIG5vZGUuX25hbWUgPSBuLm5hbWU7XG5cbiAgICAgICAgICAgIGNvbnN0IGRlZlBvcyA9IG4uZGVmYXVsdHMucDtcbiAgICAgICAgICAgIGNvbnN0IGRlZlJvdCA9IG4uZGVmYXVsdHMucjtcbiAgICAgICAgICAgIGNvbnN0IGRlZlNjbCA9IG4uZGVmYXVsdHMucztcblxuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBuLmtleXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBrID0gbi5rZXlzW2pdO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IGsudDtcbiAgICAgICAgICAgICAgICBjb25zdCBwID0gZGVmUG9zID8gZGVmUG9zIDogay5wO1xuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBkZWZSb3QgPyBkZWZSb3QgOiBrLnI7XG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IGRlZlNjbCA/IGRlZlNjbCA6IGsucztcbiAgICAgICAgICAgICAgICBjb25zdCBwb3MgPSBuZXcgVmVjMyhwWzBdLCBwWzFdLCBwWzJdKTtcbiAgICAgICAgICAgICAgICBjb25zdCByb3QgPSBuZXcgUXVhdCgpLnNldEZyb21FdWxlckFuZ2xlcyhyWzBdLCByWzFdLCByWzJdKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzY2wgPSBuZXcgVmVjMyhzWzBdLCBzWzFdLCBzWzJdKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IG5ldyBLZXkodCwgcG9zLCByb3QsIHNjbCk7XG5cbiAgICAgICAgICAgICAgICBub2RlLl9rZXlzLnB1c2goa2V5KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYW5pbS5hZGROb2RlKG5vZGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFuaW07XG4gICAgfVxufVxuXG5leHBvcnQgeyBBbmltYXRpb25IYW5kbGVyIH07XG4iXSwibmFtZXMiOlsiQW5pbWF0aW9uSGFuZGxlciIsIlJlc291cmNlSGFuZGxlciIsImNvbnN0cnVjdG9yIiwiYXBwIiwiZGV2aWNlIiwiZ3JhcGhpY3NEZXZpY2UiLCJhc3NldHMiLCJsb2FkIiwidXJsIiwiY2FsbGJhY2siLCJhc3NldCIsIm9yaWdpbmFsIiwib3B0aW9ucyIsInJldHJ5IiwibWF4UmV0cmllcyIsInN0YXJ0c1dpdGgiLCJwYXRoIiwiZ2V0RXh0ZW5zaW9uIiwidG9Mb3dlckNhc2UiLCJyZXNwb25zZVR5cGUiLCJIdHRwIiwiUmVzcG9uc2VUeXBlIiwiQVJSQVlfQlVGRkVSIiwiSlNPTiIsImh0dHAiLCJnZXQiLCJlcnIiLCJyZXNwb25zZSIsIl9hc3NldCRvcHRpb25zIiwiR2xiUGFyc2VyIiwicGFyc2UiLCJwYXJzZVJlc3VsdCIsIl9hc3NldCRkYXRhIiwiYW5pbWF0aW9ucyIsImRhdGEiLCJldmVudHMiLCJpIiwibGVuZ3RoIiwiQW5pbUV2ZW50cyIsIk9iamVjdCIsInZhbHVlcyIsImRlc3Ryb3kiLCJhbmltYXRpb24iLCJ2ZXJzaW9uIiwib3BlbiIsIl9wYXJzZUFuaW1hdGlvblYzIiwiYW5pbURhdGEiLCJhbmltIiwiQW5pbWF0aW9uIiwibmFtZSIsImR1cmF0aW9uIiwibm9kZXMiLCJub2RlIiwiTm9kZSIsIm4iLCJfbmFtZSIsImoiLCJrZXlzIiwiayIsInQiLCJ0aW1lIiwicCIsInBvcyIsInIiLCJyb3QiLCJzIiwic2NhbGUiLCJWZWMzIiwiUXVhdCIsInNldEZyb21FdWxlckFuZ2xlcyIsInNjbCIsImtleSIsIktleSIsIl9rZXlzIiwicHVzaCIsImFkZE5vZGUiLCJfcGFyc2VBbmltYXRpb25WNCIsImRlZlBvcyIsImRlZmF1bHRzIiwiZGVmUm90IiwiZGVmU2NsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFjQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUEsZ0JBQWdCLFNBQVNDLGVBQWUsQ0FBQztBQUMzQztBQUNKO0FBQ0E7QUFDQTtFQUNJQyxXQUFXQSxDQUFDQyxHQUFHLEVBQUU7QUFDYixJQUFBLEtBQUssQ0FBQ0EsR0FBRyxFQUFFLFdBQVcsQ0FBQyxDQUFBO0FBRXZCLElBQUEsSUFBSSxDQUFDQyxNQUFNLEdBQUdELEdBQUcsQ0FBQ0UsY0FBYyxDQUFB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
