import { path } from '../../core/path.js';
import { string } from '../../core/string.js';
import { http } from '../../platform/net/http.js';
import { Font } from '../font/font.js';
import { ResourceHandler } from './handler.js';

function upgradeDataSchema(data) {
  // convert v1 and v2 to v3 font data schema
  if (data.version < 3) {
    if (data.version < 2) {
      data.info.maps = data.info.maps || [{
        width: data.info.width,
        height: data.info.height
      }];
    }
    data.chars = Object.keys(data.chars || {}).reduce(function (newChars, key) {
      const existing = data.chars[key];
      // key by letter instead of char code
      const newKey = existing.letter !== undefined ? existing.letter : string.fromCodePoint(key);
      if (data.version < 2) {
        existing.map = existing.map || 0;
      }
      newChars[newKey] = existing;
      return newChars;
    }, {});
    data.version = 3;
  }
  return data;
}

/**
 * Resource handler used for loading {@link Font} resources.
 *
 * @category User Interface
 */
class FontHandler extends ResourceHandler {
  /**
   * Create a new FontHandler instance.
   *
   * @param {import('../app-base.js').AppBase} app - The running {@link AppBase}.
   * @ignore
   */
  constructor(app) {
    super(app, 'font');
    this._loader = app.loader;
    this.maxRetries = 0;
  }
  load(url, callback, asset) {
    if (typeof url === 'string') {
      url = {
        load: url,
        original: url
      };
    }
    const self = this;
    if (path.getExtension(url.original) === '.json') {
      // load json data then load texture of same name
      http.get(url.load, {
        retry: this.maxRetries > 0,
        maxRetries: this.maxRetries
      }, function (err, response) {
        // update asset data
        if (!err) {
          const data = upgradeDataSchema(response);
          self._loadTextures(url.load.replace('.json', '.png'), data, function (err, textures) {
            if (err) {
              callback(err);
            } else {
              callback(null, {
                data: data,
                textures: textures
              });
            }
          });
        } else {
          callback(`Error loading font resource: ${url.original} [${err}]`);
        }
      });
    } else {
      // upgrade asset data
      if (asset && asset.data) {
        asset.data = upgradeDataSchema(asset.data);
      }
      this._loadTextures(url.load, asset && asset.data, callback);
    }
  }
  _loadTextures(url, data, callback) {
    const numTextures = data.info.maps.length;
    let numLoaded = 0;
    let error = null;
    const textures = new Array(numTextures);
    const loader = this._loader;
    const loadTexture = function loadTexture(index) {
      const onLoaded = function onLoaded(err, texture) {
        if (error) return;
        if (err) {
          error = err;
          callback(err);
          return;
        }
        texture.upload();
        textures[index] = texture;
        numLoaded++;
        if (numLoaded === numTextures) {
          callback(null, textures);
        }
      };
      if (index === 0) {
        loader.load(url, 'texture', onLoaded);
      } else {
        loader.load(url.replace('.png', index + '.png'), 'texture', onLoaded);
      }
    };
    for (let i = 0; i < numTextures; i++) loadTexture(i);
  }
  open(url, data, asset) {
    let font;
    if (data.textures) {
      // both data and textures exist
      font = new Font(data.textures, data.data);
    } else {
      // only textures
      font = new Font(data, null);
    }
    return font;
  }
  patch(asset, assets) {
    // if not already set, get font data block from asset
    // and assign to font resource
    const font = asset.resource;
    if (!font.data && asset.data) {
      // font data present in asset but not in font
      font.data = asset.data;
    } else if (!asset.data && font.data) {
      // font data present in font but not in asset
      asset.data = font.data;
    }
    if (asset.data) {
      asset.data = upgradeDataSchema(asset.data);
    }
  }
}

export { FontHandler };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9udC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2ZyYW1ld29yay9oYW5kbGVycy9mb250LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHBhdGggfSBmcm9tICcuLi8uLi9jb3JlL3BhdGguanMnO1xuaW1wb3J0IHsgc3RyaW5nIH0gZnJvbSAnLi4vLi4vY29yZS9zdHJpbmcuanMnO1xuXG5pbXBvcnQgeyBodHRwIH0gZnJvbSAnLi4vLi4vcGxhdGZvcm0vbmV0L2h0dHAuanMnO1xuXG5pbXBvcnQgeyBGb250IH0gZnJvbSAnLi4vZm9udC9mb250LmpzJztcblxuaW1wb3J0IHsgUmVzb3VyY2VIYW5kbGVyIH0gZnJvbSAnLi9oYW5kbGVyLmpzJztcblxuZnVuY3Rpb24gdXBncmFkZURhdGFTY2hlbWEoZGF0YSkge1xuICAgIC8vIGNvbnZlcnQgdjEgYW5kIHYyIHRvIHYzIGZvbnQgZGF0YSBzY2hlbWFcbiAgICBpZiAoZGF0YS52ZXJzaW9uIDwgMykge1xuICAgICAgICBpZiAoZGF0YS52ZXJzaW9uIDwgMikge1xuICAgICAgICAgICAgZGF0YS5pbmZvLm1hcHMgPSBkYXRhLmluZm8ubWFwcyB8fCBbe1xuICAgICAgICAgICAgICAgIHdpZHRoOiBkYXRhLmluZm8ud2lkdGgsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBkYXRhLmluZm8uaGVpZ2h0XG4gICAgICAgICAgICB9XTtcbiAgICAgICAgfVxuICAgICAgICBkYXRhLmNoYXJzID0gT2JqZWN0LmtleXMoZGF0YS5jaGFycyB8fCB7fSkucmVkdWNlKGZ1bmN0aW9uIChuZXdDaGFycywga2V5KSB7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZyA9IGRhdGEuY2hhcnNba2V5XTtcbiAgICAgICAgICAgIC8vIGtleSBieSBsZXR0ZXIgaW5zdGVhZCBvZiBjaGFyIGNvZGVcbiAgICAgICAgICAgIGNvbnN0IG5ld0tleSA9IGV4aXN0aW5nLmxldHRlciAhPT0gdW5kZWZpbmVkID8gZXhpc3RpbmcubGV0dGVyIDogc3RyaW5nLmZyb21Db2RlUG9pbnQoa2V5KTtcbiAgICAgICAgICAgIGlmIChkYXRhLnZlcnNpb24gPCAyKSB7XG4gICAgICAgICAgICAgICAgZXhpc3RpbmcubWFwID0gZXhpc3RpbmcubWFwIHx8IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBuZXdDaGFyc1tuZXdLZXldID0gZXhpc3Rpbmc7XG4gICAgICAgICAgICByZXR1cm4gbmV3Q2hhcnM7XG4gICAgICAgIH0sIHt9KTtcbiAgICAgICAgZGF0YS52ZXJzaW9uID0gMztcbiAgICB9XG4gICAgcmV0dXJuIGRhdGE7XG59XG5cbi8qKlxuICogUmVzb3VyY2UgaGFuZGxlciB1c2VkIGZvciBsb2FkaW5nIHtAbGluayBGb250fSByZXNvdXJjZXMuXG4gKlxuICogQGNhdGVnb3J5IFVzZXIgSW50ZXJmYWNlXG4gKi9cbmNsYXNzIEZvbnRIYW5kbGVyIGV4dGVuZHMgUmVzb3VyY2VIYW5kbGVyIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgRm9udEhhbmRsZXIgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vYXBwLWJhc2UuanMnKS5BcHBCYXNlfSBhcHAgLSBUaGUgcnVubmluZyB7QGxpbmsgQXBwQmFzZX0uXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGFwcCkge1xuICAgICAgICBzdXBlcihhcHAsICdmb250Jyk7XG5cbiAgICAgICAgdGhpcy5fbG9hZGVyID0gYXBwLmxvYWRlcjtcbiAgICAgICAgdGhpcy5tYXhSZXRyaWVzID0gMDtcbiAgICB9XG5cbiAgICBsb2FkKHVybCwgY2FsbGJhY2ssIGFzc2V0KSB7XG4gICAgICAgIGlmICh0eXBlb2YgdXJsID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdXJsID0ge1xuICAgICAgICAgICAgICAgIGxvYWQ6IHVybCxcbiAgICAgICAgICAgICAgICBvcmlnaW5hbDogdXJsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIGlmIChwYXRoLmdldEV4dGVuc2lvbih1cmwub3JpZ2luYWwpID09PSAnLmpzb24nKSB7XG4gICAgICAgICAgICAvLyBsb2FkIGpzb24gZGF0YSB0aGVuIGxvYWQgdGV4dHVyZSBvZiBzYW1lIG5hbWVcbiAgICAgICAgICAgIGh0dHAuZ2V0KHVybC5sb2FkLCB7XG4gICAgICAgICAgICAgICAgcmV0cnk6IHRoaXMubWF4UmV0cmllcyA+IDAsXG4gICAgICAgICAgICAgICAgbWF4UmV0cmllczogdGhpcy5tYXhSZXRyaWVzXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyLCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBhc3NldCBkYXRhXG4gICAgICAgICAgICAgICAgaWYgKCFlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHVwZ3JhZGVEYXRhU2NoZW1hKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fbG9hZFRleHR1cmVzKHVybC5sb2FkLnJlcGxhY2UoJy5qc29uJywgJy5wbmcnKSwgZGF0YSwgZnVuY3Rpb24gKGVyciwgdGV4dHVyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHR1cmVzOiB0ZXh0dXJlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhgRXJyb3IgbG9hZGluZyBmb250IHJlc291cmNlOiAke3VybC5vcmlnaW5hbH0gWyR7ZXJyfV1gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gdXBncmFkZSBhc3NldCBkYXRhXG4gICAgICAgICAgICBpZiAoYXNzZXQgJiYgYXNzZXQuZGF0YSkge1xuICAgICAgICAgICAgICAgIGFzc2V0LmRhdGEgPSB1cGdyYWRlRGF0YVNjaGVtYShhc3NldC5kYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2xvYWRUZXh0dXJlcyh1cmwubG9hZCwgYXNzZXQgJiYgYXNzZXQuZGF0YSwgY2FsbGJhY2spO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX2xvYWRUZXh0dXJlcyh1cmwsIGRhdGEsIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IG51bVRleHR1cmVzID0gZGF0YS5pbmZvLm1hcHMubGVuZ3RoO1xuICAgICAgICBsZXQgbnVtTG9hZGVkID0gMDtcbiAgICAgICAgbGV0IGVycm9yID0gbnVsbDtcblxuICAgICAgICBjb25zdCB0ZXh0dXJlcyA9IG5ldyBBcnJheShudW1UZXh0dXJlcyk7XG4gICAgICAgIGNvbnN0IGxvYWRlciA9IHRoaXMuX2xvYWRlcjtcblxuICAgICAgICBjb25zdCBsb2FkVGV4dHVyZSA9IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICAgICAgY29uc3Qgb25Mb2FkZWQgPSBmdW5jdGlvbiAoZXJyLCB0ZXh0dXJlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yKSByZXR1cm47XG5cbiAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGVycm9yID0gZXJyO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGV4dHVyZS51cGxvYWQoKTtcbiAgICAgICAgICAgICAgICB0ZXh0dXJlc1tpbmRleF0gPSB0ZXh0dXJlO1xuICAgICAgICAgICAgICAgIG51bUxvYWRlZCsrO1xuICAgICAgICAgICAgICAgIGlmIChudW1Mb2FkZWQgPT09IG51bVRleHR1cmVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHRleHR1cmVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAoaW5kZXggPT09IDApIHtcbiAgICAgICAgICAgICAgICBsb2FkZXIubG9hZCh1cmwsICd0ZXh0dXJlJywgb25Mb2FkZWQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsb2FkZXIubG9hZCh1cmwucmVwbGFjZSgnLnBuZycsIGluZGV4ICsgJy5wbmcnKSwgJ3RleHR1cmUnLCBvbkxvYWRlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1UZXh0dXJlczsgaSsrKVxuICAgICAgICAgICAgbG9hZFRleHR1cmUoaSk7XG4gICAgfVxuXG4gICAgb3Blbih1cmwsIGRhdGEsIGFzc2V0KSB7XG4gICAgICAgIGxldCBmb250O1xuICAgICAgICBpZiAoZGF0YS50ZXh0dXJlcykge1xuICAgICAgICAgICAgLy8gYm90aCBkYXRhIGFuZCB0ZXh0dXJlcyBleGlzdFxuICAgICAgICAgICAgZm9udCA9IG5ldyBGb250KGRhdGEudGV4dHVyZXMsIGRhdGEuZGF0YSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBvbmx5IHRleHR1cmVzXG4gICAgICAgICAgICBmb250ID0gbmV3IEZvbnQoZGF0YSwgbnVsbCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZvbnQ7XG4gICAgfVxuXG4gICAgcGF0Y2goYXNzZXQsIGFzc2V0cykge1xuICAgICAgICAvLyBpZiBub3QgYWxyZWFkeSBzZXQsIGdldCBmb250IGRhdGEgYmxvY2sgZnJvbSBhc3NldFxuICAgICAgICAvLyBhbmQgYXNzaWduIHRvIGZvbnQgcmVzb3VyY2VcbiAgICAgICAgY29uc3QgZm9udCA9IGFzc2V0LnJlc291cmNlO1xuICAgICAgICBpZiAoIWZvbnQuZGF0YSAmJiBhc3NldC5kYXRhKSB7XG4gICAgICAgICAgICAvLyBmb250IGRhdGEgcHJlc2VudCBpbiBhc3NldCBidXQgbm90IGluIGZvbnRcbiAgICAgICAgICAgIGZvbnQuZGF0YSA9IGFzc2V0LmRhdGE7XG4gICAgICAgIH0gZWxzZSBpZiAoIWFzc2V0LmRhdGEgJiYgZm9udC5kYXRhKSB7XG4gICAgICAgICAgICAvLyBmb250IGRhdGEgcHJlc2VudCBpbiBmb250IGJ1dCBub3QgaW4gYXNzZXRcbiAgICAgICAgICAgIGFzc2V0LmRhdGEgPSBmb250LmRhdGE7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYXNzZXQuZGF0YSkge1xuICAgICAgICAgICAgYXNzZXQuZGF0YSA9IHVwZ3JhZGVEYXRhU2NoZW1hKGFzc2V0LmRhdGEpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgeyBGb250SGFuZGxlciB9O1xuIl0sIm5hbWVzIjpbInVwZ3JhZGVEYXRhU2NoZW1hIiwiZGF0YSIsInZlcnNpb24iLCJpbmZvIiwibWFwcyIsIndpZHRoIiwiaGVpZ2h0IiwiY2hhcnMiLCJPYmplY3QiLCJrZXlzIiwicmVkdWNlIiwibmV3Q2hhcnMiLCJrZXkiLCJleGlzdGluZyIsIm5ld0tleSIsImxldHRlciIsInVuZGVmaW5lZCIsInN0cmluZyIsImZyb21Db2RlUG9pbnQiLCJtYXAiLCJGb250SGFuZGxlciIsIlJlc291cmNlSGFuZGxlciIsImNvbnN0cnVjdG9yIiwiYXBwIiwiX2xvYWRlciIsImxvYWRlciIsIm1heFJldHJpZXMiLCJsb2FkIiwidXJsIiwiY2FsbGJhY2siLCJhc3NldCIsIm9yaWdpbmFsIiwic2VsZiIsInBhdGgiLCJnZXRFeHRlbnNpb24iLCJodHRwIiwiZ2V0IiwicmV0cnkiLCJlcnIiLCJyZXNwb25zZSIsIl9sb2FkVGV4dHVyZXMiLCJyZXBsYWNlIiwidGV4dHVyZXMiLCJudW1UZXh0dXJlcyIsImxlbmd0aCIsIm51bUxvYWRlZCIsImVycm9yIiwiQXJyYXkiLCJsb2FkVGV4dHVyZSIsImluZGV4Iiwib25Mb2FkZWQiLCJ0ZXh0dXJlIiwidXBsb2FkIiwiaSIsIm9wZW4iLCJmb250IiwiRm9udCIsInBhdGNoIiwiYXNzZXRzIiwicmVzb3VyY2UiXSwibWFwcGluZ3MiOiI7Ozs7OztBQVNBLFNBQVNBLGlCQUFpQkEsQ0FBQ0MsSUFBSSxFQUFFO0FBQzdCO0FBQ0EsRUFBQSxJQUFJQSxJQUFJLENBQUNDLE9BQU8sR0FBRyxDQUFDLEVBQUU7QUFDbEIsSUFBQSxJQUFJRCxJQUFJLENBQUNDLE9BQU8sR0FBRyxDQUFDLEVBQUU7TUFDbEJELElBQUksQ0FBQ0UsSUFBSSxDQUFDQyxJQUFJLEdBQUdILElBQUksQ0FBQ0UsSUFBSSxDQUFDQyxJQUFJLElBQUksQ0FBQztBQUNoQ0MsUUFBQUEsS0FBSyxFQUFFSixJQUFJLENBQUNFLElBQUksQ0FBQ0UsS0FBSztBQUN0QkMsUUFBQUEsTUFBTSxFQUFFTCxJQUFJLENBQUNFLElBQUksQ0FBQ0csTUFBQUE7QUFDdEIsT0FBQyxDQUFDLENBQUE7QUFDTixLQUFBO0lBQ0FMLElBQUksQ0FBQ00sS0FBSyxHQUFHQyxNQUFNLENBQUNDLElBQUksQ0FBQ1IsSUFBSSxDQUFDTSxLQUFLLElBQUksRUFBRSxDQUFDLENBQUNHLE1BQU0sQ0FBQyxVQUFVQyxRQUFRLEVBQUVDLEdBQUcsRUFBRTtBQUN2RSxNQUFBLE1BQU1DLFFBQVEsR0FBR1osSUFBSSxDQUFDTSxLQUFLLENBQUNLLEdBQUcsQ0FBQyxDQUFBO0FBQ2hDO0FBQ0EsTUFBQSxN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
