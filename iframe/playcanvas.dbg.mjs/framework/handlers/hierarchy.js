import { SceneParser } from '../parsers/scene.js';
import { SceneUtils } from './scene-utils.js';
import { ResourceHandler } from './handler.js';

class HierarchyHandler extends ResourceHandler {
  /**
   * @param {import('../app-base').AppBase} app - The running {@link AppBase}.
   */
  constructor(app) {
    super(app, 'hierarchy');
  }
  load(url, callback) {
    SceneUtils.load(url, this.maxRetries, callback);
  }
  open(url, data) {
    // prevent script initialization until entire scene is open
    this._app.systems.script.preloading = true;
    const parser = new SceneParser(this._app, false);
    const parent = parser.parse(data);

    // re-enable script initialization
    this._app.systems.script.preloading = false;
    return parent;
  }
}

export { HierarchyHandler };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGllcmFyY2h5LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2hhbmRsZXJzL2hpZXJhcmNoeS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTY2VuZVBhcnNlciB9IGZyb20gJy4uL3BhcnNlcnMvc2NlbmUuanMnO1xuaW1wb3J0IHsgU2NlbmVVdGlscyB9IGZyb20gJy4vc2NlbmUtdXRpbHMuanMnO1xuXG5pbXBvcnQgeyBSZXNvdXJjZUhhbmRsZXIgfSBmcm9tICcuL2hhbmRsZXIuanMnO1xuXG5jbGFzcyBIaWVyYXJjaHlIYW5kbGVyIGV4dGVuZHMgUmVzb3VyY2VIYW5kbGVyIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vYXBwLWJhc2UnKS5BcHBCYXNlfSBhcHAgLSBUaGUgcnVubmluZyB7QGxpbmsgQXBwQmFzZX0uXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoYXBwKSB7XG4gICAgICAgIHN1cGVyKGFwcCwgJ2hpZXJhcmNoeScpO1xuICAgIH1cblxuICAgIGxvYWQodXJsLCBjYWxsYmFjaykge1xuICAgICAgICBTY2VuZVV0aWxzLmxvYWQodXJsLCB0aGlzLm1heFJldHJpZXMsIGNhbGxiYWNrKTtcbiAgICB9XG5cbiAgICBvcGVuKHVybCwgZGF0YSkge1xuICAgICAgICAvLyBwcmV2ZW50IHNjcmlwdCBpbml0aWFsaXphdGlvbiB1bnRpbCBlbnRpcmUgc2NlbmUgaXMgb3BlblxuICAgICAgICB0aGlzLl9hcHAuc3lzdGVtcy5zY3JpcHQucHJlbG9hZGluZyA9IHRydWU7XG5cbiAgICAgICAgY29uc3QgcGFyc2VyID0gbmV3IFNjZW5lUGFyc2VyKHRoaXMuX2FwcCwgZmFsc2UpO1xuICAgICAgICBjb25zdCBwYXJlbnQgPSBwYXJzZXIucGFyc2UoZGF0YSk7XG5cbiAgICAgICAgLy8gcmUtZW5hYmxlIHNjcmlwdCBpbml0aWFsaXphdGlvblxuICAgICAgICB0aGlzLl9hcHAuc3lzdGVtcy5zY3JpcHQucHJlbG9hZGluZyA9IGZhbHNlO1xuXG4gICAgICAgIHJldHVybiBwYXJlbnQ7XG4gICAgfVxufVxuXG5leHBvcnQgeyBIaWVyYXJjaHlIYW5kbGVyIH07XG4iXSwibmFtZXMiOlsiSGllcmFyY2h5SGFuZGxlciIsIlJlc291cmNlSGFuZGxlciIsImNvbnN0cnVjdG9yIiwiYXBwIiwibG9hZCIsInVybCIsImNhbGxiYWNrIiwiU2NlbmVVdGlscyIsIm1heFJldHJpZXMiLCJvcGVuIiwiZGF0YSIsIl9hcHAiLCJzeXN0ZW1zIiwic2NyaXB0IiwicHJlbG9hZGluZyIsInBhcnNlciIsIlNjZW5lUGFyc2VyIiwicGFyZW50IiwicGFyc2UiXSwibWFwcGluZ3MiOiI7Ozs7QUFLQSxNQUFNQSxnQkFBZ0IsU0FBU0MsZUFBZSxDQUFDO0FBQzNDO0FBQ0o7QUFDQTtFQUNJQyxXQUFXQSxDQUFDQyxHQUFHLEVBQUU7QUFDYixJQUFBLEtBQUssQ0FBQ0EsR0FBRyxFQUFFLFdBQVcsQ0FBQyxDQUFBO0FBQzNCLEdBQUE7QUFFQUMsRUFBQUEsSUFBSUEsQ0FBQ0MsR0FBRyxFQUFFQyxRQUFRLEVBQUU7SUFDaEJDLFVBQVUsQ0FBQ0gsSUFBSSxDQUFDQyxHQUFHLEVBQUUsSUFBSSxDQUFDRyxVQUFVLEVBQUVGLFFBQVEsQ0FBQyxDQUFBO0FBQ25ELEdBQUE7QUFFQUcsRUFBQUEsSUFBSUEsQ0FBQ0osR0FBRyxFQUFFSyxJQUFJLEVBQUU7QUFDWjtJQUNBLElBQUksQ0FBQ0MsSUFBSSxDQUFDQyxPQUFPLENBQUNDLE1BQU0sQ0FBQ0MsVUFBVSxHQUFHLElBQUksQ0FBQTtJQUUxQyxNQUFNQyxNQUFNLEdBQUcsSUFBSUMsV0FBVyxDQUFDLElBQUksQ0FBQ0wsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFBO0FBQ2hELElBQUEsTUFBTU0sTUFBTSxHQUFHRixNQUFNLENBQUNHLEtBQUssQ0FBQ1IsSUFBSSxDQUFDLENBQUE7O0FBRWpDO0lBQ0EsSUFBSSxDQUFDQyxJQUFJLENBQUNDLE9BQU8sQ0FBQ0MsTUFBTSxDQUFDQyxVQUFVLEdBQUcsS0FBSyxDQUFBO0FBRTNDLElBQUEsT0FBT0csTUFBTSxDQUFBO0FBQ2pCLEdBQUE7QUFDSjs7OzsifQ==
