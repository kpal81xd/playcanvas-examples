import { path } from '../../core/path.js';
import { http } from '../../platform/net/http.js';
import { Sprite } from '../../scene/sprite.js';
import { ResourceHandler } from './handler.js';

// The scope of this function is the sprite asset
function onTextureAtlasLoaded(atlasAsset) {
  const spriteAsset = this;
  if (spriteAsset.resource) {
    spriteAsset.resource.atlas = atlasAsset.resource;
  }
}

// The scope of this function is the sprite asset
function onTextureAtlasAdded(atlasAsset) {
  const spriteAsset = this;
  spriteAsset.registry.load(atlasAsset);
}

/**
 * Resource handler used for loading {@link Sprite} resources.
 *
 * @category Graphics
 */
class SpriteHandler extends ResourceHandler {
  /**
   * Create a new SpriteHandler instance.
   *
   * @param {import('../app-base.js').AppBase} app - The running {@link AppBase}.
   * @ignore
   */
  constructor(app) {
    super(app, 'sprite');
    this._assets = app.assets;
    this._device = app.graphicsDevice;
  }
  load(url, callback) {
    if (typeof url === 'string') {
      url = {
        load: url,
        original: url
      };
    }

    // if given a json file (probably engine-only use case)
    if (path.getExtension(url.original) === '.json') {
      http.get(url.load, {
        retry: this.maxRetries > 0,
        maxRetries: this.maxRetries
      }, function (err, response) {
        if (!err) {
          callback(null, response);
        } else {
          callback(err);
        }
      });
    }
  }

  // Create sprite resource
  open(url, data) {
    const sprite = new Sprite(this._device);
    if (url) {
      // if url field is present json data is being loaded from file
      // store data on sprite object temporarily
      sprite.__data = data;
    }
    return sprite;
  }

  // Set sprite data
  patch(asset, assets) {
    const sprite = asset.resource;
    if (sprite.__data) {
      // loading from a json file we have asset data store temporarily on the sprite resource
      // copy it into asset.data and delete

      asset.data.pixelsPerUnit = sprite.__data.pixelsPerUnit;
      asset.data.renderMode = sprite.__data.renderMode;
      asset.data.frameKeys = sprite.__data.frameKeys;
      if (sprite.__data.textureAtlasAsset) {
        const atlas = assets.getByUrl(sprite.__data.textureAtlasAsset);
        if (atlas) {
          asset.data.textureAtlasAsset = atlas.id;
        } else {
          console.warn('Could not find textureatlas with url: ' + sprite.__data.textureAtlasAsset);
        }
      }

      // note: we don't remove sprite.__data in case another asset is loaded from the same URL when it is fetched from the cache
      // the __data is not re-assigned and so asset.data is not set up.
    }

    sprite.startUpdate();
    sprite.renderMode = asset.data.renderMode;
    sprite.pixelsPerUnit = asset.data.pixelsPerUnit;
    sprite.frameKeys = asset.data.frameKeys;
    this._updateAtlas(asset);
    sprite.endUpdate();
    asset.off('change', this._onAssetChange, this);
    asset.on('change', this._onAssetChange, this);
  }

  // Load atlas
  _updateAtlas(asset) {
    const sprite = asset.resource;
    if (!asset.data.textureAtlasAsset) {
      sprite.atlas = null;
      return;
    }
    this._assets.off('load:' + asset.data.textureAtlasAsset, onTextureAtlasLoaded, asset);
    this._assets.on('load:' + asset.data.textureAtlasAsset, onTextureAtlasLoaded, asset);
    const atlasAsset = this._assets.get(asset.data.textureAtlasAsset);
    if (atlasAsset && atlasAsset.resource) {
      sprite.atlas = atlasAsset.resource;
    } else {
      if (!atlasAsset) {
        this._assets.off('add:' + asset.data.textureAtlasAsset, onTextureAtlasAdded, asset);
        this._assets.on('add:' + asset.data.textureAtlasAsset, onTextureAtlasAdded, asset);
      } else {
        this._assets.load(atlasAsset);
      }
    }
  }
  _onAssetChange(asset, attribute, value, oldValue) {
    if (attribute === 'data') {
      // if the texture atlas changed, clear events for old atlas asset
      if (value && value.textureAtlasAsset && oldValue && value.textureAtlasAsset !== oldValue.textureAtlasAsset) {
        this._assets.off('load:' + oldValue.textureAtlasAsset, onTextureAtlasLoaded, asset);
        this._assets.off('add:' + oldValue.textureAtlasAsset, onTextureAtlasAdded, asset);
      }
    }
  }
}

export { SpriteHandler };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3ByaXRlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2hhbmRsZXJzL3Nwcml0ZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwYXRoIH0gZnJvbSAnLi4vLi4vY29yZS9wYXRoLmpzJztcblxuaW1wb3J0IHsgaHR0cCB9IGZyb20gJy4uLy4uL3BsYXRmb3JtL25ldC9odHRwLmpzJztcblxuaW1wb3J0IHsgU3ByaXRlIH0gZnJvbSAnLi4vLi4vc2NlbmUvc3ByaXRlLmpzJztcblxuaW1wb3J0IHsgUmVzb3VyY2VIYW5kbGVyIH0gZnJvbSAnLi9oYW5kbGVyLmpzJztcblxuLy8gVGhlIHNjb3BlIG9mIHRoaXMgZnVuY3Rpb24gaXMgdGhlIHNwcml0ZSBhc3NldFxuZnVuY3Rpb24gb25UZXh0dXJlQXRsYXNMb2FkZWQoYXRsYXNBc3NldCkge1xuICAgIGNvbnN0IHNwcml0ZUFzc2V0ID0gdGhpcztcbiAgICBpZiAoc3ByaXRlQXNzZXQucmVzb3VyY2UpIHtcbiAgICAgICAgc3ByaXRlQXNzZXQucmVzb3VyY2UuYXRsYXMgPSBhdGxhc0Fzc2V0LnJlc291cmNlO1xuICAgIH1cbn1cblxuLy8gVGhlIHNjb3BlIG9mIHRoaXMgZnVuY3Rpb24gaXMgdGhlIHNwcml0ZSBhc3NldFxuZnVuY3Rpb24gb25UZXh0dXJlQXRsYXNBZGRlZChhdGxhc0Fzc2V0KSB7XG4gICAgY29uc3Qgc3ByaXRlQXNzZXQgPSB0aGlzO1xuICAgIHNwcml0ZUFzc2V0LnJlZ2lzdHJ5LmxvYWQoYXRsYXNBc3NldCk7XG59XG5cbi8qKlxuICogUmVzb3VyY2UgaGFuZGxlciB1c2VkIGZvciBsb2FkaW5nIHtAbGluayBTcHJpdGV9IHJlc291cmNlcy5cbiAqXG4gKiBAY2F0ZWdvcnkgR3JhcGhpY3NcbiAqL1xuY2xhc3MgU3ByaXRlSGFuZGxlciBleHRlbmRzIFJlc291cmNlSGFuZGxlciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IFNwcml0ZUhhbmRsZXIgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vYXBwLWJhc2UuanMnKS5BcHBCYXNlfSBhcHAgLSBUaGUgcnVubmluZyB7QGxpbmsgQXBwQmFzZX0uXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGFwcCkge1xuICAgICAgICBzdXBlcihhcHAsICdzcHJpdGUnKTtcblxuICAgICAgICB0aGlzLl9hc3NldHMgPSBhcHAuYXNzZXRzO1xuICAgICAgICB0aGlzLl9kZXZpY2UgPSBhcHAuZ3JhcGhpY3NEZXZpY2U7XG4gICAgfVxuXG4gICAgbG9hZCh1cmwsIGNhbGxiYWNrKSB7XG4gICAgICAgIGlmICh0eXBlb2YgdXJsID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdXJsID0ge1xuICAgICAgICAgICAgICAgIGxvYWQ6IHVybCxcbiAgICAgICAgICAgICAgICBvcmlnaW5hbDogdXJsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaWYgZ2l2ZW4gYSBqc29uIGZpbGUgKHByb2JhYmx5IGVuZ2luZS1vbmx5IHVzZSBjYXNlKVxuICAgICAgICBpZiAocGF0aC5nZXRFeHRlbnNpb24odXJsLm9yaWdpbmFsKSA9PT0gJy5qc29uJykge1xuICAgICAgICAgICAgaHR0cC5nZXQodXJsLmxvYWQsIHtcbiAgICAgICAgICAgICAgICByZXRyeTogdGhpcy5tYXhSZXRyaWVzID4gMCxcbiAgICAgICAgICAgICAgICBtYXhSZXRyaWVzOiB0aGlzLm1heFJldHJpZXNcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgc3ByaXRlIHJlc291cmNlXG4gICAgb3Blbih1cmwsIGRhdGEpIHtcbiAgICAgICAgY29uc3Qgc3ByaXRlID0gbmV3IFNwcml0ZSh0aGlzLl9kZXZpY2UpO1xuICAgICAgICBpZiAodXJsKSB7XG4gICAgICAgICAgICAvLyBpZiB1cmwgZmllbGQgaXMgcHJlc2VudCBqc29uIGRhdGEgaXMgYmVpbmcgbG9hZGVkIGZyb20gZmlsZVxuICAgICAgICAgICAgLy8gc3RvcmUgZGF0YSBvbiBzcHJpdGUgb2JqZWN0IHRlbXBvcmFyaWx5XG4gICAgICAgICAgICBzcHJpdGUuX19kYXRhID0gZGF0YTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzcHJpdGU7XG4gICAgfVxuXG4gICAgLy8gU2V0IHNwcml0ZSBkYXRhXG4gICAgcGF0Y2goYXNzZXQsIGFzc2V0cykge1xuICAgICAgICBjb25zdCBzcHJpdGUgPSBhc3NldC5yZXNvdXJjZTtcbiAgICAgICAgaWYgKHNwcml0ZS5fX2RhdGEpIHtcbiAgICAgICAgICAgIC8vIGxvYWRpbmcgZnJvbSBhIGpzb24gZmlsZSB3ZSBoYXZlIGFzc2V0IGRhdGEgc3RvcmUgdGVtcG9yYXJpbHkgb24gdGhlIHNwcml0ZSByZXNvdXJjZVxuICAgICAgICAgICAgLy8gY29weSBpdCBpbnRvIGFzc2V0LmRhdGEgYW5kIGRlbGV0ZVxuXG4gICAgICAgICAgICBhc3NldC5kYXRhLnBpeGVsc1BlclVuaXQgPSBzcHJpdGUuX19kYXRhLnBpeGVsc1BlclVuaXQ7XG4gICAgICAgICAgICBhc3NldC5kYXRhLnJlbmRlck1vZGUgPSBzcHJpdGUuX19kYXRhLnJlbmRlck1vZGU7XG4gICAgICAgICAgICBhc3NldC5kYXRhLmZyYW1lS2V5cyA9IHNwcml0ZS5fX2RhdGEuZnJhbWVLZXlzO1xuXG4gICAgICAgICAgICBpZiAoc3ByaXRlLl9fZGF0YS50ZXh0dXJlQXRsYXNBc3NldCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGF0bGFzID0gYXNzZXRzLmdldEJ5VXJsKHNwcml0ZS5fX2RhdGEudGV4dHVyZUF0bGFzQXNzZXQpO1xuICAgICAgICAgICAgICAgIGlmIChhdGxhcykge1xuICAgICAgICAgICAgICAgICAgICBhc3NldC5kYXRhLnRleHR1cmVBdGxhc0Fzc2V0ID0gYXRsYXMuaWQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdDb3VsZCBub3QgZmluZCB0ZXh0dXJlYXRsYXMgd2l0aCB1cmw6ICcgKyBzcHJpdGUuX19kYXRhLnRleHR1cmVBdGxhc0Fzc2V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIG5vdGU6IHdlIGRvbid0IHJlbW92ZSBzcHJpdGUuX19kYXRhIGluIGNhc2UgYW5vdGhlciBhc3NldCBpcyBsb2FkZWQgZnJvbSB0aGUgc2FtZSBVUkwgd2hlbiBpdCBpcyBmZXRjaGVkIGZyb20gdGhlIGNhY2hlXG4gICAgICAgICAgICAvLyB0aGUgX19kYXRhIGlzIG5vdCByZS1hc3NpZ25lZCBhbmQgc28gYXNzZXQuZGF0YSBpcyBub3Qgc2V0IHVwLlxuICAgICAgICB9XG5cbiAgICAgICAgc3ByaXRlLnN0YXJ0VXBkYXRlKCk7XG4gICAgICAgIHNwcml0ZS5yZW5kZXJNb2RlID0gYXNzZXQuZGF0YS5yZW5kZXJNb2RlO1xuICAgICAgICBzcHJpdGUucGl4ZWxzUGVyVW5pdCA9IGFzc2V0LmRhdGEucGl4ZWxzUGVyVW5pdDtcbiAgICAgICAgc3ByaXRlLmZyYW1lS2V5cyA9IGFzc2V0LmRhdGEuZnJhbWVLZXlzO1xuICAgICAgICB0aGlzLl91cGRhdGVBdGxhcyhhc3NldCk7XG4gICAgICAgIHNwcml0ZS5lbmRVcGRhdGUoKTtcblxuICAgICAgICBhc3NldC5vZmYoJ2NoYW5nZScsIHRoaXMuX29uQXNzZXRDaGFuZ2UsIHRoaXMpO1xuICAgICAgICBhc3NldC5vbignY2hhbmdlJywgdGhpcy5fb25Bc3NldENoYW5nZSwgdGhpcyk7XG4gICAgfVxuXG4gICAgLy8gTG9hZCBhdGxhc1xuICAgIF91cGRhdGVBdGxhcyhhc3NldCkge1xuICAgICAgICBjb25zdCBzcHJpdGUgPSBhc3NldC5yZXNvdXJjZTtcbiAgICAgICAgaWYgKCFhc3NldC5kYXRhLnRleHR1cmVBdGxhc0Fzc2V0KSB7XG4gICAgICAgICAgICBzcHJpdGUuYXRsYXMgPSBudWxsO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fYXNzZXRzLm9mZignbG9hZDonICsgYXNzZXQuZGF0YS50ZXh0dXJlQXRsYXNBc3NldCwgb25UZXh0dXJlQXRsYXNMb2FkZWQsIGFzc2V0KTtcbiAgICAgICAgdGhpcy5fYXNzZXRzLm9uKCdsb2FkOicgKyBhc3NldC5kYXRhLnRleHR1cmVBdGxhc0Fzc2V0LCBvblRleHR1cmVBdGxhc0xvYWRlZCwgYXNzZXQpO1xuXG4gICAgICAgIGNvbnN0IGF0bGFzQXNzZXQgPSB0aGlzLl9hc3NldHMuZ2V0KGFzc2V0LmRhdGEudGV4dHVyZUF0bGFzQXNzZXQpO1xuICAgICAgICBpZiAoYXRsYXNBc3NldCAmJiBhdGxhc0Fzc2V0LnJlc291cmNlKSB7XG4gICAgICAgICAgICBzcHJpdGUuYXRsYXMgPSBhdGxhc0Fzc2V0LnJlc291cmNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKCFhdGxhc0Fzc2V0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYXNzZXRzLm9mZignYWRkOicgKyBhc3NldC5kYXRhLnRleHR1cmVBdGxhc0Fzc2V0LCBvblRleHR1cmVBdGxhc0FkZGVkLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fYXNzZXRzLm9uKCdhZGQ6JyArIGFzc2V0LmRhdGEudGV4dHVyZUF0bGFzQXNzZXQsIG9uVGV4dHVyZUF0bGFzQWRkZWQsIGFzc2V0KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYXNzZXRzLmxvYWQoYXRsYXNBc3NldCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfb25Bc3NldENoYW5nZShhc3NldCwgYXR0cmlidXRlLCB2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgaWYgKGF0dHJpYnV0ZSA9PT0gJ2RhdGEnKSB7XG4gICAgICAgICAgICAvLyBpZiB0aGUgdGV4dHVyZSBhdGxhcyBjaGFuZ2VkLCBjbGVhciBldmVudHMgZm9yIG9sZCBhdGxhcyBhc3NldFxuICAgICAgICAgICAgaWYgKHZhbHVlICYmIHZhbHVlLnRleHR1cmVBdGxhc0Fzc2V0ICYmIG9sZFZhbHVlICYmIHZhbHVlLnRleHR1cmVBdGxhc0Fzc2V0ICE9PSBvbGRWYWx1ZS50ZXh0dXJlQXRsYXNBc3NldCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2Fzc2V0cy5vZmYoJ2xvYWQ6JyArIG9sZFZhbHVlLnRleHR1cmVBdGxhc0Fzc2V0LCBvblRleHR1cmVBdGxhc0xvYWRlZCwgYXNzZXQpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2Fzc2V0cy5vZmYoJ2FkZDonICsgb2xkVmFsdWUudGV4dHVyZUF0bGFzQXNzZXQsIG9uVGV4dHVyZUF0bGFzQWRkZWQsIGFzc2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IHsgU3ByaXRlSGFuZGxlciB9O1xuIl0sIm5hbWVzIjpbIm9uVGV4dHVyZUF0bGFzTG9hZGVkIiwiYXRsYXNBc3NldCIsInNwcml0ZUFzc2V0IiwicmVzb3VyY2UiLCJhdGxhcyIsIm9uVGV4dHVyZUF0bGFzQWRkZWQiLCJyZWdpc3RyeSIsImxvYWQiLCJTcHJpdGVIYW5kbGVyIiwiUmVzb3VyY2VIYW5kbGVyIiwiY29uc3RydWN0b3IiLCJhcHAiLCJfYXNzZXRzIiwiYXNzZXRzIiwiX2RldmljZSIsImdyYXBoaWNzRGV2aWNlIiwidXJsIiwiY2FsbGJhY2siLCJvcmlnaW5hbCIsInBhdGgiLCJnZXRFeHRlbnNpb24iLCJodHRwIiwiZ2V0IiwicmV0cnkiLCJtYXhSZXRyaWVzIiwiZXJyIiwicmVzcG9uc2UiLCJvcGVuIiwiZGF0YSIsInNwcml0ZSIsIlNwcml0ZSIsIl9fZGF0YSIsInBhdGNoIiwiYXNzZXQiLCJwaXhlbHNQZXJVbml0IiwicmVuZGVyTW9kZSIsImZyYW1lS2V5cyIsInRleHR1cmVBdGxhc0Fzc2V0IiwiZ2V0QnlVcmwiLCJpZCIsImNvbnNvbGUiLCJ3YXJuIiwic3RhcnRVcGRhdGUiLCJfdXBkYXRlQXRsYXMiLCJlbmRVcGRhdGUiLCJvZmYiLCJfb25Bc3NldENoYW5nZSIsIm9uIiwiYXR0cmlidXRlIiwidmFsdWUiLCJvbGRWYWx1ZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFRQTtBQUNBLFNBQVNBLG9CQUFvQkEsQ0FBQ0MsVUFBVSxFQUFFO0VBQ3RDLE1BQU1DLFdBQVcsR0FBRyxJQUFJLENBQUE7RUFDeEIsSUFBSUEsV0FBVyxDQUFDQyxRQUFRLEVBQUU7QUFDdEJELElBQUFBLFdBQVcsQ0FBQ0MsUUFBUSxDQUFDQyxLQUFLLEdBQUdILFVBQVUsQ0FBQ0UsUUFBUSxDQUFBO0FBQ3BELEdBQUE7QUFDSixDQUFBOztBQUVBO0FBQ0EsU0FBU0UsbUJBQW1CQSxDQUFDSixVQUFVLEVBQUU7RUFDckMsTUFBTUMsV0FBVyxHQUFHLElBQUksQ0FBQTtBQUN4QkEsRUFBQUEsV0FBVyxDQUFDSSxRQUFRLENBQUNDLElBQUksQ0FBQ04sVUFBVSxDQUFDLENBQUE7QUFDekMsQ0FBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTU8sYUFBYSxTQUFTQyxlQUFlLENBQUM7QUFDeEM7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0lDLFdBQVdBLENBQUNDLEdBQUcsRUFBRTtBQUNiLElBQUEsS0FBSyxDQUFDQSxHQUFHLEVBQUUsUUFBUSxDQUFDLENBQUE7QUFFcEIsSUFBQSxJQUFJLENBQUNDLE9BQU8sR0FBR0QsR0FBRyxDQUFDRSxNQUFNLENBQUE7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
