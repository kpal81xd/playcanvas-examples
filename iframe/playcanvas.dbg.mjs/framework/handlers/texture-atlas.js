import { path } from '../../core/path.js';
import { Vec2 } from '../../core/math/vec2.js';
import { Vec4 } from '../../core/math/vec4.js';
import { TEXTURETYPE_RGBM, TEXTURETYPE_DEFAULT, ADDRESS_REPEAT, ADDRESS_CLAMP_TO_EDGE, ADDRESS_MIRRORED_REPEAT, FILTER_NEAREST, FILTER_LINEAR, FILTER_NEAREST_MIPMAP_NEAREST, FILTER_LINEAR_MIPMAP_NEAREST, FILTER_NEAREST_MIPMAP_LINEAR, FILTER_LINEAR_MIPMAP_LINEAR } from '../../platform/graphics/constants.js';
import { http } from '../../platform/net/http.js';
import { TextureAtlas } from '../../scene/texture-atlas.js';
import { ResourceHandler } from './handler.js';

const JSON_ADDRESS_MODE = {
  'repeat': ADDRESS_REPEAT,
  'clamp': ADDRESS_CLAMP_TO_EDGE,
  'mirror': ADDRESS_MIRRORED_REPEAT
};
const JSON_FILTER_MODE = {
  'nearest': FILTER_NEAREST,
  'linear': FILTER_LINEAR,
  'nearest_mip_nearest': FILTER_NEAREST_MIPMAP_NEAREST,
  'linear_mip_nearest': FILTER_LINEAR_MIPMAP_NEAREST,
  'nearest_mip_linear': FILTER_NEAREST_MIPMAP_LINEAR,
  'linear_mip_linear': FILTER_LINEAR_MIPMAP_LINEAR
};
const regexFrame = /^data\.frames\.(\d+)$/;

/**
 * Resource handler used for loading {@link TextureAtlas} resources.
 *
 * @category Graphics
 */
class TextureAtlasHandler extends ResourceHandler {
  /**
   * Create a new TextureAtlasHandler instance.
   *
   * @param {import('../app-base.js').AppBase} app - The running {@link AppBase}.
   * @ignore
   */
  constructor(app) {
    super(app, 'textureatlas');
    this._loader = app.loader;
  }

  // Load the texture atlas texture using the texture resource loader
  load(url, callback) {
    if (typeof url === 'string') {
      url = {
        load: url,
        original: url
      };
    }
    const self = this;
    const handler = this._loader.getHandler('texture');

    // if supplied with a json file url (probably engine-only)
    // load json data then load texture of same name
    if (path.getExtension(url.original) === '.json') {
      http.get(url.load, {
        retry: this.maxRetries > 0,
        maxRetries: this.maxRetries
      }, function (err, response) {
        if (!err) {
          // load texture
          const textureUrl = url.original.replace('.json', '.png');
          self._loader.load(textureUrl, 'texture', function (err, texture) {
            if (err) {
              callback(err);
            } else {
              callback(null, {
                data: response,
                texture: texture
              });
            }
          });
        } else {
          callback(err);
        }
      });
    } else {
      handler.load(url, callback);
    }
  }

  // Create texture atlas resource using the texture from the texture loader
  open(url, data) {
    const resource = new TextureAtlas();
    if (data.texture && data.data) {
      resource.texture = data.texture;
      resource.__data = data.data; // store data temporarily to be copied into asset
    } else {
      const handler = this._loader.getHandler('texture');
      const texture = handler.open(url, data);
      if (!texture) return null;
      resource.texture = texture;
    }
    return resource;
  }
  patch(asset, assets) {
    // during editor update the underlying texture is temporarily null. just return in that case.
    if (!asset.resource) {
      return;
    }
    if (asset.resource.__data) {
      // engine-only, so copy temporary asset data from texture atlas into asset and delete temp property
      if (asset.resource.__data.minfilter !== undefined) asset.data.minfilter = asset.resource.__data.minfilter;
      if (asset.resource.__data.magfilter !== undefined) asset.data.magfilter = asset.resource.__data.magfilter;
      if (asset.resource.__data.addressu !== undefined) asset.data.addressu = asset.resource.__data.addressu;
      if (asset.resource.__data.addressv !== undefined) asset.data.addressv = asset.resource.__data.addressv;
      if (asset.resource.__data.mipmaps !== undefined) asset.data.mipmaps = asset.resource.__data.mipmaps;
      if (asset.resource.__data.anisotropy !== undefined) asset.data.anisotropy = asset.resource.__data.anisotropy;
      if (asset.resource.__data.rgbm !== undefined) asset.data.rgbm = !!asset.resource.__data.rgbm;
      asset.data.frames = asset.resource.__data.frames;
      delete asset.resource.__data;
    }

    // pass texture data
    const texture = asset.resource.texture;
    if (texture) {
      texture.name = asset.name;
      if (asset.data.hasOwnProperty('minfilter') && texture.minFilter !== JSON_FILTER_MODE[asset.data.minfilter]) texture.minFilter = JSON_FILTER_MODE[asset.data.minfilter];
      if (asset.data.hasOwnProperty('magfilter') && texture.magFilter !== JSON_FILTER_MODE[asset.data.magfilter]) texture.magFilter = JSON_FILTER_MODE[asset.data.magfilter];
      if (asset.data.hasOwnProperty('addressu') && texture.addressU !== JSON_ADDRESS_MODE[asset.data.addressu]) texture.addressU = JSON_ADDRESS_MODE[asset.data.addressu];
      if (asset.data.hasOwnProperty('addressv') && texture.addressV !== JSON_ADDRESS_MODE[asset.data.addressv]) texture.addressV = JSON_ADDRESS_MODE[asset.data.addressv];
      if (asset.data.hasOwnProperty('mipmaps') && texture.mipmaps !== asset.data.mipmaps) texture.mipmaps = asset.data.mipmaps;
      if (asset.data.hasOwnProperty('anisotropy') && texture.anisotropy !== asset.data.anisotropy) texture.anisotropy = asset.data.anisotropy;
      if (asset.data.hasOwnProperty('rgbm')) {
        const type = asset.data.rgbm ? TEXTURETYPE_RGBM : TEXTURETYPE_DEFAULT;
        if (texture.type !== type) {
          texture.type = type;
        }
      }
    }
    asset.resource.texture = texture;

    // set frames
    const frames = {};
    for (const key in asset.data.frames) {
      const frame = asset.data.frames[key];
      frames[key] = {
        rect: new Vec4(frame.rect),
        pivot: new Vec2(frame.pivot),
        border: new Vec4(frame.border)
      };
    }
    asset.resource.frames = frames;
    asset.off('change', this._onAssetChange, this);
    asset.on('change', this._onAssetChange, this);
  }
  _onAssetChange(asset, attribute, value) {
    let frame;
    if (attribute === 'data' || attribute === 'data.frames') {
      // set frames
      const frames = {};
      for (const key in value.frames) {
        frame = value.frames[key];
        frames[key] = {
          rect: new Vec4(frame.rect),
          pivot: new Vec2(frame.pivot),
          border: new Vec4(frame.border)
        };
      }
      asset.resource.frames = frames;
    } else {
      const match = attribute.match(regexFrame);
      if (match) {
        const frameKey = match[1];
        if (value) {
          // add or update frame
          if (!asset.resource.frames[frameKey]) {
            asset.resource.frames[frameKey] = {
              rect: new Vec4(value.rect),
              pivot: new Vec2(value.pivot),
              border: new Vec4(value.border)
            };
          } else {
            frame = asset.resource.frames[frameKey];
            frame.rect.set(value.rect[0], value.rect[1], value.rect[2], value.rect[3]);
            frame.pivot.set(value.pivot[0], value.pivot[1]);
            frame.border.set(value.border[0], value.border[1], value.border[2], value.border[3]);
          }
          asset.resource.fire('set:frame', frameKey, asset.resource.frames[frameKey]);
        } else {
          // delete frame
          if (asset.resource.frames[frameKey]) {
            delete asset.resource.frames[frameKey];
            asset.resource.fire('remove:frame', frameKey);
          }
        }
      }
    }
  }
}

export { TextureAtlasHandler };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGV4dHVyZS1hdGxhcy5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2ZyYW1ld29yay9oYW5kbGVycy90ZXh0dXJlLWF0bGFzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHBhdGggfSBmcm9tICcuLi8uLi9jb3JlL3BhdGguanMnO1xuaW1wb3J0IHsgVmVjMiB9IGZyb20gJy4uLy4uL2NvcmUvbWF0aC92ZWMyLmpzJztcbmltcG9ydCB7IFZlYzQgfSBmcm9tICcuLi8uLi9jb3JlL21hdGgvdmVjNC5qcyc7XG5cbmltcG9ydCB7XG4gICAgQUREUkVTU19DTEFNUF9UT19FREdFLCBBRERSRVNTX01JUlJPUkVEX1JFUEVBVCwgQUREUkVTU19SRVBFQVQsXG4gICAgRklMVEVSX0xJTkVBUiwgRklMVEVSX05FQVJFU1QsIEZJTFRFUl9ORUFSRVNUX01JUE1BUF9ORUFSRVNULCBGSUxURVJfTkVBUkVTVF9NSVBNQVBfTElORUFSLCBGSUxURVJfTElORUFSX01JUE1BUF9ORUFSRVNULCBGSUxURVJfTElORUFSX01JUE1BUF9MSU5FQVIsXG4gICAgVEVYVFVSRVRZUEVfREVGQVVMVCwgVEVYVFVSRVRZUEVfUkdCTVxufSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgaHR0cCB9IGZyb20gJy4uLy4uL3BsYXRmb3JtL25ldC9odHRwLmpzJztcblxuaW1wb3J0IHsgVGV4dHVyZUF0bGFzIH0gZnJvbSAnLi4vLi4vc2NlbmUvdGV4dHVyZS1hdGxhcy5qcyc7XG5cbmltcG9ydCB7IFJlc291cmNlSGFuZGxlciB9IGZyb20gJy4vaGFuZGxlci5qcyc7XG5cbmNvbnN0IEpTT05fQUREUkVTU19NT0RFID0ge1xuICAgICdyZXBlYXQnOiBBRERSRVNTX1JFUEVBVCxcbiAgICAnY2xhbXAnOiBBRERSRVNTX0NMQU1QX1RPX0VER0UsXG4gICAgJ21pcnJvcic6IEFERFJFU1NfTUlSUk9SRURfUkVQRUFUXG59O1xuXG5jb25zdCBKU09OX0ZJTFRFUl9NT0RFID0ge1xuICAgICduZWFyZXN0JzogRklMVEVSX05FQVJFU1QsXG4gICAgJ2xpbmVhcic6IEZJTFRFUl9MSU5FQVIsXG4gICAgJ25lYXJlc3RfbWlwX25lYXJlc3QnOiBGSUxURVJfTkVBUkVTVF9NSVBNQVBfTkVBUkVTVCxcbiAgICAnbGluZWFyX21pcF9uZWFyZXN0JzogRklMVEVSX0xJTkVBUl9NSVBNQVBfTkVBUkVTVCxcbiAgICAnbmVhcmVzdF9taXBfbGluZWFyJzogRklMVEVSX05FQVJFU1RfTUlQTUFQX0xJTkVBUixcbiAgICAnbGluZWFyX21pcF9saW5lYXInOiBGSUxURVJfTElORUFSX01JUE1BUF9MSU5FQVJcbn07XG5cbmNvbnN0IHJlZ2V4RnJhbWUgPSAvXmRhdGFcXC5mcmFtZXNcXC4oXFxkKykkLztcblxuLyoqXG4gKiBSZXNvdXJjZSBoYW5kbGVyIHVzZWQgZm9yIGxvYWRpbmcge0BsaW5rIFRleHR1cmVBdGxhc30gcmVzb3VyY2VzLlxuICpcbiAqIEBjYXRlZ29yeSBHcmFwaGljc1xuICovXG5jbGFzcyBUZXh0dXJlQXRsYXNIYW5kbGVyIGV4dGVuZHMgUmVzb3VyY2VIYW5kbGVyIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgVGV4dHVyZUF0bGFzSGFuZGxlciBpbnN0YW5jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi9hcHAtYmFzZS5qcycpLkFwcEJhc2V9IGFwcCAtIFRoZSBydW5uaW5nIHtAbGluayBBcHBCYXNlfS5cbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoYXBwKSB7XG4gICAgICAgIHN1cGVyKGFwcCwgJ3RleHR1cmVhdGxhcycpO1xuXG4gICAgICAgIHRoaXMuX2xvYWRlciA9IGFwcC5sb2FkZXI7XG4gICAgfVxuXG4gICAgLy8gTG9hZCB0aGUgdGV4dHVyZSBhdGxhcyB0ZXh0dXJlIHVzaW5nIHRoZSB0ZXh0dXJlIHJlc291cmNlIGxvYWRlclxuICAgIGxvYWQodXJsLCBjYWxsYmFjaykge1xuICAgICAgICBpZiAodHlwZW9mIHVybCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHVybCA9IHtcbiAgICAgICAgICAgICAgICBsb2FkOiB1cmwsXG4gICAgICAgICAgICAgICAgb3JpZ2luYWw6IHVybFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgICAgICBjb25zdCBoYW5kbGVyID0gdGhpcy5fbG9hZGVyLmdldEhhbmRsZXIoJ3RleHR1cmUnKTtcblxuICAgICAgICAvLyBpZiBzdXBwbGllZCB3aXRoIGEganNvbiBmaWxlIHVybCAocHJvYmFibHkgZW5naW5lLW9ubHkpXG4gICAgICAgIC8vIGxvYWQganNvbiBkYXRhIHRoZW4gbG9hZCB0ZXh0dXJlIG9mIHNhbWUgbmFtZVxuICAgICAgICBpZiAocGF0aC5nZXRFeHRlbnNpb24odXJsLm9yaWdpbmFsKSA9PT0gJy5qc29uJykge1xuICAgICAgICAgICAgaHR0cC5nZXQodXJsLmxvYWQsIHtcbiAgICAgICAgICAgICAgICByZXRyeTogdGhpcy5tYXhSZXRyaWVzID4gMCxcbiAgICAgICAgICAgICAgICBtYXhSZXRyaWVzOiB0aGlzLm1heFJldHJpZXNcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gbG9hZCB0ZXh0dXJlXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRleHR1cmVVcmwgPSB1cmwub3JpZ2luYWwucmVwbGFjZSgnLmpzb24nLCAnLnBuZycpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl9sb2FkZXIubG9hZCh0ZXh0dXJlVXJsLCAndGV4dHVyZScsIGZ1bmN0aW9uIChlcnIsIHRleHR1cmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3BvbnNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0dXJlOiB0ZXh0dXJlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBoYW5kbGVyLmxvYWQodXJsLCBjYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgdGV4dHVyZSBhdGxhcyByZXNvdXJjZSB1c2luZyB0aGUgdGV4dHVyZSBmcm9tIHRoZSB0ZXh0dXJlIGxvYWRlclxuICAgIG9wZW4odXJsLCBkYXRhKSB7XG4gICAgICAgIGNvbnN0IHJlc291cmNlID0gbmV3IFRleHR1cmVBdGxhcygpO1xuICAgICAgICBpZiAoZGF0YS50ZXh0dXJlICYmIGRhdGEuZGF0YSkge1xuICAgICAgICAgICAgcmVzb3VyY2UudGV4dHVyZSA9IGRhdGEudGV4dHVyZTtcbiAgICAgICAgICAgIHJlc291cmNlLl9fZGF0YSA9IGRhdGEuZGF0YTsgLy8gc3RvcmUgZGF0YSB0ZW1wb3JhcmlseSB0byBiZSBjb3BpZWQgaW50byBhc3NldFxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgaGFuZGxlciA9IHRoaXMuX2xvYWRlci5nZXRIYW5kbGVyKCd0ZXh0dXJlJyk7XG4gICAgICAgICAgICBjb25zdCB0ZXh0dXJlID0gaGFuZGxlci5vcGVuKHVybCwgZGF0YSk7XG4gICAgICAgICAgICBpZiAoIXRleHR1cmUpIHJldHVybiBudWxsO1xuICAgICAgICAgICAgcmVzb3VyY2UudGV4dHVyZSA9IHRleHR1cmU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc291cmNlO1xuICAgIH1cblxuICAgIHBhdGNoKGFzc2V0LCBhc3NldHMpIHtcbiAgICAgICAgLy8gZHVyaW5nIGVkaXRvciB1cGRhdGUgdGhlIHVuZGVybHlpbmcgdGV4dHVyZSBpcyB0ZW1wb3JhcmlseSBudWxsLiBqdXN0IHJldHVybiBpbiB0aGF0IGNhc2UuXG4gICAgICAgIGlmICghYXNzZXQucmVzb3VyY2UpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhc3NldC5yZXNvdXJjZS5fX2RhdGEpIHtcbiAgICAgICAgICAgIC8vIGVuZ2luZS1vbmx5LCBzbyBjb3B5IHRlbXBvcmFyeSBhc3NldCBkYXRhIGZyb20gdGV4dHVyZSBhdGxhcyBpbnRvIGFzc2V0IGFuZCBkZWxldGUgdGVtcCBwcm9wZXJ0eVxuICAgICAgICAgICAgaWYgKGFzc2V0LnJlc291cmNlLl9fZGF0YS5taW5maWx0ZXIgIT09IHVuZGVmaW5lZCkgYXNzZXQuZGF0YS5taW5maWx0ZXIgPSBhc3NldC5yZXNvdXJjZS5fX2RhdGEubWluZmlsdGVyO1xuICAgICAgICAgICAgaWYgKGFzc2V0LnJlc291cmNlLl9fZGF0YS5tYWdmaWx0ZXIgIT09IHVuZGVmaW5lZCkgYXNzZXQuZGF0YS5tYWdmaWx0ZXIgPSBhc3NldC5yZXNvdXJjZS5fX2RhdGEubWFnZmlsdGVyO1xuICAgICAgICAgICAgaWYgKGFzc2V0LnJlc291cmNlLl9fZGF0YS5hZGRyZXNzdSAhPT0gdW5kZWZpbmVkKSBhc3NldC5kYXRhLmFkZHJlc3N1ID0gYXNzZXQucmVzb3VyY2UuX19kYXRhLmFkZHJlc3N1O1xuICAgICAgICAgICAgaWYgKGFzc2V0LnJlc291cmNlLl9fZGF0YS5hZGRyZXNzdiAhPT0gdW5kZWZpbmVkKSBhc3NldC5kYXRhLmFkZHJlc3N2ID0gYXNzZXQucmVzb3VyY2UuX19kYXRhLmFkZHJlc3N2O1xuICAgICAgICAgICAgaWYgKGFzc2V0LnJlc291cmNlLl9fZGF0YS5taXBtYXBzICE9PSB1bmRlZmluZWQpIGFzc2V0LmRhdGEubWlwbWFwcyA9IGFzc2V0LnJlc291cmNlLl9fZGF0YS5taXBtYXBzO1xuICAgICAgICAgICAgaWYgKGFzc2V0LnJlc291cmNlLl9fZGF0YS5hbmlzb3Ryb3B5ICE9PSB1bmRlZmluZWQpIGFzc2V0LmRhdGEuYW5pc290cm9weSA9IGFzc2V0LnJlc291cmNlLl9fZGF0YS5hbmlzb3Ryb3B5O1xuICAgICAgICAgICAgaWYgKGFzc2V0LnJlc291cmNlLl9fZGF0YS5yZ2JtICE9PSB1bmRlZmluZWQpIGFzc2V0LmRhdGEucmdibSA9ICEhYXNzZXQucmVzb3VyY2UuX19kYXRhLnJnYm07XG5cbiAgICAgICAgICAgIGFzc2V0LmRhdGEuZnJhbWVzID0gYXNzZXQucmVzb3VyY2UuX19kYXRhLmZyYW1lcztcblxuICAgICAgICAgICAgZGVsZXRlIGFzc2V0LnJlc291cmNlLl9fZGF0YTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHBhc3MgdGV4dHVyZSBkYXRhXG4gICAgICAgIGNvbnN0IHRleHR1cmUgPSBhc3NldC5yZXNvdXJjZS50ZXh0dXJlO1xuICAgICAgICBpZiAodGV4dHVyZSkge1xuICAgICAgICAgICAgdGV4dHVyZS5uYW1lID0gYXNzZXQubmFtZTtcblxuICAgICAgICAgICAgaWYgKGFzc2V0LmRhdGEuaGFzT3duUHJvcGVydHkoJ21pbmZpbHRlcicpICYmIHRleHR1cmUubWluRmlsdGVyICE9PSBKU09OX0ZJTFRFUl9NT0RFW2Fzc2V0LmRhdGEubWluZmlsdGVyXSlcbiAgICAgICAgICAgICAgICB0ZXh0dXJlLm1pbkZpbHRlciA9IEpTT05fRklMVEVSX01PREVbYXNzZXQuZGF0YS5taW5maWx0ZXJdO1xuXG4gICAgICAgICAgICBpZiAoYXNzZXQuZGF0YS5oYXNPd25Qcm9wZXJ0eSgnbWFnZmlsdGVyJykgJiYgdGV4dHVyZS5tYWdGaWx0ZXIgIT09IEpTT05fRklMVEVSX01PREVbYXNzZXQuZGF0YS5tYWdmaWx0ZXJdKVxuICAgICAgICAgICAgICAgIHRleHR1cmUubWFnRmlsdGVyID0gSlNPTl9GSUxURVJfTU9ERVthc3NldC5kYXRhLm1hZ2ZpbHRlcl07XG5cbiAgICAgICAgICAgIGlmIChhc3NldC5kYXRhLmhhc093blByb3BlcnR5KCdhZGRyZXNzdScpICYmIHRleHR1cmUuYWRkcmVzc1UgIT09IEpTT05fQUREUkVTU19NT0RFW2Fzc2V0LmRhdGEuYWRkcmVzc3VdKVxuICAgICAgICAgICAgICAgIHRleHR1cmUuYWRkcmVzc1UgPSBKU09OX0FERFJFU1NfTU9ERVthc3NldC5kYXRhLmFkZHJlc3N1XTtcblxuICAgICAgICAgICAgaWYgKGFzc2V0LmRhdGEuaGFzT3duUHJvcGVydHkoJ2FkZHJlc3N2JykgJiYgdGV4dHVyZS5hZGRyZXNzViAhPT0gSlNPTl9BRERSRVNTX01PREVbYXNzZXQuZGF0YS5hZGRyZXNzdl0pXG4gICAgICAgICAgICAgICAgdGV4dHVyZS5hZGRyZXNzViA9IEpTT05fQUREUkVTU19NT0RFW2Fzc2V0LmRhdGEuYWRkcmVzc3ZdO1xuXG4gICAgICAgICAgICBpZiAoYXNzZXQuZGF0YS5oYXNPd25Qcm9wZXJ0eSgnbWlwbWFwcycpICYmIHRleHR1cmUubWlwbWFwcyAhPT0gYXNzZXQuZGF0YS5taXBtYXBzKVxuICAgICAgICAgICAgICAgIHRleHR1cmUubWlwbWFwcyA9IGFzc2V0LmRhdGEubWlwbWFwcztcblxuICAgICAgICAgICAgaWYgKGFzc2V0LmRhdGEuaGFzT3duUHJvcGVydHkoJ2FuaXNvdHJvcHknKSAmJiB0ZXh0dXJlLmFuaXNvdHJvcHkgIT09IGFzc2V0LmRhdGEuYW5pc290cm9weSlcbiAgICAgICAgICAgICAgICB0ZXh0dXJlLmFuaXNvdHJvcHkgPSBhc3NldC5kYXRhLmFuaXNvdHJvcHk7XG5cbiAgICAgICAgICAgIGlmIChhc3NldC5kYXRhLmhhc093blByb3BlcnR5KCdyZ2JtJykpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gYXNzZXQuZGF0YS5yZ2JtID8gVEVYVFVSRVRZUEVfUkdCTSA6IFRFWFRVUkVUWVBFX0RFRkFVTFQ7XG4gICAgICAgICAgICAgICAgaWYgKHRleHR1cmUudHlwZSAhPT0gdHlwZSkge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0dXJlLnR5cGUgPSB0eXBlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGFzc2V0LnJlc291cmNlLnRleHR1cmUgPSB0ZXh0dXJlO1xuXG4gICAgICAgIC8vIHNldCBmcmFtZXNcbiAgICAgICAgY29uc3QgZnJhbWVzID0ge307XG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIGFzc2V0LmRhdGEuZnJhbWVzKSB7XG4gICAgICAgICAgICBjb25zdCBmcmFtZSA9IGFzc2V0LmRhdGEuZnJhbWVzW2tleV07XG4gICAgICAgICAgICBmcmFtZXNba2V5XSA9IHtcbiAgICAgICAgICAgICAgICByZWN0OiBuZXcgVmVjNChmcmFtZS5yZWN0KSxcbiAgICAgICAgICAgICAgICBwaXZvdDogbmV3IFZlYzIoZnJhbWUucGl2b3QpLFxuICAgICAgICAgICAgICAgIGJvcmRlcjogbmV3IFZlYzQoZnJhbWUuYm9yZGVyKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBhc3NldC5yZXNvdXJjZS5mcmFtZXMgPSBmcmFtZXM7XG5cbiAgICAgICAgYXNzZXQub2ZmKCdjaGFuZ2UnLCB0aGlzLl9vbkFzc2V0Q2hhbmdlLCB0aGlzKTtcbiAgICAgICAgYXNzZXQub24oJ2NoYW5nZScsIHRoaXMuX29uQXNzZXRDaGFuZ2UsIHRoaXMpO1xuICAgIH1cblxuICAgIF9vbkFzc2V0Q2hhbmdlKGFzc2V0LCBhdHRyaWJ1dGUsIHZhbHVlKSB7XG4gICAgICAgIGxldCBmcmFtZTtcblxuICAgICAgICBpZiAoYXR0cmlidXRlID09PSAnZGF0YScgfHwgYXR0cmlidXRlID09PSAnZGF0YS5mcmFtZXMnKSB7XG4gICAgICAgICAgICAvLyBzZXQgZnJhbWVzXG4gICAgICAgICAgICBjb25zdCBmcmFtZXMgPSB7fTtcbiAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIHZhbHVlLmZyYW1lcykge1xuICAgICAgICAgICAgICAgIGZyYW1lID0gdmFsdWUuZnJhbWVzW2tleV07XG4gICAgICAgICAgICAgICAgZnJhbWVzW2tleV0gPSB7XG4gICAgICAgICAgICAgICAgICAgIHJlY3Q6IG5ldyBWZWM0KGZyYW1lLnJlY3QpLFxuICAgICAgICAgICAgICAgICAgICBwaXZvdDogbmV3IFZlYzIoZnJhbWUucGl2b3QpLFxuICAgICAgICAgICAgICAgICAgICBib3JkZXI6IG5ldyBWZWM0KGZyYW1lLmJvcmRlcilcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXNzZXQucmVzb3VyY2UuZnJhbWVzID0gZnJhbWVzO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSBhdHRyaWJ1dGUubWF0Y2gocmVnZXhGcmFtZSk7XG4gICAgICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBmcmFtZUtleSA9IG1hdGNoWzFdO1xuXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCBvciB1cGRhdGUgZnJhbWVcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFhc3NldC5yZXNvdXJjZS5mcmFtZXNbZnJhbWVLZXldKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldC5yZXNvdXJjZS5mcmFtZXNbZnJhbWVLZXldID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY3Q6IG5ldyBWZWM0KHZhbHVlLnJlY3QpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpdm90OiBuZXcgVmVjMih2YWx1ZS5waXZvdCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyOiBuZXcgVmVjNCh2YWx1ZS5ib3JkZXIpXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWUgPSBhc3NldC5yZXNvdXJjZS5mcmFtZXNbZnJhbWVLZXldO1xuICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWUucmVjdC5zZXQodmFsdWUucmVjdFswXSwgdmFsdWUucmVjdFsxXSwgdmFsdWUucmVjdFsyXSwgdmFsdWUucmVjdFszXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmcmFtZS5waXZvdC5zZXQodmFsdWUucGl2b3RbMF0sIHZhbHVlLnBpdm90WzFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lLmJvcmRlci5zZXQodmFsdWUuYm9yZGVyWzBdLCB2YWx1ZS5ib3JkZXJbMV0sIHZhbHVlLmJvcmRlclsyXSwgdmFsdWUuYm9yZGVyWzNdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LnJlc291cmNlLmZpcmUoJ3NldDpmcmFtZScsIGZyYW1lS2V5LCBhc3NldC5yZXNvdXJjZS5mcmFtZXNbZnJhbWVLZXldKTtcblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSBmcmFtZVxuICAgICAgICAgICAgICAgICAgICBpZiAoYXNzZXQucmVzb3VyY2UuZnJhbWVzW2ZyYW1lS2V5XSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGFzc2V0LnJlc291cmNlLmZyYW1lc1tmcmFtZUtleV07XG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldC5yZXNvdXJjZS5maXJlKCdyZW1vdmU6ZnJhbWUnLCBmcmFtZUtleSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IHsgVGV4dHVyZUF0bGFzSGFuZGxlciB9O1xuIl0sIm5hbWVzIjpbIkpTT05fQUREUkVTU19NT0RFIiwiQUREUkVTU19SRVBFQVQiLCJBRERSRVNTX0NMQU1QX1RPX0VER0UiLCJBRERSRVNTX01JUlJPUkVEX1JFUEVBVCIsIkpTT05fRklMVEVSX01PREUiLCJGSUxURVJfTkVBUkVTVCIsIkZJTFRFUl9MSU5FQVIiLCJGSUxURVJfTkVBUkVTVF9NSVBNQVBfTkVBUkVTVCIsIkZJTFRFUl9MSU5FQVJfTUlQTUFQX05FQVJFU1QiLCJGSUxURVJfTkVBUkVTVF9NSVBNQVBfTElORUFSIiwiRklMVEVSX0xJTkVBUl9NSVBNQVBfTElORUFSIiwicmVnZXhGcmFtZSIsIlRleHR1cmVBdGxhc0hhbmRsZXIiLCJSZXNvdXJjZUhhbmRsZXIiLCJjb25zdHJ1Y3RvciIsImFwcCIsIl9sb2FkZXIiLCJsb2FkZXIiLCJsb2FkIiwidXJsIiwiY2FsbGJhY2siLCJvcmlnaW5hbCIsInNlbGYiLCJoYW5kbGVyIiwiZ2V0SGFuZGxlciIsInBhdGgiLCJnZXRFeHRlbnNpb24iLCJodHRwIiwiZ2V0IiwicmV0cnkiLCJtYXhSZXRyaWVzIiwiZXJyIiwicmVzcG9uc2UiLCJ0ZXh0dXJlVXJsIiwicmVwbGFjZSIsInRleHR1cmUiLCJkYXRhIiwib3BlbiIsInJlc291cmNlIiwiVGV4dHVyZUF0bGFzIiwiX19kYXRhIiwicGF0Y2giLCJhc3NldCIsImFzc2V0cyIsIm1pbmZpbHRlciIsInVuZGVmaW5lZCIsIm1hZ2ZpbHRlciIsImFkZHJlc3N1IiwiYWRkcmVzc3YiLCJtaXBtYXBzIiwiYW5pc290cm9weSIsInJnYm0iLCJmcmFtZXMiLCJuYW1lIiwiaGFzT3duUHJvcGVydHkiLCJtaW5GaWx0ZXIiLCJtYWdGaWx0ZXIiLCJhZGRyZXNzVSIsImFkZHJlc3NWIiwidHlwZSIsIlRFWFRVUkVUWVBFX1JHQk0iLCJURVhUVVJFVFlQRV9ERUZBVUxUIiwia2V5IiwiZnJhbWUiLCJyZWN0IiwiVmVjNCIsInBpdm90IiwiVmVjMiIsImJvcmRlciIsIm9mZiIsIl9vbkFzc2V0Q2hhbmdlIiwib24iLCJhdHRyaWJ1dGUiLCJ2YWx1ZSIsIm1hdGNoIiwiZnJhbWVLZXkiLCJzZXQiLCJmaXJlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQWVBLE1BQU1BLGlCQUFpQixHQUFHO0FBQ3RCLEVBQUEsUUFBUSxFQUFFQyxjQUFjO0FBQ3hCLEVBQUEsT0FBTyxFQUFFQyxxQkFBcUI7QUFDOUIsRUFBQSxRQUFRLEVBQUVDLHVCQUFBQTtBQUNkLENBQUMsQ0FBQTtBQUVELE1BQU1DLGdCQUFnQixHQUFHO0FBQ3JCLEVBQUEsU0FBUyxFQUFFQyxjQUFjO0FBQ3pCLEVBQUEsUUFBUSxFQUFFQyxhQUFhO0FBQ3ZCLEVBQUEscUJBQXFCLEVBQUVDLDZCQUE2QjtBQUNwRCxFQUFBLG9CQUFvQixFQUFFQyw0QkFBNEI7QUFDbEQsRUFBQSxvQkFBb0IsRUFBRUMsNEJBQTRCO0FBQ2xELEVBQUEsbUJBQW1CLEVBQUVDLDJCQUFBQTtBQUN6QixDQUFDLENBQUE7QUFFRCxNQUFNQyxVQUFVLEdBQUcsdUJBQXVCLENBQUE7O0FBRTFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNQyxtQkFBbUIsU0FBU0MsZUFBZSxDQUFDO0FBQzlDO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNJQyxXQUFXQSxDQUFDQyxHQUFHLEVBQUU7QUFDYixJQUFBLEtBQUssQ0FBQ0EsR0FBRyxFQUFFLGNBQWMsQ0FBQyxDQUFBO0FBRTFCLElBQUEsSUFBSSxDQUFDQyxPQUFPLEdBQUdELEdBQUcsQ0FBQ0UsTUFBTSxDQUFBO0FBQzdCLEdBQUE7O0FBRUE7QUFDQUMsRUFBQUEsSUFBSUEsQ0FBQ0MsR0FBRyxFQUFFQyxRQUFRLEVBQUU7QUFDaEIsSUFBQSxJQUFJLE9BQU9ELEdBQUcsS0FB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
