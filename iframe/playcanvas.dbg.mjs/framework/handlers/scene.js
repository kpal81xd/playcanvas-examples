import { SceneUtils } from './scene-utils.js';
import { SceneParser } from '../parsers/scene.js';
import { ResourceHandler } from './handler.js';

/**
 * Resource handler used for loading {@link Scene} resources.
 *
 * @category Graphics
 */
class SceneHandler extends ResourceHandler {
  /**
   * Create a new SceneHandler instance.
   *
   * @param {import('../app-base.js').AppBase} app - The running {@link AppBase}.
   * @ignore
   */
  constructor(app) {
    super(app, 'scene');
  }
  load(url, callback) {
    SceneUtils.load(url, this.maxRetries, callback);
  }
  open(url, data) {
    // prevent script initialization until entire scene is open
    this._app.systems.script.preloading = true;
    const parser = new SceneParser(this._app, false);
    const parent = parser.parse(data);

    // set scene root
    const scene = this._app.scene;
    scene.root = parent;
    this._app.applySceneSettings(data.settings);

    // re-enable script initialization
    this._app.systems.script.preloading = false;
    return scene;
  }
}

export { SceneHandler };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NlbmUuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9mcmFtZXdvcmsvaGFuZGxlcnMvc2NlbmUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU2NlbmVVdGlscyB9IGZyb20gJy4vc2NlbmUtdXRpbHMuanMnO1xuaW1wb3J0IHsgU2NlbmVQYXJzZXIgfSBmcm9tICcuLi9wYXJzZXJzL3NjZW5lLmpzJztcblxuaW1wb3J0IHsgUmVzb3VyY2VIYW5kbGVyIH0gZnJvbSAnLi9oYW5kbGVyLmpzJztcblxuLyoqXG4gKiBSZXNvdXJjZSBoYW5kbGVyIHVzZWQgZm9yIGxvYWRpbmcge0BsaW5rIFNjZW5lfSByZXNvdXJjZXMuXG4gKlxuICogQGNhdGVnb3J5IEdyYXBoaWNzXG4gKi9cbmNsYXNzIFNjZW5lSGFuZGxlciBleHRlbmRzIFJlc291cmNlSGFuZGxlciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IFNjZW5lSGFuZGxlciBpbnN0YW5jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi9hcHAtYmFzZS5qcycpLkFwcEJhc2V9IGFwcCAtIFRoZSBydW5uaW5nIHtAbGluayBBcHBCYXNlfS5cbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoYXBwKSB7XG4gICAgICAgIHN1cGVyKGFwcCwgJ3NjZW5lJyk7XG4gICAgfVxuXG4gICAgbG9hZCh1cmwsIGNhbGxiYWNrKSB7XG4gICAgICAgIFNjZW5lVXRpbHMubG9hZCh1cmwsIHRoaXMubWF4UmV0cmllcywgY2FsbGJhY2spO1xuICAgIH1cblxuICAgIG9wZW4odXJsLCBkYXRhKSB7XG4gICAgICAgIC8vIHByZXZlbnQgc2NyaXB0IGluaXRpYWxpemF0aW9uIHVudGlsIGVudGlyZSBzY2VuZSBpcyBvcGVuXG4gICAgICAgIHRoaXMuX2FwcC5zeXN0ZW1zLnNjcmlwdC5wcmVsb2FkaW5nID0gdHJ1ZTtcblxuICAgICAgICBjb25zdCBwYXJzZXIgPSBuZXcgU2NlbmVQYXJzZXIodGhpcy5fYXBwLCBmYWxzZSk7XG4gICAgICAgIGNvbnN0IHBhcmVudCA9IHBhcnNlci5wYXJzZShkYXRhKTtcblxuICAgICAgICAvLyBzZXQgc2NlbmUgcm9vdFxuICAgICAgICBjb25zdCBzY2VuZSA9IHRoaXMuX2FwcC5zY2VuZTtcbiAgICAgICAgc2NlbmUucm9vdCA9IHBhcmVudDtcblxuICAgICAgICB0aGlzLl9hcHAuYXBwbHlTY2VuZVNldHRpbmdzKGRhdGEuc2V0dGluZ3MpO1xuXG4gICAgICAgIC8vIHJlLWVuYWJsZSBzY3JpcHQgaW5pdGlhbGl6YXRpb25cbiAgICAgICAgdGhpcy5fYXBwLnN5c3RlbXMuc2NyaXB0LnByZWxvYWRpbmcgPSBmYWxzZTtcblxuICAgICAgICByZXR1cm4gc2NlbmU7XG4gICAgfVxufVxuXG5leHBvcnQgeyBTY2VuZUhhbmRsZXIgfTtcbiJdLCJuYW1lcyI6WyJTY2VuZUhhbmRsZXIiLCJSZXNvdXJjZUhhbmRsZXIiLCJjb25zdHJ1Y3RvciIsImFwcCIsImxvYWQiLCJ1cmwiLCJjYWxsYmFjayIsIlNjZW5lVXRpbHMiLCJtYXhSZXRyaWVzIiwib3BlbiIsImRhdGEiLCJfYXBwIiwic3lzdGVtcyIsInNjcmlwdCIsInByZWxvYWRpbmciLCJwYXJzZXIiLCJTY2VuZVBhcnNlciIsInBhcmVudCIsInBhcnNlIiwic2NlbmUiLCJyb290IiwiYXBwbHlTY2VuZVNldHRpbmdzIiwic2V0dGluZ3MiXSwibWFwcGluZ3MiOiI7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUEsWUFBWSxTQUFTQyxlQUFlLENBQUM7QUFDdkM7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0lDLFdBQVdBLENBQUNDLEdBQUcsRUFBRTtBQUNiLElBQUEsS0FBSyxDQUFDQSxHQUFHLEVBQUUsT0FBTyxDQUFDLENBQUE7QUFDdkIsR0FBQTtBQUVBQyxFQUFBQSxJQUFJQSxDQUFDQyxHQUFHLEVBQUVDLFFBQVEsRUFBRTtJQUNoQkMsVUFBVSxDQUFDSCxJQUFJLENBQUNDLEdBQUcsRUFBRSxJQUFJLENBQUNHLFVBQVUsRUFBRUYsUUFBUSxDQUFDLENBQUE7QUFDbkQsR0FBQTtBQUVBRyxFQUFBQSxJQUFJQSxDQUFDSixHQUFHLEVBQUVLLElBQUksRUFBRTtBQUNaO0lBQ0EsSUFBSSxDQUFDQyxJQUFJLENBQUNDLE9BQU8sQ0FBQ0MsTUFBTSxDQUFDQyxVQUFVLEdBQUcsSUFBSSxDQUFBO0lBRTFDLE1BQU1DLE1BQU0sR0FBRyxJQUFJQyxXQUFXLENBQUMsSUFBSSxDQUFDTCxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUE7QUFDaEQsSUFBQSxNQUFNTSxNQUFNLEdBQUdGLE1BQU0sQ0FBQ0csS0FBSyxDQUFDUixJQUFJLENBQUMsQ0FBQTs7QUFFakM7QUFDQSxJQUFBLE1BQU1TLEtBQUssR0FBRyxJQUFJLENBQUNSLElBQUksQ0FBQ1EsS0FBSyxDQUFBO0lBQzdCQSxLQUFLLENBQUNDLElBQUksR0FBR0gsTUFBTSxDQUFBO0lBRW5CLElBQUksQ0FBQ04sSUFBSSxDQUFDVSxrQkFBa0IsQ0FBQ1gsSUFBSSxDQUFDWSxRQUFRLENBQUMsQ0FBQTs7QUFFM0M7SUFDQSxJQUFJLENBQUNYLElBQUksQ0FBQ0MsT0FBTyxDQUFDQyxNQUFNLENBQUNDLFVBQVUsR0FBRyxLQUFLLENBQUE7QUFFM0MsSUFBQSxPQUFPSyxLQUFLLENBQUE7QUFDaEIsR0FBQTtBQUNKOzs7OyJ9
