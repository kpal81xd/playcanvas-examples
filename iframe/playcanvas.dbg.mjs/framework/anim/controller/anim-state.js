import { Debug } from '../../../core/debug.js';
import { AnimTrack } from '../evaluator/anim-track.js';
import { AnimBlendTree1D } from './anim-blend-tree-1d.js';
import { AnimBlendTreeCartesian2D } from './anim-blend-tree-2d-cartesian.js';
import { AnimBlendTreeDirectional2D } from './anim-blend-tree-2d-directional.js';
import { AnimBlendTreeDirect } from './anim-blend-tree-direct.js';
import { AnimNode } from './anim-node.js';
import { ANIM_BLEND_DIRECT, ANIM_BLEND_2D_DIRECTIONAL, ANIM_BLEND_2D_CARTESIAN, ANIM_BLEND_1D, ANIM_CONTROL_STATES } from './constants.js';

/**
 * Defines a single state that the controller can be in. Each state contains either a single
 * AnimNode or a AnimBlendTree of multiple AnimNodes, which will be used to animate the Entity
 * while the state is active. An AnimState will stay active and play as long as there is no
 * AnimTransition with its conditions met that has that AnimState as its source state.
 *
 * @ignore
 */
class AnimState {
  /**
   * Create a new AnimState instance.
   *
   * @param {import('./anim-controller.js').AnimController} controller - The controller this
   * AnimState is associated with.
   * @param {string} name - The name of the state. Used to find this state when the controller
   * transitions between states and links animations.
   * @param {number} [speed] - The speed animations in the state should play at. Individual
   * {@link AnimNodes} can override this value.
   * @param {boolean} [loop] - Determines whether animations in this state should loop.
   * @param {object|null} [blendTree] - If supplied, the AnimState will recursively build a
   * {@link AnimBlendTree} hierarchy, used to store, blend and play multiple animations.
   */
  constructor(controller, name, speed = 1, loop = true, blendTree) {
    /** @private */
    this._animations = {};
    /** @private */
    this._animationList = [];
    this._controller = controller;
    this._name = name;
    this._speed = speed;
    this._loop = loop;
    this._hasAnimations = false;
    if (blendTree) {
      this._blendTree = this._createTree(blendTree.type, this, null, name, 1.0, blendTree.parameter ? [blendTree.parameter] : blendTree.parameters, blendTree.children, blendTree.syncAnimations, this._createTree, this._controller.findParameter);
    } else {
      this._blendTree = new AnimNode(this, null, name, 1.0, speed);
    }
  }
  _createTree(type, state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter) {
    switch (type) {
      case ANIM_BLEND_1D:
        return new AnimBlendTree1D(state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter);
      case ANIM_BLEND_2D_CARTESIAN:
        return new AnimBlendTreeCartesian2D(state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter);
      case ANIM_BLEND_2D_DIRECTIONAL:
        return new AnimBlendTreeDirectional2D(state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter);
      case ANIM_BLEND_DIRECT:
        return new AnimBlendTreeDirect(state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter);
    }
    Debug.error(`Invalid anim blend type: ${type}`);
    return undefined;
  }
  _getNodeFromPath(path) {
    let currNode = this._blendTree;
    for (let i = 1; i < path.length; i++) {
      currNode = currNode.getChild(path[i]);
    }
    return currNode;
  }
  addAnimation(path, animTrack) {
    const pathString = path.join('.');
    const indexOfAnimation = this._animationList.findIndex(function (animation) {
      return animation.path === pathString;
    });
    if (indexOfAnimation >= 0) {
      this._animationList[indexOfAnimation].animTrack = animTrack;
    } else {
      const node = this._getNodeFromPath(path);
      node.animTrack = animTrack;
      this._animationList.push(node);
    }
    this._updateHasAnimations();
  }
  _updateHasAnimations() {
    this._hasAnimations = this._animationList.length > 0 && this._animationList.every(animation => animation.animTrack && animation.animTrack !== AnimTrack.EMPTY);
  }
  get name() {
    return this._name;
  }
  set animations(value) {
    this._animationList = value;
    this._updateHasAnimations();
  }
  get animations() {
    return this._animationList;
  }
  get hasAnimations() {
    return this._hasAnimations;
  }
  set speed(value) {
    this._speed = value;
  }
  get speed() {
    return this._speed;
  }
  set loop(value) {
    this._loop = value;
  }
  get loop() {
    return this._loop;
  }
  get nodeCount() {
    if (!this._blendTree || this._blendTree.constructor === AnimNode) return 1;
    return this._blendTree.getNodeCount();
  }
  get playable() {
    return ANIM_CONTROL_STATES.indexOf(this.name) !== -1 || this.animations.length === this.nodeCount;
  }
  get looping() {
    if (this.animations.length > 0) {
      const trackClipName = this.name + '.' + this.animations[0].animTrack.name;
      const trackClip = this._controller.animEvaluator.findClip(trackClipName);
      if (trackClip) {
        return trackClip.loop;
      }
    }
    return false;
  }
  get totalWeight() {
    let sum = 0;
    for (let i = 0; i < this.animations.length; i++) {
      sum += this.animations[i].weight;
    }
    return sum;
  }
  get timelineDuration() {
    let duration = 0;
    for (let i = 0; i < this.animations.length; i++) {
      const animation = this.animations[i];
      if (animation.animTrack.duration > duration) {
        duration = animation.animTrack.duration;
      }
    }
    return duration;
  }
}

export { AnimState };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5pbS1zdGF0ZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2ZyYW1ld29yay9hbmltL2NvbnRyb2xsZXIvYW5pbS1zdGF0ZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gJy4uLy4uLy4uL2NvcmUvZGVidWcuanMnO1xuaW1wb3J0IHsgQW5pbVRyYWNrIH0gZnJvbSAnLi4vZXZhbHVhdG9yL2FuaW0tdHJhY2suanMnO1xuXG5pbXBvcnQgeyBBbmltQmxlbmRUcmVlMUQgfSBmcm9tICcuL2FuaW0tYmxlbmQtdHJlZS0xZC5qcyc7XG5pbXBvcnQgeyBBbmltQmxlbmRUcmVlQ2FydGVzaWFuMkQgfSBmcm9tICcuL2FuaW0tYmxlbmQtdHJlZS0yZC1jYXJ0ZXNpYW4uanMnO1xuaW1wb3J0IHsgQW5pbUJsZW5kVHJlZURpcmVjdGlvbmFsMkQgfSBmcm9tICcuL2FuaW0tYmxlbmQtdHJlZS0yZC1kaXJlY3Rpb25hbC5qcyc7XG5pbXBvcnQgeyBBbmltQmxlbmRUcmVlRGlyZWN0IH0gZnJvbSAnLi9hbmltLWJsZW5kLXRyZWUtZGlyZWN0LmpzJztcbmltcG9ydCB7IEFuaW1Ob2RlIH0gZnJvbSAnLi9hbmltLW5vZGUuanMnO1xuaW1wb3J0IHtcbiAgICBBTklNX0JMRU5EXzFELCBBTklNX0JMRU5EXzJEX0NBUlRFU0lBTiwgQU5JTV9CTEVORF8yRF9ESVJFQ1RJT05BTCwgQU5JTV9CTEVORF9ESVJFQ1QsIEFOSU1fQ09OVFJPTF9TVEFURVNcbn0gZnJvbSAnLi9jb25zdGFudHMuanMnO1xuXG4vKipcbiAqIERlZmluZXMgYSBzaW5nbGUgc3RhdGUgdGhhdCB0aGUgY29udHJvbGxlciBjYW4gYmUgaW4uIEVhY2ggc3RhdGUgY29udGFpbnMgZWl0aGVyIGEgc2luZ2xlXG4gKiBBbmltTm9kZSBvciBhIEFuaW1CbGVuZFRyZWUgb2YgbXVsdGlwbGUgQW5pbU5vZGVzLCB3aGljaCB3aWxsIGJlIHVzZWQgdG8gYW5pbWF0ZSB0aGUgRW50aXR5XG4gKiB3aGlsZSB0aGUgc3RhdGUgaXMgYWN0aXZlLiBBbiBBbmltU3RhdGUgd2lsbCBzdGF5IGFjdGl2ZSBhbmQgcGxheSBhcyBsb25nIGFzIHRoZXJlIGlzIG5vXG4gKiBBbmltVHJhbnNpdGlvbiB3aXRoIGl0cyBjb25kaXRpb25zIG1ldCB0aGF0IGhhcyB0aGF0IEFuaW1TdGF0ZSBhcyBpdHMgc291cmNlIHN0YXRlLlxuICpcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgQW5pbVN0YXRlIHtcbiAgICAvKiogQHByaXZhdGUgKi9cbiAgICBfYW5pbWF0aW9ucyA9IHt9O1xuXG4gICAgLyoqIEBwcml2YXRlICovXG4gICAgX2FuaW1hdGlvbkxpc3QgPSBbXTtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBBbmltU3RhdGUgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi9hbmltLWNvbnRyb2xsZXIuanMnKS5BbmltQ29udHJvbGxlcn0gY29udHJvbGxlciAtIFRoZSBjb250cm9sbGVyIHRoaXNcbiAgICAgKiBBbmltU3RhdGUgaXMgYXNzb2NpYXRlZCB3aXRoLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHN0YXRlLiBVc2VkIHRvIGZpbmQgdGhpcyBzdGF0ZSB3aGVuIHRoZSBjb250cm9sbGVyXG4gICAgICogdHJhbnNpdGlvbnMgYmV0d2VlbiBzdGF0ZXMgYW5kIGxpbmtzIGFuaW1hdGlvbnMuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtzcGVlZF0gLSBUaGUgc3BlZWQgYW5pbWF0aW9ucyBpbiB0aGUgc3RhdGUgc2hvdWxkIHBsYXkgYXQuIEluZGl2aWR1YWxcbiAgICAgKiB7QGxpbmsgQW5pbU5vZGVzfSBjYW4gb3ZlcnJpZGUgdGhpcyB2YWx1ZS5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtsb29wXSAtIERldGVybWluZXMgd2hldGhlciBhbmltYXRpb25zIGluIHRoaXMgc3RhdGUgc2hvdWxkIGxvb3AuXG4gICAgICogQHBhcmFtIHtvYmplY3R8bnVsbH0gW2JsZW5kVHJlZV0gLSBJZiBzdXBwbGllZCwgdGhlIEFuaW1TdGF0ZSB3aWxsIHJlY3Vyc2l2ZWx5IGJ1aWxkIGFcbiAgICAgKiB7QGxpbmsgQW5pbUJsZW5kVHJlZX0gaGllcmFyY2h5LCB1c2VkIHRvIHN0b3JlLCBibGVuZCBhbmQgcGxheSBtdWx0aXBsZSBhbmltYXRpb25zLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGNvbnRyb2xsZXIsIG5hbWUsIHNwZWVkID0gMSwgbG9vcCA9IHRydWUsIGJsZW5kVHJlZSkge1xuICAgICAgICB0aGlzLl9jb250cm9sbGVyID0gY29udHJvbGxlcjtcbiAgICAgICAgdGhpcy5fbmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMuX3NwZWVkID0gc3BlZWQ7XG4gICAgICAgIHRoaXMuX2xvb3AgPSBsb29wO1xuICAgICAgICB0aGlzLl9oYXNBbmltYXRpb25zID0gZmFsc2U7XG4gICAgICAgIGlmIChibGVuZFRyZWUpIHtcbiAgICAgICAgICAgIHRoaXMuX2JsZW5kVHJlZSA9IHRoaXMuX2NyZWF0ZVRyZWUoXG4gICAgICAgICAgICAgICAgYmxlbmRUcmVlLnR5cGUsXG4gICAgICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgMS4wLFxuICAgICAgICAgICAgICAgIGJsZW5kVHJlZS5wYXJhbWV0ZXIgPyBbYmxlbmRUcmVlLnBhcmFtZXRlcl0gOiBibGVuZFRyZWUucGFyYW1ldGVycyxcbiAgICAgICAgICAgICAgICBibGVuZFRyZWUuY2hpbGRyZW4sXG4gICAgICAgICAgICAgICAgYmxlbmRUcmVlLnN5bmNBbmltYXRpb25zLFxuICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVRyZWUsXG4gICAgICAgICAgICAgICAgdGhpcy5fY29udHJvbGxlci5maW5kUGFyYW1ldGVyXG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fYmxlbmRUcmVlID0gbmV3IEFuaW1Ob2RlKHRoaXMsIG51bGwsIG5hbWUsIDEuMCwgc3BlZWQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX2NyZWF0ZVRyZWUodHlwZSwgc3RhdGUsIHBhcmVudCwgbmFtZSwgcG9pbnQsIHBhcmFtZXRlcnMsIGNoaWxkcmVuLCBzeW5jQW5pbWF0aW9ucywgY3JlYXRlVHJlZSwgZmluZFBhcmFtZXRlcikge1xuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgQU5JTV9CTEVORF8xRDpcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEFuaW1CbGVuZFRyZWUxRChzdGF0ZSwgcGFyZW50LCBuYW1lLCBwb2ludCwgcGFyYW1ldGVycywgY2hpbGRyZW4sIHN5bmNBbmltYXRpb25zLCBjcmVhdGVUcmVlLCBmaW5kUGFyYW1ldGVyKTtcbiAgICAgICAgICAgIGNhc2UgQU5JTV9CTEVORF8yRF9DQVJURVNJQU46XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBBbmltQmxlbmRUcmVlQ2FydGVzaWFuMkQoc3RhdGUsIHBhcmVudCwgbmFtZSwgcG9pbnQsIHBhcmFtZXRlcnMsIGNoaWxkcmVuLCBzeW5jQW5pbWF0aW9ucywgY3JlYXRlVHJlZSwgZmluZFBhcmFtZXRlcik7XG4gICAgICAgICAgICBjYXNlIEFOSU1fQkxFTkRfMkRfRElSRUNUSU9OQUw6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBBbmltQmxlbmRUcmVlRGlyZWN0aW9uYWwyRChzdGF0ZSwgcGFyZW50LCBuYW1lLCBwb2ludCwgcGFyYW1ldGVycywgY2hpbGRyZW4sIHN5bmNBbmltYXRpb25zLCBjcmVhdGVUcmVlLCBmaW5kUGFyYW1ldGVyKTtcbiAgICAgICAgICAgIGNhc2UgQU5JTV9CTEVORF9ESVJFQ1Q6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBBbmltQmxlbmRUcmVlRGlyZWN0KHN0YXRlLCBwYXJlbnQsIG5hbWUsIHBvaW50LCBwYXJhbWV0ZXJzLCBjaGlsZHJlbiwgc3luY0FuaW1hdGlvbnMsIGNyZWF0ZVRyZWUsIGZpbmRQYXJhbWV0ZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgRGVidWcuZXJyb3IoYEludmFsaWQgYW5pbSBibGVuZCB0eXBlOiAke3R5cGV9YCk7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgX2dldE5vZGVGcm9tUGF0aChwYXRoKSB7XG4gICAgICAgIGxldCBjdXJyTm9kZSA9IHRoaXMuX2JsZW5kVHJlZTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjdXJyTm9kZSA9IGN1cnJOb2RlLmdldENoaWxkKHBhdGhbaV0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjdXJyTm9kZTtcbiAgICB9XG5cbiAgICBhZGRBbmltYXRpb24ocGF0aCwgYW5pbVRyYWNrKSB7XG4gICAgICAgIGNvbnN0IHBhdGhTdHJpbmcgPSBwYXRoLmpvaW4oJy4nKTtcbiAgICAgICAgY29uc3QgaW5kZXhPZkFuaW1hdGlvbiA9IHRoaXMuX2FuaW1hdGlvbkxpc3QuZmluZEluZGV4KGZ1bmN0aW9uIChhbmltYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBhbmltYXRpb24ucGF0aCA9PT0gcGF0aFN0cmluZztcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChpbmRleE9mQW5pbWF0aW9uID49IDApIHtcbiAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbkxpc3RbaW5kZXhPZkFuaW1hdGlvbl0uYW5pbVRyYWNrID0gYW5pbVRyYWNrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXMuX2dldE5vZGVGcm9tUGF0aChwYXRoKTtcbiAgICAgICAgICAgIG5vZGUuYW5pbVRyYWNrID0gYW5pbVRyYWNrO1xuICAgICAgICAgICAgdGhpcy5fYW5pbWF0aW9uTGlzdC5wdXNoKG5vZGUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3VwZGF0ZUhhc0FuaW1hdGlvbnMoKTtcbiAgICB9XG5cbiAgICBfdXBkYXRlSGFzQW5pbWF0aW9ucygpIHtcbiAgICAgICAgdGhpcy5faGFzQW5pbWF0aW9ucyA9IHRoaXMuX2FuaW1hdGlvbkxpc3QubGVuZ3RoID4gMCAmJiB0aGlzLl9hbmltYXRpb25MaXN0LmV2ZXJ5KGFuaW1hdGlvbiA9PiBhbmltYXRpb24uYW5pbVRyYWNrICYmIGFuaW1hdGlvbi5hbmltVHJhY2sgIT09IEFuaW1UcmFjay5FTVBUWSk7XG4gICAgfVxuXG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9uYW1lO1xuICAgIH1cblxuICAgIHNldCBhbmltYXRpb25zKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX2FuaW1hdGlvbkxpc3QgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5fdXBkYXRlSGFzQW5pbWF0aW9ucygpO1xuICAgIH1cblxuICAgIGdldCBhbmltYXRpb25zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYW5pbWF0aW9uTGlzdDtcbiAgICB9XG5cbiAgICBnZXQgaGFzQW5pbWF0aW9ucygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hhc0FuaW1hdGlvbnM7XG4gICAgfVxuXG4gICAgc2V0IHNwZWVkKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX3NwZWVkID0gdmFsdWU7XG4gICAgfVxuXG4gICAgZ2V0IHNwZWVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc3BlZWQ7XG4gICAgfVxuXG4gICAgc2V0IGxvb3AodmFsdWUpIHtcbiAgICAgICAgdGhpcy5fbG9vcCA9IHZhbHVlO1xuICAgIH1cblxuICAgIGdldCBsb29wKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbG9vcDtcbiAgICB9XG5cbiAgICBnZXQgbm9kZUNvdW50KCkge1xuICAgICAgICBpZiAoIXRoaXMuX2JsZW5kVHJlZSB8fCAodGhpcy5fYmxlbmRUcmVlLmNvbnN0cnVjdG9yID09PSBBbmltTm9kZSkpIHJldHVybiAxO1xuICAgICAgICByZXR1cm4gdGhpcy5fYmxlbmRUcmVlLmdldE5vZGVDb3VudCgpO1xuICAgIH1cblxuICAgIGdldCBwbGF5YWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIChBTklNX0NPTlRST0xfU1RBVEVTLmluZGV4T2YodGhpcy5uYW1lKSAhPT0gLTEgfHwgdGhpcy5hbmltYXRpb25zLmxlbmd0aCA9PT0gdGhpcy5ub2RlQ291bnQpO1xuICAgIH1cblxuICAgIGdldCBsb29waW5nKCkge1xuICAgICAgICBpZiAodGhpcy5hbmltYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHRyYWNrQ2xpcE5hbWUgPSB0aGlzLm5hbWUgKyAnLicgKyB0aGlzLmFuaW1hdGlvbnNbMF0uYW5pbVRyYWNrLm5hbWU7XG4gICAgICAgICAgICBjb25zdCB0cmFja0NsaXAgPSB0aGlzLl9jb250cm9sbGVyLmFuaW1FdmFsdWF0b3IuZmluZENsaXAodHJhY2tDbGlwTmFtZSk7XG4gICAgICAgICAgICBpZiAodHJhY2tDbGlwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYWNrQ2xpcC5sb29wO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBnZXQgdG90YWxXZWlnaHQoKSB7XG4gICAgICAgIGxldCBzdW0gPSAwO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYW5pbWF0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgc3VtICs9IHRoaXMuYW5pbWF0aW9uc1tpXS53ZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN1bTtcbiAgICB9XG5cbiAgICBnZXQgdGltZWxpbmVEdXJhdGlvbigpIHtcbiAgICAgICAgbGV0IGR1cmF0aW9uID0gMDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmFuaW1hdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGFuaW1hdGlvbiA9IHRoaXMuYW5pbWF0aW9uc1tpXTtcbiAgICAgICAgICAgIGlmIChhbmltYXRpb24uYW5pbVRyYWNrLmR1cmF0aW9uID4gZHVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICBkdXJhdGlvbiA9IGFuaW1hdGlvbi5hbmltVHJhY2suZHVyYXRpb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGR1cmF0aW9uO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgQW5pbVN0YXRlIH07XG4iXSwibmFtZXMiOlsiQW5pbVN0YXRlIiwiY29uc3RydWN0b3IiLCJjb250cm9sbGVyIiwibmFtZSIsInNwZWVkIiwibG9vcCIsImJsZW5kVHJlZSIsIl9hbmltYXRpb25zIiwiX2FuaW1hdGlvbkxpc3QiLCJfY29udHJvbGxlciIsIl9uYW1lIiwiX3NwZWVkIiwiX2xvb3AiLCJfaGFzQW5pbWF0aW9ucyIsIl9ibGVuZFRyZWUiLCJfY3JlYXRlVHJlZSIsInR5cGUiLCJwYXJhbWV0ZXIiLCJwYXJhbWV0ZXJzIiwiY2hpbGRyZW4iLCJzeW5jQW5pbWF0aW9ucyIsImZpbmRQYXJhbWV0ZXIiLCJBbmltTm9kZSIsInN0YXRlIiwicGFyZW50IiwicG9pbnQiLCJjcmVhdGVUcmVlIiwiQU5JTV9CTEVORF8xRCIsIkFuaW1CbGVuZFRyZWUxRCIsIkFOSU1fQkxFTkRfMkRfQ0FSVEVTSUFOIiwiQW5pbUJsZW5kVHJlZUNhcnRlc2lhbjJEIiwiQU5JTV9CTEVORF8yRF9ESVJFQ1RJT05BTCIsIkFuaW1CbGVuZFRyZWVEaXJlY3Rpb25hbDJEIiwiQU5JTV9CTEVORF9ESVJFQ1QiLCJBbmltQmxlbmRUcmVlRGlyZWN0IiwiRGVidWciLCJlcnJvciIsInVuZGVmaW5lZCIsIl9nZXROb2RlRnJvbVBhdGgiLCJwYXRoIiwiY3Vyck5vZGUiLCJpIiwibGVuZ3RoIiwiZ2V0Q2hpbGQiLCJhZGRBbmltYXRpb24iLCJhbmltVHJhY2siLCJwYXRoU3RyaW5nIiwiam9pbiIsImluZGV4T2ZBbmltYXRpb24iLCJmaW5kSW5kZXgiLCJhbmltYXRpb24iLCJub2RlIiwicHVzaCIsIl91cGRhdGVIYXNBbmltYXRpb25zIiwiZXZlcnkiLCJBbmltVHJhY2siLCJFTVBUWSIsImFuaW1hdGlvbnMiLCJ2YWx1ZSIsImhhc0FuaW1hdGlvbnMiLCJub2RlQ291bnQiLCJnZXROb2RlQ291bnQiLCJwbGF5YWJsZSIsIkFOSU1fQ09OVFJPTF9TVEFURVMiLCJpbmRleE9mIiwibG9vcGluZyIsInRyYWNrQ2xpcE5hbWUiLCJ0cmFja0NsaXAiLCJhbmltRXZhbHVhdG9yIiwiZmluZENsaXAiLCJ0b3RhbFdlaWdodCIsInN1bSIsIndlaWdodCIsInRpbWVsaW5lRHVyYXRpb24iLCJkdXJhdGlvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBWUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1BLFNBQVMsQ0FBQztBQU9aO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0lDLEVBQUFBLFdBQVdBLENBQUNDLFVBQVUsRUFBRUMsSUFBSSxFQUFFQyxLQUFLLEdBQUcsQ0FBQyxFQUFFQyxJQUFJLEdBQUcsSUFBSSxFQUFFQyxTQUFTLEVBQUU7QUFuQmpFO0lBQUEsSUFDQUMsQ0FBQUEsV0FBVyxHQUFHLEVBQUUsQ0FBQTtBQUVoQjtJQUFBLElBQ0FDLENBQUFBLGNBQWMsR0FBRyxFQUFFLENBQUE7SUFnQmYsSUFBSSxDQUFDQyxXQUFXLEdBQUdQLFVBQVUsQ0FBQTtJQUM3QixJQUFJLENBQUNRLEtBQUssR0FBR1AsSUFBSSxDQUFBO0lBQ2pCLElBQUksQ0FBQ1EsTUFBTSxHQUFHUCxLQUFLLENBQUE7SUFDbkIsSUFBSSxDQUFDUSxLQUFLLEdBQUdQLElBQUksQ0FBQTtJQUNqQixJQUFJLENBQUNRLGNBQWMsR0FBRyxLQUFLLENBQUE7QUFD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
