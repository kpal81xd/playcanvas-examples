import { FUNC_ALWAYS, STENCILOP_KEEP } from './constants.js';
import { StringIds } from '../../core/string-ids.js';

var _class;
const stringIds = new StringIds();

/**
 * Holds stencil test settings.
 *
 * @category Graphics
 */
class StencilParameters {
  /**
   * A comparison function that decides if the pixel should be written, based on the current
   * stencil buffer value, reference value, and mask value. Can be:
   *
   * - {@link FUNC_NEVER}: never pass
   * - {@link FUNC_LESS}: pass if (ref & mask) < (stencil & mask)
   * - {@link FUNC_EQUAL}: pass if (ref & mask) == (stencil & mask)
   * - {@link FUNC_LESSEQUAL}: pass if (ref & mask) <= (stencil & mask)
   * - {@link FUNC_GREATER}: pass if (ref & mask) > (stencil & mask)
   * - {@link FUNC_NOTEQUAL}: pass if (ref & mask) != (stencil & mask)
   * - {@link FUNC_GREATEREQUAL}: pass if (ref & mask) >= (stencil & mask)
   * - {@link FUNC_ALWAYS}: always pass
   *
   * @type {number}
   */
  set func(value) {
    this._func = value;
    this._dirty = true;
  }
  get func() {
    return this._func;
  }

  /**
   * Sets stencil test reference value used in comparisons.
   *
   * @type {number}
   */
  set ref(value) {
    this._ref = value;
    this._dirty = true;
  }
  get ref() {
    return this._ref;
  }

  /**
   * Operation to perform if stencil test is failed. Can be:
   *
   * - {@link STENCILOP_KEEP}: don't change the stencil buffer value
   * - {@link STENCILOP_ZERO}: set value to zero
   * - {@link STENCILOP_REPLACE}: replace value with the reference value.
   * - {@link STENCILOP_INCREMENT}: increment the value
   * - {@link STENCILOP_INCREMENTWRAP}: increment the value, but wrap it to zero when it's larger
   * than a maximum representable value
   * - {@link STENCILOP_DECREMENT}: decrement the value
   * - {@link STENCILOP_DECREMENTWRAP}: decrement the value, but wrap it to a maximum
   * representable value, if the current value is 0
   * - {@link STENCILOP_INVERT}: invert the value bitwise
   *
   * @type {number}
   */
  set fail(value) {
    this._fail = value;
    this._dirty = true;
  }
  get fail() {
    return this._fail;
  }

  /**
   * Operation to perform if depth test is failed. Accepts the same values as `fail`.
   *
   * @type {number}
   */
  set zfail(value) {
    this._zfail = value;
    this._dirty = true;
  }
  get zfail() {
    return this._zfail;
  }

  /**
   * Operation to perform if both stencil and depth test are passed. Accepts the same values as
   * `fail`.
   *
   * @type {number}
   */
  set zpass(value) {
    this._zpass = value;
    this._dirty = true;
  }
  get zpass() {
    return this._zpass;
  }

  /**
   * Mask applied to stencil buffer value and reference value before comparison.
   *
   * @type {number}
   */
  set readMask(value) {
    this._readMask = value;
    this._dirty = true;
  }
  get readMask() {
    return this._readMask;
  }

  /**
   * A bit mask applied to the stencil value, when written.
   *
   * @type {number}
   */
  set writeMask(value) {
    this._writeMask = value;
    this._dirty = true;
  }
  get writeMask() {
    return this._writeMask;
  }

  /**
   * Create a new StencilParameters instance.
   *
   * @param {object} [options] - Options object to configure the stencil parameters.
   */
  constructor(options = {}) {
    var _options$func, _options$ref, _options$readMask, _options$writeMask, _options$fail, _options$zfail, _options$zpass;
    /**
     * @type {number}
     * @private
     */
    this._func = void 0;
    /**
     * @type {number}
     * @private
     */
    this._ref = void 0;
    /**
     * @type {number}
     * @private
     */
    this._fail = void 0;
    /**
     * @type {number}
     * @private
     */
    this._zfail = void 0;
    /**
     * @type {number}
     * @private
     */
    this._zpass = void 0;
    /**
     * @type {number}
     * @private
     */
    this._readMask = void 0;
    /**
     * @type {number}
     * @private
     */
    this._writeMask = void 0;
    /**
     * @type {boolean}
     * @private
     */
    this._dirty = true;
    /**
     * @type {number}
     * @private
     */
    this._key = void 0;
    this._func = (_options$func = options.func) != null ? _options$func : FUNC_ALWAYS;
    this._ref = (_options$ref = options.ref) != null ? _options$ref : 0;
    this._readMask = (_options$readMask = options.readMask) != null ? _options$readMask : 0xFF;
    this._writeMask = (_options$writeMask = options.writeMask) != null ? _options$writeMask : 0xFF;
    this._fail = (_options$fail = options.fail) != null ? _options$fail : STENCILOP_KEEP; // keep == 0
    this._zfail = (_options$zfail = options.zfail) != null ? _options$zfail : STENCILOP_KEEP;
    this._zpass = (_options$zpass = options.zpass) != null ? _options$zpass : STENCILOP_KEEP;

    // Evaluate key here. This evaluates the key for the DEFAULT instance, which is important,
    // as during rendering it gets copied and the key would get evaluated each time.
    this._evalKey();
  }
  _evalKey() {
    const {
      _func,
      _ref,
      _fail,
      _zfail,
      _zpass,
      _readMask,
      _writeMask
    } = this;
    const key = `${_func},${_ref},${_fail},${_zfail},${_zpass},${_readMask},${_writeMask}`;
    this._key = stringIds.get(key);
    this._dirty = false;
  }
  get key() {
    if (this._dirty) {
      this._evalKey();
    }
    return this._key;
  }

  /**
   * Copies the contents of a source stencil parameters to this stencil parameters.
   *
   * @param {StencilParameters} rhs - A stencil parameters to copy from.
   * @returns {StencilParameters} Self for chaining.
   */
  copy(rhs) {
    this._func = rhs._func;
    this._ref = rhs._ref;
    this._readMask = rhs._readMask;
    this._writeMask = rhs._writeMask;
    this._fail = rhs._fail;
    this._zfail = rhs._zfail;
    this._zpass = rhs._zpass;
    this._dirty = rhs._dirty;
    this._key = rhs._key;
    return this;
  }

  /**
   * Clone the stencil parameters.
   *
   * @returns {StencilParameters} A cloned StencilParameters object.
   */
  clone() {
    const clone = new this.constructor();
    return clone.copy(this);
  }

  /**
   * A default stencil state.
   *
   * @type {StencilParameters}
   * @readonly
   */
}
_class = StencilParameters;
StencilParameters.DEFAULT = Object.freeze(new _class());

export { StencilParameters };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RlbmNpbC1wYXJhbWV0ZXJzLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvcGxhdGZvcm0vZ3JhcGhpY3Mvc3RlbmNpbC1wYXJhbWV0ZXJzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZVTkNfQUxXQVlTLCBTVEVOQ0lMT1BfS0VFUCB9IGZyb20gJy4vY29uc3RhbnRzLmpzJztcbmltcG9ydCB7IFN0cmluZ0lkcyB9IGZyb20gJy4uLy4uL2NvcmUvc3RyaW5nLWlkcy5qcyc7XG5cbmNvbnN0IHN0cmluZ0lkcyA9IG5ldyBTdHJpbmdJZHMoKTtcblxuLyoqXG4gKiBIb2xkcyBzdGVuY2lsIHRlc3Qgc2V0dGluZ3MuXG4gKlxuICogQGNhdGVnb3J5IEdyYXBoaWNzXG4gKi9cbmNsYXNzIFN0ZW5jaWxQYXJhbWV0ZXJzIHtcbiAgICAvKipcbiAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2Z1bmM7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3JlZjtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZmFpbDtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfemZhaWw7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3pwYXNzO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge251bWJlcn1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9yZWFkTWFzaztcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfd3JpdGVNYXNrO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZGlydHkgPSB0cnVlO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge251bWJlcn1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9rZXk7XG5cbiAgICAvKipcbiAgICAgKiBBIGNvbXBhcmlzb24gZnVuY3Rpb24gdGhhdCBkZWNpZGVzIGlmIHRoZSBwaXhlbCBzaG91bGQgYmUgd3JpdHRlbiwgYmFzZWQgb24gdGhlIGN1cnJlbnRcbiAgICAgKiBzdGVuY2lsIGJ1ZmZlciB2YWx1ZSwgcmVmZXJlbmNlIHZhbHVlLCBhbmQgbWFzayB2YWx1ZS4gQ2FuIGJlOlxuICAgICAqXG4gICAgICogLSB7QGxpbmsgRlVOQ19ORVZFUn06IG5ldmVyIHBhc3NcbiAgICAgKiAtIHtAbGluayBGVU5DX0xFU1N9OiBwYXNzIGlmIChyZWYgJiBtYXNrKSA8IChzdGVuY2lsICYgbWFzaylcbiAgICAgKiAtIHtAbGluayBGVU5DX0VRVUFMfTogcGFzcyBpZiAocmVmICYgbWFzaykgPT0gKHN0ZW5jaWwgJiBtYXNrKVxuICAgICAqIC0ge0BsaW5rIEZVTkNfTEVTU0VRVUFMfTogcGFzcyBpZiAocmVmICYgbWFzaykgPD0gKHN0ZW5jaWwgJiBtYXNrKVxuICAgICAqIC0ge0BsaW5rIEZVTkNfR1JFQVRFUn06IHBhc3MgaWYgKHJlZiAmIG1hc2spID4gKHN0ZW5jaWwgJiBtYXNrKVxuICAgICAqIC0ge0BsaW5rIEZVTkNfTk9URVFVQUx9OiBwYXNzIGlmIChyZWYgJiBtYXNrKSAhPSAoc3RlbmNpbCAmIG1hc2spXG4gICAgICogLSB7QGxpbmsgRlVOQ19HUkVBVEVSRVFVQUx9OiBwYXNzIGlmIChyZWYgJiBtYXNrKSA+PSAoc3RlbmNpbCAmIG1hc2spXG4gICAgICogLSB7QGxpbmsgRlVOQ19BTFdBWVN9OiBhbHdheXMgcGFzc1xuICAgICAqXG4gICAgICogQHR5cGUge251bWJlcn1cbiAgICAgKi9cbiAgICBzZXQgZnVuYyh2YWx1ZSkge1xuICAgICAgICB0aGlzLl9mdW5jID0gdmFsdWU7XG4gICAgICAgIHRoaXMuX2RpcnR5ID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBnZXQgZnVuYygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Z1bmM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyBzdGVuY2lsIHRlc3QgcmVmZXJlbmNlIHZhbHVlIHVzZWQgaW4gY29tcGFyaXNvbnMuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAqL1xuICAgIHNldCByZWYodmFsdWUpIHtcbiAgICAgICAgdGhpcy5fcmVmID0gdmFsdWU7XG4gICAgICAgIHRoaXMuX2RpcnR5ID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBnZXQgcmVmKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcmVmO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9wZXJhdGlvbiB0byBwZXJmb3JtIGlmIHN0ZW5jaWwgdGVzdCBpcyBmYWlsZWQuIENhbiBiZTpcbiAgICAgKlxuICAgICAqIC0ge0BsaW5rIFNURU5DSUxPUF9LRUVQfTogZG9uJ3QgY2hhbmdlIHRoZSBzdGVuY2lsIGJ1ZmZlciB2YWx1ZVxuICAgICAqIC0ge0BsaW5rIFNURU5DSUxPUF9aRVJPfTogc2V0IHZhbHVlIHRvIHplcm9cbiAgICAgKiAtIHtAbGluayBTVEVOQ0lMT1BfUkVQTEFDRX06IHJlcGxhY2UgdmFsdWUgd2l0aCB0aGUgcmVmZXJlbmNlIHZhbHVlLlxuICAgICAqIC0ge0BsaW5rIFNURU5DSUxPUF9JTkNSRU1FTlR9OiBpbmNyZW1lbnQgdGhlIHZhbHVlXG4gICAgICogLSB7QGxpbmsgU1RFTkNJTE9QX0lOQ1JFTUVOVFdSQVB9OiBpbmNyZW1lbnQgdGhlIHZhbHVlLCBidXQgd3JhcCBpdCB0byB6ZXJvIHdoZW4gaXQncyBsYXJnZXJcbiAgICAgKiB0aGFuIGEgbWF4aW11bSByZXByZXNlbnRhYmxlIHZhbHVlXG4gICAgICogLSB7QGxpbmsgU1RFTkNJTE9QX0RFQ1JFTUVOVH06IGRlY3JlbWVudCB0aGUgdmFsdWVcbiAgICAgKiAtIHtAbGluayBTVEVOQ0lMT1BfREVDUkVNRU5UV1JBUH06IGRlY3JlbWVudCB0aGUgdmFsdWUsIGJ1dCB3cmFwIGl0IHRvIGEgbWF4aW11bVxuICAgICAqIHJlcHJlc2VudGFibGUgdmFsdWUsIGlmIHRoZSBjdXJyZW50IHZhbHVlIGlzIDBcbiAgICAgKiAtIHtAbGluayBTVEVOQ0lMT1BfSU5WRVJUfTogaW52ZXJ0IHRoZSB2YWx1ZSBiaXR3aXNlXG4gICAgICpcbiAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAqL1xuICAgIHNldCBmYWlsKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX2ZhaWwgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5fZGlydHkgPSB0cnVlO1xuICAgIH1cblxuICAgIGdldCBmYWlsKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZmFpbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcGVyYXRpb24gdG8gcGVyZm9ybSBpZiBkZXB0aCB0ZXN0IGlzIGZhaWxlZC4gQWNjZXB0cyB0aGUgc2FtZSB2YWx1ZXMgYXMgYGZhaWxgLlxuICAgICAqXG4gICAgICogQHR5cGUge251bWJlcn1cbiAgICAgKi9cbiAgICBzZXQgemZhaWwodmFsdWUpIHtcbiAgICAgICAgdGhpcy5femZhaWwgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5fZGlydHkgPSB0cnVlO1xuICAgIH1cblxuICAgIGdldCB6ZmFpbCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3pmYWlsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9wZXJhdGlvbiB0byBwZXJmb3JtIGlmIGJvdGggc3RlbmNpbCBhbmQgZGVwdGggdGVzdCBhcmUgcGFzc2VkLiBBY2NlcHRzIHRoZSBzYW1lIHZhbHVlcyBhc1xuICAgICAqIGBmYWlsYC5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICovXG4gICAgc2V0IHpwYXNzKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX3pwYXNzID0gdmFsdWU7XG4gICAgICAgIHRoaXMuX2RpcnR5ID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBnZXQgenBhc3MoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl96cGFzcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNYXNrIGFwcGxpZWQgdG8gc3RlbmNpbCBidWZmZXIgdmFsdWUgYW5kIHJlZmVyZW5jZSB2YWx1ZSBiZWZvcmUgY29tcGFyaXNvbi5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICovXG4gICAgc2V0IHJlYWRNYXNrKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX3JlYWRNYXNrID0gdmFsdWU7XG4gICAgICAgIHRoaXMuX2RpcnR5ID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBnZXQgcmVhZE1hc2soKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9yZWFkTWFzaztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBIGJpdCBtYXNrIGFwcGxpZWQgdG8gdGhlIHN0ZW5jaWwgdmFsdWUsIHdoZW4gd3JpdHRlbi5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICovXG4gICAgc2V0IHdyaXRlTWFzayh2YWx1ZSkge1xuICAgICAgICB0aGlzLl93cml0ZU1hc2sgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5fZGlydHkgPSB0cnVlO1xuICAgIH1cblxuICAgIGdldCB3cml0ZU1hc2soKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl93cml0ZU1hc2s7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IFN0ZW5jaWxQYXJhbWV0ZXJzIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtvYmplY3R9IFtvcHRpb25zXSAtIE9wdGlvbnMgb2JqZWN0IHRvIGNvbmZpZ3VyZSB0aGUgc3RlbmNpbCBwYXJhbWV0ZXJzLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICB0aGlzLl9mdW5jID0gb3B0aW9ucy5mdW5jID8/IEZVTkNfQUxXQVlTO1xuICAgICAgICB0aGlzLl9yZWYgPSBvcHRpb25zLnJlZiA/PyAwO1xuICAgICAgICB0aGlzLl9yZWFkTWFzayA9IG9wdGlvbnMucmVhZE1hc2sgPz8gMHhGRjtcbiAgICAgICAgdGhpcy5fd3JpdGVNYXNrID0gb3B0aW9ucy53cml0ZU1hc2sgPz8gMHhGRjtcblxuICAgICAgICB0aGlzLl9mYWlsID0gb3B0aW9ucy5mYWlsID8/IFNURU5DSUxPUF9LRUVQOyAvLyBrZWVwID09IDBcbiAgICAgICAgdGhpcy5femZhaWwgPSBvcHRpb25zLnpmYWlsID8/IFNURU5DSUxPUF9LRUVQO1xuICAgICAgICB0aGlzLl96cGFzcyA9IG9wdGlvbnMuenBhc3MgPz8gU1RFTkNJTE9QX0tFRVA7XG5cbiAgICAgICAgLy8gRXZhbHVhdGUga2V5IGhlcmUuIFRoaXMgZXZhbHVhdGVzIHRoZSBrZXkgZm9yIHRoZSBERUZBVUxUIGluc3RhbmNlLCB3aGljaCBpcyBpbXBvcnRhbnQsXG4gICAgICAgIC8vIGFzIGR1cmluZyByZW5kZXJpbmcgaXQgZ2V0cyBjb3BpZWQgYW5kIHRoZSBrZXkgd291bGQgZ2V0IGV2YWx1YXRlZCBlYWNoIHRpbWUuXG4gICAgICAgIHRoaXMuX2V2YWxLZXkoKTtcbiAgICB9XG5cbiAgICBfZXZhbEtleSgpIHtcbiAgICAgICAgY29uc3QgeyBfZnVuYywgX3JlZiwgX2ZhaWwsIF96ZmFpbCwgX3pwYXNzLCBfcmVhZE1hc2ssIF93cml0ZU1hc2sgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGtleSA9IGAke19mdW5jfSwke19yZWZ9LCR7X2ZhaWx9LCR7X3pmYWlsfSwke196cGFzc30sJHtfcmVhZE1hc2t9LCR7X3dyaXRlTWFza31gO1xuICAgICAgICB0aGlzLl9rZXkgPSBzdHJpbmdJZHMuZ2V0KGtleSk7XG4gICAgICAgIHRoaXMuX2RpcnR5ID0gZmFsc2U7XG4gICAgfVxuXG4gICAgZ2V0IGtleSgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2RpcnR5KSB7XG4gICAgICAgICAgICB0aGlzLl9ldmFsS2V5KCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2tleTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb3BpZXMgdGhlIGNvbnRlbnRzIG9mIGEgc291cmNlIHN0ZW5jaWwgcGFyYW1ldGVycyB0byB0aGlzIHN0ZW5jaWwgcGFyYW1ldGVycy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RlbmNpbFBhcmFtZXRlcnN9IHJocyAtIEEgc3RlbmNpbCBwYXJhbWV0ZXJzIHRvIGNvcHkgZnJvbS5cbiAgICAgKiBAcmV0dXJucyB7U3RlbmNpbFBhcmFtZXRlcnN9IFNlbGYgZm9yIGNoYWluaW5nLlxuICAgICAqL1xuICAgIGNvcHkocmhzKSB7XG4gICAgICAgIHRoaXMuX2Z1bmMgPSByaHMuX2Z1bmM7XG4gICAgICAgIHRoaXMuX3JlZiA9IHJocy5fcmVmO1xuICAgICAgICB0aGlzLl9yZWFkTWFzayA9IHJocy5fcmVhZE1hc2s7XG4gICAgICAgIHRoaXMuX3dyaXRlTWFzayA9IHJocy5fd3JpdGVNYXNrO1xuICAgICAgICB0aGlzLl9mYWlsID0gcmhzLl9mYWlsO1xuICAgICAgICB0aGlzLl96ZmFpbCA9IHJocy5femZhaWw7XG4gICAgICAgIHRoaXMuX3pwYXNzID0gcmhzLl96cGFzcztcbiAgICAgICAgdGhpcy5fZGlydHkgPSByaHMuX2RpcnR5O1xuICAgICAgICB0aGlzLl9rZXkgPSByaHMuX2tleTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xvbmUgdGhlIHN0ZW5jaWwgcGFyYW1ldGVycy5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtTdGVuY2lsUGFyYW1ldGVyc30gQSBjbG9uZWQgU3RlbmNpbFBhcmFtZXRlcnMgb2JqZWN0LlxuICAgICAqL1xuICAgIGNsb25lKCkge1xuICAgICAgICBjb25zdCBjbG9uZSA9IG5ldyB0aGlzLmNvbnN0cnVjdG9yKCk7XG4gICAgICAgIHJldHVybiBjbG9uZS5jb3B5KHRoaXMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEEgZGVmYXVsdCBzdGVuY2lsIHN0YXRlLlxuICAgICAqXG4gICAgICogQHR5cGUge1N0ZW5jaWxQYXJhbWV0ZXJzfVxuICAgICAqIEByZWFkb25seVxuICAgICAqL1xuICAgIHN0YXRpYyBERUZBVUxUID0gT2JqZWN0LmZyZWV6ZShuZXcgU3RlbmNpbFBhcmFtZXRlcnMoKSk7XG59XG5cbmV4cG9ydCB7IFN0ZW5jaWxQYXJhbWV0ZXJzIH07XG4iXSwibmFtZXMiOlsic3RyaW5nSWRzIiwiU3RyaW5nSWRzIiwiU3RlbmNpbFBhcmFtZXRlcnMiLCJmdW5jIiwidmFsdWUiLCJfZnVuYyIsIl9kaXJ0eSIsInJlZiIsIl9yZWYiLCJmYWlsIiwiX2ZhaWwiLCJ6ZmFpbCIsIl96ZmFpbCIsInpwYXNzIiwiX3pwYXNzIiwicmVhZE1hc2siLCJfcmVhZE1hc2siLCJ3cml0ZU1hc2siLCJfd3JpdGVNYXNrIiwiY29uc3RydWN0b3IiLCJvcHRpb25zIiwiX29wdGlvbnMkZnVuYyIsIl9vcHRpb25zJHJlZiIsIl9vcHRpb25zJHJlYWRNYXNrIiwiX29wdGlvbnMkd3JpdGVNYXNrIiwiX29wdGlvbnMkZmFpbCIsIl9vcHRpb25zJHpmYWlsIiwiX29wdGlvbnMkenBhc3MiLCJfa2V5IiwiRlVOQ19BTFdBWVMiLCJTVEVOQ0lMT1BfS0VFUCIsIl9ldmFsS2V5Iiwia2V5IiwiZ2V0IiwiY29weSIsInJocyIsImNsb25lIiwiX2NsYXNzIiwiREVGQVVMVCIsIk9iamVjdCIsImZyZWV6ZSJdLCJtYXBwaW5ncyI6Ijs7OztBQUdBLE1BQU1BLFNBQVMsR0FBRyxJQUFJQyxTQUFTLEVBQUUsQ0FBQTs7QUFFakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1DLGlCQUFpQixDQUFDO0FBdURwQjtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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
