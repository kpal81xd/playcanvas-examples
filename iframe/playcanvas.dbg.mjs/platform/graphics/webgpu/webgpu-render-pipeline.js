import { Debug, DebugHelper } from '../../../core/debug.js';
import { hash32Fnv1a } from '../../../core/hash.js';
import { array } from '../../../core/array-utils.js';
import { TRACEID_RENDERPIPELINE_ALLOC } from '../../../core/constants.js';
import { WebgpuVertexBufferLayout } from './webgpu-vertex-buffer-layout.js';
import { WebgpuDebug } from './webgpu-debug.js';
import { WebgpuPipeline } from './webgpu-pipeline.js';

let _pipelineId = 0;
const _primitiveTopology = ['point-list',
// PRIMITIVE_POINTS
'line-list',
// PRIMITIVE_LINES
undefined,
// PRIMITIVE_LINELOOP
'line-strip',
// PRIMITIVE_LINESTRIP
'triangle-list',
// PRIMITIVE_TRIANGLES
'triangle-strip',
// PRIMITIVE_TRISTRIP
undefined // PRIMITIVE_TRIFAN
];

const _blendOperation = ['add',
// BLENDEQUATION_ADD
'subtract',
// BLENDEQUATION_SUBTRACT
'reverse-subtract',
// BLENDEQUATION_REVERSE_SUBTRACT
'min',
// BLENDEQUATION_MIN
'max' // BLENDEQUATION_MAX
];

const _blendFactor = ['zero',
// BLENDMODE_ZERO
'one',
// BLENDMODE_ONE
'src',
// BLENDMODE_SRC_COLOR
'one-minus-src',
// BLENDMODE_ONE_MINUS_SRC_COLOR
'dst',
// BLENDMODE_DST_COLOR
'one-minus-dst',
// BLENDMODE_ONE_MINUS_DST_COLOR
'src-alpha',
// BLENDMODE_SRC_ALPHA
'src-alpha-saturated',
// BLENDMODE_SRC_ALPHA_SATURATE
'one-minus-src-alpha',
// BLENDMODE_ONE_MINUS_SRC_ALPHA
'dst-alpha',
// BLENDMODE_DST_ALPHA
'one-minus-dst-alpha',
// BLENDMODE_ONE_MINUS_DST_ALPHA
'constant',
// BLENDMODE_CONSTANT
'one-minus-constant' // BLENDMODE_ONE_MINUS_CONSTANT
];

const _compareFunction = ['never',
// FUNC_NEVER
'less',
// FUNC_LESS
'equal',
// FUNC_EQUAL
'less-equal',
// FUNC_LESSEQUAL
'greater',
// FUNC_GREATER
'not-equal',
// FUNC_NOTEQUAL
'greater-equal',
// FUNC_GREATEREQUAL
'always' // FUNC_ALWAYS
];

const _cullModes = ['none',
// CULLFACE_NONE
'back',
// CULLFACE_BACK
'front' // CULLFACE_FRONT
];

const _stencilOps = ['keep',
// STENCILOP_KEEP
'zero',
// STENCILOP_ZERO
'replace',
// STENCILOP_REPLACE
'increment-clamp',
// STENCILOP_INCREMENT
'increment-wrap',
// STENCILOP_INCREMENTWRAP
'decrement-clamp',
// STENCILOP_DECREMENT
'decrement-wrap',
// STENCILOP_DECREMENTWRAP
'invert' // STENCILOP_INVERT
];

/** @ignore */
class CacheEntry {
  constructor() {
    /**
     * Render pipeline
     *
     * @type {GPURenderPipeline}
     * @private
     */
    this.pipeline = void 0;
    /**
     * The full array of hashes used to lookup the pipeline, used in case of hash collision.
     *
     * @type {Uint32Array}
     */
    this.hashes = void 0;
  }
}

/**
 * @ignore
 */
class WebgpuRenderPipeline extends WebgpuPipeline {
  constructor(device) {
    super(device);

    /**
     * The cache of vertex buffer layouts
     *
     * @type {WebgpuVertexBufferLayout}
     */
    this.lookupHashes = new Uint32Array(13);
    this.vertexBufferLayout = new WebgpuVertexBufferLayout();

    /**
     * The cache of render pipelines
     *
     * @type {Map<number, CacheEntry[]>}
     */
    this.cache = new Map();
  }

  /** @private */
  get(primitive, vertexFormat0, vertexFormat1, shader, renderTarget, bindGroupFormats, blendState, depthState, cullMode, stencilEnabled, stencilFront, stencilBack) {
    var _vertexFormat0$render, _vertexFormat1$render, _bindGroupFormats$0$k, _bindGroupFormats$, _bindGroupFormats$1$k, _bindGroupFormats$2, _bindGroupFormats$2$k, _bindGroupFormats$3;
    Debug.assert(bindGroupFormats.length <= 3);

    // render pipeline unique hash
    const lookupHashes = this.lookupHashes;
    lookupHashes[0] = primitive.type;
    lookupHashes[1] = shader.id;
    lookupHashes[2] = cullMode;
    lookupHashes[3] = depthState.key;
    lookupHashes[4] = blendState.key;
    lookupHashes[5] = (_vertexFormat0$render = vertexFormat0 == null ? void 0 : vertexFormat0.renderingHash) != null ? _vertexFormat0$render : 0;
    lookupHashes[6] = (_vertexFormat1$render = vertexFormat1 == null ? void 0 : vertexFormat1.renderingHash) != null ? _vertexFormat1$render : 0;
    lookupHashes[7] = renderTarget.impl.key;
    lookupHashes[8] = (_bindGroupFormats$0$k = (_bindGroupFormats$ = bindGroupFormats[0]) == null ? void 0 : _bindGroupFormats$.key) != null ? _bindGroupFormats$0$k : 0;
    lookupHashes[9] = (_bindGroupFormats$1$k = (_bindGroupFormats$2 = bindGroupFormats[1]) == null ? void 0 : _bindGroupFormats$2.key) != null ? _bindGroupFormats$1$k : 0;
    lookupHashes[10] = (_bindGroupFormats$2$k = (_bindGroupFormats$3 = bindGroupFormats[2]) == null ? void 0 : _bindGroupFormats$3.key) != null ? _bindGroupFormats$2$k : 0;
    lookupHashes[11] = stencilEnabled ? stencilFront.key : 0;
    lookupHashes[12] = stencilEnabled ? stencilBack.key : 0;
    const hash = hash32Fnv1a(lookupHashes);

    // cached pipeline
    let cacheEntries = this.cache.get(hash);

    // if we have cache entries, find the exact match, as hash collision can occur
    if (cacheEntries) {
      for (let i = 0; i < cacheEntries.length; i++) {
        const entry = cacheEntries[i];
        if (array.equals(entry.hashes, lookupHashes)) {
          return entry.pipeline;
        }
      }
    }

    // no match or a hash collision, so create a new pipeline
    const primitiveTopology = _primitiveTopology[primitive.type];
    Debug.assert(primitiveTopology, `Unsupported primitive topology`, primitive);

    // pipeline layout
    const pipelineLayout = this.getPipelineLayout(bindGroupFormats);

    // vertex buffer layout
    const vertexBufferLayout = this.vertexBufferLayout.get(vertexFormat0, vertexFormat1);

    // pipeline
    const cacheEntry = new CacheEntry();
    cacheEntry.hashes = new Uint32Array(lookupHashes);
    cacheEntry.pipeline = this.create(primitiveTopology, shader, renderTarget, pipelineLayout, blendState, depthState, vertexBufferLayout, cullMode, stencilEnabled, stencilFront, stencilBack);

    // add to cache
    if (cacheEntries) {
      cacheEntries.push(cacheEntry);
    } else {
      cacheEntries = [cacheEntry];
    }
    this.cache.set(hash, cacheEntries);
    return cacheEntry.pipeline;
  }
  getBlend(blendState) {
    // blend needs to be undefined when blending is disabled
    let blend;
    if (blendState.blend) {
      /** @type {GPUBlendState} */
      blend = {
        color: {
          operation: _blendOperation[blendState.colorOp],
          srcFactor: _blendFactor[blendState.colorSrcFactor],
          dstFactor: _blendFactor[blendState.colorDstFactor]
        },
        alpha: {
          operation: _blendOperation[blendState.alphaOp],
          srcFactor: _blendFactor[blendState.alphaSrcFactor],
          dstFactor: _blendFactor[blendState.alphaDstFactor]
        }
      };

      // unsupported blend factors
      Debug.assert(blend.color.srcFactor !== undefined);
      Debug.assert(blend.color.dstFactor !== undefined);
      Debug.assert(blend.alpha.srcFactor !== undefined);
      Debug.assert(blend.alpha.dstFactor !== undefined);
    }
    return blend;
  }

  /** @private */
  getDepthStencil(depthState, renderTarget, stencilEnabled, stencilFront, stencilBack) {
    /** @type {GPUDepthStencilState} */
    let depthStencil;
    const {
      depth,
      stencil
    } = renderTarget;
    if (depth || stencil) {
      // format of depth-stencil attachment
      depthStencil = {
        format: renderTarget.impl.depthFormat
      };

      // depth
      if (depth) {
        depthStencil.depthWriteEnabled = depthState.write;
        depthStencil.depthCompare = _compareFunction[depthState.func];
        depthStencil.depthBias = depthState.depthBias;
        depthStencil.depthBiasSlopeScale = depthState.depthBiasSlope;
      } else {
        // if render target does not have depth buffer
        depthStencil.depthWriteEnabled = false;
        depthStencil.depthCompare = 'always';
      }

      // stencil
      if (stencil && stencilEnabled) {
        // Note that WebGPU only supports a single mask, we use the one from front, but not from back.
        depthStencil.stencilReadMas = stencilFront.readMask;
        depthStencil.stencilWriteMask = stencilFront.writeMask;
        depthStencil.stencilFront = {
          compare: _compareFunction[stencilFront.func],
          failOp: _stencilOps[stencilFront.fail],
          passOp: _stencilOps[stencilFront.zpass],
          depthFailOp: _stencilOps[stencilFront.zfail]
        };
        depthStencil.stencilBack = {
          compare: _compareFunction[stencilBack.func],
          failOp: _stencilOps[stencilBack.fail],
          passOp: _stencilOps[stencilBack.zpass],
          depthFailOp: _stencilOps[stencilBack.zfail]
        };
      }
    }
    return depthStencil;
  }
  create(primitiveTopology, shader, renderTarget, pipelineLayout, blendState, depthState, vertexBufferLayout, cullMode, stencilEnabled, stencilFront, stencilBack) {
    const wgpu = this.device.wgpu;

    /** @type {import('./webgpu-shader.js').WebgpuShader} */
    const webgpuShader = shader.impl;

    /** @type {GPURenderPipelineDescriptor} */
    const descr = {
      vertex: {
        module: webgpuShader.getVertexShaderModule(),
        entryPoint: webgpuShader.vertexEntryPoint,
        buffers: vertexBufferLayout
      },
      primitive: {
        topology: primitiveTopology,
        frontFace: 'ccw',
        cullMode: _cullModes[cullMode]
      },
      depthStencil: this.getDepthStencil(depthState, renderTarget, stencilEnabled, stencilFront, stencilBack),
      multisample: {
        count: renderTarget.samples
      },
      // uniform / texture binding layout
      layout: pipelineLayout
    };
    const colorAttachments = renderTarget.impl.colorAttachments;
    if (colorAttachments.length > 0) {
      descr.fragment = {
        module: webgpuShader.getFragmentShaderModule(),
        entryPoint: webgpuShader.fragmentEntryPoint,
        targets: []
      };

      // the same write mask is used by all color buffers, to match the WebGL behavior
      let writeMask = 0;
      if (blendState.redWrite) writeMask |= GPUColorWrite.RED;
      if (blendState.greenWrite) writeMask |= GPUColorWrite.GREEN;
      if (blendState.blueWrite) writeMask |= GPUColorWrite.BLUE;
      if (blendState.alphaWrite) writeMask |= GPUColorWrite.ALPHA;

      // the same blend state is used by all color buffers, to match the WebGL behavior
      const blend = this.getBlend(blendState);
      colorAttachments.forEach(attachment => {
        descr.fragment.targets.push({
          format: attachment.format,
          writeMask: writeMask,
          blend: blend
        });
      });
    }
    WebgpuDebug.validate(this.device);
    _pipelineId++;
    DebugHelper.setLabel(descr, `RenderPipelineDescr-${_pipelineId}`);
    const pipeline = wgpu.createRenderPipeline(descr);
    DebugHelper.setLabel(pipeline, `RenderPipeline-${_pipelineId}`);
    Debug.trace(TRACEID_RENDERPIPELINE_ALLOC, `Alloc: Id ${_pipelineId}`, descr);
    WebgpuDebug.end(this.device, {
      renderPipeline: this,
      descr,
      shader
    });
    return pipeline;
  }
}

export { WebgpuRenderPipeline };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViZ3B1LXJlbmRlci1waXBlbGluZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL3BsYXRmb3JtL2dyYXBoaWNzL3dlYmdwdS93ZWJncHUtcmVuZGVyLXBpcGVsaW5lLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnLCBEZWJ1Z0hlbHBlciB9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2RlYnVnLmpzXCI7XG5pbXBvcnQgeyBoYXNoMzJGbnYxYSB9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2hhc2guanNcIjtcbmltcG9ydCB7IGFycmF5IH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvYXJyYXktdXRpbHMuanNcIjtcbmltcG9ydCB7IFRSQUNFSURfUkVOREVSUElQRUxJTkVfQUxMT0MgfSBmcm9tIFwiLi4vLi4vLi4vY29yZS9jb25zdGFudHMuanNcIjtcblxuaW1wb3J0IHsgV2ViZ3B1VmVydGV4QnVmZmVyTGF5b3V0IH0gZnJvbSBcIi4vd2ViZ3B1LXZlcnRleC1idWZmZXItbGF5b3V0LmpzXCI7XG5pbXBvcnQgeyBXZWJncHVEZWJ1ZyB9IGZyb20gXCIuL3dlYmdwdS1kZWJ1Zy5qc1wiO1xuaW1wb3J0IHsgV2ViZ3B1UGlwZWxpbmUgfSBmcm9tIFwiLi93ZWJncHUtcGlwZWxpbmUuanNcIjtcblxubGV0IF9waXBlbGluZUlkID0gMDtcblxuY29uc3QgX3ByaW1pdGl2ZVRvcG9sb2d5ID0gW1xuICAgICdwb2ludC1saXN0JywgICAgICAgLy8gUFJJTUlUSVZFX1BPSU5UU1xuICAgICdsaW5lLWxpc3QnLCAgICAgICAgLy8gUFJJTUlUSVZFX0xJTkVTXG4gICAgdW5kZWZpbmVkLCAgICAgICAgICAvLyBQUklNSVRJVkVfTElORUxPT1BcbiAgICAnbGluZS1zdHJpcCcsICAgICAgIC8vIFBSSU1JVElWRV9MSU5FU1RSSVBcbiAgICAndHJpYW5nbGUtbGlzdCcsICAgIC8vIFBSSU1JVElWRV9UUklBTkdMRVNcbiAgICAndHJpYW5nbGUtc3RyaXAnLCAgIC8vIFBSSU1JVElWRV9UUklTVFJJUFxuICAgIHVuZGVmaW5lZCAgICAgICAgICAgLy8gUFJJTUlUSVZFX1RSSUZBTlxuXTtcblxuY29uc3QgX2JsZW5kT3BlcmF0aW9uID0gW1xuICAgICdhZGQnLCAgICAgICAgICAgICAgLy8gQkxFTkRFUVVBVElPTl9BRERcbiAgICAnc3VidHJhY3QnLCAgICAgICAgIC8vIEJMRU5ERVFVQVRJT05fU1VCVFJBQ1RcbiAgICAncmV2ZXJzZS1zdWJ0cmFjdCcsIC8vIEJMRU5ERVFVQVRJT05fUkVWRVJTRV9TVUJUUkFDVFxuICAgICdtaW4nLCAgICAgICAgICAgICAgLy8gQkxFTkRFUVVBVElPTl9NSU5cbiAgICAnbWF4JyAgICAgICAgICAgICAgIC8vIEJMRU5ERVFVQVRJT05fTUFYXG5dO1xuXG5jb25zdCBfYmxlbmRGYWN0b3IgPSBbXG4gICAgJ3plcm8nLCAgICAgICAgICAgICAgICAgLy8gQkxFTkRNT0RFX1pFUk9cbiAgICAnb25lJywgICAgICAgICAgICAgICAgICAvLyBCTEVORE1PREVfT05FXG4gICAgJ3NyYycsICAgICAgICAgICAgICAgICAgLy8gQkxFTkRNT0RFX1NSQ19DT0xPUlxuICAgICdvbmUtbWludXMtc3JjJywgICAgICAgIC8vIEJMRU5ETU9ERV9PTkVfTUlOVVNfU1JDX0NPTE9SXG4gICAgJ2RzdCcsICAgICAgICAgICAgICAgICAgLy8gQkxFTkRNT0RFX0RTVF9DT0xPUlxuICAgICdvbmUtbWludXMtZHN0JywgICAgICAgIC8vIEJMRU5ETU9ERV9PTkVfTUlOVVNfRFNUX0NPTE9SXG4gICAgJ3NyYy1hbHBoYScsICAgICAgICAgICAgLy8gQkxFTkRNT0RFX1NSQ19BTFBIQVxuICAgICdzcmMtYWxwaGEtc2F0dXJhdGVkJywgIC8vIEJMRU5ETU9ERV9TUkNfQUxQSEFfU0FUVVJBVEVcbiAgICAnb25lLW1pbnVzLXNyYy1hbHBoYScsICAvLyBCTEVORE1PREVfT05FX01JTlVTX1NSQ19BTFBIQVxuICAgICdkc3QtYWxwaGEnLCAgICAgICAgICAgIC8vIEJMRU5ETU9ERV9EU1RfQUxQSEFcbiAgICAnb25lLW1pbnVzLWRzdC1hbHBoYScsICAvLyBCTEVORE1PREVfT05FX01JTlVTX0RTVF9BTFBIQVxuICAgICdjb25zdGFudCcsICAgICAgICAgICAgIC8vIEJMRU5ETU9ERV9DT05TVEFOVFxuICAgICdvbmUtbWludXMtY29uc3RhbnQnICAgIC8vIEJMRU5ETU9ERV9PTkVfTUlOVVNfQ09OU1RBTlRcbl07XG5cbmNvbnN0IF9jb21wYXJlRnVuY3Rpb24gPSBbXG4gICAgJ25ldmVyJywgICAgICAgICAgICAgICAgLy8gRlVOQ19ORVZFUlxuICAgICdsZXNzJywgICAgICAgICAgICAgICAgIC8vIEZVTkNfTEVTU1xuICAgICdlcXVhbCcsICAgICAgICAgICAgICAgIC8vIEZVTkNfRVFVQUxcbiAgICAnbGVzcy1lcXVhbCcsICAgICAgICAgICAvLyBGVU5DX0xFU1NFUVVBTFxuICAgICdncmVhdGVyJywgICAgICAgICAgICAgIC8vIEZVTkNfR1JFQVRFUlxuICAgICdub3QtZXF1YWwnLCAgICAgICAgICAgIC8vIEZVTkNfTk9URVFVQUxcbiAgICAnZ3JlYXRlci1lcXVhbCcsICAgICAgICAvLyBGVU5DX0dSRUFURVJFUVVBTFxuICAgICdhbHdheXMnICAgICAgICAgICAgICAgIC8vIEZVTkNfQUxXQVlTXG5dO1xuXG5jb25zdCBfY3VsbE1vZGVzID0gW1xuICAgICdub25lJywgICAgICAgICAgICAgICAgIC8vIENVTExGQUNFX05PTkVcbiAgICAnYmFjaycsICAgICAgICAgICAgICAgICAvLyBDVUxMRkFDRV9CQUNLXG4gICAgJ2Zyb250JyAgICAgICAgICAgICAgICAgLy8gQ1VMTEZBQ0VfRlJPTlRcbl07XG5cbmNvbnN0IF9zdGVuY2lsT3BzID0gW1xuICAgICdrZWVwJywgICAgICAgICAgICAgICAgIC8vIFNURU5DSUxPUF9LRUVQXG4gICAgJ3plcm8nLCAgICAgICAgICAgICAgICAgLy8gU1RFTkNJTE9QX1pFUk9cbiAgICAncmVwbGFjZScsICAgICAgICAgICAgICAvLyBTVEVOQ0lMT1BfUkVQTEFDRVxuICAgICdpbmNyZW1lbnQtY2xhbXAnLCAgICAgIC8vIFNURU5DSUxPUF9JTkNSRU1FTlRcbiAgICAnaW5jcmVtZW50LXdyYXAnLCAgICAgICAvLyBTVEVOQ0lMT1BfSU5DUkVNRU5UV1JBUFxuICAgICdkZWNyZW1lbnQtY2xhbXAnLCAgICAgIC8vIFNURU5DSUxPUF9ERUNSRU1FTlRcbiAgICAnZGVjcmVtZW50LXdyYXAnLCAgICAgICAvLyBTVEVOQ0lMT1BfREVDUkVNRU5UV1JBUFxuICAgICdpbnZlcnQnICAgICAgICAgICAgICAgIC8vIFNURU5DSUxPUF9JTlZFUlRcbl07XG5cbi8qKiBAaWdub3JlICovXG5jbGFzcyBDYWNoZUVudHJ5IHtcbiAgICAvKipcbiAgICAgKiBSZW5kZXIgcGlwZWxpbmVcbiAgICAgKlxuICAgICAqIEB0eXBlIHtHUFVSZW5kZXJQaXBlbGluZX1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHBpcGVsaW5lO1xuXG4gICAgLyoqXG4gICAgICogVGhlIGZ1bGwgYXJyYXkgb2YgaGFzaGVzIHVzZWQgdG8gbG9va3VwIHRoZSBwaXBlbGluZSwgdXNlZCBpbiBjYXNlIG9mIGhhc2ggY29sbGlzaW9uLlxuICAgICAqXG4gICAgICogQHR5cGUge1VpbnQzMkFycmF5fVxuICAgICAqL1xuICAgIGhhc2hlcztcbn1cblxuLyoqXG4gKiBAaWdub3JlXG4gKi9cbmNsYXNzIFdlYmdwdVJlbmRlclBpcGVsaW5lIGV4dGVuZHMgV2ViZ3B1UGlwZWxpbmUge1xuICAgIGxvb2t1cEhhc2hlcyA9IG5ldyBVaW50MzJBcnJheSgxMyk7XG5cbiAgICBjb25zdHJ1Y3RvcihkZXZpY2UpIHtcbiAgICAgICAgc3VwZXIoZGV2aWNlKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGNhY2hlIG9mIHZlcnRleCBidWZmZXIgbGF5b3V0c1xuICAgICAgICAgKlxuICAgICAgICAgKiBAdHlwZSB7V2ViZ3B1VmVydGV4QnVmZmVyTGF5b3V0fVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy52ZXJ0ZXhCdWZmZXJMYXlvdXQgPSBuZXcgV2ViZ3B1VmVydGV4QnVmZmVyTGF5b3V0KCk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBjYWNoZSBvZiByZW5kZXIgcGlwZWxpbmVzXG4gICAgICAgICAqXG4gICAgICAgICAqIEB0eXBlIHtNYXA8bnVtYmVyLCBDYWNoZUVudHJ5W10+fVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jYWNoZSA9IG5ldyBNYXAoKTtcbiAgICB9XG5cbiAgICAvKiogQHByaXZhdGUgKi9cbiAgICBnZXQocHJpbWl0aXZlLCB2ZXJ0ZXhGb3JtYXQwLCB2ZXJ0ZXhGb3JtYXQxLCBzaGFkZXIsIHJlbmRlclRhcmdldCwgYmluZEdyb3VwRm9ybWF0cywgYmxlbmRTdGF0ZSxcbiAgICAgICAgZGVwdGhTdGF0ZSwgY3VsbE1vZGUsIHN0ZW5jaWxFbmFibGVkLCBzdGVuY2lsRnJvbnQsIHN0ZW5jaWxCYWNrKSB7XG5cbiAgICAgICAgRGVidWcuYXNzZXJ0KGJpbmRHcm91cEZvcm1hdHMubGVuZ3RoIDw9IDMpO1xuXG4gICAgICAgIC8vIHJlbmRlciBwaXBlbGluZSB1bmlxdWUgaGFzaFxuICAgICAgICBjb25zdCBsb29rdXBIYXNoZXMgPSB0aGlzLmxvb2t1cEhhc2hlcztcbiAgICAgICAgbG9va3VwSGFzaGVzWzBdID0gcHJpbWl0aXZlLnR5cGU7XG4gICAgICAgIGxvb2t1cEhhc2hlc1sxXSA9IHNoYWRlci5pZDtcbiAgICAgICAgbG9va3VwSGFzaGVzWzJdID0gY3VsbE1vZGU7XG4gICAgICAgIGxvb2t1cEhhc2hlc1szXSA9IGRlcHRoU3RhdGUua2V5O1xuICAgICAgICBsb29rdXBIYXNoZXNbNF0gPSBibGVuZFN0YXRlLmtleTtcbiAgICAgICAgbG9va3VwSGFzaGVzWzVdID0gdmVydGV4Rm9ybWF0MD8ucmVuZGVyaW5nSGFzaCA/PyAwO1xuICAgICAgICBsb29rdXBIYXNoZXNbNl0gPSB2ZXJ0ZXhGb3JtYXQxPy5yZW5kZXJpbmdIYXNoID8/IDA7XG4gICAgICAgIGxvb2t1cEhhc2hlc1s3XSA9IHJlbmRlclRhcmdldC5pbXBsLmtleTtcbiAgICAgICAgbG9va3VwSGFzaGVzWzhdID0gYmluZEdyb3VwRm9ybWF0c1swXT8ua2V5ID8/IDA7XG4gICAgICAgIGxvb2t1cEhhc2hlc1s5XSA9IGJpbmRHcm91cEZvcm1hdHNbMV0/LmtleSA/PyAwO1xuICAgICAgICBsb29rdXBIYXNoZXNbMTBdID0gYmluZEdyb3VwRm9ybWF0c1syXT8ua2V5ID8/IDA7XG4gICAgICAgIGxvb2t1cEhhc2hlc1sxMV0gPSBzdGVuY2lsRW5hYmxlZCA/IHN0ZW5jaWxGcm9udC5rZXkgOiAwO1xuICAgICAgICBsb29rdXBIYXNoZXNbMTJdID0gc3RlbmNpbEVuYWJsZWQgPyBzdGVuY2lsQmFjay5rZXkgOiAwO1xuICAgICAgICBjb25zdCBoYXNoID0gaGFzaDMyRm52MWEobG9va3VwSGFzaGVzKTtcblxuICAgICAgICAvLyBjYWNoZWQgcGlwZWxpbmVcbiAgICAgICAgbGV0IGNhY2hlRW50cmllcyA9IHRoaXMuY2FjaGUuZ2V0KGhhc2gpO1xuXG4gICAgICAgIC8vIGlmIHdlIGhhdmUgY2FjaGUgZW50cmllcywgZmluZCB0aGUgZXhhY3QgbWF0Y2gsIGFzIGhhc2ggY29sbGlzaW9uIGNhbiBvY2N1clxuICAgICAgICBpZiAoY2FjaGVFbnRyaWVzKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNhY2hlRW50cmllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGVudHJ5ID0gY2FjaGVFbnRyaWVzW2ldO1xuICAgICAgICAgICAgICAgIGlmIChhcnJheS5lcXVhbHMoZW50cnkuaGFzaGVzLCBsb29rdXBIYXNoZXMpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbnRyeS5waXBlbGluZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBubyBtYXRjaCBvciBhIGhhc2ggY29sbGlzaW9uLCBzbyBjcmVhdGUgYSBuZXcgcGlwZWxpbmVcbiAgICAgICAgY29uc3QgcHJpbWl0aXZlVG9wb2xvZ3kgPSBfcHJpbWl0aXZlVG9wb2xvZ3lbcHJpbWl0aXZlLnR5cGVdO1xuICAgICAgICBEZWJ1Zy5hc3NlcnQocHJpbWl0aXZlVG9wb2xvZ3ksIGBVbnN1cHBvcnRlZCBwcmltaXRpdmUgdG9wb2xvZ3lgLCBwcmltaXRpdmUpO1xuXG4gICAgICAgIC8vIHBpcGVsaW5lIGxheW91dFxuICAgICAgICBjb25zdCBwaXBlbGluZUxheW91dCA9IHRoaXMuZ2V0UGlwZWxpbmVMYXlvdXQoYmluZEdyb3VwRm9ybWF0cyk7XG5cbiAgICAgICAgLy8gdmVydGV4IGJ1ZmZlciBsYXlvdXRcbiAgICAgICAgY29uc3QgdmVydGV4QnVmZmVyTGF5b3V0ID0gdGhpcy52ZXJ0ZXhCdWZmZXJMYXlvdXQuZ2V0KHZlcnRleEZvcm1hdDAsIHZlcnRleEZvcm1hdDEpO1xuXG4gICAgICAgIC8vIHBpcGVsaW5lXG4gICAgICAgIGNvbnN0IGNhY2hlRW50cnkgPSBuZXcgQ2FjaGVFbnRyeSgpO1xuICAgICAgICBjYWNoZUVudHJ5Lmhhc2hlcyA9IG5ldyBVaW50MzJBcnJheShsb29rdXBIYXNoZXMpO1xuICAgICAgICBjYWNoZUVudHJ5LnBpcGVsaW5lID0gdGhpcy5jcmVhdGUocHJpbWl0aXZlVG9wb2xvZ3ksIHNoYWRlciwgcmVuZGVyVGFyZ2V0LCBwaXBlbGluZUxheW91dCwgYmxlbmRTdGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlcHRoU3RhdGUsIHZlcnRleEJ1ZmZlckxheW91dCwgY3VsbE1vZGUsIHN0ZW5jaWxFbmFibGVkLCBzdGVuY2lsRnJvbnQsIHN0ZW5jaWxCYWNrKTtcblxuICAgICAgICAvLyBhZGQgdG8gY2FjaGVcbiAgICAgICAgaWYgKGNhY2hlRW50cmllcykge1xuICAgICAgICAgICAgY2FjaGVFbnRyaWVzLnB1c2goY2FjaGVFbnRyeSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYWNoZUVudHJpZXMgPSBbY2FjaGVFbnRyeV07XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jYWNoZS5zZXQoaGFzaCwgY2FjaGVFbnRyaWVzKTtcblxuICAgICAgICByZXR1cm4gY2FjaGVFbnRyeS5waXBlbGluZTtcbiAgICB9XG5cbiAgICBnZXRCbGVuZChibGVuZFN0YXRlKSB7XG5cbiAgICAgICAgLy8gYmxlbmQgbmVlZHMgdG8gYmUgdW5kZWZpbmVkIHdoZW4gYmxlbmRpbmcgaXMgZGlzYWJsZWRcbiAgICAgICAgbGV0IGJsZW5kO1xuXG4gICAgICAgIGlmIChibGVuZFN0YXRlLmJsZW5kKSB7XG5cbiAgICAgICAgICAgIC8qKiBAdHlwZSB7R1BVQmxlbmRTdGF0ZX0gKi9cbiAgICAgICAgICAgIGJsZW5kID0ge1xuICAgICAgICAgICAgICAgIGNvbG9yOiB7XG4gICAgICAgICAgICAgICAgICAgIG9wZXJhdGlvbjogX2JsZW5kT3BlcmF0aW9uW2JsZW5kU3RhdGUuY29sb3JPcF0sXG4gICAgICAgICAgICAgICAgICAgIHNyY0ZhY3RvcjogX2JsZW5kRmFjdG9yW2JsZW5kU3RhdGUuY29sb3JTcmNGYWN0b3JdLFxuICAgICAgICAgICAgICAgICAgICBkc3RGYWN0b3I6IF9ibGVuZEZhY3RvcltibGVuZFN0YXRlLmNvbG9yRHN0RmFjdG9yXVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYWxwaGE6IHtcbiAgICAgICAgICAgICAgICAgICAgb3BlcmF0aW9uOiBfYmxlbmRPcGVyYXRpb25bYmxlbmRTdGF0ZS5hbHBoYU9wXSxcbiAgICAgICAgICAgICAgICAgICAgc3JjRmFjdG9yOiBfYmxlbmRGYWN0b3JbYmxlbmRTdGF0ZS5hbHBoYVNyY0ZhY3Rvcl0sXG4gICAgICAgICAgICAgICAgICAgIGRzdEZhY3RvcjogX2JsZW5kRmFjdG9yW2JsZW5kU3RhdGUuYWxwaGFEc3RGYWN0b3JdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gdW5zdXBwb3J0ZWQgYmxlbmQgZmFjdG9yc1xuICAgICAgICAgICAgRGVidWcuYXNzZXJ0KGJsZW5kLmNvbG9yLnNyY0ZhY3RvciAhPT0gdW5kZWZpbmVkKTtcbiAgICAgICAgICAgIERlYnVnLmFzc2VydChibGVuZC5jb2xvci5kc3RGYWN0b3IgIT09IHVuZGVmaW5lZCk7XG4gICAgICAgICAgICBEZWJ1Zy5hc3NlcnQoYmxlbmQuYWxwaGEuc3JjRmFjdG9yICE9PSB1bmRlZmluZWQpO1xuICAgICAgICAgICAgRGVidWcuYXNzZXJ0KGJsZW5kLmFscGhhLmRzdEZhY3RvciAhPT0gdW5kZWZpbmVkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBibGVuZDtcbiAgICB9XG5cbiAgICAvKiogQHByaXZhdGUgKi9cbiAgICBnZXREZXB0aFN0ZW5jaWwoZGVwdGhTdGF0ZSwgcmVuZGVyVGFyZ2V0LCBzdGVuY2lsRW5hYmxlZCwgc3RlbmNpbEZyb250LCBzdGVuY2lsQmFjaykge1xuXG4gICAgICAgIC8qKiBAdHlwZSB7R1BVRGVwdGhTdGVuY2lsU3RhdGV9ICovXG4gICAgICAgIGxldCBkZXB0aFN0ZW5jaWw7XG4gICAgICAgIGNvbnN0IHsgZGVwdGgsIHN0ZW5jaWwgfSA9IHJlbmRlclRhcmdldDtcbiAgICAgICAgaWYgKGRlcHRoIHx8IHN0ZW5jaWwpIHtcblxuICAgICAgICAgICAgLy8gZm9ybWF0IG9mIGRlcHRoLXN0ZW5jaWwgYXR0YWNobWVudFxuICAgICAgICAgICAgZGVwdGhTdGVuY2lsID0ge1xuICAgICAgICAgICAgICAgIGZvcm1hdDogcmVuZGVyVGFyZ2V0LmltcGwuZGVwdGhGb3JtYXRcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIGRlcHRoXG4gICAgICAgICAgICBpZiAoZGVwdGgpIHtcbiAgICAgICAgICAgICAgICBkZXB0aFN0ZW5jaWwuZGVwdGhXcml0ZUVuYWJsZWQgPSBkZXB0aFN0YXRlLndyaXRlO1xuICAgICAgICAgICAgICAgIGRlcHRoU3RlbmNpbC5kZXB0aENvbXBhcmUgPSBfY29tcGFyZUZ1bmN0aW9uW2RlcHRoU3RhdGUuZnVuY107XG4gICAgICAgICAgICAgICAgZGVwdGhTdGVuY2lsLmRlcHRoQmlhcyA9IGRlcHRoU3RhdGUuZGVwdGhCaWFzO1xuICAgICAgICAgICAgICAgIGRlcHRoU3RlbmNpbC5kZXB0aEJpYXNTbG9wZVNjYWxlID0gZGVwdGhTdGF0ZS5kZXB0aEJpYXNTbG9wZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gaWYgcmVuZGVyIHRhcmdldCBkb2VzIG5vdCBoYXZlIGRlcHRoIGJ1ZmZlclxuICAgICAgICAgICAgICAgIGRlcHRoU3RlbmNpbC5kZXB0aFdyaXRlRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGRlcHRoU3RlbmNpbC5kZXB0aENvbXBhcmUgPSAnYWx3YXlzJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gc3RlbmNpbFxuICAgICAgICAgICAgaWYgKHN0ZW5jaWwgJiYgc3RlbmNpbEVuYWJsZWQpIHtcblxuICAgICAgICAgICAgICAgIC8vIE5vdGUgdGhhdCBXZWJHUFUgb25seSBzdXBwb3J0cyBhIHNpbmdsZSBtYXNrLCB3ZSB1c2UgdGhlIG9uZSBmcm9tIGZyb250LCBidXQgbm90IGZyb20gYmFjay5cbiAgICAgICAgICAgICAgICBkZXB0aFN0ZW5jaWwuc3RlbmNpbFJlYWRNYXMgPSBzdGVuY2lsRnJvbnQucmVhZE1hc2s7XG4gICAgICAgICAgICAgICAgZGVwdGhTdGVuY2lsLnN0ZW5jaWxXcml0ZU1hc2sgPSBzdGVuY2lsRnJvbnQud3JpdGVNYXNrO1xuXG4gICAgICAgICAgICAgICAgZGVwdGhTdGVuY2lsLnN0ZW5jaWxGcm9udCA9IHtcbiAgICAgICAgICAgICAgICAgICAgY29tcGFyZTogX2NvbXBhcmVGdW5jdGlvbltzdGVuY2lsRnJvbnQuZnVuY10sXG4gICAgICAgICAgICAgICAgICAgIGZhaWxPcDogX3N0ZW5jaWxPcHNbc3RlbmNpbEZyb250LmZhaWxdLFxuICAgICAgICAgICAgICAgICAgICBwYXNzT3A6IF9zdGVuY2lsT3BzW3N0ZW5jaWxGcm9udC56cGFzc10sXG4gICAgICAgICAgICAgICAgICAgIGRlcHRoRmFpbE9wOiBfc3RlbmNpbE9wc1tzdGVuY2lsRnJvbnQuemZhaWxdXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGRlcHRoU3RlbmNpbC5zdGVuY2lsQmFjayA9IHtcbiAgICAgICAgICAgICAgICAgICAgY29tcGFyZTogX2NvbXBhcmVGdW5jdGlvbltzdGVuY2lsQmFjay5mdW5jXSxcbiAgICAgICAgICAgICAgICAgICAgZmFpbE9wOiBfc3RlbmNpbE9wc1tzdGVuY2lsQmFjay5mYWlsXSxcbiAgICAgICAgICAgICAgICAgICAgcGFzc09wOiBfc3RlbmNpbE9wc1tzdGVuY2lsQmFjay56cGFzc10sXG4gICAgICAgICAgICAgICAgICAgIGRlcHRoRmFpbE9wOiBfc3RlbmNpbE9wc1tzdGVuY2lsQmFjay56ZmFpbF1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGRlcHRoU3RlbmNpbDtcbiAgICB9XG5cbiAgICBjcmVhdGUocHJpbWl0aXZlVG9wb2xvZ3ksIHNoYWRlciwgcmVuZGVyVGFyZ2V0LCBwaXBlbGluZUxheW91dCwgYmxlbmRTdGF0ZSwgZGVwdGhTdGF0ZSwgdmVydGV4QnVmZmVyTGF5b3V0LFxuICAgICAgICBjdWxsTW9kZSwgc3RlbmNpbEVuYWJsZWQsIHN0ZW5jaWxGcm9udCwgc3RlbmNpbEJhY2spIHtcblxuICAgICAgICBjb25zdCB3Z3B1ID0gdGhpcy5kZXZpY2Uud2dwdTtcblxuICAgICAgICAvKiogQHR5cGUge2ltcG9ydCgnLi93ZWJncHUtc2hhZGVyLmpzJykuV2ViZ3B1U2hhZGVyfSAqL1xuICAgICAgICBjb25zdCB3ZWJncHVTaGFkZXIgPSBzaGFkZXIuaW1wbDtcblxuICAgICAgICAvKiogQHR5cGUge0dQVVJlbmRlclBpcGVsaW5lRGVzY3JpcHRvcn0gKi9cbiAgICAgICAgY29uc3QgZGVzY3IgPSB7XG4gICAgICAgICAgICB2ZXJ0ZXg6IHtcbiAgICAgICAgICAgICAgICBtb2R1bGU6IHdlYmdwdVNoYWRlci5nZXRWZXJ0ZXhTaGFkZXJNb2R1bGUoKSxcbiAgICAgICAgICAgICAgICBlbnRyeVBvaW50OiB3ZWJncHVTaGFkZXIudmVydGV4RW50cnlQb2ludCxcbiAgICAgICAgICAgICAgICBidWZmZXJzOiB2ZXJ0ZXhCdWZmZXJMYXlvdXRcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHByaW1pdGl2ZToge1xuICAgICAgICAgICAgICAgIHRvcG9sb2d5OiBwcmltaXRpdmVUb3BvbG9neSxcbiAgICAgICAgICAgICAgICBmcm9udEZhY2U6ICdjY3cnLFxuICAgICAgICAgICAgICAgIGN1bGxNb2RlOiBfY3VsbE1vZGVzW2N1bGxNb2RlXVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZGVwdGhTdGVuY2lsOiB0aGlzLmdldERlcHRoU3RlbmNpbChkZXB0aFN0YXRlLCByZW5kZXJUYXJnZXQsIHN0ZW5jaWxFbmFibGVkLCBzdGVuY2lsRnJvbnQsIHN0ZW5jaWxCYWNrKSxcblxuICAgICAgICAgICAgbXVsdGlzYW1wbGU6IHtcbiAgICAgICAgICAgICAgICBjb3VudDogcmVuZGVyVGFyZ2V0LnNhbXBsZXNcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8vIHVuaWZvcm0gLyB0ZXh0dXJlIGJpbmRpbmcgbGF5b3V0XG4gICAgICAgICAgICBsYXlvdXQ6IHBpcGVsaW5lTGF5b3V0XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgY29sb3JBdHRhY2htZW50cyA9IHJlbmRlclRhcmdldC5pbXBsLmNvbG9yQXR0YWNobWVudHM7XG4gICAgICAgIGlmIChjb2xvckF0dGFjaG1lbnRzLmxlbmd0aCA+IDApIHtcblxuICAgICAgICAgICAgZGVzY3IuZnJhZ21lbnQgPSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlOiB3ZWJncHVTaGFkZXIuZ2V0RnJhZ21lbnRTaGFkZXJNb2R1bGUoKSxcbiAgICAgICAgICAgICAgICBlbnRyeVBvaW50OiB3ZWJncHVTaGFkZXIuZnJhZ21lbnRFbnRyeVBvaW50LFxuICAgICAgICAgICAgICAgIHRhcmdldHM6IFtdXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyB0aGUgc2FtZSB3cml0ZSBtYXNrIGlzIHVzZWQgYnkgYWxsIGNvbG9yIGJ1ZmZlcnMsIHRvIG1hdGNoIHRoZSBXZWJHTCBiZWhhdmlvclxuICAgICAgICAgICAgbGV0IHdyaXRlTWFzayA9IDA7XG4gICAgICAgICAgICBpZiAoYmxlbmRTdGF0ZS5yZWRXcml0ZSkgd3JpdGVNYXNrIHw9IEdQVUNvbG9yV3JpdGUuUkVEO1xuICAgICAgICAgICAgaWYgKGJsZW5kU3RhdGUuZ3JlZW5Xcml0ZSkgd3JpdGVNYXNrIHw9IEdQVUNvbG9yV3JpdGUuR1JFRU47XG4gICAgICAgICAgICBpZiAoYmxlbmRTdGF0ZS5ibHVlV3JpdGUpIHdyaXRlTWFzayB8PSBHUFVDb2xvcldyaXRlLkJMVUU7XG4gICAgICAgICAgICBpZiAoYmxlbmRTdGF0ZS5hbHBoYVdyaXRlKSB3cml0ZU1hc2sgfD0gR1BVQ29sb3JXcml0ZS5BTFBIQTtcblxuICAgICAgICAgICAgLy8gdGhlIHNhbWUgYmxlbmQgc3RhdGUgaXMgdXNlZCBieSBhbGwgY29sb3IgYnVmZmVycywgdG8gbWF0Y2ggdGhlIFdlYkdMIGJlaGF2aW9yXG4gICAgICAgICAgICBjb25zdCBibGVuZCA9IHRoaXMuZ2V0QmxlbmQoYmxlbmRTdGF0ZSk7XG5cbiAgICAgICAgICAgIGNvbG9yQXR0YWNobWVudHMuZm9yRWFjaCgoYXR0YWNobWVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGRlc2NyLmZyYWdtZW50LnRhcmdldHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGZvcm1hdDogYXR0YWNobWVudC5mb3JtYXQsXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlTWFzazogd3JpdGVNYXNrLFxuICAgICAgICAgICAgICAgICAgICBibGVuZDogYmxlbmRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgV2ViZ3B1RGVidWcudmFsaWRhdGUodGhpcy5kZXZpY2UpO1xuXG4gICAgICAgIF9waXBlbGluZUlkKys7XG4gICAgICAgIERlYnVnSGVscGVyLnNldExhYmVsKGRlc2NyLCBgUmVuZGVyUGlwZWxpbmVEZXNjci0ke19waXBlbGluZUlkfWApO1xuXG4gICAgICAgIGNvbnN0IHBpcGVsaW5lID0gd2dwdS5jcmVhdGVSZW5kZXJQaXBlbGluZShkZXNjcik7XG5cbiAgICAgICAgRGVidWdIZWxwZXIuc2V0TGFiZWwocGlwZWxpbmUsIGBSZW5kZXJQaXBlbGluZS0ke19waXBlbGluZUlkfWApO1xuICAgICAgICBEZWJ1Zy50cmFjZShUUkFDRUlEX1JFTkRFUlBJUEVMSU5FX0FMTE9DLCBgQWxsb2M6IElkICR7X3BpcGVsaW5lSWR9YCwgZGVzY3IpO1xuXG4gICAgICAgIFdlYmdwdURlYnVnLmVuZCh0aGlzLmRldmljZSwge1xuICAgICAgICAgICAgcmVuZGVyUGlwZWxpbmU6IHRoaXMsXG4gICAgICAgICAgICBkZXNjcixcbiAgICAgICAgICAgIHNoYWRlclxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gcGlwZWxpbmU7XG4gICAgfVxufVxuXG5leHBvcnQgeyBXZWJncHVSZW5kZXJQaXBlbGluZSB9O1xuIl0sIm5hbWVzIjpbIl9waXBlbGluZUlkIiwiX3ByaW1pdGl2ZVRvcG9sb2d5IiwidW5kZWZpbmVkIiwiX2JsZW5kT3BlcmF0aW9uIiwiX2JsZW5kRmFjdG9yIiwiX2NvbXBhcmVGdW5jdGlvbiIsIl9jdWxsTW9kZXMiLCJfc3RlbmNpbE9wcyIsIkNhY2hlRW50cnkiLCJjb25zdHJ1Y3RvciIsInBpcGVsaW5lIiwiaGFzaGVzIiwiV2ViZ3B1UmVuZGVyUGlwZWxpbmUiLCJXZWJncHVQaXBlbGluZSIsImRldmljZSIsImxvb2t1cEhhc2hlcyIsIlVpbnQzMkFycmF5IiwidmVydGV4QnVmZmVyTGF5b3V0IiwiV2ViZ3B1VmVydGV4QnVmZmVyTGF5b3V0IiwiY2FjaGUiLCJNYXAiLCJnZXQiLCJwcmltaXRpdmUiLCJ2ZXJ0ZXhGb3JtYXQwIiwidmVydGV4Rm9ybWF0MSIsInNoYWRlciIsInJlbmRlclRhcmdldCIsImJpbmRHcm91cEZvcm1hdHMiLCJibGVuZFN0YXRlIiwiZGVwdGhTdGF0ZSIsImN1bGxNb2RlIiwic3RlbmNpbEVuYWJsZWQiLCJzdGVuY2lsRnJvbnQiLCJzdGVuY2lsQmFjayIsIl92ZXJ0ZXhGb3JtYXQwJHJlbmRlciIsIl92ZXJ0ZXhGb3JtYXQxJHJlbmRlciIsIl9iaW5kR3JvdXBGb3JtYXRzJDAkayIsIl9iaW5kR3JvdXBGb3JtYXRzJCIsIl9iaW5kR3JvdXBGb3JtYXRzJDEkayIsIl9iaW5kR3JvdXBGb3JtYXRzJDIiLCJfYmluZEdyb3VwRm9ybWF0cyQyJGsiLCJfYmluZEdyb3VwRm9ybWF0cyQzIiwiRGVidWciLCJhc3NlcnQiLCJsZW5ndGgiLCJ0eXBlIiwiaWQiLCJrZXkiLCJyZW5kZXJpbmdIYXNoIiwiaW1wbCIsImhhc2giLCJoYXNoMzJGbnYxYSIsImNhY2hlRW50cmllcyIsImkiLCJlbnRyeSIsImFycmF5IiwiZXF1YWxzIiwicHJpbWl0aXZlVG9wb2xvZ3kiLCJwaXBlbGluZUxheW91dCIsImdldFBpcGVsaW5lTGF5b3V0IiwiY2FjaGVFbnRyeSIsImNyZWF0ZSIsInB1c2giLCJzZXQiLCJnZXRCbGVuZCIsImJsZW5kIiwiY29sb3IiLCJvcGVyYXRpb24iLCJjb2xvck9wIiwic3JjRmFjdG9yIiwiY29sb3JTcmNGYWN0b3IiLCJkc3RGYWN0b3IiLCJjb2xvckRzdEZhY3RvciIsImFscGhhIiwiYWxwaGFPcCIsImFscGhhU3JjRmFjdG9yIiwiYWxwaGFEc3RGYWN0b3IiLCJnZXREZXB0aFN0ZW5jaWwiLCJkZXB0aFN0ZW5jaWwiLCJkZXB0aCIsInN0ZW5jaWwiLCJmb3JtYXQiLCJkZXB0aEZvcm1hdCIsImRlcHRoV3JpdGVFbmFibGVkIiwid3JpdGUiLCJkZXB0aENvbXBhcmUiLCJmdW5jIiwiZGVwdGhCaWFzIiwiZGVwdGhCaWFzU2xvcGVTY2FsZSIsImRlcHRoQmlhc1Nsb3BlIiwic3RlbmNpbFJlYWRNYXMiLCJyZWFkTWFzayIsInN0ZW5jaWxXcml0ZU1hc2siLCJ3cml0ZU1hc2siLCJjb21wYXJlIiwiZmFpbE9wIiwiZmFpbCIsInBhc3NPcCIsInpwYXNzIiwiZGVwdGhGYWlsT3AiLCJ6ZmFpbCIsIndncHUiLCJ3ZWJncHVTaGFkZXIiLCJkZXNjciIsInZlcnRleCIsIm1vZHVsZSIsImdldFZlcnRleFNoYWRlck1vZHVsZSIsImVudHJ5UG9pbnQiLCJ2ZXJ0ZXhFbnRyeVBvaW50IiwiYnVmZmVycyIsInRvcG9sb2d5IiwiZnJvbnRGYWNlIiwibXVsdGlzYW1wbGUiLCJjb3VudCIsInNhbXBsZXMiLCJsYXlvdXQiLCJjb2xvckF0dGFjaG1lbnRzIiwiZnJhZ21lbnQiLCJnZXRGcmFnbWVudFNoYWRlck1vZHVsZSIsImZyYWdtZW50RW50cnlQb2ludCIsInRhcmdldHMiLCJyZWRXcml0ZSIsIkdQVUNvbG9yV3JpdGUiLCJSRUQiLCJncmVlbldyaXRlIiwiR1JFRU4iLCJibHVlV3JpdGUiLCJCTFVFIiwiYWxwaGFXcml0ZSIsIkFMUEhBIiwiZm9yRWFjaCIsImF0dGFjaG1lbnQiLCJXZWJncHVEZWJ1ZyIsInZhbGlkYXRlIiwiRGVidWdIZWxwZXIiLCJzZXRMYWJlbCIsImNyZWF0ZVJlbmRlclBpcGVsaW5lIiwidHJhY2UiLCJUUkFDRUlEX1JFTkRFUlBJUEVMSU5FX0FMTE9DIiwiZW5kIiwicmVuZGVyUGlwZWxpbmUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBU0EsSUFBSUEsV0FB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
