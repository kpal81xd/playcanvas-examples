import { Debug } from '../../core/debug.js';
import { math } from '../../core/math/math.js';
import { uniformTypeToName, UNIFORMTYPE_MAT4, UNIFORMTYPE_MAT4ARRAY, UNIFORMTYPE_BVEC4, UNIFORMTYPE_BVEC4ARRAY, UNIFORMTYPE_UVEC4, UNIFORMTYPE_UVEC4ARRAY, UNIFORMTYPE_IVEC4, UNIFORMTYPE_IVEC4ARRAY, UNIFORMTYPE_VEC4, UNIFORMTYPE_VEC4ARRAY, UNIFORMTYPE_BVEC3, UNIFORMTYPE_BVEC3ARRAY, UNIFORMTYPE_UVEC3, UNIFORMTYPE_UVEC3ARRAY, UNIFORMTYPE_IVEC3, UNIFORMTYPE_IVEC3ARRAY, UNIFORMTYPE_VEC3, UNIFORMTYPE_VEC3ARRAY, UNIFORMTYPE_BVEC2, UNIFORMTYPE_BVEC2ARRAY, UNIFORMTYPE_UVEC2, UNIFORMTYPE_UVEC2ARRAY, UNIFORMTYPE_IVEC2, UNIFORMTYPE_IVEC2ARRAY, UNIFORMTYPE_VEC2, UNIFORMTYPE_VEC2ARRAY, UNIFORMTYPE_BOOL, UNIFORMTYPE_BOOLARRAY, UNIFORMTYPE_UINT, UNIFORMTYPE_UINTARRAY, UNIFORMTYPE_INT, UNIFORMTYPE_INTARRAY, UNIFORMTYPE_FLOAT, UNIFORMTYPE_FLOATARRAY, bindGroupNames, UNIFORMTYPE_MAT2, UNIFORMTYPE_MAT3 } from './constants.js';

// map of UNIFORMTYPE_*** to number of 32bit components
const uniformTypeToNumComponents = [];
uniformTypeToNumComponents[UNIFORMTYPE_FLOAT] = 1;
uniformTypeToNumComponents[UNIFORMTYPE_VEC2] = 2;
uniformTypeToNumComponents[UNIFORMTYPE_VEC3] = 3;
uniformTypeToNumComponents[UNIFORMTYPE_VEC4] = 4;
uniformTypeToNumComponents[UNIFORMTYPE_INT] = 1;
uniformTypeToNumComponents[UNIFORMTYPE_IVEC2] = 2;
uniformTypeToNumComponents[UNIFORMTYPE_IVEC3] = 3;
uniformTypeToNumComponents[UNIFORMTYPE_IVEC4] = 4;
uniformTypeToNumComponents[UNIFORMTYPE_BOOL] = 1;
uniformTypeToNumComponents[UNIFORMTYPE_BVEC2] = 2;
uniformTypeToNumComponents[UNIFORMTYPE_BVEC3] = 3;
uniformTypeToNumComponents[UNIFORMTYPE_BVEC4] = 4;
uniformTypeToNumComponents[UNIFORMTYPE_MAT2] = 8; // 2 x vec4
uniformTypeToNumComponents[UNIFORMTYPE_MAT3] = 12; // 3 x vec4
uniformTypeToNumComponents[UNIFORMTYPE_MAT4] = 16; // 4 x vec4
uniformTypeToNumComponents[UNIFORMTYPE_UINT] = 1;
uniformTypeToNumComponents[UNIFORMTYPE_UVEC2] = 2;
uniformTypeToNumComponents[UNIFORMTYPE_UVEC3] = 3;
uniformTypeToNumComponents[UNIFORMTYPE_UVEC4] = 4;

/**
 * A class storing description of an individual uniform, stored inside a uniform buffer.
 *
 * @ignore
 */
class UniformFormat {
  /**
   * True if this is an array of elements (i.e. count > 0)
   *
   * @type {number}
   */
  get isArrayType() {
    return this.count > 0;
  }
  constructor(name, type, count = 0) {
    /** @type {string} */
    this.name = void 0;
    // UNIFORMTYPE_***
    /** @type {number} */
    this.type = void 0;
    /** @type {number} */
    this.byteSize = void 0;
    /**
     * Index of the uniform in an array of 32bit values (Float32Array and similar)
     *
     * @type {number}
     */
    this.offset = void 0;
    /** @type {import('./scope-id.js').ScopeId} */
    this.scopeId = void 0;
    /**
     * Count of elements for arrays, otherwise 0.
     *
     * @type {number}
     */
    this.count = void 0;
    /**
     * Number of components in each element (e.g. vec2 has 2 components, mat4 has 16 components)
     *
     * @type {number}
     */
    this.numComponents = void 0;
    // just a name
    this.shortName = name;

    // name with [0] if this is an array
    this.name = count ? `${name}[0]` : name;
    this.type = type;
    this.numComponents = uniformTypeToNumComponents[type];
    Debug.assert(this.numComponents, `Unhandled uniform format ${type} used for ${name}`);
    this.updateType = type;
    if (count > 0) {
      switch (type) {
        case UNIFORMTYPE_FLOAT:
          this.updateType = UNIFORMTYPE_FLOATARRAY;
          break;
        case UNIFORMTYPE_INT:
          this.updateType = UNIFORMTYPE_INTARRAY;
          break;
        case UNIFORMTYPE_UINT:
          this.updateType = UNIFORMTYPE_UINTARRAY;
          break;
        case UNIFORMTYPE_BOOL:
          this.updateType = UNIFORMTYPE_BOOLARRAY;
          break;
        case UNIFORMTYPE_VEC2:
          this.updateType = UNIFORMTYPE_VEC2ARRAY;
          break;
        case UNIFORMTYPE_IVEC2:
          this.updateType = UNIFORMTYPE_IVEC2ARRAY;
          break;
        case UNIFORMTYPE_UVEC2:
          this.updateType = UNIFORMTYPE_UVEC2ARRAY;
          break;
        case UNIFORMTYPE_BVEC2:
          this.updateType = UNIFORMTYPE_BVEC2ARRAY;
          break;
        case UNIFORMTYPE_VEC3:
          this.updateType = UNIFORMTYPE_VEC3ARRAY;
          break;
        case UNIFORMTYPE_IVEC3:
          this.updateType = UNIFORMTYPE_IVEC3ARRAY;
          break;
        case UNIFORMTYPE_UVEC3:
          this.updateType = UNIFORMTYPE_UVEC3ARRAY;
          break;
        case UNIFORMTYPE_BVEC3:
          this.updateType = UNIFORMTYPE_BVEC3ARRAY;
          break;
        case UNIFORMTYPE_VEC4:
          this.updateType = UNIFORMTYPE_VEC4ARRAY;
          break;
        case UNIFORMTYPE_IVEC4:
          this.updateType = UNIFORMTYPE_IVEC4ARRAY;
          break;
        case UNIFORMTYPE_UVEC4:
          this.updateType = UNIFORMTYPE_UVEC4ARRAY;
          break;
        case UNIFORMTYPE_BVEC4:
          this.updateType = UNIFORMTYPE_BVEC4ARRAY;
          break;
        case UNIFORMTYPE_MAT4:
          this.updateType = UNIFORMTYPE_MAT4ARRAY;
          break;
        default:
          Debug.error(`Uniform array of type ${uniformTypeToName[type]} is not supported when processing uniform '${name}'.`);
          Debug.call(() => {
            this.invalid = true;
          });
          break;
      }
    }
    this.count = count;
    Debug.assert(!isNaN(count), `Unsupported uniform: ${name}[${count}]`);
    Debug.call(() => {
      if (isNaN(count)) this.invalid = true;
    });
    let componentSize = this.numComponents;

    // component size for arrays is aligned up to vec4
    if (count) {
      componentSize = math.roundUp(componentSize, 4);
    }
    this.byteSize = componentSize * 4;
    if (count) this.byteSize *= count;
    Debug.assert(this.byteSize, `Unknown byte size for uniform format ${type} used for ${name}`);
  }

  // std140 rules: https://registry.khronos.org/OpenGL/specs/gl/glspec45.core.pdf#page=159
  // TODO: this support limited subset of functionality, arrays and structs are not supported.
  calculateOffset(offset) {
    // Note: vec3 has the same alignment as vec4
    let alignment = this.byteSize <= 8 ? this.byteSize : 16;

    // arrays have vec4 alignments
    if (this.count) alignment = 16;

    // align the start offset
    offset = math.roundUp(offset, alignment);
    this.offset = offset / 4;
  }
}

/**
 * A descriptor that defines the layout of of data inside the {@link UniformBuffer}.
 *
 * @ignore
 */
class UniformBufferFormat {
  /**
   * Create a new UniformBufferFormat instance.
   *
   * @param {import('./graphics-device.js').GraphicsDevice} graphicsDevice - The graphics device.
   * @param {UniformFormat[]} uniforms - An array of uniforms to be stored in the buffer
   */
  constructor(graphicsDevice, uniforms) {
    /** @type {number} */
    this.byteSize = 0;
    /** @type {Map<string,UniformFormat>} */
    this.map = new Map();
    this.scope = graphicsDevice.scope;

    /** @type {UniformFormat[]} */
    this.uniforms = uniforms;

    // TODO: optimize uniforms ordering

    let offset = 0;
    for (let i = 0; i < uniforms.length; i++) {
      const uniform = uniforms[i];
      uniform.calculateOffset(offset);
      offset = uniform.offset * 4 + uniform.byteSize;
      uniform.scopeId = this.scope.resolve(uniform.name);
      this.map.set(uniform.name, uniform);
    }

    // round up buffer size
    this.byteSize = math.roundUp(offset, 16);
  }

  /**
   * Returns format of a uniform with specified name.
   *
   * @param {string} name - The name of the uniform.
   * @returns {UniformFormat} - The format of the uniform.
   */
  get(name) {
    return this.map.get(name);
  }
  getShaderDeclaration(bindGroup, bindIndex) {
    const name = bindGroupNames[bindGroup];
    let code = `layout(set = ${bindGroup}, binding = ${bindIndex}, std140) uniform ub_${name} {\n`;
    this.uniforms.forEach(uniform => {
      const typeString = uniformTypeToName[uniform.type];
      Debug.assert(typeString.length > 0, `Uniform type ${uniform.type} is not handled.`);
      code += `    ${typeString} ${uniform.shortName}${uniform.count ? `[${uniform.count}]` : ''};\n`;
    });
    return code + '};\n';
  }
}

export { UniformBufferFormat, UniformFormat };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidW5pZm9ybS1idWZmZXItZm9ybWF0LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvcGxhdGZvcm0vZ3JhcGhpY3MvdW5pZm9ybS1idWZmZXItZm9ybWF0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSAnLi4vLi4vY29yZS9kZWJ1Zy5qcyc7XG5pbXBvcnQgeyBtYXRoIH0gZnJvbSAnLi4vLi4vY29yZS9tYXRoL21hdGguanMnO1xuaW1wb3J0IHtcbiAgICB1bmlmb3JtVHlwZVRvTmFtZSwgYmluZEdyb3VwTmFtZXMsXG4gICAgVU5JRk9STVRZUEVfQk9PTCwgVU5JRk9STVRZUEVfSU5ULCBVTklGT1JNVFlQRV9GTE9BVCwgVU5JRk9STVRZUEVfVUlOVCwgVU5JRk9STVRZUEVfVkVDMixcbiAgICBVTklGT1JNVFlQRV9WRUMzLCBVTklGT1JNVFlQRV9WRUM0LCBVTklGT1JNVFlQRV9JVkVDMiwgVU5JRk9STVRZUEVfVVZFQzIsIFVOSUZPUk1UWVBFX0lWRUMzLFxuICAgIFVOSUZPUk1UWVBFX0lWRUM0LCBVTklGT1JNVFlQRV9CVkVDMiwgVU5JRk9STVRZUEVfQlZFQzMsIFVOSUZPUk1UWVBFX1VWRUMzLCBVTklGT1JNVFlQRV9CVkVDNCxcbiAgICBVTklGT1JNVFlQRV9NQVQ0LCBVTklGT1JNVFlQRV9NQVQyLCBVTklGT1JNVFlQRV9NQVQzLCBVTklGT1JNVFlQRV9GTE9BVEFSUkFZLCBVTklGT1JNVFlQRV9VVkVDNCxcbiAgICBVTklGT1JNVFlQRV9WRUMyQVJSQVksIFVOSUZPUk1UWVBFX1ZFQzNBUlJBWSwgVU5JRk9STVRZUEVfVkVDNEFSUkFZLCBVTklGT1JNVFlQRV9NQVQ0QVJSQVksIFVOSUZPUk1UWVBFX0lOVEFSUkFZLFxuICAgIFVOSUZPUk1UWVBFX1VJTlRBUlJBWSwgVU5JRk9STVRZUEVfQk9PTEFSUkFZLCBVTklGT1JNVFlQRV9JVkVDMkFSUkFZLCBVTklGT1JNVFlQRV9VVkVDMkFSUkFZLFxuICAgIFVOSUZPUk1UWVBFX0JWRUMyQVJSQVksIFVOSUZPUk1UWVBFX0lWRUMzQVJSQVksIFVOSUZPUk1UWVBFX1VWRUMzQVJSQVksIFVOSUZPUk1UWVBFX0JWRUMzQVJSQVksXG4gICAgVU5JRk9STVRZUEVfSVZFQzRBUlJBWSwgVU5JRk9STVRZUEVfVVZFQzRBUlJBWSwgVU5JRk9STVRZUEVfQlZFQzRBUlJBWVxufSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5cbi8vIG1hcCBvZiBVTklGT1JNVFlQRV8qKiogdG8gbnVtYmVyIG9mIDMyYml0IGNvbXBvbmVudHNcbmNvbnN0IHVuaWZvcm1UeXBlVG9OdW1Db21wb25lbnRzID0gW107XG51bmlmb3JtVHlwZVRvTnVtQ29tcG9uZW50c1tVTklGT1JNVFlQRV9GTE9BVF0gPSAxO1xudW5pZm9ybVR5cGVUb051bUNvbXBvbmVudHNbVU5JRk9STVRZUEVfVkVDMl0gPSAyO1xudW5pZm9ybVR5cGVUb051bUNvbXBvbmVudHNbVU5JRk9STVRZUEVfVkVDM10gPSAzO1xudW5pZm9ybVR5cGVUb051bUNvbXBvbmVudHNbVU5JRk9STVRZUEVfVkVDNF0gPSA0O1xudW5pZm9ybVR5cGVUb051bUNvbXBvbmVudHNbVU5JRk9STVRZUEVfSU5UXSA9IDE7XG51bmlmb3JtVHlwZVRvTnVtQ29tcG9uZW50c1tVTklGT1JNVFlQRV9JVkVDMl0gPSAyO1xudW5pZm9ybVR5cGVUb051bUNvbXBvbmVudHNbVU5JRk9STVRZUEVfSVZFQzNdID0gMztcbnVuaWZvcm1UeXBlVG9OdW1Db21wb25lbnRzW1VOSUZPUk1UWVBFX0lWRUM0XSA9IDQ7XG51bmlmb3JtVHlwZVRvTnVtQ29tcG9uZW50c1tVTklGT1JNVFlQRV9CT09MXSA9IDE7XG51bmlmb3JtVHlwZVRvTnVtQ29tcG9uZW50c1tVTklGT1JNVFlQRV9CVkVDMl0gPSAyO1xudW5pZm9ybVR5cGVUb051bUNvbXBvbmVudHNbVU5JRk9STVRZUEVfQlZFQzNdID0gMztcbnVuaWZvcm1UeXBlVG9OdW1Db21wb25lbnRzW1VOSUZPUk1UWVBFX0JWRUM0XSA9IDQ7XG51bmlmb3JtVHlwZVRvTnVtQ29tcG9uZW50c1tVTklGT1JNVFlQRV9NQVQyXSA9IDg7ICAgIC8vIDIgeCB2ZWM0XG51bmlmb3JtVHlwZVRvTnVtQ29tcG9uZW50c1tVTklGT1JNVFlQRV9NQVQzXSA9IDEyOyAgIC8vIDMgeCB2ZWM0XG51bmlmb3JtVHlwZVRvTnVtQ29tcG9uZW50c1tVTklGT1JNVFlQRV9NQVQ0XSA9IDE2OyAgIC8vIDQgeCB2ZWM0XG51bmlmb3JtVHlwZVRvTnVtQ29tcG9uZW50c1tVTklGT1JNVFlQRV9VSU5UXSA9IDE7XG51bmlmb3JtVHlwZVRvTnVtQ29tcG9uZW50c1tVTklGT1JNVFlQRV9VVkVDMl0gPSAyO1xudW5pZm9ybVR5cGVUb051bUNvbXBvbmVudHNbVU5JRk9STVRZUEVfVVZFQzNdID0gMztcbnVuaWZvcm1UeXBlVG9OdW1Db21wb25lbnRzW1VOSUZPUk1UWVBFX1VWRUM0XSA9IDQ7XG5cblxuLyoqXG4gKiBBIGNsYXNzIHN0b3JpbmcgZGVzY3JpcHRpb24gb2YgYW4gaW5kaXZpZHVhbCB1bmlmb3JtLCBzdG9yZWQgaW5zaWRlIGEgdW5pZm9ybSBidWZmZXIuXG4gKlxuICogQGlnbm9yZVxuICovXG5jbGFzcyBVbmlmb3JtRm9ybWF0IHtcbiAgICAvKiogQHR5cGUge3N0cmluZ30gKi9cbiAgICBuYW1lO1xuXG4gICAgLy8gVU5JRk9STVRZUEVfKioqXG4gICAgLyoqIEB0eXBlIHtudW1iZXJ9ICovXG4gICAgdHlwZTtcblxuICAgIC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xuICAgIGJ5dGVTaXplO1xuXG4gICAgLyoqXG4gICAgICogSW5kZXggb2YgdGhlIHVuaWZvcm0gaW4gYW4gYXJyYXkgb2YgMzJiaXQgdmFsdWVzIChGbG9hdDMyQXJyYXkgYW5kIHNpbWlsYXIpXG4gICAgICpcbiAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAqL1xuICAgIG9mZnNldDtcblxuICAgIC8qKiBAdHlwZSB7aW1wb3J0KCcuL3Njb3BlLWlkLmpzJykuU2NvcGVJZH0gKi9cbiAgICBzY29wZUlkO1xuXG4gICAgLyoqXG4gICAgICogQ291bnQgb2YgZWxlbWVudHMgZm9yIGFycmF5cywgb3RoZXJ3aXNlIDAuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAqL1xuICAgIGNvdW50O1xuXG4gICAgLyoqXG4gICAgICogTnVtYmVyIG9mIGNvbXBvbmVudHMgaW4gZWFjaCBlbGVtZW50IChlLmcuIHZlYzIgaGFzIDIgY29tcG9uZW50cywgbWF0NCBoYXMgMTYgY29tcG9uZW50cylcbiAgICAgKlxuICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICovXG4gICAgbnVtQ29tcG9uZW50cztcblxuICAgIC8qKlxuICAgICAqIFRydWUgaWYgdGhpcyBpcyBhbiBhcnJheSBvZiBlbGVtZW50cyAoaS5lLiBjb3VudCA+IDApXG4gICAgICpcbiAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAqL1xuICAgIGdldCBpc0FycmF5VHlwZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY291bnQgPiAwO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKG5hbWUsIHR5cGUsIGNvdW50ID0gMCkge1xuXG4gICAgICAgIC8vIGp1c3QgYSBuYW1lXG4gICAgICAgIHRoaXMuc2hvcnROYW1lID0gbmFtZTtcblxuICAgICAgICAvLyBuYW1lIHdpdGggWzBdIGlmIHRoaXMgaXMgYW4gYXJyYXlcbiAgICAgICAgdGhpcy5uYW1lID0gY291bnQgPyBgJHtuYW1lfVswXWAgOiBuYW1lO1xuXG4gICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG5cbiAgICAgICAgdGhpcy5udW1Db21wb25lbnRzID0gdW5pZm9ybVR5cGVUb051bUNvbXBvbmVudHNbdHlwZV07XG4gICAgICAgIERlYnVnLmFzc2VydCh0aGlzLm51bUNvbXBvbmVudHMsIGBVbmhhbmRsZWQgdW5pZm9ybSBmb3JtYXQgJHt0eXBlfSB1c2VkIGZvciAke25hbWV9YCk7XG5cbiAgICAgICAgdGhpcy51cGRhdGVUeXBlID0gdHlwZTtcbiAgICAgICAgaWYgKGNvdW50ID4gMCkge1xuXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFVOSUZPUk1UWVBFX0ZMT0FUOiB0aGlzLnVwZGF0ZVR5cGUgPSBVTklGT1JNVFlQRV9GTE9BVEFSUkFZOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFVOSUZPUk1UWVBFX0lOVDogdGhpcy51cGRhdGVUeXBlID0gVU5JRk9STVRZUEVfSU5UQVJSQVk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgVU5JRk9STVRZUEVfVUlOVDogdGhpcy51cGRhdGVUeXBlID0gVU5JRk9STVRZUEVfVUlOVEFSUkFZOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFVOSUZPUk1UWVBFX0JPT0w6IHRoaXMudXBkYXRlVHlwZSA9IFVOSUZPUk1UWVBFX0JPT0xBUlJBWTsgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlIFVOSUZPUk1UWVBFX1ZFQzI6IHRoaXMudXBkYXRlVHlwZSA9IFVOSUZPUk1UWVBFX1ZFQzJBUlJBWTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBVTklGT1JNVFlQRV9JVkVDMjogdGhpcy51cGRhdGVUeXBlID0gVU5JRk9STVRZUEVfSVZFQzJBUlJBWTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBVTklGT1JNVFlQRV9VVkVDMjogdGhpcy51cGRhdGVUeXBlID0gVU5JRk9STVRZUEVfVVZFQzJBUlJBWTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBVTklGT1JNVFlQRV9CVkVDMjogdGhpcy51cGRhdGVUeXBlID0gVU5JRk9STVRZUEVfQlZFQzJBUlJBWTsgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlIFVOSUZPUk1UWVBFX1ZFQzM6IHRoaXMudXBkYXRlVHlwZSA9IFVOSUZPUk1UWVBFX1ZFQzNBUlJBWTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBVTklGT1JNVFlQRV9JVkVDMzogdGhpcy51cGRhdGVUeXBlID0gVU5JRk9STVRZUEVfSVZFQzNBUlJBWTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBVTklGT1JNVFlQRV9VVkVDMzogdGhpcy51cGRhdGVUeXBlID0gVU5JRk9STVRZUEVfVVZFQzNBUlJBWTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBVTklGT1JNVFlQRV9CVkVDMzogdGhpcy51cGRhdGVUeXBlID0gVU5JRk9STVRZUEVfQlZFQzNBUlJBWTsgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlIFVOSUZPUk1UWVBFX1ZFQzQ6IHRoaXMudXBkYXRlVHlwZSA9IFVOSUZPUk1UWVBFX1ZFQzRBUlJBWTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBVTklGT1JNVFlQRV9JVkVDNDogdGhpcy51cGRhdGVUeXBlID0gVU5JRk9STVRZUEVfSVZFQzRBUlJBWTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBVTklGT1JNVFlQRV9VVkVDNDogdGhpcy51cGRhdGVUeXBlID0gVU5JRk9STVRZUEVfVVZFQzRBUlJBWTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBVTklGT1JNVFlQRV9CVkVDNDogdGhpcy51cGRhdGVUeXBlID0gVU5JRk9STVRZUEVfQlZFQzRBUlJBWTsgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlIFVOSUZPUk1UWVBFX01BVDQ6IHRoaXMudXBkYXRlVHlwZSA9IFVOSUZPUk1UWVBFX01BVDRBUlJBWTsgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5lcnJvcihgVW5pZm9ybSBhcnJheSBvZiB0eXBlICR7dW5pZm9ybVR5cGVUb05hbWVbdHlwZV19IGlzIG5vdCBzdXBwb3J0ZWQgd2hlbiBwcm9jZXNzaW5nIHVuaWZvcm0gJyR7bmFtZX0nLmApO1xuICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW52YWxpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY291bnQgPSBjb3VudDtcbiAgICAgICAgRGVidWcuYXNzZXJ0KCFpc05hTihjb3VudCksIGBVbnN1cHBvcnRlZCB1bmlmb3JtOiAke25hbWV9WyR7Y291bnR9XWApO1xuICAgICAgICBEZWJ1Zy5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgIGlmIChpc05hTihjb3VudCkpXG4gICAgICAgICAgICAgICAgdGhpcy5pbnZhbGlkID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbGV0IGNvbXBvbmVudFNpemUgPSB0aGlzLm51bUNvbXBvbmVudHM7XG5cbiAgICAgICAgLy8gY29tcG9uZW50IHNpemUgZm9yIGFycmF5cyBpcyBhbGlnbmVkIHVwIHRvIHZlYzRcbiAgICAgICAgaWYgKGNvdW50KSB7XG4gICAgICAgICAgICBjb21wb25lbnRTaXplID0gbWF0aC5yb3VuZFVwKGNvbXBvbmVudFNpemUsIDQpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5ieXRlU2l6ZSA9IGNvbXBvbmVudFNpemUgKiA0O1xuICAgICAgICBpZiAoY291bnQpXG4gICAgICAgICAgICB0aGlzLmJ5dGVTaXplICo9IGNvdW50O1xuXG4gICAgICAgIERlYnVnLmFzc2VydCh0aGlzLmJ5dGVTaXplLCBgVW5rbm93biBieXRlIHNpemUgZm9yIHVuaWZvcm0gZm9ybWF0ICR7dHlwZX0gdXNlZCBmb3IgJHtuYW1lfWApO1xuICAgIH1cblxuICAgIC8vIHN0ZDE0MCBydWxlczogaHR0cHM6Ly9yZWdpc3RyeS5raHJvbm9zLm9yZy9PcGVuR0wvc3BlY3MvZ2wvZ2xzcGVjNDUuY29yZS5wZGYjcGFnZT0xNTlcbiAgICAvLyBUT0RPOiB0aGlzIHN1cHBvcnQgbGltaXRlZCBzdWJzZXQgb2YgZnVuY3Rpb25hbGl0eSwgYXJyYXlzIGFuZCBzdHJ1Y3RzIGFyZSBub3Qgc3VwcG9ydGVkLlxuICAgIGNhbGN1bGF0ZU9mZnNldChvZmZzZXQpIHtcblxuICAgICAgICAvLyBOb3RlOiB2ZWMzIGhhcyB0aGUgc2FtZSBhbGlnbm1lbnQgYXMgdmVjNFxuICAgICAgICBsZXQgYWxpZ25tZW50ID0gdGhpcy5ieXRlU2l6ZSA8PSA4ID8gdGhpcy5ieXRlU2l6ZSA6IDE2O1xuXG4gICAgICAgIC8vIGFycmF5cyBoYXZlIHZlYzQgYWxpZ25tZW50c1xuICAgICAgICBpZiAodGhpcy5jb3VudClcbiAgICAgICAgICAgIGFsaWdubWVudCA9IDE2O1xuXG4gICAgICAgIC8vIGFsaWduIHRoZSBzdGFydCBvZmZzZXRcbiAgICAgICAgb2Zmc2V0ID0gbWF0aC5yb3VuZFVwKG9mZnNldCwgYWxpZ25tZW50KTtcbiAgICAgICAgdGhpcy5vZmZzZXQgPSBvZmZzZXQgLyA0O1xuICAgIH1cbn1cblxuLyoqXG4gKiBBIGRlc2NyaXB0b3IgdGhhdCBkZWZpbmVzIHRoZSBsYXlvdXQgb2Ygb2YgZGF0YSBpbnNpZGUgdGhlIHtAbGluayBVbmlmb3JtQnVmZmVyfS5cbiAqXG4gKiBAaWdub3JlXG4gKi9cbmNsYXNzIFVuaWZvcm1CdWZmZXJGb3JtYXQge1xuICAgIC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xuICAgIGJ5dGVTaXplID0gMDtcblxuICAgIC8qKiBAdHlwZSB7TWFwPHN0cmluZyxVbmlmb3JtRm9ybWF0Pn0gKi9cbiAgICBtYXAgPSBuZXcgTWFwKCk7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgVW5pZm9ybUJ1ZmZlckZvcm1hdCBpbnN0YW5jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuL2dyYXBoaWNzLWRldmljZS5qcycpLkdyYXBoaWNzRGV2aWNlfSBncmFwaGljc0RldmljZSAtIFRoZSBncmFwaGljcyBkZXZpY2UuXG4gICAgICogQHBhcmFtIHtVbmlmb3JtRm9ybWF0W119IHVuaWZvcm1zIC0gQW4gYXJyYXkgb2YgdW5pZm9ybXMgdG8gYmUgc3RvcmVkIGluIHRoZSBidWZmZXJcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihncmFwaGljc0RldmljZSwgdW5pZm9ybXMpIHtcbiAgICAgICAgdGhpcy5zY29wZSA9IGdyYXBoaWNzRGV2aWNlLnNjb3BlO1xuXG4gICAgICAgIC8qKiBAdHlwZSB7VW5pZm9ybUZvcm1hdFtdfSAqL1xuICAgICAgICB0aGlzLnVuaWZvcm1zID0gdW5pZm9ybXM7XG5cbiAgICAgICAgLy8gVE9ETzogb3B0aW1pemUgdW5pZm9ybXMgb3JkZXJpbmdcblxuICAgICAgICBsZXQgb2Zmc2V0ID0gMDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1bmlmb3Jtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgdW5pZm9ybSA9IHVuaWZvcm1zW2ldO1xuICAgICAgICAgICAgdW5pZm9ybS5jYWxjdWxhdGVPZmZzZXQob2Zmc2V0KTtcbiAgICAgICAgICAgIG9mZnNldCA9IHVuaWZvcm0ub2Zmc2V0ICogNCArIHVuaWZvcm0uYnl0ZVNpemU7XG5cbiAgICAgICAgICAgIHVuaWZvcm0uc2NvcGVJZCA9IHRoaXMuc2NvcGUucmVzb2x2ZSh1bmlmb3JtLm5hbWUpO1xuXG4gICAgICAgICAgICB0aGlzLm1hcC5zZXQodW5pZm9ybS5uYW1lLCB1bmlmb3JtKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHJvdW5kIHVwIGJ1ZmZlciBzaXplXG4gICAgICAgIHRoaXMuYnl0ZVNpemUgPSBtYXRoLnJvdW5kVXAob2Zmc2V0LCAxNik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBmb3JtYXQgb2YgYSB1bmlmb3JtIHdpdGggc3BlY2lmaWVkIG5hbWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIFRoZSBuYW1lIG9mIHRoZSB1bmlmb3JtLlxuICAgICAqIEByZXR1cm5zIHtVbmlmb3JtRm9ybWF0fSAtIFRoZSBmb3JtYXQgb2YgdGhlIHVuaWZvcm0uXG4gICAgICovXG4gICAgZ2V0KG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWFwLmdldChuYW1lKTtcbiAgICB9XG5cbiAgICBnZXRTaGFkZXJEZWNsYXJhdGlvbihiaW5kR3JvdXAsIGJpbmRJbmRleCkge1xuXG4gICAgICAgIGNvbnN0IG5hbWUgPSBiaW5kR3JvdXBOYW1lc1tiaW5kR3JvdXBdO1xuICAgICAgICBsZXQgY29kZSA9IGBsYXlvdXQoc2V0ID0gJHtiaW5kR3JvdXB9LCBiaW5kaW5nID0gJHtiaW5kSW5kZXh9LCBzdGQxNDApIHVuaWZvcm0gdWJfJHtuYW1lfSB7XFxuYDtcblxuICAgICAgICB0aGlzLnVuaWZvcm1zLmZvckVhY2goKHVuaWZvcm0pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHR5cGVTdHJpbmcgPSB1bmlmb3JtVHlwZVRvTmFtZVt1bmlmb3JtLnR5cGVdO1xuICAgICAgICAgICAgRGVidWcuYXNzZXJ0KHR5cGVTdHJpbmcubGVuZ3RoID4gMCwgYFVuaWZvcm0gdHlwZSAke3VuaWZvcm0udHlwZX0gaXMgbm90IGhhbmRsZWQuYCk7XG4gICAgICAgICAgICBjb2RlICs9IGAgICAgJHt0eXBlU3RyaW5nfSAke3VuaWZvcm0uc2hvcnROYW1lfSR7dW5pZm9ybS5jb3VudCA/IGBbJHt1bmlmb3JtLmNvdW50fV1gIDogJyd9O1xcbmA7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBjb2RlICsgJ307XFxuJztcbiAgICB9XG59XG5cbmV4cG9ydCB7IFVuaWZvcm1Gb3JtYXQsIFVuaWZvcm1CdWZmZXJGb3JtYXQgfTtcbiJdLCJuYW1lcyI6WyJ1bmlmb3JtVHlwZVRvTnVtQ29tcG9uZW50cyIsIlVOSUZPUk1UWVBFX0ZMT0FUIiwiVU5JRk9STVRZUEVfVkVDMiIsIlVOSUZPUk1UWVBFX1ZFQzMiLCJVTklGT1JNVFlQRV9WRUM0IiwiVU5JRk9STVRZUEVfSU5UIiwiVU5JRk9STVRZUEVfSVZFQzIiLCJVTklGT1JNVFlQRV9JVkVDMyIsIlVOSUZPUk1UWVBFX0lWRUM0IiwiVU5JRk9STVRZUEVfQk9PTCIsIlVOSUZPUk1UWVBFX0JWRUMyIiwiVU5JRk9STVRZUEVfQlZFQzMiLCJVTklGT1JNVFlQRV9CVkVDNCIsIlVOSUZPUk1UWVBFX01BVDIiLCJVTklGT1JNVFlQRV9NQVQzIiwiVU5JRk9STVRZUEVfTUFUNCIsIlVOSUZPUk1UWVBFX1VJTlQiLCJVTklGT1JNVFlQRV9VVkVDMiIsIlVOSUZPUk1UWVBFX1VWRUMzIiwiVU5JRk9STVRZUEVfVVZFQzQiLCJVbmlmb3JtRm9ybWF0IiwiaXNBcnJheVR5cGUiLCJjb3VudCIsImNvbnN0cnVjdG9yIiwibmFtZSIsInR5cGUiLCJieXRlU2l6ZSIsIm9mZnNldCIsInNjb3BlSWQiLCJudW1Db21wb25lbnRzIiwic2hvcnROYW1lIiwiRGVidWciLCJhc3NlcnQiLCJ1cGRhdGVUeXBlIiwiVU5JRk9STVRZUEVfRkxPQVRBUlJBWSIsIlVOSUZPUk1UWVBFX0lOVEFSUkFZIiwiVU5JRk9STVRZUEVfVUlOVEFSUkFZIiwiVU5JRk9STVRZUEVfQk9PTEFSUkFZIiwiVU5JRk9STVRZUEVfVkVDMkFSUkFZIiwiVU5JRk9STVRZUEVfSVZFQzJBUlJBWSIsIlVOSUZPUk1UWVBFX1VWRUMyQVJSQVkiLCJVTklGT1JNVFlQRV9CVkVDMkFSUkFZIiwiVU5JRk9STVRZUEVfVkVDM0FSUkFZIiwiVU5JRk9STVRZUEVfSVZFQzNBUlJBWSIsIlVOSUZPUk1UWVBFX1VWRUMzQVJSQVkiLCJVTklGT1JNVFlQRV9CVkVDM0FSUkFZIiwiVU5JRk9STVRZUEVfVkVDNEFSUkFZIiwiVU5JRk9STVRZUEVfSVZFQzRBUlJBWSIsIlVOSUZPUk1UWVBFX1VWRUM0QVJSQVkiLCJVTklGT1JNVFlQRV9CVkVDNEFSUkFZIiwiVU5JRk9STVRZUEVfTUFUNEFSUkFZIiwiZXJyb3IiLCJ1bmlmb3JtVHlwZVRvTmFtZSIsImNhbGwiLCJpbnZhbGlkIiwiaXNOYU4iLCJjb21wb25lbnRTaXplIiwibWF0aCIsInJvdW5kVXAiLCJjYWxjdWxhdGVPZmZzZXQiLCJhbGlnbm1lbnQiLCJVbmlmb3JtQnVmZmVyRm9ybWF0IiwiZ3JhcGhpY3NEZXZpY2UiLCJ1bmlmb3JtcyIsIm1hcCIsIk1hcCIsInNjb3BlIiwiaSIsImxlbmd0aCIsInVuaWZvcm0iLCJyZXNvbHZlIiwic2V0IiwiZ2V0IiwiZ2V0U2hhZGVyRGVjbGFyYXRpb24iLCJiaW5kR3JvdXAiLCJiaW5kSW5kZXgiLCJiaW5kR3JvdXBOYW1lcyIsImNvZGUiLCJmb3JFYWNoIiwidHlwZVN0cmluZyJdLCJtYXBwaW5ncyI6Ijs7OztBQWNBO0FBQ0EsTUFBTUEsMEJBQTBCLEdBQUcsRUFBRSxDQUFBO0FBQ3JDQSwwQkFBMEIsQ0FBQ0MsaUJBQWlCLENBQUMsR0FBRyxDQUFDLENBQUE7QUFDakRELDBCQUEwQixDQUFDRSxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsQ0FBQTtBQUNoREYsMEJBQTBCLENBQUNHLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxDQUFBO0FBQ2hESCwwQkFBMEIsQ0FBQ0ksZ0JBQWdCLENBQUMsR0FBRyxDQUFDLENBQUE7QUFDaERKLDBCQUEwQixDQUFDSyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUE7QUFDL0NMLDBCQUEwQixDQUFDTSxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsQ0FBQTtBQUNqRE4sMEJBQTBCLENBQUNPLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFBO0FBQ2pEUCwwQkFBMEIsQ0FBQ1EsaUJBQWlCLENBQUMsR0FBRyxDQUFDLENBQUE7QUFDakRSLDBCQUEwQixDQUFDUyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsQ0FBQTtBQUNoRFQsMEJBQTBCLENBQUNVLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFBO0FBQ2pEViwwQkFBMEIsQ0FBQ1csaUJBQWlCLENBQUMsR0FBRyxDQUFDLENBQUE7QUFDakRYLDBCQUEwQixDQUFDWSxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsQ0FBQTtBQUNqRFosMEJBQTBCLENBQUNhLGdCQUFnQixDQUFD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
