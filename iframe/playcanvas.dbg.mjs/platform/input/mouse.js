import { platform } from '../../core/platform.js';
import { EventHandler } from '../../core/event-handler.js';
import { EVENT_MOUSEUP, EVENT_MOUSEDOWN, EVENT_MOUSEMOVE, EVENT_MOUSEWHEEL } from './constants.js';
import { isMousePointerLocked, MouseEvent } from './mouse-event.js';

/**
 * Callback used by {@link Mouse#enablePointerLock} and {@link Application#disablePointerLock}.
 *
 * @callback LockMouseCallback
 */

/**
 * A Mouse Device, bound to a DOM Element.
 *
 * @augments EventHandler
 * @category Input
 */
class Mouse extends EventHandler {
  /**
   * Create a new Mouse instance.
   *
   * @param {Element} [element] - The Element that the mouse events are attached to.
   */
  constructor(element) {
    super();

    // Clear the mouse state
    this._lastX = 0;
    this._lastY = 0;
    this._buttons = [false, false, false];
    this._lastbuttons = [false, false, false];

    // Setup event handlers so they are bound to the correct 'this'
    this._upHandler = this._handleUp.bind(this);
    this._downHandler = this._handleDown.bind(this);
    this._moveHandler = this._handleMove.bind(this);
    this._wheelHandler = this._handleWheel.bind(this);
    this._contextMenuHandler = event => {
      event.preventDefault();
    };
    this._target = null;
    this._attached = false;
    this.attach(element);
  }

  /**
   * Check if the mouse pointer has been locked, using {@link Mouse#enablePointerLock}.
   *
   * @returns {boolean} True if locked.
   */
  static isPointerLocked() {
    return isMousePointerLocked();
  }

  /**
   * Attach mouse events to an Element.
   *
   * @param {Element} element - The DOM element to attach the mouse to.
   */
  attach(element) {
    this._target = element;
    if (this._attached) return;
    this._attached = true;
    const opts = platform.passiveEvents ? {
      passive: false
    } : false;
    window.addEventListener('mouseup', this._upHandler, opts);
    window.addEventListener('mousedown', this._downHandler, opts);
    window.addEventListener('mousemove', this._moveHandler, opts);
    window.addEventListener('wheel', this._wheelHandler, opts);
  }

  /**
   * Remove mouse events from the element that it is attached to.
   */
  detach() {
    if (!this._attached) return;
    this._attached = false;
    this._target = null;
    const opts = platform.passiveEvents ? {
      passive: false
    } : false;
    window.removeEventListener('mouseup', this._upHandler, opts);
    window.removeEventListener('mousedown', this._downHandler, opts);
    window.removeEventListener('mousemove', this._moveHandler, opts);
    window.removeEventListener('wheel', this._wheelHandler, opts);
  }

  /**
   * Disable the context menu usually activated with right-click.
   */
  disableContextMenu() {
    if (!this._target) return;
    this._target.addEventListener('contextmenu', this._contextMenuHandler);
  }

  /**
   * Enable the context menu usually activated with right-click. This option is active by
   * default.
   */
  enableContextMenu() {
    if (!this._target) return;
    this._target.removeEventListener('contextmenu', this._contextMenuHandler);
  }

  /**
   * Request that the browser hides the mouse cursor and locks the mouse to the element. Allowing
   * raw access to mouse movement input without risking the mouse exiting the element. Notes:
   *
   * - In some browsers this will only work when the browser is running in fullscreen mode. See
   * {@link https://developer.mozilla.org/en-US/docs/Web/API/Fullscreen_API Fullscreen API} for
   * more details.
   * - Enabling pointer lock can only be initiated by a user action e.g. in the event handler for
   * a mouse or keyboard input.
   *
   * @param {LockMouseCallback} [success] - Function called if the request for mouse lock is
   * successful.
   * @param {LockMouseCallback} [error] - Function called if the request for mouse lock is
   * unsuccessful.
   */
  enablePointerLock(success, error) {
    if (!document.body.requestPointerLock) {
      if (error) error();
      return;
    }
    const s = () => {
      success();
      document.removeEventListener('pointerlockchange', s);
    };
    const e = () => {
      error();
      document.removeEventListener('pointerlockerror', e);
    };
    if (success) {
      document.addEventListener('pointerlockchange', s, false);
    }
    if (error) {
      document.addEventListener('pointerlockerror', e, false);
    }
    document.body.requestPointerLock();
  }

  /**
   * Return control of the mouse cursor to the user.
   *
   * @param {LockMouseCallback} [success] - Function called when the mouse lock is disabled.
   */
  disablePointerLock(success) {
    if (!document.exitPointerLock) {
      return;
    }
    const s = () => {
      success();
      document.removeEventListener('pointerlockchange', s);
    };
    if (success) {
      document.addEventListener('pointerlockchange', s, false);
    }
    document.exitPointerLock();
  }

  /**
   * Update method, should be called once per frame.
   */
  update() {
    // Copy current button state
    this._lastbuttons[0] = this._buttons[0];
    this._lastbuttons[1] = this._buttons[1];
    this._lastbuttons[2] = this._buttons[2];
  }

  /**
   * Returns true if the mouse button is currently pressed.
   *
   * @param {number} button - The mouse button to test. Can be:
   *
   * - {@link MOUSEBUTTON_LEFT}
   * - {@link MOUSEBUTTON_MIDDLE}
   * - {@link MOUSEBUTTON_RIGHT}
   *
   * @returns {boolean} True if the mouse button is current pressed.
   */
  isPressed(button) {
    return this._buttons[button];
  }

  /**
   * Returns true if the mouse button was pressed this frame (since the last call to update).
   *
   * @param {number} button - The mouse button to test. Can be:
   *
   * - {@link MOUSEBUTTON_LEFT}
   * - {@link MOUSEBUTTON_MIDDLE}
   * - {@link MOUSEBUTTON_RIGHT}
   *
   * @returns {boolean} True if the mouse button was pressed since the last update.
   */
  wasPressed(button) {
    return this._buttons[button] && !this._lastbuttons[button];
  }

  /**
   * Returns true if the mouse button was released this frame (since the last call to update).
   *
   * @param {number} button - The mouse button to test. Can be:
   *
   * - {@link MOUSEBUTTON_LEFT}
   * - {@link MOUSEBUTTON_MIDDLE}
   * - {@link MOUSEBUTTON_RIGHT}
   *
   * @returns {boolean} True if the mouse button was released since the last update.
   */
  wasReleased(button) {
    return !this._buttons[button] && this._lastbuttons[button];
  }
  _handleUp(event) {
    // disable released button
    this._buttons[event.button] = false;
    const e = new MouseEvent(this, event);
    if (!e.event) return;

    // send 'mouseup' event
    this.fire(EVENT_MOUSEUP, e);
  }
  _handleDown(event) {
    // Store which button has affected
    this._buttons[event.button] = true;
    const e = new MouseEvent(this, event);
    if (!e.event) return;
    this.fire(EVENT_MOUSEDOWN, e);
  }
  _handleMove(event) {
    const e = new MouseEvent(this, event);
    if (!e.event) return;
    this.fire(EVENT_MOUSEMOVE, e);

    // Store the last offset position to calculate deltas
    this._lastX = e.x;
    this._lastY = e.y;
  }
  _handleWheel(event) {
    const e = new MouseEvent(this, event);
    if (!e.event) return;
    this.fire(EVENT_MOUSEWHEEL, e);
  }
  _getTargetCoords(event) {
    const rect = this._target.getBoundingClientRect();
    const left = Math.floor(rect.left);
    const top = Math.floor(rect.top);

    // mouse is outside of canvas
    if (event.clientX < left || event.clientX >= left + this._target.clientWidth || event.clientY < top || event.clientY >= top + this._target.clientHeight) {
      return null;
    }
    return {
      x: event.clientX - left,
      y: event.clientY - top
    };
  }
}
/**
 * Fired when the mouse is moved. The handler is passed a {@link MouseEvent}.
 *
 * @event
 * @example
 * app.mouse.on('mousemove', (e) => {
 *     console.log(`Current mouse position is: ${e.x}, ${e.y}`);
 * });
 */
Mouse.EVENT_MOUSEMOVE = EVENT_MOUSEMOVE;
/**
 * Fired when a mouse button is pressed. The handler is passed a {@link MouseEvent}.
 *
 * @event
 * @example
 * app.mouse.on('mousedown', (e) => {
 *     console.log(`The ${e.button} button was pressed at position: ${e.x}, ${e.y}`);
 * });
 */
Mouse.EVENT_MOUSEDOWN = EVENT_MOUSEDOWN;
/**
 * Fired when a mouse button is released. The handler is passed a {@link MouseEvent}.
 *
 * @event
 * @example
 * app.mouse.on('mouseup', (e) => {
 *     console.log(`The ${e.button} button was released at position: ${e.x}, ${e.y}`);
 * });
 */
Mouse.EVENT_MOUSEUP = EVENT_MOUSEUP;
/**
 * Fired when a mouse wheel is moved. The handler is passed a {@link MouseEvent}.
 *
 * @event
 * @example
 * app.mouse.on('mousewheel', (e) => {
 *     console.log(`The mouse wheel was moved by ${e.wheelDelta}`);
 * });
 */
Mouse.EVENT_MOUSEWHEEL = EVENT_MOUSEWHEEL;

export { Mouse };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW91c2UuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9wbGF0Zm9ybS9pbnB1dC9tb3VzZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwbGF0Zm9ybSB9IGZyb20gJy4uLy4uL2NvcmUvcGxhdGZvcm0uanMnO1xuaW1wb3J0IHsgRXZlbnRIYW5kbGVyIH0gZnJvbSAnLi4vLi4vY29yZS9ldmVudC1oYW5kbGVyLmpzJztcblxuaW1wb3J0IHsgRVZFTlRfTU9VU0VET1dOLCBFVkVOVF9NT1VTRU1PVkUsIEVWRU5UX01PVVNFVVAsIEVWRU5UX01PVVNFV0hFRUwgfSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgeyBpc01vdXNlUG9pbnRlckxvY2tlZCwgTW91c2VFdmVudCB9IGZyb20gJy4vbW91c2UtZXZlbnQuanMnO1xuXG4vKipcbiAqIENhbGxiYWNrIHVzZWQgYnkge0BsaW5rIE1vdXNlI2VuYWJsZVBvaW50ZXJMb2NrfSBhbmQge0BsaW5rIEFwcGxpY2F0aW9uI2Rpc2FibGVQb2ludGVyTG9ja30uXG4gKlxuICogQGNhbGxiYWNrIExvY2tNb3VzZUNhbGxiYWNrXG4gKi9cblxuLyoqXG4gKiBBIE1vdXNlIERldmljZSwgYm91bmQgdG8gYSBET00gRWxlbWVudC5cbiAqXG4gKiBAYXVnbWVudHMgRXZlbnRIYW5kbGVyXG4gKiBAY2F0ZWdvcnkgSW5wdXRcbiAqL1xuY2xhc3MgTW91c2UgZXh0ZW5kcyBFdmVudEhhbmRsZXIge1xuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4gdGhlIG1vdXNlIGlzIG1vdmVkLiBUaGUgaGFuZGxlciBpcyBwYXNzZWQgYSB7QGxpbmsgTW91c2VFdmVudH0uXG4gICAgICpcbiAgICAgKiBAZXZlbnRcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGFwcC5tb3VzZS5vbignbW91c2Vtb3ZlJywgKGUpID0+IHtcbiAgICAgKiAgICAgY29uc29sZS5sb2coYEN1cnJlbnQgbW91c2UgcG9zaXRpb24gaXM6ICR7ZS54fSwgJHtlLnl9YCk7XG4gICAgICogfSk7XG4gICAgICovXG4gICAgc3RhdGljIEVWRU5UX01PVVNFTU9WRSA9IEVWRU5UX01PVVNFTU9WRTtcblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4gYSBtb3VzZSBidXR0b24gaXMgcHJlc3NlZC4gVGhlIGhhbmRsZXIgaXMgcGFzc2VkIGEge0BsaW5rIE1vdXNlRXZlbnR9LlxuICAgICAqXG4gICAgICogQGV2ZW50XG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBhcHAubW91c2Uub24oJ21vdXNlZG93bicsIChlKSA9PiB7XG4gICAgICogICAgIGNvbnNvbGUubG9nKGBUaGUgJHtlLmJ1dHRvbn0gYnV0dG9uIHdhcyBwcmVzc2VkIGF0IHBvc2l0aW9uOiAke2UueH0sICR7ZS55fWApO1xuICAgICAqIH0pO1xuICAgICAqL1xuICAgIHN0YXRpYyBFVkVOVF9NT1VTRURPV04gPSBFVkVOVF9NT1VTRURPV047XG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIGEgbW91c2UgYnV0dG9uIGlzIHJlbGVhc2VkLiBUaGUgaGFuZGxlciBpcyBwYXNzZWQgYSB7QGxpbmsgTW91c2VFdmVudH0uXG4gICAgICpcbiAgICAgKiBAZXZlbnRcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGFwcC5tb3VzZS5vbignbW91c2V1cCcsIChlKSA9PiB7XG4gICAgICogICAgIGNvbnNvbGUubG9nKGBUaGUgJHtlLmJ1dHRvbn0gYnV0dG9uIHdhcyByZWxlYXNlZCBhdCBwb3NpdGlvbjogJHtlLnh9LCAke2UueX1gKTtcbiAgICAgKiB9KTtcbiAgICAgKi9cbiAgICBzdGF0aWMgRVZFTlRfTU9VU0VVUCA9IEVWRU5UX01PVVNFVVA7XG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIGEgbW91c2Ugd2hlZWwgaXMgbW92ZWQuIFRoZSBoYW5kbGVyIGlzIHBhc3NlZCBhIHtAbGluayBNb3VzZUV2ZW50fS5cbiAgICAgKlxuICAgICAqIEBldmVudFxuICAgICAqIEBleGFtcGxlXG4gICAgICogYXBwLm1vdXNlLm9uKCdtb3VzZXdoZWVsJywgKGUpID0+IHtcbiAgICAgKiAgICAgY29uc29sZS5sb2coYFRoZSBtb3VzZSB3aGVlbCB3YXMgbW92ZWQgYnkgJHtlLndoZWVsRGVsdGF9YCk7XG4gICAgICogfSk7XG4gICAgICovXG4gICAgc3RhdGljIEVWRU5UX01PVVNFV0hFRUwgPSBFVkVOVF9NT1VTRVdIRUVMO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IE1vdXNlIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtFbGVtZW50fSBbZWxlbWVudF0gLSBUaGUgRWxlbWVudCB0aGF0IHRoZSBtb3VzZSBldmVudHMgYXJlIGF0dGFjaGVkIHRvLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGVsZW1lbnQpIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICAvLyBDbGVhciB0aGUgbW91c2Ugc3RhdGVcbiAgICAgICAgdGhpcy5fbGFzdFggPSAwO1xuICAgICAgICB0aGlzLl9sYXN0WSA9IDA7XG4gICAgICAgIHRoaXMuX2J1dHRvbnMgPSBbZmFsc2UsIGZhbHNlLCBmYWxzZV07XG4gICAgICAgIHRoaXMuX2xhc3RidXR0b25zID0gW2ZhbHNlLCBmYWxzZSwgZmFsc2VdO1xuXG5cbiAgICAgICAgLy8gU2V0dXAgZXZlbnQgaGFuZGxlcnMgc28gdGhleSBhcmUgYm91bmQgdG8gdGhlIGNvcnJlY3QgJ3RoaXMnXG4gICAgICAgIHRoaXMuX3VwSGFuZGxlciA9IHRoaXMuX2hhbmRsZVVwLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMuX2Rvd25IYW5kbGVyID0gdGhpcy5faGFuZGxlRG93bi5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLl9tb3ZlSGFuZGxlciA9IHRoaXMuX2hhbmRsZU1vdmUuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5fd2hlZWxIYW5kbGVyID0gdGhpcy5faGFuZGxlV2hlZWwuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5fY29udGV4dE1lbnVIYW5kbGVyID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuX3RhcmdldCA9IG51bGw7XG4gICAgICAgIHRoaXMuX2F0dGFjaGVkID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5hdHRhY2goZWxlbWVudCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgdGhlIG1vdXNlIHBvaW50ZXIgaGFzIGJlZW4gbG9ja2VkLCB1c2luZyB7QGxpbmsgTW91c2UjZW5hYmxlUG9pbnRlckxvY2t9LlxuICAgICAqXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgbG9ja2VkLlxuICAgICAqL1xuICAgIHN0YXRpYyBpc1BvaW50ZXJMb2NrZWQoKSB7XG4gICAgICAgIHJldHVybiBpc01vdXNlUG9pbnRlckxvY2tlZCgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEF0dGFjaCBtb3VzZSBldmVudHMgdG8gYW4gRWxlbWVudC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudCAtIFRoZSBET00gZWxlbWVudCB0byBhdHRhY2ggdGhlIG1vdXNlIHRvLlxuICAgICAqL1xuICAgIGF0dGFjaChlbGVtZW50KSB7XG4gICAgICAgIHRoaXMuX3RhcmdldCA9IGVsZW1lbnQ7XG5cbiAgICAgICAgaWYgKHRoaXMuX2F0dGFjaGVkKSByZXR1cm47XG4gICAgICAgIHRoaXMuX2F0dGFjaGVkID0gdHJ1ZTtcblxuICAgICAgICBjb25zdCBvcHRzID0gcGxhdGZvcm0ucGFzc2l2ZUV2ZW50cyA/IHsgcGFzc2l2ZTogZmFsc2UgfSA6IGZhbHNlO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMuX3VwSGFuZGxlciwgb3B0cyk7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLl9kb3duSGFuZGxlciwgb3B0cyk7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLl9tb3ZlSGFuZGxlciwgb3B0cyk7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd3aGVlbCcsIHRoaXMuX3doZWVsSGFuZGxlciwgb3B0cyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIG1vdXNlIGV2ZW50cyBmcm9tIHRoZSBlbGVtZW50IHRoYXQgaXQgaXMgYXR0YWNoZWQgdG8uXG4gICAgICovXG4gICAgZGV0YWNoKCkge1xuICAgICAgICBpZiAoIXRoaXMuX2F0dGFjaGVkKSByZXR1cm47XG4gICAgICAgIHRoaXMuX2F0dGFjaGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX3RhcmdldCA9IG51bGw7XG5cbiAgICAgICAgY29uc3Qgb3B0cyA9IHBsYXRmb3JtLnBhc3NpdmVFdmVudHMgPyB7IHBhc3NpdmU6IGZhbHNlIH0gOiBmYWxzZTtcbiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLl91cEhhbmRsZXIsIG9wdHMpO1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5fZG93bkhhbmRsZXIsIG9wdHMpO1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5fbW92ZUhhbmRsZXIsIG9wdHMpO1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignd2hlZWwnLCB0aGlzLl93aGVlbEhhbmRsZXIsIG9wdHMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERpc2FibGUgdGhlIGNvbnRleHQgbWVudSB1c3VhbGx5IGFjdGl2YXRlZCB3aXRoIHJpZ2h0LWNsaWNrLlxuICAgICAqL1xuICAgIGRpc2FibGVDb250ZXh0TWVudSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl90YXJnZXQpIHJldHVybjtcbiAgICAgICAgdGhpcy5fdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRleHRtZW51JywgdGhpcy5fY29udGV4dE1lbnVIYW5kbGVyKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFbmFibGUgdGhlIGNvbnRleHQgbWVudSB1c3VhbGx5IGFjdGl2YXRlZCB3aXRoIHJpZ2h0LWNsaWNrLiBUaGlzIG9wdGlvbiBpcyBhY3RpdmUgYnlcbiAgICAgKiBkZWZhdWx0LlxuICAgICAqL1xuICAgIGVuYWJsZUNvbnRleHRNZW51KCkge1xuICAgICAgICBpZiAoIXRoaXMuX3RhcmdldCkgcmV0dXJuO1xuICAgICAgICB0aGlzLl90YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY29udGV4dG1lbnUnLCB0aGlzLl9jb250ZXh0TWVudUhhbmRsZXIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlcXVlc3QgdGhhdCB0aGUgYnJvd3NlciBoaWRlcyB0aGUgbW91c2UgY3Vyc29yIGFuZCBsb2NrcyB0aGUgbW91c2UgdG8gdGhlIGVsZW1lbnQuIEFsbG93aW5nXG4gICAgICogcmF3IGFjY2VzcyB0byBtb3VzZSBtb3ZlbWVudCBpbnB1dCB3aXRob3V0IHJpc2tpbmcgdGhlIG1vdXNlIGV4aXRpbmcgdGhlIGVsZW1lbnQuIE5vdGVzOlxuICAgICAqXG4gICAgICogLSBJbiBzb21lIGJyb3dzZXJzIHRoaXMgd2lsbCBvbmx5IHdvcmsgd2hlbiB0aGUgYnJvd3NlciBpcyBydW5uaW5nIGluIGZ1bGxzY3JlZW4gbW9kZS4gU2VlXG4gICAgICoge0BsaW5rIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9GdWxsc2NyZWVuX0FQSSBGdWxsc2NyZWVuIEFQSX0gZm9yXG4gICAgICogbW9yZSBkZXRhaWxzLlxuICAgICAqIC0gRW5hYmxpbmcgcG9pbnRlciBsb2NrIGNhbiBvbmx5IGJlIGluaXRpYXRlZCBieSBhIHVzZXIgYWN0aW9uIGUuZy4gaW4gdGhlIGV2ZW50IGhhbmRsZXIgZm9yXG4gICAgICogYSBtb3VzZSBvciBrZXlib2FyZCBpbnB1dC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7TG9ja01vdXNlQ2FsbGJhY2t9IFtzdWNjZXNzXSAtIEZ1bmN0aW9uIGNhbGxlZCBpZiB0aGUgcmVxdWVzdCBmb3IgbW91c2UgbG9jayBpc1xuICAgICAqIHN1Y2Nlc3NmdWwuXG4gICAgICogQHBhcmFtIHtMb2NrTW91c2VDYWxsYmFja30gW2Vycm9yXSAtIEZ1bmN0aW9uIGNhbGxlZCBpZiB0aGUgcmVxdWVzdCBmb3IgbW91c2UgbG9jayBpc1xuICAgICAqIHVuc3VjY2Vzc2Z1bC5cbiAgICAgKi9cbiAgICBlbmFibGVQb2ludGVyTG9jayhzdWNjZXNzLCBlcnJvcikge1xuICAgICAgICBpZiAoIWRvY3VtZW50LmJvZHkucmVxdWVzdFBvaW50ZXJMb2NrKSB7XG4gICAgICAgICAgICBpZiAoZXJyb3IpXG4gICAgICAgICAgICAgICAgZXJyb3IoKTtcblxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcyA9ICgpID0+IHtcbiAgICAgICAgICAgIHN1Y2Nlc3MoKTtcbiAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJsb2NrY2hhbmdlJywgcyk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGUgPSAoKSA9PiB7XG4gICAgICAgICAgICBlcnJvcigpO1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9pbnRlcmxvY2tlcnJvcicsIGUpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVybG9ja2NoYW5nZScsIHMsIGZhbHNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmxvY2tlcnJvcicsIGUsIGZhbHNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVxdWVzdFBvaW50ZXJMb2NrKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIGNvbnRyb2wgb2YgdGhlIG1vdXNlIGN1cnNvciB0byB0aGUgdXNlci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7TG9ja01vdXNlQ2FsbGJhY2t9IFtzdWNjZXNzXSAtIEZ1bmN0aW9uIGNhbGxlZCB3aGVuIHRoZSBtb3VzZSBsb2NrIGlzIGRpc2FibGVkLlxuICAgICAqL1xuICAgIGRpc2FibGVQb2ludGVyTG9jayhzdWNjZXNzKSB7XG4gICAgICAgIGlmICghZG9jdW1lbnQuZXhpdFBvaW50ZXJMb2NrKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzID0gKCkgPT4ge1xuICAgICAgICAgICAgc3VjY2VzcygpO1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9pbnRlcmxvY2tjaGFuZ2UnLCBzKTtcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJsb2NrY2hhbmdlJywgcywgZmFsc2UpO1xuICAgICAgICB9XG4gICAgICAgIGRvY3VtZW50LmV4aXRQb2ludGVyTG9jaygpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSBtZXRob2QsIHNob3VsZCBiZSBjYWxsZWQgb25jZSBwZXIgZnJhbWUuXG4gICAgICovXG4gICAgdXBkYXRlKCkge1xuICAgICAgICAvLyBDb3B5IGN1cnJlbnQgYnV0dG9uIHN0YXRlXG4gICAgICAgIHRoaXMuX2xhc3RidXR0b25zWzBdID0gdGhpcy5fYnV0dG9uc1swXTtcbiAgICAgICAgdGhpcy5fbGFzdGJ1dHRvbnNbMV0gPSB0aGlzLl9idXR0b25zWzFdO1xuICAgICAgICB0aGlzLl9sYXN0YnV0dG9uc1syXSA9IHRoaXMuX2J1dHRvbnNbMl07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBtb3VzZSBidXR0b24gaXMgY3VycmVudGx5IHByZXNzZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gYnV0dG9uIC0gVGhlIG1vdXNlIGJ1dHRvbiB0byB0ZXN0LiBDYW4gYmU6XG4gICAgICpcbiAgICAgKiAtIHtAbGluayBNT1VTRUJVVFRPTl9MRUZUfVxuICAgICAqIC0ge0BsaW5rIE1PVVNFQlVUVE9OX01JRERMRX1cbiAgICAgKiAtIHtAbGluayBNT1VTRUJVVFRPTl9SSUdIVH1cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHRoZSBtb3VzZSBidXR0b24gaXMgY3VycmVudCBwcmVzc2VkLlxuICAgICAqL1xuICAgIGlzUHJlc3NlZChidXR0b24pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2J1dHRvbnNbYnV0dG9uXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIG1vdXNlIGJ1dHRvbiB3YXMgcHJlc3NlZCB0aGlzIGZyYW1lIChzaW5jZSB0aGUgbGFzdCBjYWxsIHRvIHVwZGF0ZSkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gYnV0dG9uIC0gVGhlIG1vdXNlIGJ1dHRvbiB0byB0ZXN0LiBDYW4gYmU6XG4gICAgICpcbiAgICAgKiAtIHtAbGluayBNT1VTRUJVVFRPTl9MRUZUfVxuICAgICAqIC0ge0BsaW5rIE1PVVNFQlVUVE9OX01JRERMRX1cbiAgICAgKiAtIHtAbGluayBNT1VTRUJVVFRPTl9SSUdIVH1cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHRoZSBtb3VzZSBidXR0b24gd2FzIHByZXNzZWQgc2luY2UgdGhlIGxhc3QgdXBkYXRlLlxuICAgICAqL1xuICAgIHdhc1ByZXNzZWQoYnV0dG9uKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5fYnV0dG9uc1tidXR0b25dICYmICF0aGlzLl9sYXN0YnV0dG9uc1tidXR0b25dKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIG1vdXNlIGJ1dHRvbiB3YXMgcmVsZWFzZWQgdGhpcyBmcmFtZSAoc2luY2UgdGhlIGxhc3QgY2FsbCB0byB1cGRhdGUpLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGJ1dHRvbiAtIFRoZSBtb3VzZSBidXR0b24gdG8gdGVzdC4gQ2FuIGJlOlxuICAgICAqXG4gICAgICogLSB7QGxpbmsgTU9VU0VCVVRUT05fTEVGVH1cbiAgICAgKiAtIHtAbGluayBNT1VTRUJVVFRPTl9NSURETEV9XG4gICAgICogLSB7QGxpbmsgTU9VU0VCVVRUT05fUklHSFR9XG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgbW91c2UgYnV0dG9uIHdhcyByZWxlYXNlZCBzaW5jZSB0aGUgbGFzdCB1cGRhdGUuXG4gICAgICovXG4gICAgd2FzUmVsZWFzZWQoYnV0dG9uKSB7XG4gICAgICAgIHJldHVybiAoIXRoaXMuX2J1dHRvbnNbYnV0dG9uXSAmJiB0aGlzLl9sYXN0YnV0dG9uc1tidXR0b25dKTtcbiAgICB9XG5cbiAgICBfaGFuZGxlVXAoZXZlbnQpIHtcbiAgICAgICAgLy8gZGlzYWJsZSByZWxlYXNlZCBidXR0b25cbiAgICAgICAgdGhpcy5fYnV0dG9uc1tldmVudC5idXR0b25dID0gZmFsc2U7XG5cbiAgICAgICAgY29uc3QgZSA9IG5ldyBNb3VzZUV2ZW50KHRoaXMsIGV2ZW50KTtcbiAgICAgICAgaWYgKCFlLmV2ZW50KSByZXR1cm47XG5cbiAgICAgICAgLy8gc2VuZCAnbW91c2V1cCcgZXZlbnRcbiAgICAgICAgdGhpcy5maXJlKEVWRU5UX01PVVNFVVAsIGUpO1xuICAgIH1cblxuICAgIF9oYW5kbGVEb3duKGV2ZW50KSB7XG4gICAgICAgIC8vIFN0b3JlIHdoaWNoIGJ1dHRvbiBoYXMgYWZmZWN0ZWRcbiAgICAgICAgdGhpcy5fYnV0dG9uc1tldmVudC5idXR0b25dID0gdHJ1ZTtcblxuICAgICAgICBjb25zdCBlID0gbmV3IE1vdXNlRXZlbnQodGhpcywgZXZlbnQpO1xuICAgICAgICBpZiAoIWUuZXZlbnQpIHJldHVybjtcblxuICAgICAgICB0aGlzLmZpcmUoRVZFTlRfTU9VU0VET1dOLCBlKTtcbiAgICB9XG5cbiAgICBfaGFuZGxlTW92ZShldmVudCkge1xuICAgICAgICBjb25zdCBlID0gbmV3IE1vdXNlRXZlbnQodGhpcywgZXZlbnQpO1xuICAgICAgICBpZiAoIWUuZXZlbnQpIHJldHVybjtcblxuICAgICAgICB0aGlzLmZpcmUoRVZFTlRfTU9VU0VNT1ZFLCBlKTtcblxuICAgICAgICAvLyBTdG9yZSB0aGUgbGFzdCBvZmZzZXQgcG9zaXRpb24gdG8gY2FsY3VsYXRlIGRlbHRhc1xuICAgICAgICB0aGlzLl9sYXN0WCA9IGUueDtcbiAgICAgICAgdGhpcy5fbGFzdFkgPSBlLnk7XG4gICAgfVxuXG4gICAgX2hhbmRsZVdoZWVsKGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IGUgPSBuZXcgTW91c2VFdmVudCh0aGlzLCBldmVudCk7XG4gICAgICAgIGlmICghZS5ldmVudCkgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMuZmlyZShFVkVOVF9NT1VTRVdIRUVMLCBlKTtcbiAgICB9XG5cbiAgICBfZ2V0VGFyZ2V0Q29vcmRzKGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IHJlY3QgPSB0aGlzLl90YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgIGNvbnN0IGxlZnQgPSBNYXRoLmZsb29yKHJlY3QubGVmdCk7XG4gICAgICAgIGNvbnN0IHRvcCA9IE1hdGguZmxvb3IocmVjdC50b3ApO1xuXG4gICAgICAgIC8vIG1vdXNlIGlzIG91dHNpZGUgb2YgY2FudmFzXG4gICAgICAgIGlmIChldmVudC5jbGllbnRYIDwgbGVmdCB8fFxuICAgICAgICAgICAgZXZlbnQuY2xpZW50WCA+PSBsZWZ0ICsgdGhpcy5fdGFyZ2V0LmNsaWVudFdpZHRoIHx8XG4gICAgICAgICAgICBldmVudC5jbGllbnRZIDwgdG9wIHx8XG4gICAgICAgICAgICBldmVudC5jbGllbnRZID49IHRvcCArIHRoaXMuX3RhcmdldC5jbGllbnRIZWlnaHQpIHtcblxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgeDogZXZlbnQuY2xpZW50WCAtIGxlZnQsXG4gICAgICAgICAgICB5OiBldmVudC5jbGllbnRZIC0gdG9wXG4gICAgICAgIH07XG4gICAgfVxufVxuXG5leHBvcnQgeyBNb3VzZSB9O1xuIl0sIm5hbWVzIjpbIk1vdXNlIiwiRXZlbnRIYW5kbGVyIiwiY29uc3RydWN0b3IiLCJlbGVtZW50IiwiX2xhc3RYIiwiX2xhc3RZIiwiX2J1dHRvbnMiLCJfbGFzdGJ1dHRvbnMiLCJfdXBIYW5kbGVyIiwiX2hhbmRsZVVwIiwiYmluZCIsIl9kb3duSGFuZGxlciIsIl9oYW5kbGVEb3duIiwiX21vdmVIYW5kbGVyIiwiX2hhbmRsZU1vdmUiLCJfd2hlZWxIYW5kbGVyIiwiX2hhbmRsZVdoZWVsIiwiX2NvbnRleHRNZW51SGFuZGxlciIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJfdGFyZ2V0IiwiX2F0dGFjaGVkIiwiYXR0YWNoIiwiaXNQb2ludGVyTG9ja2VkIiwiaXNNb3VzZVBvaW50ZXJMb2NrZWQiLCJvcHRzIiwicGxhdGZvcm0iLCJwYXNzaXZlRXZlbnRzIiwicGFzc2l2ZSIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJkZXRhY2giLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZGlzYWJsZUNvbnRleHRNZW51IiwiZW5hYmxlQ29udGV4dE1lbnUiLCJlbmFibGVQb2ludGVyTG9jayIsInN1Y2Nlc3MiLCJlcnJvciIsImRvY3VtZW50IiwiYm9keSIsInJlcXVlc3RQb2ludGVyTG9jayIsInMiLCJlIiwiZGlzYWJsZVBvaW50ZXJMb2NrIiwiZXhpdFBvaW50ZXJMb2NrIiwidXBkYXRlIiwiaXNQcmVzc2VkIiwiYnV0dG9uIiwid2FzUHJlc3NlZCIsIndhc1JlbGVhc2VkIiwiTW91c2VFdmVudCIsImZpcmUiLCJFVkVOVF9NT1VTRVVQIiwiRVZFTlRfTU9VU0VET1dOIiwiRVZFTlRfTU9VU0VNT1ZFIiwieCIsInkiLCJFVkVOVF9NT1VTRVdIRUVMIiwiX2dldFRhcmdldENvb3JkcyIsInJlY3QiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJsZWZ0IiwiTWF0aCIsImZsb29yIiwidG9wIiwiY2xpZW50WCIsImNsaWVudFdpZHRoIiwiY2xpZW50WSIsImNsaWVudEhlaWdodCJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1BLEtBQUssU0FBU0MsWUFBWSxDQUFDO0FBNkM3QjtBQUNKO0FBQ0E7QUFDQTtBQUNBO0VBQ0lDLFdBQVdBLENBQUNDLE9BQU8sRUFBRTtBQUNqQixJQUFBLEtBQUssRUFBRSxDQUFBOztBQUVQO0lBQ0EsSUFBSSxDQUFDQyxNQUFNLEdBQUcsQ0FBQyxDQUFBO0lBQ2YsSUFBSSxDQUFDQyxNQUFNLEdBQUcsQ0FBQyxDQUFBO0lBQ2YsSUFBSSxDQUFDQyxRQUFRLEdBQUcsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFBO0lBQ3JDLElBQUksQ0FBQ0MsWUFBWSxHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQTs7QUFHekM7SUFDQSxJQUFJLENBQUNDLFVBQVUsR0FBRyxJQUFJLENBQUNDLFNBQVMsQ0FBQ0MsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQzNDLElBQUksQ0FBQ0MsWUFBWSxHQUFHLElBQUksQ0FBQ0MsV0FBVyxDQUFDRixJQUFJLENBQUMsSUFBSSxD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
