import { Debug } from '../../core/debug.js';
import { math } from '../../core/math/math.js';
import { Vec3 } from '../../core/math/vec3.js';
import { DISTANCE_INVERSE, DISTANCE_LINEAR, DISTANCE_EXPONENTIAL } from './constants.js';
import { hasAudioContext } from './capabilities.js';
import { Channel } from './channel.js';

// default maxDistance, same as Web Audio API
const MAX_DISTANCE = 10000;

/**
 * 3D audio channel.
 *
 * @ignore
 */
class Channel3d extends Channel {
  /**
   * Create a new Channel3d instance.
   *
   * @param {import('../sound/manager.js').SoundManager} manager - The SoundManager instance.
   * @param {import('../sound/sound.js').Sound} sound - The sound to playback.
   * @param {object} [options] - Optional options object.
   * @param {number} [options.volume] - The playback volume, between 0 and 1. Defaults to 1.
   * @param {number} [options.pitch] - The relative pitch. Defaults to 1 (plays at normal pitch).
   * @param {boolean} [options.loop] - Whether the sound should loop when it reaches the end or
   * not. Defaults to false.
   */
  constructor(manager, sound, options) {
    super(manager, sound, options);
    this.position = new Vec3();
    this.velocity = new Vec3();
    if (hasAudioContext()) {
      this.panner = manager.context.createPanner();
    } else {
      this.maxDistance = MAX_DISTANCE;
      this.minDistance = 1;
      this.rollOffFactor = 1;
      this.distanceModel = DISTANCE_INVERSE;
    }
  }
  getPosition() {
    return this.position;
  }
  setPosition(position) {
    this.position.copy(position);
    const panner = this.panner;
    if ('positionX' in panner) {
      panner.positionX.value = position.x;
      panner.positionY.value = position.y;
      panner.positionZ.value = position.z;
    } else if (panner.setPosition) {
      // Firefox (and legacy browsers)
      panner.setPosition(position.x, position.y, position.z);
    }
  }
  getVelocity() {
    Debug.warn('Channel3d#getVelocity is not implemented.');
    return this.velocity;
  }
  setVelocity(velocity) {
    Debug.warn('Channel3d#setVelocity is not implemented.');
    this.velocity.copy(velocity);
  }
  getMaxDistance() {
    return this.panner.maxDistance;
  }
  setMaxDistance(max) {
    this.panner.maxDistance = max;
  }
  getMinDistance() {
    return this.panner.refDistance;
  }
  setMinDistance(min) {
    this.panner.refDistance = min;
  }
  getRollOffFactor() {
    return this.panner.rolloffFactor;
  }
  setRollOffFactor(factor) {
    this.panner.rolloffFactor = factor;
  }
  getDistanceModel() {
    return this.panner.distanceModel;
  }
  setDistanceModel(distanceModel) {
    this.panner.distanceModel = distanceModel;
  }

  /**
   * Create the buffer source and connect it up to the correct audio nodes.
   *
   * @private
   */
  _createSource() {
    const context = this.manager.context;
    this.source = context.createBufferSource();
    this.source.buffer = this.sound.buffer;

    // Connect up the nodes
    this.source.connect(this.panner);
    this.panner.connect(this.gain);
    this.gain.connect(context.destination);
    if (!this.loop) {
      // mark source as paused when it ends
      this.source.onended = this.pause.bind(this);
    }
  }
}
if (!hasAudioContext()) {
  // temp vector storage
  let offset = new Vec3();

  // Fall off function which should be the same as the one in the Web Audio API
  // Taken from https://developer.mozilla.org/en-US/docs/Web/API/PannerNode/distanceModel
  const fallOff = function fallOff(posOne, posTwo, refDistance, maxDistance, rolloffFactor, distanceModel) {
    offset = offset.sub2(posOne, posTwo);
    const distance = offset.length();
    if (distance < refDistance) {
      return 1;
    } else if (distance > maxDistance) {
      return 0;
    }
    let result = 0;
    if (distanceModel === DISTANCE_LINEAR) {
      result = 1 - rolloffFactor * (distance - refDistance) / (maxDistance - refDistance);
    } else if (distanceModel === DISTANCE_INVERSE) {
      result = refDistance / (refDistance + rolloffFactor * (distance - refDistance));
    } else if (distanceModel === DISTANCE_EXPONENTIAL) {
      result = Math.pow(distance / refDistance, -rolloffFactor);
    }
    return math.clamp(result, 0, 1);
  };
  Object.assign(Channel3d.prototype, {
    setPosition: function (position) {
      this.position.copy(position);
      if (this.source) {
        const listener = this.manager.listener;
        const lpos = listener.getPosition();
        const factor = fallOff(lpos, this.position, this.minDistance, this.maxDistance, this.rollOffFactor, this.distanceModel);
        const v = this.getVolume();
        this.source.volume = v * factor;
      }
    },
    getMaxDistance: function () {
      return this.maxDistance;
    },
    setMaxDistance: function (max) {
      this.maxDistance = max;
    },
    getMinDistance: function () {
      return this.minDistance;
    },
    setMinDistance: function (min) {
      this.minDistance = min;
    },
    getRollOffFactor: function () {
      return this.rollOffFactor;
    },
    setRollOffFactor: function (factor) {
      this.rollOffFactor = factor;
    },
    getDistanceModel: function () {
      return this.distanceModel;
    },
    setDistanceModel: function (distanceModel) {
      this.distanceModel = distanceModel;
    }
  });
}

export { Channel3d };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhbm5lbDNkLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvcGxhdGZvcm0vYXVkaW8vY2hhbm5lbDNkLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnIH0gZnJvbSAnLi4vLi4vY29yZS9kZWJ1Zy5qcyc7XG5pbXBvcnQgeyBtYXRoIH0gZnJvbSAnLi4vLi4vY29yZS9tYXRoL21hdGguanMnO1xuaW1wb3J0IHsgVmVjMyB9IGZyb20gJy4uLy4uL2NvcmUvbWF0aC92ZWMzLmpzJztcblxuaW1wb3J0IHsgRElTVEFOQ0VfRVhQT05FTlRJQUwsIERJU1RBTkNFX0lOVkVSU0UsIERJU1RBTkNFX0xJTkVBUiB9IGZyb20gJy4vY29uc3RhbnRzLmpzJztcbmltcG9ydCB7IGhhc0F1ZGlvQ29udGV4dCB9IGZyb20gJy4vY2FwYWJpbGl0aWVzLmpzJztcbmltcG9ydCB7IENoYW5uZWwgfSBmcm9tICcuL2NoYW5uZWwuanMnO1xuXG4vLyBkZWZhdWx0IG1heERpc3RhbmNlLCBzYW1lIGFzIFdlYiBBdWRpbyBBUElcbmNvbnN0IE1BWF9ESVNUQU5DRSA9IDEwMDAwO1xuXG4vKipcbiAqIDNEIGF1ZGlvIGNoYW5uZWwuXG4gKlxuICogQGlnbm9yZVxuICovXG5jbGFzcyBDaGFubmVsM2QgZXh0ZW5kcyBDaGFubmVsIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgQ2hhbm5lbDNkIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uL3NvdW5kL21hbmFnZXIuanMnKS5Tb3VuZE1hbmFnZXJ9IG1hbmFnZXIgLSBUaGUgU291bmRNYW5hZ2VyIGluc3RhbmNlLlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi9zb3VuZC9zb3VuZC5qcycpLlNvdW5kfSBzb3VuZCAtIFRoZSBzb3VuZCB0byBwbGF5YmFjay5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gW29wdGlvbnNdIC0gT3B0aW9uYWwgb3B0aW9ucyBvYmplY3QuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLnZvbHVtZV0gLSBUaGUgcGxheWJhY2sgdm9sdW1lLCBiZXR3ZWVuIDAgYW5kIDEuIERlZmF1bHRzIHRvIDEuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLnBpdGNoXSAtIFRoZSByZWxhdGl2ZSBwaXRjaC4gRGVmYXVsdHMgdG8gMSAocGxheXMgYXQgbm9ybWFsIHBpdGNoKS5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLmxvb3BdIC0gV2hldGhlciB0aGUgc291bmQgc2hvdWxkIGxvb3Agd2hlbiBpdCByZWFjaGVzIHRoZSBlbmQgb3JcbiAgICAgKiBub3QuIERlZmF1bHRzIHRvIGZhbHNlLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKG1hbmFnZXIsIHNvdW5kLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKG1hbmFnZXIsIHNvdW5kLCBvcHRpb25zKTtcblxuICAgICAgICB0aGlzLnBvc2l0aW9uID0gbmV3IFZlYzMoKTtcbiAgICAgICAgdGhpcy52ZWxvY2l0eSA9IG5ldyBWZWMzKCk7XG5cbiAgICAgICAgaWYgKGhhc0F1ZGlvQ29udGV4dCgpKSB7XG4gICAgICAgICAgICB0aGlzLnBhbm5lciA9IG1hbmFnZXIuY29udGV4dC5jcmVhdGVQYW5uZXIoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubWF4RGlzdGFuY2UgPSBNQVhfRElTVEFOQ0U7XG4gICAgICAgICAgICB0aGlzLm1pbkRpc3RhbmNlID0gMTtcbiAgICAgICAgICAgIHRoaXMucm9sbE9mZkZhY3RvciA9IDE7XG4gICAgICAgICAgICB0aGlzLmRpc3RhbmNlTW9kZWwgPSBESVNUQU5DRV9JTlZFUlNFO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0UG9zaXRpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBvc2l0aW9uO1xuICAgIH1cblxuICAgIHNldFBvc2l0aW9uKHBvc2l0aW9uKSB7XG4gICAgICAgIHRoaXMucG9zaXRpb24uY29weShwb3NpdGlvbik7XG4gICAgICAgIGNvbnN0IHBhbm5lciA9IHRoaXMucGFubmVyO1xuICAgICAgICBpZiAoJ3Bvc2l0aW9uWCcgaW4gcGFubmVyKSB7XG4gICAgICAgICAgICBwYW5uZXIucG9zaXRpb25YLnZhbHVlID0gcG9zaXRpb24ueDtcbiAgICAgICAgICAgIHBhbm5lci5wb3NpdGlvblkudmFsdWUgPSBwb3NpdGlvbi55O1xuICAgICAgICAgICAgcGFubmVyLnBvc2l0aW9uWi52YWx1ZSA9IHBvc2l0aW9uLno7XG4gICAgICAgIH0gZWxzZSBpZiAocGFubmVyLnNldFBvc2l0aW9uKSB7IC8vIEZpcmVmb3ggKGFuZCBsZWdhY3kgYnJvd3NlcnMpXG4gICAgICAgICAgICBwYW5uZXIuc2V0UG9zaXRpb24ocG9zaXRpb24ueCwgcG9zaXRpb24ueSwgcG9zaXRpb24ueik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRWZWxvY2l0eSgpIHtcbiAgICAgICAgRGVidWcud2FybignQ2hhbm5lbDNkI2dldFZlbG9jaXR5IGlzIG5vdCBpbXBsZW1lbnRlZC4nKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmVsb2NpdHk7XG4gICAgfVxuXG4gICAgc2V0VmVsb2NpdHkodmVsb2NpdHkpIHtcbiAgICAgICAgRGVidWcud2FybignQ2hhbm5lbDNkI3NldFZlbG9jaXR5IGlzIG5vdCBpbXBsZW1lbnRlZC4nKTtcbiAgICAgICAgdGhpcy52ZWxvY2l0eS5jb3B5KHZlbG9jaXR5KTtcbiAgICB9XG5cbiAgICBnZXRNYXhEaXN0YW5jZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGFubmVyLm1heERpc3RhbmNlO1xuICAgIH1cblxuICAgIHNldE1heERpc3RhbmNlKG1heCkge1xuICAgICAgICB0aGlzLnBhbm5lci5tYXhEaXN0YW5jZSA9IG1heDtcbiAgICB9XG5cbiAgICBnZXRNaW5EaXN0YW5jZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGFubmVyLnJlZkRpc3RhbmNlO1xuICAgIH1cblxuICAgIHNldE1pbkRpc3RhbmNlKG1pbikge1xuICAgICAgICB0aGlzLnBhbm5lci5yZWZEaXN0YW5jZSA9IG1pbjtcbiAgICB9XG5cbiAgICBnZXRSb2xsT2ZmRmFjdG9yKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYW5uZXIucm9sbG9mZkZhY3RvcjtcbiAgICB9XG5cbiAgICBzZXRSb2xsT2ZmRmFjdG9yKGZhY3Rvcikge1xuICAgICAgICB0aGlzLnBhbm5lci5yb2xsb2ZmRmFjdG9yID0gZmFjdG9yO1xuICAgIH1cblxuICAgIGdldERpc3RhbmNlTW9kZWwoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhbm5lci5kaXN0YW5jZU1vZGVsO1xuICAgIH1cblxuICAgIHNldERpc3RhbmNlTW9kZWwoZGlzdGFuY2VNb2RlbCkge1xuICAgICAgICB0aGlzLnBhbm5lci5kaXN0YW5jZU1vZGVsID0gZGlzdGFuY2VNb2RlbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgdGhlIGJ1ZmZlciBzb3VyY2UgYW5kIGNvbm5lY3QgaXQgdXAgdG8gdGhlIGNvcnJlY3QgYXVkaW8gbm9kZXMuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9jcmVhdGVTb3VyY2UoKSB7XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSB0aGlzLm1hbmFnZXIuY29udGV4dDtcblxuICAgICAgICB0aGlzLnNvdXJjZSA9IGNvbnRleHQuY3JlYXRlQnVmZmVyU291cmNlKCk7XG4gICAgICAgIHRoaXMuc291cmNlLmJ1ZmZlciA9IHRoaXMuc291bmQuYnVmZmVyO1xuXG4gICAgICAgIC8vIENvbm5lY3QgdXAgdGhlIG5vZGVzXG4gICAgICAgIHRoaXMuc291cmNlLmNvbm5lY3QodGhpcy5wYW5uZXIpO1xuICAgICAgICB0aGlzLnBhbm5lci5jb25uZWN0KHRoaXMuZ2Fpbik7XG4gICAgICAgIHRoaXMuZ2Fpbi5jb25uZWN0KGNvbnRleHQuZGVzdGluYXRpb24pO1xuXG4gICAgICAgIGlmICghdGhpcy5sb29wKSB7XG4gICAgICAgICAgICAvLyBtYXJrIHNvdXJjZSBhcyBwYXVzZWQgd2hlbiBpdCBlbmRzXG4gICAgICAgICAgICB0aGlzLnNvdXJjZS5vbmVuZGVkID0gdGhpcy5wYXVzZS5iaW5kKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5pZiAoIWhhc0F1ZGlvQ29udGV4dCgpKSB7XG4gICAgLy8gdGVtcCB2ZWN0b3Igc3RvcmFnZVxuICAgIGxldCBvZmZzZXQgPSBuZXcgVmVjMygpO1xuXG4gICAgLy8gRmFsbCBvZmYgZnVuY3Rpb24gd2hpY2ggc2hvdWxkIGJlIHRoZSBzYW1lIGFzIHRoZSBvbmUgaW4gdGhlIFdlYiBBdWRpbyBBUElcbiAgICAvLyBUYWtlbiBmcm9tIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9QYW5uZXJOb2RlL2Rpc3RhbmNlTW9kZWxcbiAgICBjb25zdCBmYWxsT2ZmID0gZnVuY3Rpb24gKHBvc09uZSwgcG9zVHdvLCByZWZEaXN0YW5jZSwgbWF4RGlzdGFuY2UsIHJvbGxvZmZGYWN0b3IsIGRpc3RhbmNlTW9kZWwpIHtcbiAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0LnN1YjIocG9zT25lLCBwb3NUd28pO1xuICAgICAgICBjb25zdCBkaXN0YW5jZSA9IG9mZnNldC5sZW5ndGgoKTtcblxuICAgICAgICBpZiAoZGlzdGFuY2UgPCByZWZEaXN0YW5jZSkge1xuICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH0gZWxzZSBpZiAoZGlzdGFuY2UgPiBtYXhEaXN0YW5jZSkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcmVzdWx0ID0gMDtcbiAgICAgICAgaWYgKGRpc3RhbmNlTW9kZWwgPT09IERJU1RBTkNFX0xJTkVBUikge1xuICAgICAgICAgICAgcmVzdWx0ID0gMSAtIHJvbGxvZmZGYWN0b3IgKiAoZGlzdGFuY2UgLSByZWZEaXN0YW5jZSkgLyAobWF4RGlzdGFuY2UgLSByZWZEaXN0YW5jZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZGlzdGFuY2VNb2RlbCA9PT0gRElTVEFOQ0VfSU5WRVJTRSkge1xuICAgICAgICAgICAgcmVzdWx0ID0gcmVmRGlzdGFuY2UgLyAocmVmRGlzdGFuY2UgKyByb2xsb2ZmRmFjdG9yICogKGRpc3RhbmNlIC0gcmVmRGlzdGFuY2UpKTtcbiAgICAgICAgfSBlbHNlIGlmIChkaXN0YW5jZU1vZGVsID09PSBESVNUQU5DRV9FWFBPTkVOVElBTCkge1xuICAgICAgICAgICAgcmVzdWx0ID0gTWF0aC5wb3coZGlzdGFuY2UgLyByZWZEaXN0YW5jZSwgLXJvbGxvZmZGYWN0b3IpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBtYXRoLmNsYW1wKHJlc3VsdCwgMCwgMSk7XG4gICAgfTtcblxuICAgIE9iamVjdC5hc3NpZ24oQ2hhbm5lbDNkLnByb3RvdHlwZSwge1xuICAgICAgICBzZXRQb3NpdGlvbjogZnVuY3Rpb24gKHBvc2l0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkocG9zaXRpb24pO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5zb3VyY2UpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBsaXN0ZW5lciA9IHRoaXMubWFuYWdlci5saXN0ZW5lcjtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGxwb3MgPSBsaXN0ZW5lci5nZXRQb3NpdGlvbigpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgZmFjdG9yID0gZmFsbE9mZihscG9zLCB0aGlzLnBvc2l0aW9uLCB0aGlzLm1pbkRpc3RhbmNlLCB0aGlzLm1heERpc3RhbmNlLCB0aGlzLnJvbGxPZmZGYWN0b3IsIHRoaXMuZGlzdGFuY2VNb2RlbCk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCB2ID0gdGhpcy5nZXRWb2x1bWUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZS52b2x1bWUgPSB2ICogZmFjdG9yO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGdldE1heERpc3RhbmNlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tYXhEaXN0YW5jZTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXRNYXhEaXN0YW5jZTogZnVuY3Rpb24gKG1heCkge1xuICAgICAgICAgICAgdGhpcy5tYXhEaXN0YW5jZSA9IG1heDtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRNaW5EaXN0YW5jZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubWluRGlzdGFuY2U7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0TWluRGlzdGFuY2U6IGZ1bmN0aW9uIChtaW4pIHtcbiAgICAgICAgICAgIHRoaXMubWluRGlzdGFuY2UgPSBtaW47XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0Um9sbE9mZkZhY3RvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucm9sbE9mZkZhY3RvcjtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXRSb2xsT2ZmRmFjdG9yOiBmdW5jdGlvbiAoZmFjdG9yKSB7XG4gICAgICAgICAgICB0aGlzLnJvbGxPZmZGYWN0b3IgPSBmYWN0b3I7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0RGlzdGFuY2VNb2RlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlzdGFuY2VNb2RlbDtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXREaXN0YW5jZU1vZGVsOiBmdW5jdGlvbiAoZGlzdGFuY2VNb2RlbCkge1xuICAgICAgICAgICAgdGhpcy5kaXN0YW5jZU1vZGVsID0gZGlzdGFuY2VNb2RlbDtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG5leHBvcnQgeyBDaGFubmVsM2QgfTtcbiJdLCJuYW1lcyI6WyJNQVhfRElTVEFOQ0UiLCJDaGFubmVsM2QiLCJDaGFubmVsIiwiY29uc3RydWN0b3IiLCJtYW5hZ2VyIiwic291bmQiLCJvcHRpb25zIiwicG9zaXRpb24iLCJWZWMzIiwidmVsb2NpdHkiLCJoYXNBdWRpb0NvbnRleHQiLCJwYW5uZXIiLCJjb250ZXh0IiwiY3JlYXRlUGFubmVyIiwibWF4RGlzdGFuY2UiLCJtaW5EaXN0YW5jZSIsInJvbGxPZmZGYWN0b3IiLCJkaXN0YW5jZU1vZGVsIiwiRElTVEFOQ0VfSU5WRVJTRSIsImdldFBvc2l0aW9uIiwic2V0UG9zaXRpb24iLCJjb3B5IiwicG9zaXRpb25YIiwidmFsdWUiLCJ4IiwicG9zaXRpb25ZIiwieSIsInBvc2l0aW9uWiIsInoiLCJnZXRWZWxvY2l0eSIsIkRlYnVnIiwid2FybiIsInNldFZlbG9jaXR5IiwiZ2V0TWF4RGlzdGFuY2UiLCJzZXRNYXhEaXN0YW5jZSIsIm1heCIsImdldE1pbkRpc3RhbmNlIiwicmVmRGlzdGFuY2UiLCJzZXRNaW5EaXN0YW5jZSIsIm1pbiIsImdldFJvbGxPZmZGYWN0b3IiLCJyb2xsb2ZmRmFjdG9yIiwic2V0Um9sbE9mZkZhY3RvciIsImZhY3RvciIsImdldERpc3RhbmNlTW9kZWwiLCJzZXREaXN0YW5jZU1vZGVsIiwiX2NyZWF0ZVNvdXJjZSIsInNvdXJjZSIsImNyZWF0ZUJ1ZmZlclNvdXJjZSIsImJ1ZmZlciIsImNvbm5lY3QiLCJnYWluIiwiZGVzdGluYXRpb24iLCJsb29wIiwib25lbmRlZCIsInBhdXNlIiwiYmluZCIsIm9mZnNldCIsImZhbGxPZmYiLCJwb3NPbmUiLCJwb3NUd28iLCJzdWIyIiwiZGlzdGFuY2UiLCJsZW5ndGgiLCJyZXN1bHQiLCJESVNUQU5DRV9MSU5FQVIiLCJESVNUQU5DRV9FWFBPTkVOVElBTCIsIk1hdGgiLCJwb3ciLCJtYXRoIiwiY2xhbXAiLCJPYmplY3QiLCJhc3NpZ24iLCJwcm90b3R5cGUiLCJsaXN0ZW5lciIsImxwb3MiLCJ2IiwiZ2V0Vm9sdW1lIiwidm9sdW1lIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBUUE7QUFDQSxNQUFNQSxZQUFZ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
