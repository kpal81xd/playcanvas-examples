import { DebugHelper } from '../../core/debug.js';
import { WorldClusters } from '../lighting/world-clusters.js';

const tempClusterArray = [];

/**
 * A class managing instances of world clusters used by the renderer for layers with
 * unique sets of clustered lights.
 *
 * @ignore
 */
class WorldClustersAllocator {
  /**
   * Create a new instance.
   *
   * @param {import('../../platform/graphics/graphics-device.js').GraphicsDevice} graphicsDevice -
   * The graphics device.
   */
  constructor(graphicsDevice) {
    /**
     * Empty cluster with no lights.
     *
     * @type {WorldClusters|null}
     */
    this._empty = null;
    /**
     * All allocated clusters
     *
     * @type {WorldClusters[]}
     */
    this._allocated = [];
    /**
     * Render actions with all unique light clusters. The key is the hash of lights on a layer, the
     * value is a render action with unique light clusters.
     *
     * @type {Map<number, import('../composition/render-action.js').RenderAction>}
     */
    this._clusters = new Map();
    this.device = graphicsDevice;
  }
  destroy() {
    // empty light cluster
    if (this._empty) {
      this._empty.destroy();
      this._empty = null;
    }

    // all other clusters
    this._allocated.forEach(cluster => {
      cluster.destroy();
    });
    this._allocated.length = 0;
  }
  get count() {
    return this._allocated.length;
  }

  // returns an empty light cluster object to be used when no lights are used
  get empty() {
    if (!this._empty) {
      // create cluster structure with no lights
      const empty = new WorldClusters(this.device);
      empty.name = 'ClusterEmpty';

      // update it once to avoid doing it each frame
      empty.update([], false, null);
      this._empty = empty;
    }
    return this._empty;
  }

  // assign light clusters to render actions that need it
  assign(renderPasses) {
    const empty = this.empty;

    // reuse previously allocated clusters
    tempClusterArray.push(...this._allocated);
    this._allocated.length = 0;
    this._clusters.clear();

    // update render actions in passes that use them
    const passCount = renderPasses.length;
    for (let p = 0; p < passCount; p++) {
      const renderPass = renderPasses[p];
      const renderActions = renderPass.renderActions;
      if (renderActions) {
        // process all render actions
        const count = renderActions.length;
        for (let i = 0; i < count; i++) {
          const ra = renderActions[i];
          ra.lightClusters = null;

          // if the layer has lights used by clusters, and meshes
          const layer = ra.layer;
          if (layer.hasClusteredLights && layer.meshInstances.length) {
            // use existing clusters if the lights on the layer are the same
            const hash = layer.getLightIdHash();
            const existingRenderAction = this._clusters.get(hash);
            let clusters = existingRenderAction == null ? void 0 : existingRenderAction.lightClusters;

            // no match, needs new clusters
            if (!clusters) {
              var _tempClusterArray$pop;
              // use already allocated cluster from last frame, or create a new one
              clusters = (_tempClusterArray$pop = tempClusterArray.pop()) != null ? _tempClusterArray$pop : new WorldClusters(this.device);
              DebugHelper.setName(clusters, `Cluster-${this._allocated.length}`);
              this._allocated.push(clusters);
              this._clusters.set(hash, ra);
            }
            ra.lightClusters = clusters;
          }

          // no clustered lights, use the cluster with no lights
          if (!ra.lightClusters) {
            ra.lightClusters = empty;
          }
        }
      }
    }

    // delete leftovers
    tempClusterArray.forEach(item => item.destroy());
    tempClusterArray.length = 0;
  }
  update(renderPasses, gammaCorrection, lighting) {
    // assign clusters to render actions
    this.assign(renderPasses);

    // update all unique clusters
    this._clusters.forEach(renderAction => {
      const layer = renderAction.layer;
      const cluster = renderAction.lightClusters;
      cluster.update(layer.clusteredLightsSet, gammaCorrection, lighting);
    });
  }
}

export { WorldClustersAllocator };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ybGQtY2x1c3RlcnMtYWxsb2NhdG9yLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvc2NlbmUvcmVuZGVyZXIvd29ybGQtY2x1c3RlcnMtYWxsb2NhdG9yLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnSGVscGVyIH0gZnJvbSAnLi4vLi4vY29yZS9kZWJ1Zy5qcyc7XG5pbXBvcnQgeyBXb3JsZENsdXN0ZXJzIH0gZnJvbSAnLi4vbGlnaHRpbmcvd29ybGQtY2x1c3RlcnMuanMnO1xuXG5jb25zdCB0ZW1wQ2x1c3RlckFycmF5ID0gW107XG5cbi8qKlxuICogQSBjbGFzcyBtYW5hZ2luZyBpbnN0YW5jZXMgb2Ygd29ybGQgY2x1c3RlcnMgdXNlZCBieSB0aGUgcmVuZGVyZXIgZm9yIGxheWVycyB3aXRoXG4gKiB1bmlxdWUgc2V0cyBvZiBjbHVzdGVyZWQgbGlnaHRzLlxuICpcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgV29ybGRDbHVzdGVyc0FsbG9jYXRvciB7XG4gICAgLyoqXG4gICAgICogRW1wdHkgY2x1c3RlciB3aXRoIG5vIGxpZ2h0cy5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtXb3JsZENsdXN0ZXJzfG51bGx9XG4gICAgICovXG4gICAgX2VtcHR5ID0gbnVsbDtcblxuICAgIC8qKlxuICAgICAqIEFsbCBhbGxvY2F0ZWQgY2x1c3RlcnNcbiAgICAgKlxuICAgICAqIEB0eXBlIHtXb3JsZENsdXN0ZXJzW119XG4gICAgICovXG4gICAgX2FsbG9jYXRlZCA9IFtdO1xuXG4gICAgLyoqXG4gICAgICogUmVuZGVyIGFjdGlvbnMgd2l0aCBhbGwgdW5pcXVlIGxpZ2h0IGNsdXN0ZXJzLiBUaGUga2V5IGlzIHRoZSBoYXNoIG9mIGxpZ2h0cyBvbiBhIGxheWVyLCB0aGVcbiAgICAgKiB2YWx1ZSBpcyBhIHJlbmRlciBhY3Rpb24gd2l0aCB1bmlxdWUgbGlnaHQgY2x1c3RlcnMuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7TWFwPG51bWJlciwgaW1wb3J0KCcuLi9jb21wb3NpdGlvbi9yZW5kZXItYWN0aW9uLmpzJykuUmVuZGVyQWN0aW9uPn1cbiAgICAgKi9cbiAgICBfY2x1c3RlcnMgPSBuZXcgTWFwKCk7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3MvZ3JhcGhpY3MtZGV2aWNlLmpzJykuR3JhcGhpY3NEZXZpY2V9IGdyYXBoaWNzRGV2aWNlIC1cbiAgICAgKiBUaGUgZ3JhcGhpY3MgZGV2aWNlLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGdyYXBoaWNzRGV2aWNlKSB7XG4gICAgICAgIHRoaXMuZGV2aWNlID0gZ3JhcGhpY3NEZXZpY2U7XG4gICAgfVxuXG4gICAgZGVzdHJveSgpIHtcblxuICAgICAgICAvLyBlbXB0eSBsaWdodCBjbHVzdGVyXG4gICAgICAgIGlmICh0aGlzLl9lbXB0eSkge1xuICAgICAgICAgICAgdGhpcy5fZW1wdHkuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5fZW1wdHkgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gYWxsIG90aGVyIGNsdXN0ZXJzXG4gICAgICAgIHRoaXMuX2FsbG9jYXRlZC5mb3JFYWNoKChjbHVzdGVyKSA9PiB7XG4gICAgICAgICAgICBjbHVzdGVyLmRlc3Ryb3koKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX2FsbG9jYXRlZC5sZW5ndGggPSAwO1xuICAgIH1cblxuICAgIGdldCBjb3VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FsbG9jYXRlZC5sZW5ndGg7XG4gICAgfVxuXG4gICAgLy8gcmV0dXJucyBhbiBlbXB0eSBsaWdodCBjbHVzdGVyIG9iamVjdCB0byBiZSB1c2VkIHdoZW4gbm8gbGlnaHRzIGFyZSB1c2VkXG4gICAgZ2V0IGVtcHR5KCkge1xuICAgICAgICBpZiAoIXRoaXMuX2VtcHR5KSB7XG5cbiAgICAgICAgICAgIC8vIGNyZWF0ZSBjbHVzdGVyIHN0cnVjdHVyZSB3aXRoIG5vIGxpZ2h0c1xuICAgICAgICAgICAgY29uc3QgZW1wdHkgPSBuZXcgV29ybGRDbHVzdGVycyh0aGlzLmRldmljZSk7XG4gICAgICAgICAgICBlbXB0eS5uYW1lID0gJ0NsdXN0ZXJFbXB0eSc7XG5cbiAgICAgICAgICAgIC8vIHVwZGF0ZSBpdCBvbmNlIHRvIGF2b2lkIGRvaW5nIGl0IGVhY2ggZnJhbWVcbiAgICAgICAgICAgIGVtcHR5LnVwZGF0ZShbXSwgZmFsc2UsIG51bGwpO1xuICAgICAgICAgICAgdGhpcy5fZW1wdHkgPSBlbXB0eTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLl9lbXB0eTtcbiAgICB9XG5cbiAgICAvLyBhc3NpZ24gbGlnaHQgY2x1c3RlcnMgdG8gcmVuZGVyIGFjdGlvbnMgdGhhdCBuZWVkIGl0XG4gICAgYXNzaWduKHJlbmRlclBhc3Nlcykge1xuXG4gICAgICAgIGNvbnN0IGVtcHR5ID0gdGhpcy5lbXB0eTtcblxuICAgICAgICAvLyByZXVzZSBwcmV2aW91c2x5IGFsbG9jYXRlZCBjbHVzdGVyc1xuICAgICAgICB0ZW1wQ2x1c3RlckFycmF5LnB1c2goLi4udGhpcy5fYWxsb2NhdGVkKTtcbiAgICAgICAgdGhpcy5fYWxsb2NhdGVkLmxlbmd0aCA9IDA7XG4gICAgICAgIHRoaXMuX2NsdXN0ZXJzLmNsZWFyKCk7XG5cbiAgICAgICAgLy8gdXBkYXRlIHJlbmRlciBhY3Rpb25zIGluIHBhc3NlcyB0aGF0IHVzZSB0aGVtXG4gICAgICAgIGNvbnN0IHBhc3NDb3VudCA9IHJlbmRlclBhc3Nlcy5sZW5ndGg7XG4gICAgICAgIGZvciAobGV0IHAgPSAwOyBwIDwgcGFzc0NvdW50OyBwKyspIHtcblxuICAgICAgICAgICAgY29uc3QgcmVuZGVyUGFzcyA9IHJlbmRlclBhc3Nlc1twXTtcbiAgICAgICAgICAgIGNvbnN0IHJlbmRlckFjdGlvbnMgPSByZW5kZXJQYXNzLnJlbmRlckFjdGlvbnM7XG4gICAgICAgICAgICBpZiAocmVuZGVyQWN0aW9ucykge1xuXG4gICAgICAgICAgICAgICAgLy8gcHJvY2VzcyBhbGwgcmVuZGVyIGFjdGlvbnNcbiAgICAgICAgICAgICAgICBjb25zdCBjb3VudCA9IHJlbmRlckFjdGlvbnMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByYSA9IHJlbmRlckFjdGlvbnNbaV07XG4gICAgICAgICAgICAgICAgICAgIHJhLmxpZ2h0Q2x1c3RlcnMgPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBsYXllciBoYXMgbGlnaHRzIHVzZWQgYnkgY2x1c3RlcnMsIGFuZCBtZXNoZXNcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSByYS5sYXllcjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxheWVyLmhhc0NsdXN0ZXJlZExpZ2h0cyAmJiBsYXllci5tZXNoSW5zdGFuY2VzLmxlbmd0aCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB1c2UgZXhpc3RpbmcgY2x1c3RlcnMgaWYgdGhlIGxpZ2h0cyBvbiB0aGUgbGF5ZXIgYXJlIHRoZSBzYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNoID0gbGF5ZXIuZ2V0TGlnaHRJZEhhc2goKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nUmVuZGVyQWN0aW9uID0gdGhpcy5fY2x1c3RlcnMuZ2V0KGhhc2gpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNsdXN0ZXJzID0gZXhpc3RpbmdSZW5kZXJBY3Rpb24/LmxpZ2h0Q2x1c3RlcnM7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vIG1hdGNoLCBuZWVkcyBuZXcgY2x1c3RlcnNcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY2x1c3RlcnMpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVzZSBhbHJlYWR5IGFsbG9jYXRlZCBjbHVzdGVyIGZyb20gbGFzdCBmcmFtZSwgb3IgY3JlYXRlIGEgbmV3IG9uZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsdXN0ZXJzID0gdGVtcENsdXN0ZXJBcnJheS5wb3AoKSA/PyBuZXcgV29ybGRDbHVzdGVycyh0aGlzLmRldmljZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVidWdIZWxwZXIuc2V0TmFtZShjbHVzdGVycywgYENsdXN0ZXItJHt0aGlzLl9hbGxvY2F0ZWQubGVuZ3RofWApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWxsb2NhdGVkLnB1c2goY2x1c3RlcnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NsdXN0ZXJzLnNldChoYXNoLCByYSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJhLmxpZ2h0Q2x1c3RlcnMgPSBjbHVzdGVycztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIG5vIGNsdXN0ZXJlZCBsaWdodHMsIHVzZSB0aGUgY2x1c3RlciB3aXRoIG5vIGxpZ2h0c1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXJhLmxpZ2h0Q2x1c3RlcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhLmxpZ2h0Q2x1c3RlcnMgPSBlbXB0eTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGRlbGV0ZSBsZWZ0b3ZlcnNcbiAgICAgICAgdGVtcENsdXN0ZXJBcnJheS5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5kZXN0cm95KCkpO1xuICAgICAgICB0ZW1wQ2x1c3RlckFycmF5Lmxlbmd0aCA9IDA7XG4gICAgfVxuXG4gICAgdXBkYXRlKHJlbmRlclBhc3NlcywgZ2FtbWFDb3JyZWN0aW9uLCBsaWdodGluZykge1xuXG4gICAgICAgIC8vIGFzc2lnbiBjbHVzdGVycyB0byByZW5kZXIgYWN0aW9uc1xuICAgICAgICB0aGlzLmFzc2lnbihyZW5kZXJQYXNzZXMpO1xuXG4gICAgICAgIC8vIHVwZGF0ZSBhbGwgdW5pcXVlIGNsdXN0ZXJzXG4gICAgICAgIHRoaXMuX2NsdXN0ZXJzLmZvckVhY2goKHJlbmRlckFjdGlvbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSByZW5kZXJBY3Rpb24ubGF5ZXI7XG4gICAgICAgICAgICBjb25zdCBjbHVzdGVyID0gcmVuZGVyQWN0aW9uLmxpZ2h0Q2x1c3RlcnM7XG4gICAgICAgICAgICBjbHVzdGVyLnVwZGF0ZShsYXllci5jbHVzdGVyZWRMaWdodHNTZXQsIGdhbW1hQ29ycmVjdGlvbiwgbGlnaHRpbmcpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IFdvcmxkQ2x1c3RlcnNBbGxvY2F0b3IgfTtcbiJdLCJuYW1lcyI6WyJ0ZW1wQ2x1c3RlckFycmF5IiwiV29ybGRDbHVzdGVyc0FsbG9jYXRvciIsImNvbnN0cnVjdG9yIiwiZ3JhcGhpY3NEZXZpY2UiLCJfZW1wdHkiLCJfYWxsb2NhdGVkIiwiX2NsdXN0ZXJzIiwiTWFwIiwiZGV2aWNlIiwiZGVzdHJveSIsImZvckVhY2giLCJjbHVzdGVyIiwibGVuZ3RoIiwiY291bnQiLCJlbXB0eSIsIldvcmxkQ2x1c3RlcnMiLCJuYW1lIiwidXBkYXRlIiwiYXNzaWduIiwicmVuZGVyUGFzc2VzIiwicHVzaCIsImNsZWFyIiwicGFzc0NvdW50IiwicCIsInJlbmRlclBhc3MiLCJyZW5kZXJBY3Rpb25zIiwiaSIsInJhIiwibGlnaHRDbHVzdGVycyIsImxheWVyIiwiaGFzQ2x1c3RlcmVkTGlnaHRzIiwibWVzaEluc3RhbmNlcyIsImhhc2giLCJnZXRMaWdodElkSGFzaCIsImV4aXN0aW5nUmVuZGVyQWN0aW9uIiwiZ2V0IiwiY2x1c3RlcnMiLCJfdGVtcENsdXN0ZXJBcnJheSRwb3AiLCJwb3AiLCJEZWJ1Z0hlbHBlciIsInNldE5hbWUiLCJzZXQiLCJpdGVtIiwiZ2FtbWFDb3JyZWN0aW9uIiwibGlnaHRpbmciLCJyZW5kZXJBY3Rpb24iLCJjbHVzdGVyZWRMaWdodHNTZXQiXSwibWFwcGluZ3MiOiI7OztBQUdBLE1BQU1BLGdCQUFnQixHQUFHLEVBQUUsQ0FBQTs7QUFFM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUMsc0JBQXNCLENBQUM7QUF1QnpCO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNJQyxXQUFXQSxDQUFDQyxjQUFjLEVBQUU7QUE1QjVCO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7SUFKSSxJQUtBQyxDQUFBQSxNQUFNLEdBQUcsSUFBSSxDQUFBO0FBRWI7QUFDSjtBQUNBO0FBQ0E7QUFDQTtJQUpJLElBS0FDLENBQUFBLFVBQVUsR0FBRyxFQUFFLENBQUE7QUFFZjtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMSSxJQUFBLElBQUEsQ0FNQUMsU0FBUyxHQUFHLElBQUlDLEdBQUcsRUFBRSxDQUFBO0lBU2pCLElBQUksQ0FBQ0MsTUFBTSxHQUFHTCxjQUFjLENBQUE7QUFDaEMsR0FBQTtBQUVBTSxFQUFBQSxPQUFPQSxHQUFHO0FBRU47SUFDQSxJQUFJLElBQUksQ0FBQ0wsTUFBTSxFQUFFO0FBQ2IsTUFBQSxJQUFJLENBQUNBLE1BQU0sQ0FBQ0ssT0FBTyxFQUFFLENBQUE7TUFDckIsSUFBSSxDQUFDTCxNQUFNLEdBQUcsSUFBSSxDQUFBO0FBQ3RCLEtBQUE7O0FBRUE7QUFDQSxJQUFBLElBQUksQ0FBQ0MsVUFBVSxDQUFDSyxPQUFPLENBQUVDLE9BQU8sSUFBSztNQUNqQ0EsT0FBTyxDQUFDRixPQUFPLEVBQUUsQ0FBQTtBQUNyQixLQUFDLENBQUMsQ0FBQTtBQUNGLElBQUEsSUFBSSxDQUFDSixVQUFV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
