import { math } from '../../core/math/math.js';
import { ShadowMap } from './shadow-map.js';
import { LIGHTTYPE_SPOT, LIGHTTYPE_OMNI } from '../constants.js';
import { RenderPassShadowLocalNonClustered } from './render-pass-shadow-local-non-clustered.js';

/**
 * @ignore
 */
class ShadowRendererLocal {
  constructor(renderer, shadowRenderer) {
    // temporary list to collect lights to render shadows for
    this.shadowLights = [];
    /** @type {import('./renderer.js').Renderer} */
    this.renderer = void 0;
    /** @type {import('./shadow-renderer.js').ShadowRenderer} */
    this.shadowRenderer = void 0;
    /** @type {import('../../platform/graphics/graphics-device.js').GraphicsDevice} */
    this.device = void 0;
    this.renderer = renderer;
    this.shadowRenderer = shadowRenderer;
    this.device = renderer.device;
  }

  // cull local shadow map
  cull(light, comp, casters = null) {
    const isClustered = this.renderer.scene.clusteredLightingEnabled;

    // force light visibility if function was manually called
    light.visibleThisFrame = true;

    // allocate shadow map unless in clustered lighting mode
    if (!isClustered) {
      if (!light._shadowMap) {
        light._shadowMap = ShadowMap.create(this.device, light);
      }
    }
    const type = light._type;
    const faceCount = type === LIGHTTYPE_SPOT ? 1 : 6;
    for (let face = 0; face < faceCount; face++) {
      // render data are shared between cameras for local lights, so pass null for camera
      const lightRenderData = light.getRenderData(null, face);
      const shadowCam = lightRenderData.shadowCamera;
      shadowCam.nearClip = light.attenuationEnd / 1000;
      shadowCam.farClip = light.attenuationEnd;
      lightRenderData.depthRangeCompensation = shadowCam.farClip - shadowCam.nearClip;
      const shadowCamNode = shadowCam._node;
      const lightNode = light._node;
      shadowCamNode.setPosition(lightNode.getPosition());
      if (type === LIGHTTYPE_SPOT) {
        shadowCam.fov = light._outerConeAngle * 2;

        // Camera looks down the negative Z, and spot light points down the negative Y
        shadowCamNode.setRotation(lightNode.getRotation());
        shadowCamNode.rotateLocal(-90, 0, 0);
      } else if (type === LIGHTTYPE_OMNI) {
        // when rendering omni shadows to an atlas, use larger fov by few pixels to allow shadow filtering to stay on a single face
        if (isClustered) {
          const tileSize = this.shadowRenderer.lightTextureAtlas.shadowAtlasResolution * light.atlasViewport.z / 3; // using 3x3 for cubemap
          const texelSize = 2 / tileSize;
          const filterSize = texelSize * this.shadowRenderer.lightTextureAtlas.shadowEdgePixels;
          shadowCam.fov = Math.atan(1 + filterSize) * math.RAD_TO_DEG * 2;
        } else {
          shadowCam.fov = 90;
        }
      }

      // cull shadow casters
      this.renderer.updateCameraFrustum(shadowCam);
      this.shadowRenderer.cullShadowCasters(comp, light, lightRenderData.visibleCasters, shadowCam, casters);
    }
  }
  prepareLights(shadowLights, lights) {
    let shadowCamera;
    for (let i = 0; i < lights.length; i++) {
      const light = lights[i];
      if (this.shadowRenderer.needsShadowRendering(light) && light.atlasViewportAllocated) {
        shadowLights.push(light);
        for (let face = 0; face < light.numShadowFaces; face++) {
          shadowCamera = this.shadowRenderer.prepareFace(light, null, face);
        }
      }
    }
    return shadowCamera;
  }

  /**
   * Prepare render passes for rendering of shadows for local non-clustered lights. Each shadow face
   * is a separate render pass as it renders to a separate render target.
   */
  buildNonClusteredRenderPasses(frameGraph, localLights) {
    for (let i = 0; i < localLights.length; i++) {
      const light = localLights[i];
      if (this.shadowRenderer.needsShadowRendering(light)) {
        // only spot lights support VSM
        const applyVsm = light._type === LIGHTTYPE_SPOT;

        // create render pass per face
        const faceCount = light.numShadowFaces;
        for (let face = 0; face < faceCount; face++) {
          const renderPass = new RenderPassShadowLocalNonClustered(this.device, this.shadowRenderer, light, face, applyVsm);
          frameGraph.addRenderPass(renderPass);
        }
      }
    }
  }
}

export { ShadowRendererLocal };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhZG93LXJlbmRlcmVyLWxvY2FsLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvc2NlbmUvcmVuZGVyZXIvc2hhZG93LXJlbmRlcmVyLWxvY2FsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG1hdGggfSBmcm9tICcuLi8uLi9jb3JlL21hdGgvbWF0aC5qcyc7XG5cbmltcG9ydCB7IFNoYWRvd01hcCB9IGZyb20gJy4vc2hhZG93LW1hcC5qcyc7XG5pbXBvcnQge1xuICAgIExJR0hUVFlQRV9PTU5JLCBMSUdIVFRZUEVfU1BPVFxufSBmcm9tICcuLi9jb25zdGFudHMuanMnO1xuXG5pbXBvcnQgeyBSZW5kZXJQYXNzU2hhZG93TG9jYWxOb25DbHVzdGVyZWQgfSBmcm9tICcuL3JlbmRlci1wYXNzLXNoYWRvdy1sb2NhbC1ub24tY2x1c3RlcmVkLmpzJztcblxuLyoqXG4gKiBAaWdub3JlXG4gKi9cbmNsYXNzIFNoYWRvd1JlbmRlcmVyTG9jYWwge1xuICAgIC8vIHRlbXBvcmFyeSBsaXN0IHRvIGNvbGxlY3QgbGlnaHRzIHRvIHJlbmRlciBzaGFkb3dzIGZvclxuICAgIHNoYWRvd0xpZ2h0cyA9IFtdO1xuXG4gICAgLyoqIEB0eXBlIHtpbXBvcnQoJy4vcmVuZGVyZXIuanMnKS5SZW5kZXJlcn0gKi9cbiAgICByZW5kZXJlcjtcblxuICAgIC8qKiBAdHlwZSB7aW1wb3J0KCcuL3NoYWRvdy1yZW5kZXJlci5qcycpLlNoYWRvd1JlbmRlcmVyfSAqL1xuICAgIHNoYWRvd1JlbmRlcmVyO1xuXG4gICAgLyoqIEB0eXBlIHtpbXBvcnQoJy4uLy4uL3BsYXRmb3JtL2dyYXBoaWNzL2dyYXBoaWNzLWRldmljZS5qcycpLkdyYXBoaWNzRGV2aWNlfSAqL1xuICAgIGRldmljZTtcblxuICAgIGNvbnN0cnVjdG9yKHJlbmRlcmVyLCBzaGFkb3dSZW5kZXJlcikge1xuICAgICAgICB0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgICAgIHRoaXMuc2hhZG93UmVuZGVyZXIgPSBzaGFkb3dSZW5kZXJlcjtcbiAgICAgICAgdGhpcy5kZXZpY2UgPSByZW5kZXJlci5kZXZpY2U7XG4gICAgfVxuXG4gICAgLy8gY3VsbCBsb2NhbCBzaGFkb3cgbWFwXG4gICAgY3VsbChsaWdodCwgY29tcCwgY2FzdGVycyA9IG51bGwpIHtcblxuICAgICAgICBjb25zdCBpc0NsdXN0ZXJlZCA9IHRoaXMucmVuZGVyZXIuc2NlbmUuY2x1c3RlcmVkTGlnaHRpbmdFbmFibGVkO1xuXG4gICAgICAgIC8vIGZvcmNlIGxpZ2h0IHZpc2liaWxpdHkgaWYgZnVuY3Rpb24gd2FzIG1hbnVhbGx5IGNhbGxlZFxuICAgICAgICBsaWdodC52aXNpYmxlVGhpc0ZyYW1lID0gdHJ1ZTtcblxuICAgICAgICAvLyBhbGxvY2F0ZSBzaGFkb3cgbWFwIHVubGVzcyBpbiBjbHVzdGVyZWQgbGlnaHRpbmcgbW9kZVxuICAgICAgICBpZiAoIWlzQ2x1c3RlcmVkKSB7XG4gICAgICAgICAgICBpZiAoIWxpZ2h0Ll9zaGFkb3dNYXApIHtcbiAgICAgICAgICAgICAgICBsaWdodC5fc2hhZG93TWFwID0gU2hhZG93TWFwLmNyZWF0ZSh0aGlzLmRldmljZSwgbGlnaHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgdHlwZSA9IGxpZ2h0Ll90eXBlO1xuICAgICAgICBjb25zdCBmYWNlQ291bnQgPSB0eXBlID09PSBMSUdIVFRZUEVfU1BPVCA/IDEgOiA2O1xuXG4gICAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgZmFjZUNvdW50OyBmYWNlKyspIHtcblxuICAgICAgICAgICAgLy8gcmVuZGVyIGRhdGEgYXJlIHNoYXJlZCBiZXR3ZWVuIGNhbWVyYXMgZm9yIGxvY2FsIGxpZ2h0cywgc28gcGFzcyBudWxsIGZvciBjYW1lcmFcbiAgICAgICAgICAgIGNvbnN0IGxpZ2h0UmVuZGVyRGF0YSA9IGxpZ2h0LmdldFJlbmRlckRhdGEobnVsbCwgZmFjZSk7XG4gICAgICAgICAgICBjb25zdCBzaGFkb3dDYW0gPSBsaWdodFJlbmRlckRhdGEuc2hhZG93Q2FtZXJhO1xuXG4gICAgICAgICAgICBzaGFkb3dDYW0ubmVhckNsaXAgPSBsaWdodC5hdHRlbnVhdGlvbkVuZCAvIDEwMDA7XG4gICAgICAgICAgICBzaGFkb3dDYW0uZmFyQ2xpcCA9IGxpZ2h0LmF0dGVudWF0aW9uRW5kO1xuXG4gICAgICAgICAgICBsaWdodFJlbmRlckRhdGEuZGVwdGhSYW5nZUNvbXBlbnNhdGlvbiA9IHNoYWRvd0NhbS5mYXJDbGlwIC0gc2hhZG93Q2FtLm5lYXJDbGlwO1xuXG4gICAgICAgICAgICBjb25zdCBzaGFkb3dDYW1Ob2RlID0gc2hhZG93Q2FtLl9ub2RlO1xuICAgICAgICAgICAgY29uc3QgbGlnaHROb2RlID0gbGlnaHQuX25vZGU7XG4gICAgICAgICAgICBzaGFkb3dDYW1Ob2RlLnNldFBvc2l0aW9uKGxpZ2h0Tm9kZS5nZXRQb3NpdGlvbigpKTtcblxuICAgICAgICAgICAgaWYgKHR5cGUgPT09IExJR0hUVFlQRV9TUE9UKSB7XG4gICAgICAgICAgICAgICAgc2hhZG93Q2FtLmZvdiA9IGxpZ2h0Ll9vdXRlckNvbmVBbmdsZSAqIDI7XG5cbiAgICAgICAgICAgICAgICAvLyBDYW1lcmEgbG9va3MgZG93biB0aGUgbmVnYXRpdmUgWiwgYW5kIHNwb3QgbGlnaHQgcG9pbnRzIGRvd24gdGhlIG5lZ2F0aXZlIFlcbiAgICAgICAgICAgICAgICBzaGFkb3dDYW1Ob2RlLnNldFJvdGF0aW9uKGxpZ2h0Tm9kZS5nZXRSb3RhdGlvbigpKTtcbiAgICAgICAgICAgICAgICBzaGFkb3dDYW1Ob2RlLnJvdGF0ZUxvY2FsKC05MCwgMCwgMCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gTElHSFRUWVBFX09NTkkpIHtcblxuICAgICAgICAgICAgICAgIC8vIHdoZW4gcmVuZGVyaW5nIG9tbmkgc2hhZG93cyB0byBhbiBhdGxhcywgdXNlIGxhcmdlciBmb3YgYnkgZmV3IHBpeGVscyB0byBhbGxvdyBzaGFkb3cgZmlsdGVyaW5nIHRvIHN0YXkgb24gYSBzaW5nbGUgZmFjZVxuICAgICAgICAgICAgICAgIGlmIChpc0NsdXN0ZXJlZCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0aWxlU2l6ZSA9IHRoaXMuc2hhZG93UmVuZGVyZXIubGlnaHRUZXh0dXJlQXRsYXMuc2hhZG93QXRsYXNSZXNvbHV0aW9uICogbGlnaHQuYXRsYXNWaWV3cG9ydC56IC8gMzsgICAgLy8gdXNpbmcgM3gzIGZvciBjdWJlbWFwXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRleGVsU2l6ZSA9IDIgLyB0aWxlU2l6ZTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsdGVyU2l6ZSA9IHRleGVsU2l6ZSAqIHRoaXMuc2hhZG93UmVuZGVyZXIubGlnaHRUZXh0dXJlQXRsYXMuc2hhZG93RWRnZVBpeGVscztcbiAgICAgICAgICAgICAgICAgICAgc2hhZG93Q2FtLmZvdiA9IE1hdGguYXRhbigxICsgZmlsdGVyU2l6ZSkgKiBtYXRoLlJBRF9UT19ERUcgKiAyO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNoYWRvd0NhbS5mb3YgPSA5MDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGN1bGwgc2hhZG93IGNhc3RlcnNcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIudXBkYXRlQ2FtZXJhRnJ1c3R1bShzaGFkb3dDYW0pO1xuICAgICAgICAgICAgdGhpcy5zaGFkb3dSZW5kZXJlci5jdWxsU2hhZG93Q2FzdGVycyhjb21wLCBsaWdodCwgbGlnaHRSZW5kZXJEYXRhLnZpc2libGVDYXN0ZXJzLCBzaGFkb3dDYW0sIGNhc3RlcnMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJlcGFyZUxpZ2h0cyhzaGFkb3dMaWdodHMsIGxpZ2h0cykge1xuXG4gICAgICAgIGxldCBzaGFkb3dDYW1lcmE7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGlnaHRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBsaWdodCA9IGxpZ2h0c1tpXTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuc2hhZG93UmVuZGVyZXIubmVlZHNTaGFkb3dSZW5kZXJpbmcobGlnaHQpICYmIGxpZ2h0LmF0bGFzVmlld3BvcnRBbGxvY2F0ZWQpIHtcblxuICAgICAgICAgICAgICAgIHNoYWRvd0xpZ2h0cy5wdXNoKGxpZ2h0KTtcblxuICAgICAgICAgICAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgbGlnaHQubnVtU2hhZG93RmFjZXM7IGZhY2UrKykge1xuICAgICAgICAgICAgICAgICAgICBzaGFkb3dDYW1lcmEgPSB0aGlzLnNoYWRvd1JlbmRlcmVyLnByZXBhcmVGYWNlKGxpZ2h0LCBudWxsLCBmYWNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc2hhZG93Q2FtZXJhO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFByZXBhcmUgcmVuZGVyIHBhc3NlcyBmb3IgcmVuZGVyaW5nIG9mIHNoYWRvd3MgZm9yIGxvY2FsIG5vbi1jbHVzdGVyZWQgbGlnaHRzLiBFYWNoIHNoYWRvdyBmYWNlXG4gICAgICogaXMgYSBzZXBhcmF0ZSByZW5kZXIgcGFzcyBhcyBpdCByZW5kZXJzIHRvIGEgc2VwYXJhdGUgcmVuZGVyIHRhcmdldC5cbiAgICAgKi9cbiAgICBidWlsZE5vbkNsdXN0ZXJlZFJlbmRlclBhc3NlcyhmcmFtZUdyYXBoLCBsb2NhbExpZ2h0cykge1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbG9jYWxMaWdodHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGxpZ2h0ID0gbG9jYWxMaWdodHNbaV07XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnNoYWRvd1JlbmRlcmVyLm5lZWRzU2hhZG93UmVuZGVyaW5nKGxpZ2h0KSkge1xuXG4gICAgICAgICAgICAgICAgLy8gb25seSBzcG90IGxpZ2h0cyBzdXBwb3J0IFZTTVxuICAgICAgICAgICAgICAgIGNvbnN0IGFwcGx5VnNtID0gbGlnaHQuX3R5cGUgPT09IExJR0hUVFlQRV9TUE9UO1xuXG4gICAgICAgICAgICAgICAgLy8gY3JlYXRlIHJlbmRlciBwYXNzIHBlciBmYWNlXG4gICAgICAgICAgICAgICAgY29uc3QgZmFjZUNvdW50ID0gbGlnaHQubnVtU2hhZG93RmFjZXM7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgZmFjZSA9IDA7IGZhY2UgPCBmYWNlQ291bnQ7IGZhY2UrKykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByZW5kZXJQYXNzID0gbmV3IFJlbmRlclBhc3NTaGFkb3dMb2NhbE5vbkNsdXN0ZXJlZCh0aGlzLmRldmljZSwgdGhpcy5zaGFkb3dSZW5kZXJlciwgbGlnaHQsIGZhY2UsIGFwcGx5VnNtKTtcbiAgICAgICAgICAgICAgICAgICAgZnJhbWVHcmFwaC5hZGRSZW5kZXJQYXNzKHJlbmRlclBhc3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IHsgU2hhZG93UmVuZGVyZXJMb2NhbCB9O1xuIl0sIm5hbWVzIjpbIlNoYWRvd1JlbmRlcmVyTG9jYWwiLCJjb25zdHJ1Y3RvciIsInJlbmRlcmVyIiwic2hhZG93UmVuZGVyZXIiLCJzaGFkb3dMaWdodHMiLCJkZXZpY2UiLCJjdWxsIiwibGlnaHQiLCJjb21wIiwiY2FzdGVycyIsImlzQ2x1c3RlcmVkIiwic2NlbmUiLCJjbHVzdGVyZWRMaWdodGluZ0VuYWJsZWQiLCJ2aXNpYmxlVGhpc0ZyYW1lIiwiX3NoYWRvd01hcCIsIlNoYWRvd01hcCIsImNyZWF0ZSIsInR5cGUiLCJfdHlwZSIsImZhY2VDb3VudCIsIkxJR0hUVFlQRV9TUE9UIiwiZmFjZSIsImxpZ2h0UmVuZGVyRGF0YSIsImdldFJlbmRlckRhdGEiLCJzaGFkb3dDYW0iLCJzaGFkb3dDYW1lcmEiLCJuZWFyQ2xpcCIsImF0dGVudWF0aW9uRW5kIiwiZmFyQ2xpcCIsImRlcHRoUmFuZ2VDb21wZW5zYXRpb24iLCJzaGFkb3dDYW1Ob2RlIiwiX25vZGUiLCJsaWdodE5vZGUiLCJzZXRQb3NpdGlvbiIsImdldFBvc2l0aW9uIiwiZm92IiwiX291dGVyQ29uZUFuZ2xlIiwic2V0Um90YXRpb24iLCJnZXRSb3RhdGlvbiIsInJvdGF0ZUxvY2FsIiwiTElHSFRUWVBFX09NTkkiLCJ0aWxlU2l6ZSIsImxpZ2h0VGV4dHVyZUF0bGFzIiwic2hhZG93QXRsYXNSZXNvbHV0aW9uIiwiYXRsYXNWaWV3cG9ydCIsInoiLCJ0ZXhlbFNpemUiLCJmaWx0ZXJTaXplIiwic2hhZG93RWRnZVBpeGVscyIsIk1hdGgiLCJhdGFuIiwibWF0aCIsIlJBRF9UT19ERUciLCJ1cGRhdGVDYW1lcmFGcnVzdHVtIiwiY3VsbFNoYWRvd0Nhc3RlcnMiLCJ2aXNpYmxlQ2FzdGVycyIsInByZXBhcmVMaWdodHMiLCJsaWdodHMiLCJpIiwibGVuZ3RoIiwibmVlZHNTaGFkb3dSZW5kZXJpbmciLCJhdGxhc1ZpZXdwb3J0QWxsb2NhdGVkIiwicHVzaCIsIm51bVNoYWRvd0ZhY2VzIiwicHJlcGFyZUZhY2UiLCJidWlsZE5vbkNsdXN0ZXJlZFJlbmRlclBhc3NlcyIsImZyYW1lR3JhcGgiLCJsb2NhbExpZ2h0cyIsImFwcGx5VnNtIiwicmVuZGVyUGFzcyIsIlJlbmRlclBhc3NTaGFkb3dMb2NhbE5vbkNsdXN0ZXJlZCIsImFkZFJlbmRlclBhc3MiXSwibWFwcGluZ3MiOiI7Ozs7O0FBU0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUEsbUJBQW1CLENBQUM7QUFhdEJDLEVBQUFBLFdBQVdBLENBQUNDLFFBQVEsRUFBRUMsY0FBYyxFQUFFO0FBWnRDO0lBQUEsSUFDQUMsQ0FBQUEsWUFBWSxHQUFHLEVBQUUsQ0FBQTtBQUVqQjtBQUFBLElBQUEsSUFB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
