import { PIXELFORMAT_RGBA32F, PIXELFORMAT_RGBA16F, PIXELFORMAT_DEPTH, PIXELFORMAT_R32F, PIXELFORMAT_RGBA8, FILTER_NEAREST, FILTER_LINEAR, TEXHINT_SHADOWMAP, ADDRESS_CLAMP_TO_EDGE, FUNC_LESS } from '../../platform/graphics/constants.js';
import { RenderTarget } from '../../platform/graphics/render-target.js';
import { Texture } from '../../platform/graphics/texture.js';
import { SHADOW_VSM32, SHADOW_VSM16, SHADOW_PCF5, SHADOW_PCF1, SHADOW_PCF3, SHADOW_PCSS, LIGHTTYPE_OMNI } from '../constants.js';

class ShadowMap {
  constructor(texture, targets) {
    // the actual texture buffer that is shared by shadow map render targets
    this.texture = texture;

    // set to true if the shadow map is owned by the shadow map cache
    this.cached = false;

    // an array of render targets:
    // 1 for directional and spot light
    // 6 for omni light
    this.renderTargets = targets;
  }
  destroy() {
    // single texture is shared by all render targets, destroy it once
    if (this.texture) {
      this.texture.destroy();
      this.texture = null;
    }
    const targets = this.renderTargets;
    for (let i = 0; i < targets.length; i++) {
      targets[i].destroy();
    }
    this.renderTargets.length = 0;
  }
  static getShadowFormat(device, shadowType) {
    if (shadowType === SHADOW_VSM32) {
      return PIXELFORMAT_RGBA32F;
    } else if (shadowType === SHADOW_VSM16) {
      return PIXELFORMAT_RGBA16F;
    } else if (shadowType === SHADOW_PCF5) {
      return PIXELFORMAT_DEPTH;
    } else if ((shadowType === SHADOW_PCF1 || shadowType === SHADOW_PCF3) && device.supportsDepthShadow) {
      return PIXELFORMAT_DEPTH;
    } else if (shadowType === SHADOW_PCSS && !device.isWebGL1) {
      return PIXELFORMAT_R32F;
    }
    return PIXELFORMAT_RGBA8;
  }
  static getShadowFiltering(device, shadowType) {
    if ((shadowType === SHADOW_PCF1 || shadowType === SHADOW_PCF3 || shadowType === SHADOW_PCSS) && !device.supportsDepthShadow) {
      return FILTER_NEAREST;
    } else if (shadowType === SHADOW_VSM32) {
      return device.extTextureFloatLinear ? FILTER_LINEAR : FILTER_NEAREST;
    } else if (shadowType === SHADOW_VSM16) {
      return device.extTextureHalfFloatLinear ? FILTER_LINEAR : FILTER_NEAREST;
    }
    return FILTER_LINEAR;
  }
  static create(device, light) {
    let shadowMap = null;
    if (light._type === LIGHTTYPE_OMNI) {
      shadowMap = this.createCubemap(device, light._shadowResolution, light._shadowType);
    } else {
      shadowMap = this.create2dMap(device, light._shadowResolution, light._shadowType);
    }
    return shadowMap;
  }

  // creates a shadow map which is used by the light texture atlas for clustered lighting
  static createAtlas(device, resolution, shadowType) {
    const shadowMap = this.create2dMap(device, resolution, shadowType);

    // copy the target 5 more times to allow unified access for point light faces
    const targets = shadowMap.renderTargets;
    const rt = targets[0];
    for (let i = 0; i < 5; i++) {
      targets.push(rt);
    }
    return shadowMap;
  }
  static create2dMap(device, size, shadowType) {
    const format = this.getShadowFormat(device, shadowType);
    const filter = this.getShadowFiltering(device, shadowType);
    const texture = new Texture(device, {
      profilerHint: TEXHINT_SHADOWMAP,
      format: format,
      width: size,
      height: size,
      mipmaps: false,
      minFilter: filter,
      magFilter: filter,
      addressU: ADDRESS_CLAMP_TO_EDGE,
      addressV: ADDRESS_CLAMP_TO_EDGE,
      name: 'ShadowMap2D'
    });
    let target = null;
    if (shadowType === SHADOW_PCF5 || (shadowType === SHADOW_PCF1 || shadowType === SHADOW_PCF3) && device.supportsDepthShadow) {
      // enable hardware PCF when sampling the depth texture
      texture.compareOnRead = true;
      texture.compareFunc = FUNC_LESS;

      // depthbuffer only
      target = new RenderTarget({
        depthBuffer: texture
      });
    } else {
      // encoded rgba depth
      target = new RenderTarget({
        colorBuffer: texture,
        depth: true
      });
    }

    // TODO: this is temporary, and will be handle on generic level for all render targets for WebGPU
    if (device.isWebGPU) {
      target.flipY = true;
    }
    return new ShadowMap(texture, [target]);
  }
  static createCubemap(device, size, shadowType) {
    const format = shadowType === SHADOW_PCSS && !device.isWebGL1 ? PIXELFORMAT_R32F : PIXELFORMAT_RGBA8;
    const cubemap = new Texture(device, {
      profilerHint: TEXHINT_SHADOWMAP,
      format: format,
      width: size,
      height: size,
      cubemap: true,
      mipmaps: false,
      minFilter: FILTER_NEAREST,
      magFilter: FILTER_NEAREST,
      addressU: ADDRESS_CLAMP_TO_EDGE,
      addressV: ADDRESS_CLAMP_TO_EDGE,
      name: 'ShadowMapCube'
    });
    const targets = [];
    for (let i = 0; i < 6; i++) {
      const target = new RenderTarget({
        colorBuffer: cubemap,
        face: i,
        depth: true
      });
      targets.push(target);
    }
    return new ShadowMap(cubemap, targets);
  }
}

export { ShadowMap };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhZG93LW1hcC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL3NjZW5lL3JlbmRlcmVyL3NoYWRvdy1tYXAuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBBRERSRVNTX0NMQU1QX1RPX0VER0UsXG4gICAgRklMVEVSX0xJTkVBUiwgRklMVEVSX05FQVJFU1QsXG4gICAgRlVOQ19MRVNTLFxuICAgIFBJWEVMRk9STUFUX0RFUFRILCBQSVhFTEZPUk1BVF9SR0JBOCwgUElYRUxGT1JNQVRfUkdCQTE2RiwgUElYRUxGT1JNQVRfUkdCQTMyRixcbiAgICBURVhISU5UX1NIQURPV01BUCxcbiAgICBQSVhFTEZPUk1BVF9SMzJGXG59IGZyb20gJy4uLy4uL3BsYXRmb3JtL2dyYXBoaWNzL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgeyBSZW5kZXJUYXJnZXQgfSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9yZW5kZXItdGFyZ2V0LmpzJztcbmltcG9ydCB7IFRleHR1cmUgfSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy90ZXh0dXJlLmpzJztcblxuaW1wb3J0IHtcbiAgICBMSUdIVFRZUEVfT01OSSxcbiAgICBTSEFET1dfUENGMSwgU0hBRE9XX1BDRjMsIFNIQURPV19QQ0Y1LCBTSEFET1dfVlNNMTYsIFNIQURPV19WU00zMiwgU0hBRE9XX1BDU1Ncbn0gZnJvbSAnLi4vY29uc3RhbnRzLmpzJztcblxuXG5jbGFzcyBTaGFkb3dNYXAge1xuICAgIGNvbnN0cnVjdG9yKHRleHR1cmUsIHRhcmdldHMpIHtcblxuICAgICAgICAvLyB0aGUgYWN0dWFsIHRleHR1cmUgYnVmZmVyIHRoYXQgaXMgc2hhcmVkIGJ5IHNoYWRvdyBtYXAgcmVuZGVyIHRhcmdldHNcbiAgICAgICAgdGhpcy50ZXh0dXJlID0gdGV4dHVyZTtcblxuICAgICAgICAvLyBzZXQgdG8gdHJ1ZSBpZiB0aGUgc2hhZG93IG1hcCBpcyBvd25lZCBieSB0aGUgc2hhZG93IG1hcCBjYWNoZVxuICAgICAgICB0aGlzLmNhY2hlZCA9IGZhbHNlO1xuXG4gICAgICAgIC8vIGFuIGFycmF5IG9mIHJlbmRlciB0YXJnZXRzOlxuICAgICAgICAvLyAxIGZvciBkaXJlY3Rpb25hbCBhbmQgc3BvdCBsaWdodFxuICAgICAgICAvLyA2IGZvciBvbW5pIGxpZ2h0XG4gICAgICAgIHRoaXMucmVuZGVyVGFyZ2V0cyA9IHRhcmdldHM7XG4gICAgfVxuXG4gICAgZGVzdHJveSgpIHtcblxuICAgICAgICAvLyBzaW5nbGUgdGV4dHVyZSBpcyBzaGFyZWQgYnkgYWxsIHJlbmRlciB0YXJnZXRzLCBkZXN0cm95IGl0IG9uY2VcbiAgICAgICAgaWYgKHRoaXMudGV4dHVyZSkge1xuICAgICAgICAgICAgdGhpcy50ZXh0dXJlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMudGV4dHVyZSA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB0YXJnZXRzID0gdGhpcy5yZW5kZXJUYXJnZXRzO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRhcmdldHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRhcmdldHNbaV0uZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucmVuZGVyVGFyZ2V0cy5sZW5ndGggPSAwO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRTaGFkb3dGb3JtYXQoZGV2aWNlLCBzaGFkb3dUeXBlKSB7XG4gICAgICAgIGlmIChzaGFkb3dUeXBlID09PSBTSEFET1dfVlNNMzIpIHtcbiAgICAgICAgICAgIHJldHVybiBQSVhFTEZPUk1BVF9SR0JBMzJGO1xuICAgICAgICB9IGVsc2UgaWYgKHNoYWRvd1R5cGUgPT09IFNIQURPV19WU00xNikge1xuICAgICAgICAgICAgcmV0dXJuIFBJWEVMRk9STUFUX1JHQkExNkY7XG4gICAgICAgIH0gZWxzZSBpZiAoc2hhZG93VHlwZSA9PT0gU0hBRE9XX1BDRjUpIHtcbiAgICAgICAgICAgIHJldHVybiBQSVhFTEZPUk1BVF9ERVBUSDtcbiAgICAgICAgfSBlbHNlIGlmICgoc2hhZG93VHlwZSA9PT0gU0hBRE9XX1BDRjEgfHwgc2hhZG93VHlwZSA9PT0gU0hBRE9XX1BDRjMpICYmIGRldmljZS5zdXBwb3J0c0RlcHRoU2hhZG93KSB7XG4gICAgICAgICAgICByZXR1cm4gUElYRUxGT1JNQVRfREVQVEg7XG4gICAgICAgIH0gZWxzZSBpZiAoKHNoYWRvd1R5cGUgPT09IFNIQURPV19QQ1NTKSAmJiAhZGV2aWNlLmlzV2ViR0wxKSB7XG4gICAgICAgICAgICByZXR1cm4gUElYRUxGT1JNQVRfUjMyRjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBQSVhFTEZPUk1BVF9SR0JBODtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0U2hhZG93RmlsdGVyaW5nKGRldmljZSwgc2hhZG93VHlwZSkge1xuICAgICAgICBpZiAoKHNoYWRvd1R5cGUgPT09IFNIQURPV19QQ0YxIHx8IHNoYWRvd1R5cGUgPT09IFNIQURPV19QQ0YzIHx8IHNoYWRvd1R5cGUgPT09IFNIQURPV19QQ1NTKSAmJiAhZGV2aWNlLnN1cHBvcnRzRGVwdGhTaGFkb3cpIHtcbiAgICAgICAgICAgIHJldHVybiBGSUxURVJfTkVBUkVTVDtcbiAgICAgICAgfSBlbHNlIGlmIChzaGFkb3dUeXBlID09PSBTSEFET1dfVlNNMzIpIHtcbiAgICAgICAgICAgIHJldHVybiBkZXZpY2UuZXh0VGV4dHVyZUZsb2F0TGluZWFyID8gRklMVEVSX0xJTkVBUiA6IEZJTFRFUl9ORUFSRVNUO1xuICAgICAgICB9IGVsc2UgaWYgKHNoYWRvd1R5cGUgPT09IFNIQURPV19WU00xNikge1xuICAgICAgICAgICAgcmV0dXJuIGRldmljZS5leHRUZXh0dXJlSGFsZkZsb2F0TGluZWFyID8gRklMVEVSX0xJTkVBUiA6IEZJTFRFUl9ORUFSRVNUO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBGSUxURVJfTElORUFSO1xuICAgIH1cblxuICAgIHN0YXRpYyBjcmVhdGUoZGV2aWNlLCBsaWdodCkge1xuXG4gICAgICAgIGxldCBzaGFkb3dNYXAgPSBudWxsO1xuICAgICAgICBpZiAobGlnaHQuX3R5cGUgPT09IExJR0hUVFlQRV9PTU5JKSB7XG4gICAgICAgICAgICBzaGFkb3dNYXAgPSB0aGlzLmNyZWF0ZUN1YmVtYXAoZGV2aWNlLCBsaWdodC5fc2hhZG93UmVzb2x1dGlvbiwgbGlnaHQuX3NoYWRvd1R5cGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2hhZG93TWFwID0gdGhpcy5jcmVhdGUyZE1hcChkZXZpY2UsIGxpZ2h0Ll9zaGFkb3dSZXNvbHV0aW9uLCBsaWdodC5fc2hhZG93VHlwZSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc2hhZG93TWFwO1xuICAgIH1cblxuICAgIC8vIGNyZWF0ZXMgYSBzaGFkb3cgbWFwIHdoaWNoIGlzIHVzZWQgYnkgdGhlIGxpZ2h0IHRleHR1cmUgYXRsYXMgZm9yIGNsdXN0ZXJlZCBsaWdodGluZ1xuICAgIHN0YXRpYyBjcmVhdGVBdGxhcyhkZXZpY2UsIHJlc29sdXRpb24sIHNoYWRvd1R5cGUpIHtcbiAgICAgICAgY29uc3Qgc2hhZG93TWFwID0gdGhpcy5jcmVhdGUyZE1hcChkZXZpY2UsIHJlc29sdXRpb24sIHNoYWRvd1R5cGUpO1xuXG4gICAgICAgIC8vIGNvcHkgdGhlIHRhcmdldCA1IG1vcmUgdGltZXMgdG8gYWxsb3cgdW5pZmllZCBhY2Nlc3MgZm9yIHBvaW50IGxpZ2h0IGZhY2VzXG4gICAgICAgIGNvbnN0IHRhcmdldHMgPSBzaGFkb3dNYXAucmVuZGVyVGFyZ2V0cztcbiAgICAgICAgY29uc3QgcnQgPSB0YXJnZXRzWzBdO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDU7IGkrKykge1xuICAgICAgICAgICAgdGFyZ2V0cy5wdXNoKHJ0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzaGFkb3dNYXA7XG4gICAgfVxuXG4gICAgc3RhdGljIGNyZWF0ZTJkTWFwKGRldmljZSwgc2l6ZSwgc2hhZG93VHlwZSkge1xuXG4gICAgICAgIGNvbnN0IGZvcm1hdCA9IHRoaXMuZ2V0U2hhZG93Rm9ybWF0KGRldmljZSwgc2hhZG93VHlwZSk7XG4gICAgICAgIGNvbnN0IGZpbHRlciA9IHRoaXMuZ2V0U2hhZG93RmlsdGVyaW5nKGRldmljZSwgc2hhZG93VHlwZSk7XG5cbiAgICAgICAgY29uc3QgdGV4dHVyZSA9IG5ldyBUZXh0dXJlKGRldmljZSwge1xuICAgICAgICAgICAgLy8gI2lmIF9QUk9GSUxFUlxuICAgICAgICAgICAgcHJvZmlsZXJIaW50OiBURVhISU5UX1NIQURPV01BUCxcbiAgICAgICAgICAgIC8vICNlbmRpZlxuICAgICAgICAgICAgZm9ybWF0OiBmb3JtYXQsXG4gICAgICAgICAgICB3aWR0aDogc2l6ZSxcbiAgICAgICAgICAgIGhlaWdodDogc2l6ZSxcbiAgICAgICAgICAgIG1pcG1hcHM6IGZhbHNlLFxuICAgICAgICAgICAgbWluRmlsdGVyOiBmaWx0ZXIsXG4gICAgICAgICAgICBtYWdGaWx0ZXI6IGZpbHRlcixcbiAgICAgICAgICAgIGFkZHJlc3NVOiBBRERSRVNTX0NMQU1QX1RPX0VER0UsXG4gICAgICAgICAgICBhZGRyZXNzVjogQUREUkVTU19DTEFNUF9UT19FREdFLFxuICAgICAgICAgICAgbmFtZTogJ1NoYWRvd01hcDJEJ1xuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgdGFyZ2V0ID0gbnVsbDtcbiAgICAgICAgaWYgKHNoYWRvd1R5cGUgPT09IFNIQURPV19QQ0Y1IHx8ICgoc2hhZG93VHlwZSA9PT0gU0hBRE9XX1BDRjEgfHwgc2hhZG93VHlwZSA9PT0gU0hBRE9XX1BDRjMpICYmIGRldmljZS5zdXBwb3J0c0RlcHRoU2hhZG93KSkge1xuXG4gICAgICAgICAgICAvLyBlbmFibGUgaGFyZHdhcmUgUENGIHdoZW4gc2FtcGxpbmcgdGhlIGRlcHRoIHRleHR1cmVcbiAgICAgICAgICAgIHRleHR1cmUuY29tcGFyZU9uUmVhZCA9IHRydWU7XG4gICAgICAgICAgICB0ZXh0dXJlLmNvbXBhcmVGdW5jID0gRlVOQ19MRVNTO1xuXG4gICAgICAgICAgICAvLyBkZXB0aGJ1ZmZlciBvbmx5XG4gICAgICAgICAgICB0YXJnZXQgPSBuZXcgUmVuZGVyVGFyZ2V0KHtcbiAgICAgICAgICAgICAgICBkZXB0aEJ1ZmZlcjogdGV4dHVyZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBlbmNvZGVkIHJnYmEgZGVwdGhcbiAgICAgICAgICAgIHRhcmdldCA9IG5ldyBSZW5kZXJUYXJnZXQoe1xuICAgICAgICAgICAgICAgIGNvbG9yQnVmZmVyOiB0ZXh0dXJlLFxuICAgICAgICAgICAgICAgIGRlcHRoOiB0cnVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFRPRE86IHRoaXMgaXMgdGVtcG9yYXJ5LCBhbmQgd2lsbCBiZSBoYW5kbGUgb24gZ2VuZXJpYyBsZXZlbCBmb3IgYWxsIHJlbmRlciB0YXJnZXRzIGZvciBXZWJHUFVcbiAgICAgICAgaWYgKGRldmljZS5pc1dlYkdQVSkge1xuICAgICAgICAgICAgdGFyZ2V0LmZsaXBZID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBuZXcgU2hhZG93TWFwKHRleHR1cmUsIFt0YXJnZXRdKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgY3JlYXRlQ3ViZW1hcChkZXZpY2UsIHNpemUsIHNoYWRvd1R5cGUpIHtcblxuICAgICAgICBjb25zdCBmb3JtYXQgPSAoc2hhZG93VHlwZSA9PT0gU0hBRE9XX1BDU1MgJiYgIWRldmljZS5pc1dlYkdMMSkgPyBQSVhFTEZPUk1BVF9SMzJGIDogUElYRUxGT1JNQVRfUkdCQTg7XG4gICAgICAgIGNvbnN0IGN1YmVtYXAgPSBuZXcgVGV4dHVyZShkZXZpY2UsIHtcbiAgICAgICAgICAgIC8vICNpZiBfUFJPRklMRVJcbiAgICAgICAgICAgIHByb2ZpbGVySGludDogVEVYSElOVF9TSEFET1dNQVAsXG4gICAgICAgICAgICAvLyAjZW5kaWZcbiAgICAgICAgICAgIGZvcm1hdDogZm9ybWF0LFxuICAgICAgICAgICAgd2lkdGg6IHNpemUsXG4gICAgICAgICAgICBoZWlnaHQ6IHNpemUsXG4gICAgICAgICAgICBjdWJlbWFwOiB0cnVlLFxuICAgICAgICAgICAgbWlwbWFwczogZmFsc2UsXG4gICAgICAgICAgICBtaW5GaWx0ZXI6IEZJTFRFUl9ORUFSRVNULFxuICAgICAgICAgICAgbWFnRmlsdGVyOiBGSUxURVJfTkVBUkVTVCxcbiAgICAgICAgICAgIGFkZHJlc3NVOiBBRERSRVNTX0NMQU1QX1RPX0VER0UsXG4gICAgICAgICAgICBhZGRyZXNzVjogQUREUkVTU19DTEFNUF9UT19FREdFLFxuICAgICAgICAgICAgbmFtZTogJ1NoYWRvd01hcEN1YmUnXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHRhcmdldHMgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IG5ldyBSZW5kZXJUYXJnZXQoe1xuICAgICAgICAgICAgICAgIGNvbG9yQnVmZmVyOiBjdWJlbWFwLFxuICAgICAgICAgICAgICAgIGZhY2U6IGksXG4gICAgICAgICAgICAgICAgZGVwdGg6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGFyZ2V0cy5wdXNoKHRhcmdldCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBTaGFkb3dNYXAoY3ViZW1hcCwgdGFyZ2V0cyk7XG4gICAgfVxufVxuXG5leHBvcnQgeyBTaGFkb3dNYXAgfTtcbiJdLCJuYW1lcyI6WyJTaGFkb3dNYXAiLCJjb25zdHJ1Y3RvciIsInRleHR1cmUiLCJ0YXJnZXRzIiwiY2FjaGVkIiwicmVuZGVyVGFyZ2V0cyIsImRlc3Ryb3kiLCJpIiwibGVuZ3RoIiwiZ2V0U2hhZG93Rm9ybWF0IiwiZGV2aWNlIiwic2hhZG93VHlwZSIsIlNIQURPV19WU00zMiIsIlBJWEVMRk9STUFUX1JHQkEzMkYiLCJTSEFET1dfVlNNMTYiLCJQSVhFTEZPUk1BVF9SR0JBMTZGIiwiU0hBRE9XX1BDRjUiLCJQSVhFTEZPUk1BVF9ERVBUSCIsIlNIQURPV19QQ0YxIiwiU0hBRE9XX1BDRjMiLCJzdXBwb3J0c0RlcHRoU2hhZG93IiwiU0hBRE9XX1BDU1MiLCJpc1dlYkdMMSIsIlBJWEVMRk9STUFUX1IzMkYiLCJQSVhFTEZPUk1BVF9SR0JBOCIsImdldFNoYWRvd0ZpbHRlcmluZyIsIkZJTFRFUl9ORUFSRVNUIiwiZXh0VGV4dHVyZUZsb2F0TGluZWFyIiwiRklMVEVSX0xJTkVBUiIsImV4dFRleHR1cmVIYWxmRmxvYXRMaW5lYXIiLCJjcmVhdGUiLCJsaWdodCIsInNoYWRvd01hcCIsIl90eXBlIiwiTElHSFRUWVBFX09NTkkiLCJjcmVhdGVDdWJlbWFwIiwiX3NoYWRvd1Jlc29sdXRpb24iLCJfc2hhZG93VHlwZSIsImNyZWF0ZTJkTWFwIiwiY3JlYXRlQXRsYXMiLCJyZXNvbHV0aW9uIiwicnQiLCJwdXNoIiwic2l6ZSIsImZvcm1hdCIsImZpbHRlciIsIlRleHR1cmUiLCJwcm9maWxlckhpbnQiLCJURVhISU5UX1NIQURPV01BUCIsIndpZHRoIiwiaGVpZ2h0IiwibWlwbWFwcyIsIm1pbkZpbHRlciIsIm1hZ0ZpbHRlciIsImFkZHJlc3NVIiwiQUREUkVTU19DTEFNUF9UT19FREdFIiwiYWRkcmVzc1YiLCJuYW1lIiwidGFyZ2V0IiwiY29tcGFyZU9uUmVhZCIsImNvbXBhcmVGdW5jIiwiRlVOQ19MRVNTIiwiUmVuZGVyVGFyZ2V0IiwiZGVwdGhCdWZmZXIiLCJjb2xvckJ1ZmZlciIsImRlcHRoIiwiaXNXZWJHUFUiLCJmbGlwWSIsImN1YmVtYXAiLCJmYWNlIl0sIm1hcHBpbmdzIjoiOzs7OztBQWlCQSxNQUFNQSxTQUFTLENBQUM7QUFDWkMsRUFBQUEsV0FBV0EsQ0FBQ0MsT0FBTyxFQUFFQyxPQUFPLEVBQUU7QUFF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
