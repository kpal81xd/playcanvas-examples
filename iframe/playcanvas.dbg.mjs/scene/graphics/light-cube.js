import { Vec3 } from '../../core/math/vec3.js';
import { LIGHTTYPE_DIRECTIONAL } from '../constants.js';

const lightCubeDir = [new Vec3(-1, 0, 0), new Vec3(1, 0, 0), new Vec3(0, -1, 0), new Vec3(0, 1, 0), new Vec3(0, 0, -1), new Vec3(0, 0, 1)];

/**
 * A lighting cube represented by 6 colors, one per cube direction. Use for simple lighting on the
 * particle system.
 *
 * @ignore
 */
class LightCube {
  constructor() {
    this.colors = new Float32Array(6 * 3);
  }
  update(ambientLight, lights) {
    const colors = this.colors;

    // ambient contribution
    const {
      r,
      g,
      b
    } = ambientLight;
    for (let j = 0; j < 6; j++) {
      colors[j * 3] = r;
      colors[j * 3 + 1] = g;
      colors[j * 3 + 2] = b;
    }

    // directional contribution
    for (let j = 0; j < lights.length; j++) {
      const light = lights[j];
      if (light._type === LIGHTTYPE_DIRECTIONAL) {
        for (let c = 0; c < 6; c++) {
          const weight = Math.max(lightCubeDir[c].dot(light._direction), 0) * light._intensity;
          const lightColor = light._color;
          colors[c * 3] += lightColor.r * weight;
          colors[c * 3 + 1] += lightColor.g * weight;
          colors[c * 3 + 2] += lightColor.b * weight;
        }
      }
    }
  }
}

export { LightCube };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlnaHQtY3ViZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL3NjZW5lL2dyYXBoaWNzL2xpZ2h0LWN1YmUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVmVjMyB9IGZyb20gXCIuLi8uLi9jb3JlL21hdGgvdmVjMy5qc1wiO1xuaW1wb3J0IHsgTElHSFRUWVBFX0RJUkVDVElPTkFMIH0gZnJvbSBcIi4uL2NvbnN0YW50cy5qc1wiO1xuXG5jb25zdCBsaWdodEN1YmVEaXIgPSBbXG4gICAgbmV3IFZlYzMoLTEsIDAsIDApLFxuICAgIG5ldyBWZWMzKDEsIDAsIDApLFxuICAgIG5ldyBWZWMzKDAsIC0xLCAwKSxcbiAgICBuZXcgVmVjMygwLCAxLCAwKSxcbiAgICBuZXcgVmVjMygwLCAwLCAtMSksXG4gICAgbmV3IFZlYzMoMCwgMCwgMSlcbl07XG5cbi8qKlxuICogQSBsaWdodGluZyBjdWJlIHJlcHJlc2VudGVkIGJ5IDYgY29sb3JzLCBvbmUgcGVyIGN1YmUgZGlyZWN0aW9uLiBVc2UgZm9yIHNpbXBsZSBsaWdodGluZyBvbiB0aGVcbiAqIHBhcnRpY2xlIHN5c3RlbS5cbiAqXG4gKiBAaWdub3JlXG4gKi9cbmNsYXNzIExpZ2h0Q3ViZSB7XG4gICAgY29sb3JzID0gbmV3IEZsb2F0MzJBcnJheSg2ICogMyk7XG5cbiAgICB1cGRhdGUoYW1iaWVudExpZ2h0LCBsaWdodHMpIHtcbiAgICAgICAgY29uc3QgY29sb3JzID0gdGhpcy5jb2xvcnM7XG5cbiAgICAgICAgLy8gYW1iaWVudCBjb250cmlidXRpb25cbiAgICAgICAgY29uc3QgeyByLCBnLCBiIH0gPSBhbWJpZW50TGlnaHQ7XG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgNjsgaisrKSB7XG4gICAgICAgICAgICBjb2xvcnNbaiAqIDNdID0gcjtcbiAgICAgICAgICAgIGNvbG9yc1tqICogMyArIDFdID0gZztcbiAgICAgICAgICAgIGNvbG9yc1tqICogMyArIDJdID0gYjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGRpcmVjdGlvbmFsIGNvbnRyaWJ1dGlvblxuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGxpZ2h0cy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgY29uc3QgbGlnaHQgPSBsaWdodHNbal07XG4gICAgICAgICAgICBpZiAobGlnaHQuX3R5cGUgPT09IExJR0hUVFlQRV9ESVJFQ1RJT05BTCkge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgNjsgYysrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHdlaWdodCA9IE1hdGgubWF4KGxpZ2h0Q3ViZURpcltjXS5kb3QobGlnaHQuX2RpcmVjdGlvbiksIDApICogbGlnaHQuX2ludGVuc2l0eTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlnaHRDb2xvciA9IGxpZ2h0Ll9jb2xvcjtcbiAgICAgICAgICAgICAgICAgICAgY29sb3JzW2MgKiAzXSArPSBsaWdodENvbG9yLnIgKiB3ZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yc1tjICogMyArIDFdICs9IGxpZ2h0Q29sb3IuZyAqIHdlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgY29sb3JzW2MgKiAzICsgMl0gKz0gbGlnaHRDb2xvci5iICogd2VpZ2h0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IHsgTGlnaHRDdWJlIH07XG4iXSwibmFtZXMiOlsibGlnaHRDdWJlRGlyIiwiVmVjMyIsIkxpZ2h0Q3ViZSIsImNvbnN0cnVjdG9yIiwiY29sb3JzIiwiRmxvYXQzMkFycmF5IiwidXBkYXRlIiwiYW1iaWVudExpZ2h0IiwibGlnaHRzIiwiciIsImciLCJiIiwiaiIsImxlbmd0aCIsImxpZ2h0IiwiX3R5cGUiLCJMSUdIVFRZUEVfRElSRUNUSU9OQUwiLCJjIiwid2VpZ2h0IiwiTWF0aCIsIm1heCIsImRvdCIs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
