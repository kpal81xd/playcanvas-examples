import { FILTER_LINEAR_MIPMAP_LINEAR, FILTER_LINEAR, ADDRESS_CLAMP_TO_EDGE } from '../../platform/graphics/constants.js';
import { DebugGraphics } from '../../platform/graphics/debug-graphics.js';
import { RenderPass } from '../../platform/graphics/render-pass.js';
import { RenderTarget } from '../../platform/graphics/render-target.js';
import { Texture } from '../../platform/graphics/texture.js';

// uniform names (first is current name, second one is deprecated name for compatibility)
const _colorUniformNames = ['uSceneColorMap', 'texture_grabPass'];

/**
 * A render pass implementing grab of a color buffer.
 *
 * TODO: implement mipmapped color buffer support for WebGL 1 as well, which requires
 * the texture to be a power of two, by first downscaling the captured framebuffer
 * texture to smaller power of 2 texture, and then generate mipmaps and use it for rendering
 * TODO: or even better, implement blur filter to have smoother lower levels
 *
 * @ignore
 */
class RenderPassColorGrab extends RenderPass {
  constructor(...args) {
    super(...args);
    this.colorRenderTarget = null;
    /**
     * The source render target to grab the color from.
     *
     * @type {RenderTarget|null}
     */
    this.source = null;
  }
  destroy() {
    super.destroy();
    this.releaseRenderTarget(this.colorRenderTarget);
  }
  shouldReallocate(targetRT, sourceTexture, sourceFormat) {
    // need to reallocate if format does not match
    const targetFormat = targetRT == null ? void 0 : targetRT.colorBuffer.format;
    if (targetFormat !== sourceFormat) return true;

    // need to reallocate if dimensions don't match
    const width = (sourceTexture == null ? void 0 : sourceTexture.width) || this.device.width;
    const height = (sourceTexture == null ? void 0 : sourceTexture.height) || this.device.height;
    return !targetRT || width !== targetRT.width || height !== targetRT.height;
  }
  allocateRenderTarget(renderTarget, sourceRenderTarget, device, format) {
    // allocate texture buffer
    const mipmaps = device.isWebGL2;
    const texture = new Texture(device, {
      name: _colorUniformNames[0],
      format,
      width: sourceRenderTarget ? sourceRenderTarget.colorBuffer.width : device.width,
      height: sourceRenderTarget ? sourceRenderTarget.colorBuffer.height : device.height,
      mipmaps,
      minFilter: mipmaps ? FILTER_LINEAR_MIPMAP_LINEAR : FILTER_LINEAR,
      magFilter: FILTER_LINEAR,
      addressU: ADDRESS_CLAMP_TO_EDGE,
      addressV: ADDRESS_CLAMP_TO_EDGE
    });
    if (renderTarget) {
      // if reallocating RT size, release previous framebuffer
      renderTarget.destroyFrameBuffers();

      // assign new texture
      renderTarget._colorBuffer = texture;
      renderTarget._colorBuffers = [texture];
    } else {
      // create new render target with the texture
      renderTarget = new RenderTarget({
        name: 'ColorGrabRT',
        colorBuffer: texture,
        depth: false,
        stencil: false,
        autoResolve: false
      });
    }
    return renderTarget;
  }
  releaseRenderTarget(rt) {
    if (rt) {
      rt.destroyTextureBuffers();
      rt.destroy();
    }
  }
  frameUpdate() {
    var _sourceRt$colorBuffer;
    const device = this.device;

    // resize based on the source render target
    const sourceRt = this.source;
    const sourceFormat = (_sourceRt$colorBuffer = sourceRt == null ? void 0 : sourceRt.colorBuffer.format) != null ? _sourceRt$colorBuffer : this.device.backBufferFormat;

    // allocate / resize existing RT as needed
    if (this.shouldReallocate(this.colorRenderTarget, sourceRt == null ? void 0 : sourceRt.colorBuffer, sourceFormat)) {
      this.releaseRenderTarget(this.colorRenderTarget);
      this.colorRenderTarget = this.allocateRenderTarget(this.colorRenderTarget, sourceRt, device, sourceFormat);
    }

    // assign uniform
    const colorBuffer = this.colorRenderTarget.colorBuffer;
    _colorUniformNames.forEach(name => device.scope.resolve(name).setValue(colorBuffer));
  }
  execute() {
    // copy color from the current render target
    const device = this.device;
    DebugGraphics.pushGpuMarker(device, 'GRAB-COLOR');
    const sourceRt = this.source;
    const colorBuffer = this.colorRenderTarget.colorBuffer;
    if (device.isWebGPU) {
      device.copyRenderTarget(sourceRt, this.colorRenderTarget, true, false);

      // generate mipmaps
      device.mipmapRenderer.generate(this.colorRenderTarget.colorBuffer.impl);
    } else if (device.isWebGL2) {
      device.copyRenderTarget(sourceRt, this.colorRenderTarget, true, false);

      // generate mipmaps
      device.activeTexture(device.maxCombinedTextures - 1);
      device.bindTexture(colorBuffer);
      device.gl.generateMipmap(colorBuffer.impl._glTarget);
    } else {
      // webgl 1

      // initialize the texture
      if (!colorBuffer.impl._glTexture) {
        colorBuffer.impl.initialize(device, colorBuffer);
      }

      // copy framebuffer to it
      device.bindTexture(colorBuffer);
      const gl = device.gl;
      gl.copyTexImage2D(gl.TEXTURE_2D, 0, colorBuffer.impl._glFormat, 0, 0, colorBuffer.width, colorBuffer.height, 0);

      // stop the device from updating this texture further
      colorBuffer._needsUpload = false;
      colorBuffer._needsMipmapsUpload = false;
    }
    DebugGraphics.popGpuMarker(device);
  }
}

export { RenderPassColorGrab };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyLXBhc3MtY29sb3ItZ3JhYi5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL3NjZW5lL2dyYXBoaWNzL3JlbmRlci1wYXNzLWNvbG9yLWdyYWIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQUREUkVTU19DTEFNUF9UT19FREdFLCBGSUxURVJfTElORUFSLCBGSUxURVJfTElORUFSX01JUE1BUF9MSU5FQVIgfSBmcm9tIFwiLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3MvY29uc3RhbnRzLmpzXCI7XG5pbXBvcnQgeyBEZWJ1Z0dyYXBoaWNzIH0gZnJvbSBcIi4uLy4uL3BsYXRmb3JtL2dyYXBoaWNzL2RlYnVnLWdyYXBoaWNzLmpzXCI7XG5pbXBvcnQgeyBSZW5kZXJQYXNzIH0gZnJvbSBcIi4uLy4uL3BsYXRmb3JtL2dyYXBoaWNzL3JlbmRlci1wYXNzLmpzXCI7XG5pbXBvcnQgeyBSZW5kZXJUYXJnZXQgfSBmcm9tIFwiLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3MvcmVuZGVyLXRhcmdldC5qc1wiO1xuaW1wb3J0IHsgVGV4dHVyZSB9IGZyb20gXCIuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy90ZXh0dXJlLmpzXCI7XG5cbi8vIHVuaWZvcm0gbmFtZXMgKGZpcnN0IGlzIGN1cnJlbnQgbmFtZSwgc2Vjb25kIG9uZSBpcyBkZXByZWNhdGVkIG5hbWUgZm9yIGNvbXBhdGliaWxpdHkpXG5jb25zdCBfY29sb3JVbmlmb3JtTmFtZXMgPSBbJ3VTY2VuZUNvbG9yTWFwJywgJ3RleHR1cmVfZ3JhYlBhc3MnXTtcblxuLyoqXG4gKiBBIHJlbmRlciBwYXNzIGltcGxlbWVudGluZyBncmFiIG9mIGEgY29sb3IgYnVmZmVyLlxuICpcbiAqIFRPRE86IGltcGxlbWVudCBtaXBtYXBwZWQgY29sb3IgYnVmZmVyIHN1cHBvcnQgZm9yIFdlYkdMIDEgYXMgd2VsbCwgd2hpY2ggcmVxdWlyZXNcbiAqIHRoZSB0ZXh0dXJlIHRvIGJlIGEgcG93ZXIgb2YgdHdvLCBieSBmaXJzdCBkb3duc2NhbGluZyB0aGUgY2FwdHVyZWQgZnJhbWVidWZmZXJcbiAqIHRleHR1cmUgdG8gc21hbGxlciBwb3dlciBvZiAyIHRleHR1cmUsIGFuZCB0aGVuIGdlbmVyYXRlIG1pcG1hcHMgYW5kIHVzZSBpdCBmb3IgcmVuZGVyaW5nXG4gKiBUT0RPOiBvciBldmVuIGJldHRlciwgaW1wbGVtZW50IGJsdXIgZmlsdGVyIHRvIGhhdmUgc21vb3RoZXIgbG93ZXIgbGV2ZWxzXG4gKlxuICogQGlnbm9yZVxuICovXG5jbGFzcyBSZW5kZXJQYXNzQ29sb3JHcmFiIGV4dGVuZHMgUmVuZGVyUGFzcyB7XG4gICAgY29sb3JSZW5kZXJUYXJnZXQgPSBudWxsO1xuXG4gICAgLyoqXG4gICAgICogVGhlIHNvdXJjZSByZW5kZXIgdGFyZ2V0IHRvIGdyYWIgdGhlIGNvbG9yIGZyb20uXG4gICAgICpcbiAgICAgKiBAdHlwZSB7UmVuZGVyVGFyZ2V0fG51bGx9XG4gICAgICovXG4gICAgc291cmNlID0gbnVsbDtcblxuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIHN1cGVyLmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5yZWxlYXNlUmVuZGVyVGFyZ2V0KHRoaXMuY29sb3JSZW5kZXJUYXJnZXQpO1xuICAgIH1cblxuICAgIHNob3VsZFJlYWxsb2NhdGUodGFyZ2V0UlQsIHNvdXJjZVRleHR1cmUsIHNvdXJjZUZvcm1hdCkge1xuXG4gICAgICAgIC8vIG5lZWQgdG8gcmVhbGxvY2F0ZSBpZiBmb3JtYXQgZG9lcyBub3QgbWF0Y2hcbiAgICAgICAgY29uc3QgdGFyZ2V0Rm9ybWF0ID0gdGFyZ2V0UlQ/LmNvbG9yQnVmZmVyLmZvcm1hdDtcbiAgICAgICAgaWYgKHRhcmdldEZvcm1hdCAhPT0gc291cmNlRm9ybWF0KVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgLy8gbmVlZCB0byByZWFsbG9jYXRlIGlmIGRpbWVuc2lvbnMgZG9uJ3QgbWF0Y2hcbiAgICAgICAgY29uc3Qgd2lkdGggPSBzb3VyY2VUZXh0dXJlPy53aWR0aCB8fCB0aGlzLmRldmljZS53aWR0aDtcbiAgICAgICAgY29uc3QgaGVpZ2h0ID0gc291cmNlVGV4dHVyZT8uaGVpZ2h0IHx8IHRoaXMuZGV2aWNlLmhlaWdodDtcbiAgICAgICAgcmV0dXJuICF0YXJnZXRSVCB8fCB3aWR0aCAhPT0gdGFyZ2V0UlQud2lkdGggfHwgaGVpZ2h0ICE9PSB0YXJnZXRSVC5oZWlnaHQ7XG4gICAgfVxuXG4gICAgYWxsb2NhdGVSZW5kZXJUYXJnZXQocmVuZGVyVGFyZ2V0LCBzb3VyY2VSZW5kZXJUYXJnZXQsIGRldmljZSwgZm9ybWF0KSB7XG5cbiAgICAgICAgLy8gYWxsb2NhdGUgdGV4dHVyZSBidWZmZXJcbiAgICAgICAgY29uc3QgbWlwbWFwcyA9IGRldmljZS5pc1dlYkdMMjtcbiAgICAgICAgY29uc3QgdGV4dHVyZSA9IG5ldyBUZXh0dXJlKGRldmljZSwge1xuICAgICAgICAgICAgbmFtZTogX2NvbG9yVW5pZm9ybU5hbWVzWzBdLFxuICAgICAgICAgICAgZm9ybWF0LFxuICAgICAgICAgICAgd2lkdGg6IHNvdXJjZVJlbmRlclRhcmdldCA/IHNvdXJjZVJlbmRlclRhcmdldC5jb2xvckJ1ZmZlci53aWR0aCA6IGRldmljZS53aWR0aCxcbiAgICAgICAgICAgIGhlaWdodDogc291cmNlUmVuZGVyVGFyZ2V0ID8gc291cmNlUmVuZGVyVGFyZ2V0LmNvbG9yQnVmZmVyLmhlaWdodCA6IGRldmljZS5oZWlnaHQsXG4gICAgICAgICAgICBtaXBtYXBzLFxuICAgICAgICAgICAgbWluRmlsdGVyOiBtaXBtYXBzID8gRklMVEVSX0xJTkVBUl9NSVBNQVBfTElORUFSIDogRklMVEVSX0xJTkVBUixcbiAgICAgICAgICAgIG1hZ0ZpbHRlcjogRklMVEVSX0xJTkVBUixcbiAgICAgICAgICAgIGFkZHJlc3NVOiBBRERSRVNTX0NMQU1QX1RPX0VER0UsXG4gICAgICAgICAgICBhZGRyZXNzVjogQUREUkVTU19DTEFNUF9UT19FREdFXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChyZW5kZXJUYXJnZXQpIHtcblxuICAgICAgICAgICAgLy8gaWYgcmVhbGxvY2F0aW5nIFJUIHNpemUsIHJlbGVhc2UgcHJldmlvdXMgZnJhbWVidWZmZXJcbiAgICAgICAgICAgIHJlbmRlclRhcmdldC5kZXN0cm95RnJhbWVCdWZmZXJzKCk7XG5cbiAgICAgICAgICAgIC8vIGFzc2lnbiBuZXcgdGV4dHVyZVxuICAgICAgICAgICAgcmVuZGVyVGFyZ2V0Ll9jb2xvckJ1ZmZlciA9IHRleHR1cmU7XG4gICAgICAgICAgICByZW5kZXJUYXJnZXQuX2NvbG9yQnVmZmVycyA9IFt0ZXh0dXJlXTtcbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgLy8gY3JlYXRlIG5ldyByZW5kZXIgdGFyZ2V0IHdpdGggdGhlIHRleHR1cmVcbiAgICAgICAgICAgIHJlbmRlclRhcmdldCA9IG5ldyBSZW5kZXJUYXJnZXQoe1xuICAgICAgICAgICAgICAgIG5hbWU6ICdDb2xvckdyYWJSVCcsXG4gICAgICAgICAgICAgICAgY29sb3JCdWZmZXI6IHRleHR1cmUsXG4gICAgICAgICAgICAgICAgZGVwdGg6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHN0ZW5jaWw6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGF1dG9SZXNvbHZlOiBmYWxzZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVuZGVyVGFyZ2V0O1xuICAgIH1cblxuICAgIHJlbGVhc2VSZW5kZXJUYXJnZXQocnQpIHtcblxuICAgICAgICBpZiAocnQpIHtcbiAgICAgICAgICAgIHJ0LmRlc3Ryb3lUZXh0dXJlQnVmZmVycygpO1xuICAgICAgICAgICAgcnQuZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnJhbWVVcGRhdGUoKSB7XG5cbiAgICAgICAgY29uc3QgZGV2aWNlID0gdGhpcy5kZXZpY2U7XG5cbiAgICAgICAgLy8gcmVzaXplIGJhc2VkIG9uIHRoZSBzb3VyY2UgcmVuZGVyIHRhcmdldFxuICAgICAgICBjb25zdCBzb3VyY2VSdCA9IHRoaXMuc291cmNlO1xuICAgICAgICBjb25zdCBzb3VyY2VGb3JtYXQgPSBzb3VyY2VSdD8uY29sb3JCdWZmZXIuZm9ybWF0ID8/IHRoaXMuZGV2aWNlLmJhY2tCdWZmZXJGb3JtYXQ7XG5cbiAgICAgICAgLy8gYWxsb2NhdGUgLyByZXNpemUgZXhpc3RpbmcgUlQgYXMgbmVlZGVkXG4gICAgICAgIGlmICh0aGlzLnNob3VsZFJlYWxsb2NhdGUodGhpcy5jb2xvclJlbmRlclRhcmdldCwgc291cmNlUnQ/LmNvbG9yQnVmZmVyLCBzb3VyY2VGb3JtYXQpKSB7XG4gICAgICAgICAgICB0aGlzLnJlbGVhc2VSZW5kZXJUYXJnZXQodGhpcy5jb2xvclJlbmRlclRhcmdldCk7XG4gICAgICAgICAgICB0aGlzLmNvbG9yUmVuZGVyVGFyZ2V0ID0gdGhpcy5hbGxvY2F0ZVJlbmRlclRhcmdldCh0aGlzLmNvbG9yUmVuZGVyVGFyZ2V0LCBzb3VyY2VSdCwgZGV2aWNlLCBzb3VyY2VGb3JtYXQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gYXNzaWduIHVuaWZvcm1cbiAgICAgICAgY29uc3QgY29sb3JCdWZmZXIgPSB0aGlzLmNvbG9yUmVuZGVyVGFyZ2V0LmNvbG9yQnVmZmVyO1xuICAgICAgICBfY29sb3JVbmlmb3JtTmFtZXMuZm9yRWFjaChuYW1lID0+IGRldmljZS5zY29wZS5yZXNvbHZlKG5hbWUpLnNldFZhbHVlKGNvbG9yQnVmZmVyKSk7XG4gICAgfVxuXG4gICAgZXhlY3V0ZSgpIHtcblxuICAgICAgICAvLyBjb3B5IGNvbG9yIGZyb20gdGhlIGN1cnJlbnQgcmVuZGVyIHRhcmdldFxuICAgICAgICBjb25zdCBkZXZpY2UgPSB0aGlzLmRldmljZTtcbiAgICAgICAgRGVidWdHcmFwaGljcy5wdXNoR3B1TWFya2VyKGRldmljZSwgJ0dSQUItQ09MT1InKTtcblxuICAgICAgICBjb25zdCBzb3VyY2VSdCA9IHRoaXMuc291cmNlO1xuICAgICAgICBjb25zdCBjb2xvckJ1ZmZlciA9IHRoaXMuY29sb3JSZW5kZXJUYXJnZXQuY29sb3JCdWZmZXI7XG5cbiAgICAgICAgaWYgKGRldmljZS5pc1dlYkdQVSkge1xuXG4gICAgICAgICAgICBkZXZpY2UuY29weVJlbmRlclRhcmdldChzb3VyY2VSdCwgdGhpcy5jb2xvclJlbmRlclRhcmdldCwgdHJ1ZSwgZmFsc2UpO1xuXG4gICAgICAgICAgICAvLyBnZW5lcmF0ZSBtaXBtYXBzXG4gICAgICAgICAgICBkZXZpY2UubWlwbWFwUmVuZGVyZXIuZ2VuZXJhdGUodGhpcy5jb2xvclJlbmRlclRhcmdldC5jb2xvckJ1ZmZlci5pbXBsKTtcblxuICAgICAgICB9IGVsc2UgaWYgKGRldmljZS5pc1dlYkdMMikge1xuXG4gICAgICAgICAgICBkZXZpY2UuY29weVJlbmRlclRhcmdldChzb3VyY2VSdCwgdGhpcy5jb2xvclJlbmRlclRhcmdldCwgdHJ1ZSwgZmFsc2UpO1xuXG4gICAgICAgICAgICAvLyBnZW5lcmF0ZSBtaXBtYXBzXG4gICAgICAgICAgICBkZXZpY2UuYWN0aXZlVGV4dHVyZShkZXZpY2UubWF4Q29tYmluZWRUZXh0dXJlcyAtIDEpO1xuICAgICAgICAgICAgZGV2aWNlLmJpbmRUZXh0dXJlKGNvbG9yQnVmZmVyKTtcbiAgICAgICAgICAgIGRldmljZS5nbC5nZW5lcmF0ZU1pcG1hcChjb2xvckJ1ZmZlci5pbXBsLl9nbFRhcmdldCk7XG5cbiAgICAgICAgfSBlbHNlIHsgLy8gd2ViZ2wgMVxuXG4gICAgICAgICAgICAvLyBpbml0aWFsaXplIHRoZSB0ZXh0dXJlXG4gICAgICAgICAgICBpZiAoIWNvbG9yQnVmZmVyLmltcGwuX2dsVGV4dHVyZSkge1xuICAgICAgICAgICAgICAgIGNvbG9yQnVmZmVyLmltcGwuaW5pdGlhbGl6ZShkZXZpY2UsIGNvbG9yQnVmZmVyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gY29weSBmcmFtZWJ1ZmZlciB0byBpdFxuICAgICAgICAgICAgZGV2aWNlLmJpbmRUZXh0dXJlKGNvbG9yQnVmZmVyKTtcbiAgICAgICAgICAgIGNvbnN0IGdsID0gZGV2aWNlLmdsO1xuICAgICAgICAgICAgZ2wuY29weVRleEltYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMCwgY29sb3JCdWZmZXIuaW1wbC5fZ2xGb3JtYXQsIDAsIDAsIGNvbG9yQnVmZmVyLndpZHRoLCBjb2xvckJ1ZmZlci5oZWlnaHQsIDApO1xuXG4gICAgICAgICAgICAvLyBzdG9wIHRoZSBkZXZpY2UgZnJvbSB1cGRhdGluZyB0aGlzIHRleHR1cmUgZnVydGhlclxuICAgICAgICAgICAgY29sb3JCdWZmZXIuX25lZWRzVXBsb2FkID0gZmFsc2U7XG4gICAgICAgICAgICBjb2xvckJ1ZmZlci5fbmVlZHNNaXBtYXBzVXBsb2FkID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBEZWJ1Z0dyYXBoaWNzLnBvcEdwdU1hcmtlcihkZXZpY2UpO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgUmVuZGVyUGFzc0NvbG9yR3JhYiB9O1xuIl0sIm5hbWVzIjpbIl9jb2xvclVuaWZvcm1OYW1lcyIsIlJlbmRlclBhc3NDb2xvckdyYWIiLCJSZW5kZXJQYXNzIiwiY29uc3RydWN0b3IiLCJhcmdzIiwiY29sb3JSZW5kZXJUYXJnZXQiLCJzb3VyY2UiLCJkZXN0cm95IiwicmVsZWFzZVJlbmRlclRhcmdldCIsInNob3VsZFJlYWxsb2NhdGUiLCJ0YXJnZXRSVCIsInNvdXJjZVRleHR1cmUiLCJzb3VyY2VGb3JtYXQiLCJ0YXJnZXRGb3JtYXQiLCJjb2xvckJ1ZmZlciIsImZvcm1hdCIsIndpZHRoIiwiZGV2aWNlIiwiaGVpZ2h0IiwiYWxsb2NhdGVSZW5kZXJUYXJnZXQiLCJyZW5kZXJUYXJnZXQiLCJzb3VyY2VSZW5kZXJUYXJnZXQiLCJtaXBtYXBzIiwiaXNXZWJHTDIiLCJ0ZXh0dXJlIiwiVGV4dHVyZSIsIm5hbWUiLCJtaW5GaWx0ZXIiLCJGSUxURVJfTElORUFSX01JUE1BUF9MSU5FQVIiLCJGSUxURVJfTElORUFSIiwibWFnRmlsdGVyIiwiYWRkcmVzc1UiLCJBRERSRVNTX0NMQU1QX1RPX0VER0UiLCJhZGRyZXNzViIsImRlc3Ryb3lGcmFtZUJ1ZmZlcnMiLCJfY29sb3JCdWZmZXIiLCJfY29sb3JCdWZmZXJzIiwiUmVuZGVyVGFyZ2V0IiwiZGVwdGgiLCJzdGVuY2lsIiwiYXV0b1Jlc29sdmUiLCJydCIsImRlc3Ryb3lUZXh0dXJlQnVmZmVycyIsImZyYW1lVXBkYXRlIiwiX3NvdXJjZVJ0JGNvbG9yQnVmZmVyIiwic291cmNlUnQiLCJiYWNrQnVmZmVyRm9ybWF0IiwiZm9yRWFjaCIsInNjb3BlIiwicmVzb2x2ZSIsInNldFZhbHVlIiwiZXhlY3V0ZSIsIkRlYnVnR3JhcGhpY3MiLCJwdXNoR3B1TWFya2VyIiwiaXNXZWJHUFUiLCJjb3B5UmVuZGVyVGFyZ2V0IiwibWlwbWFwUmVuZGVyZXIiLCJnZW5lcmF0ZSIsImltcGwiLCJhY3RpdmVUZXh0dXJlIiwibWF4Q29tYmluZWRUZXh0dXJlcyIsImJpbmRUZXh0dXJlIiwiZ2wiLCJnZW5lcmF0ZU1pcG1hcCIsIl9nbFRhcmdldCIsIl9nbFRleHR1cmUiLCJpbml0aWFsaXplIiwiY29weVRleEltYWdlMkQiLCJURVhUVVJFXzJEIiwiX2dsRm9ybWF0IiwiX25lZWRzVXBsb2FkIiwiX25lZWRzTWlwbWFwc1VwbG9hZCIsInBvcEdwdU1hcmtlciJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBTUE7QUFDQSxNQUFNQSxrQkFBa0IsR0FBRyxDQUFDLGdCQUFnQixFQUFFLGtCQUFrQixDQUFDLENBQUE7O0FBRWpFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUMsbUJBQW1CLFNBQVNDLFVBQVUsQ0FBQztBQUFBQyxFQUFBQSxXQUFBQSxDQUFBLEdBQUFDLElBQUEsRUFBQTtBQUFBLElBQUEsS0FBQSxDQUFBLEdBQUFBLElBQUEsQ0FBQSxDQUFBO0lB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
