import { ShaderProcessorOptions } from '../../platform/graphics/shader-processor-options.js';
import { SPECULAR_BLINN, SPECOCC_AO, DITHER_NONE, FRESNEL_SCHLICK } from '../constants.js';
import { Material } from './material.js';
import { LitMaterialOptions } from './lit-material-options.js';
import { LitMaterialOptionsBuilder } from './lit-material-options-builder.js';
import { getProgramLibrary } from '../shader-lib/get-program-library.js';
import { lit } from '../shader-lib/programs/lit.js';

const options = new LitMaterialOptions();

/**
 * LitMaterial comprises a shader chunk implementing the material "front end" (the shader program
 * providing the material surface properties like diffuse, opacity, normals etc) and a set of
 * flags which control the material "back end" (the shader program calculating the lighting,
 * shadows, reflections, fogging etc).
 *
 * The front end and back end together form a complete PBR shader.
 *
 * @ignore
 */
class LitMaterial extends Material {
  constructor(...args) {
    super(...args);
    this.usedUvs = [true];
    this.shaderChunk = 'void evaluateFrontend() {}\n';
    this.chunks = null;
    this.useLighting = true;
    this.useFog = true;
    this.useGammaTonemap = true;
    this.useSkybox = true;
    this.shadingModel = SPECULAR_BLINN;
    this.ambientSH = null;
    this.pixelSnap = false;
    this.nineSlicedMode = null;
    this.fastTbn = false;
    this.twoSidedLighting = false;
    this.occludeDirect = false;
    this.occludeSpecular = SPECOCC_AO;
    this.occludeSpecularIntensity = 1;
    this.opacityFadesSpecular = true;
    this.opacityDither = DITHER_NONE;
    this.opacityShadowDither = DITHER_NONE;
    this.conserveEnergy = true;
    this.ggxSpecular = false;
    this.fresnelModel = FRESNEL_SCHLICK;
    this.dynamicRefraction = false;
    // has members
    this.hasAo = false;
    this.hasSpecular = false;
    this.hasSpecularityFactor = false;
    this.hasLighting = false;
    this.hasHeights = false;
    this.hasNormals = false;
    this.hasSheen = false;
    this.hasRefraction = false;
    this.hasIrridescence = false;
    this.hasMetalness = false;
    this.hasClearCoat = false;
    this.hasClearCoatNormals = false;
  }
  getShaderVariant(device, scene, objDefs, unused, pass, sortedLights, viewUniformFormat, viewBindGroupFormat, vertexFormat) {
    options.usedUvs = this.usedUvs.slice();
    options.shaderChunk = this.shaderChunk;
    LitMaterialOptionsBuilder.update(options.litOptions, this, scene, objDefs, pass, sortedLights);
    const processingOptions = new ShaderProcessorOptions(viewUniformFormat, viewBindGroupFormat, vertexFormat);
    const library = getProgramLibrary(device);
    library.register('lit', lit);
    const shader = library.getProgram('lit', options, processingOptions, this.userId);
    return shader;
  }
}

export { LitMaterial };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl0LW1hdGVyaWFsLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvc2NlbmUvbWF0ZXJpYWxzL2xpdC1tYXRlcmlhbC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTaGFkZXJQcm9jZXNzb3JPcHRpb25zIH0gZnJvbSAnLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3Mvc2hhZGVyLXByb2Nlc3Nvci1vcHRpb25zLmpzJztcbmltcG9ydCB7IERJVEhFUl9OT05FLCBGUkVTTkVMX1NDSExJQ0ssIFNQRUNPQ0NfQU8sIFNQRUNVTEFSX0JMSU5OIH0gZnJvbSBcIi4uL2NvbnN0YW50cy5qc1wiO1xuaW1wb3J0IHsgTWF0ZXJpYWwgfSBmcm9tICcuL21hdGVyaWFsLmpzJztcbmltcG9ydCB7IExpdE1hdGVyaWFsT3B0aW9ucyB9IGZyb20gJy4vbGl0LW1hdGVyaWFsLW9wdGlvbnMuanMnO1xuaW1wb3J0IHsgTGl0TWF0ZXJpYWxPcHRpb25zQnVpbGRlciB9IGZyb20gJy4vbGl0LW1hdGVyaWFsLW9wdGlvbnMtYnVpbGRlci5qcyc7XG5pbXBvcnQgeyBnZXRQcm9ncmFtTGlicmFyeSB9IGZyb20gXCIuLi9zaGFkZXItbGliL2dldC1wcm9ncmFtLWxpYnJhcnkuanNcIjtcbmltcG9ydCB7IGxpdCB9IGZyb20gJy4uL3NoYWRlci1saWIvcHJvZ3JhbXMvbGl0LmpzJztcblxuY29uc3Qgb3B0aW9ucyA9IG5ldyBMaXRNYXRlcmlhbE9wdGlvbnMoKTtcblxuLyoqXG4gKiBMaXRNYXRlcmlhbCBjb21wcmlzZXMgYSBzaGFkZXIgY2h1bmsgaW1wbGVtZW50aW5nIHRoZSBtYXRlcmlhbCBcImZyb250IGVuZFwiICh0aGUgc2hhZGVyIHByb2dyYW1cbiAqIHByb3ZpZGluZyB0aGUgbWF0ZXJpYWwgc3VyZmFjZSBwcm9wZXJ0aWVzIGxpa2UgZGlmZnVzZSwgb3BhY2l0eSwgbm9ybWFscyBldGMpIGFuZCBhIHNldCBvZlxuICogZmxhZ3Mgd2hpY2ggY29udHJvbCB0aGUgbWF0ZXJpYWwgXCJiYWNrIGVuZFwiICh0aGUgc2hhZGVyIHByb2dyYW0gY2FsY3VsYXRpbmcgdGhlIGxpZ2h0aW5nLFxuICogc2hhZG93cywgcmVmbGVjdGlvbnMsIGZvZ2dpbmcgZXRjKS5cbiAqXG4gKiBUaGUgZnJvbnQgZW5kIGFuZCBiYWNrIGVuZCB0b2dldGhlciBmb3JtIGEgY29tcGxldGUgUEJSIHNoYWRlci5cbiAqXG4gKiBAaWdub3JlXG4gKi9cbmNsYXNzIExpdE1hdGVyaWFsIGV4dGVuZHMgTWF0ZXJpYWwge1xuICAgIHVzZWRVdnMgPSBbdHJ1ZV07XG5cbiAgICBzaGFkZXJDaHVuayA9ICd2b2lkIGV2YWx1YXRlRnJvbnRlbmQoKSB7fVxcbic7XG5cbiAgICBjaHVua3MgPSBudWxsO1xuXG4gICAgdXNlTGlnaHRpbmcgPSB0cnVlO1xuXG4gICAgdXNlRm9nID0gdHJ1ZTtcblxuICAgIHVzZUdhbW1hVG9uZW1hcCA9IHRydWU7XG5cbiAgICB1c2VTa3lib3ggPSB0cnVlO1xuXG4gICAgc2hhZGluZ01vZGVsID0gU1BFQ1VMQVJfQkxJTk47XG5cbiAgICBhbWJpZW50U0ggPSBudWxsO1xuXG4gICAgcGl4ZWxTbmFwID0gZmFsc2U7XG5cbiAgICBuaW5lU2xpY2VkTW9kZSA9IG51bGw7XG5cbiAgICBmYXN0VGJuID0gZmFsc2U7XG5cbiAgICB0d29TaWRlZExpZ2h0aW5nID0gZmFsc2U7XG5cbiAgICBvY2NsdWRlRGlyZWN0ID0gZmFsc2U7XG5cbiAgICBvY2NsdWRlU3BlY3VsYXIgPSBTUEVDT0NDX0FPO1xuXG4gICAgb2NjbHVkZVNwZWN1bGFySW50ZW5zaXR5ID0gMTtcblxuICAgIG9wYWNpdHlGYWRlc1NwZWN1bGFyID0gdHJ1ZTtcblxuICAgIG9wYWNpdHlEaXRoZXIgPSBESVRIRVJfTk9ORTtcblxuICAgIG9wYWNpdHlTaGFkb3dEaXRoZXIgPSBESVRIRVJfTk9ORTtcblxuICAgIGNvbnNlcnZlRW5lcmd5ID0gdHJ1ZTtcblxuICAgIGdneFNwZWN1bGFyID0gZmFsc2U7XG5cbiAgICBmcmVzbmVsTW9kZWwgPSBGUkVTTkVMX1NDSExJQ0s7XG5cbiAgICBkeW5hbWljUmVmcmFjdGlvbiA9IGZhbHNlO1xuXG4gICAgLy8gaGFzIG1lbWJlcnNcbiAgICBoYXNBbyA9IGZhbHNlO1xuXG4gICAgaGFzU3BlY3VsYXIgPSBmYWxzZTtcblxuICAgIGhhc1NwZWN1bGFyaXR5RmFjdG9yID0gZmFsc2U7XG5cbiAgICBoYXNMaWdodGluZyA9IGZhbHNlO1xuXG4gICAgaGFzSGVpZ2h0cyA9IGZhbHNlO1xuXG4gICAgaGFzTm9ybWFscyA9IGZhbHNlO1xuXG4gICAgaGFzU2hlZW4gPSBmYWxzZTtcblxuICAgIGhhc1JlZnJhY3Rpb24gPSBmYWxzZTtcblxuICAgIGhhc0lycmlkZXNjZW5jZSA9IGZhbHNlO1xuXG4gICAgaGFzTWV0YWxuZXNzID0gZmFsc2U7XG5cbiAgICBoYXNDbGVhckNvYXQgPSBmYWxzZTtcblxuICAgIGhhc0NsZWFyQ29hdE5vcm1hbHMgPSBmYWxzZTtcblxuICAgIGdldFNoYWRlclZhcmlhbnQoZGV2aWNlLCBzY2VuZSwgb2JqRGVmcywgdW51c2VkLCBwYXNzLCBzb3J0ZWRMaWdodHMsIHZpZXdVbmlmb3JtRm9ybWF0LCB2aWV3QmluZEdyb3VwRm9ybWF0LCB2ZXJ0ZXhGb3JtYXQpIHtcbiAgICAgICAgb3B0aW9ucy51c2VkVXZzID0gdGhpcy51c2VkVXZzLnNsaWNlKCk7XG4gICAgICAgIG9wdGlvbnMuc2hhZGVyQ2h1bmsgPSB0aGlzLnNoYWRlckNodW5rO1xuXG4gICAgICAgIExpdE1hdGVyaWFsT3B0aW9uc0J1aWxkZXIudXBkYXRlKG9wdGlvbnMubGl0T3B0aW9ucywgdGhpcywgc2NlbmUsIG9iakRlZnMsIHBhc3MsIHNvcnRlZExpZ2h0cyk7XG4gICAgICAgIGNvbnN0IHByb2Nlc3NpbmdPcHRpb25zID0gbmV3IFNoYWRlclByb2Nlc3Nvck9wdGlvbnModmlld1VuaWZvcm1Gb3JtYXQsIHZpZXdCaW5kR3JvdXBGb3JtYXQsIHZlcnRleEZvcm1hdCk7XG4gICAgICAgIGNvbnN0IGxpYnJhcnkgPSBnZXRQcm9ncmFtTGlicmFyeShkZXZpY2UpO1xuICAgICAgICBsaWJyYXJ5LnJlZ2lzdGVyKCdsaXQnLCBsaXQpO1xuICAgICAgICBjb25zdCBzaGFkZXIgPSBsaWJyYXJ5LmdldFByb2dyYW0oJ2xpdCcsIG9wdGlvbnMsIHByb2Nlc3NpbmdPcHRpb25zLCB0aGlzLnVzZXJJZCk7XG4gICAgICAgIHJldHVybiBzaGFkZXI7XG4gICAgfVxufVxuXG5leHBvcnQgeyBMaXRNYXRlcmlhbCB9O1xuIl0sIm5hbWVzIjpbIm9wdGlvbnMiLCJMaXRNYXRlcmlhbE9wdGlvbnMiLCJMaXRNYXRlcmlhbCIsIk1hdGVyaWFsIiwiY29uc3RydWN0b3IiLCJhcmdzIiwidXNlZFV2cyIsInNoYWRlckNodW5rIiwiY2h1bmtzIiwidXNlTGlnaHRpbmciLCJ1c2VGb2ciLCJ1c2VHYW1tYVRvbmVtYXAiLCJ1c2VTa3lib3giLCJzaGFkaW5nTW9kZWwiLCJTUEVDVUxBUl9CTElOTiIsImFtYmllbnRTSCIsInBpeGVsU25hcCIsIm5pbmVTbGljZWRNb2RlIiwiZmFzdFRibiIsInR3b1NpZGVkTGlnaHRpbmciLCJvY2NsdWRlRGlyZWN0Iiwib2NjbHVkZVNwZWN1bGFyIiwiU1BFQ09DQ19BTyIsIm9jY2x1ZGVTcGVjdWxhckludGVuc2l0eSIsIm9wYWNpdHlGYWRlc1NwZWN1bGFyIiwib3BhY2l0eURpdGhlciIsIkRJVEhFUl9OT05FIiwib3BhY2l0eVNoYWRvd0RpdGhlciIsImNvbnNlcnZlRW5lcmd5IiwiZ2d4U3BlY3VsYXIiLCJmcmVzbmVsTW9kZWwiLCJGUkVTTkVMX1NDSExJQ0siLCJkeW5hbWljUmVmcmFjdGlvbiIsImhhc0FvIiwiaGFzU3BlY3VsYXIiLCJoYXNTcGVjdWxhcml0eUZhY3RvciIsImhhc0xpZ2h0aW5nIiwiaGFzSGVpZ2h0cyIsImhhc05vcm1hbHMiLCJoYXNTaGVlbiIsImhhc1JlZnJhY3Rpb24iLCJoYXNJcnJpZGVzY2VuY2UiLCJoYXNNZXRhbG5lc3MiLCJoYXNDbGVhckNvYXQiLCJoYXNDbGVhckNvYXROb3JtYWxzIiwiZ2V0U2hhZGVyVmFyaWFudCIsImRldmljZSIsInNjZW5lIiwib2JqRGVmcyIsInVudXNlZCIsInBhc3MiLCJzb3J0ZWRMaWdodHMiLCJ2aWV3VW5pZm9ybUZvcm1hdCIsInZpZXdCaW5kR3JvdXBGb3JtYXQiLCJ2ZXJ0ZXhGb3JtYXQiLCJzbGljZSIsIkxpdE1hdGVyaWFsT3B0aW9uc0J1aWxkZXIiLCJ1cGRhdGUiLCJsaXRPcHRpb25zIiwicHJvY2Vzc2luZ09wdGlvbnMiLCJTaGFkZXJQcm9jZXNzb3JPcHRpb25zIiwibGlicmFyeSIsImdldFByb2dyYW1MaWJyYXJ5IiwicmVnaXN0ZXIiLCJsaXQiLCJzaGFkZXIiLCJnZXRQcm9ncmFtIiwidXNlcklkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQVFBLE1BQU1BLE9BQU8sR0FBRyxJQUFJQyxrQkFBa0IsRUFBRSxDQUFBOztBQUV4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1DLFdBQVcsU0FBU0MsUUFBUSxDQUFDO0FBQUFDLEVBQUFBLFdBQUFBLENBQUEsR0FBQUMsSUFBQSxFQUFBO0FBQUEsSUFBQSxLQUFBLENBQUEsR0FBQUEsSUFBQSxDQUFBLENBQUE7QUFBQSxJQUFBLElBQUEsQ0FDL0JDLE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQUEsSUFFaEJDLENBQUFBLFdBQVcsR0FBRyw4QkFBOEIsQ0FBQTtJQUFBLElBRTVDQyxDQUFBQSxNQUFNLEdBQUcsSUFBSSxDQUFBO0lBQUEsSUFFYkMsQ0FBQUEsV0FBVyxHQUFHLElBQUksQ0FBQTtJQUFBLElBRWxCQyxDQUFBQSxNQUFNLEdBQUcsSUFBSSxDQUFBO0lBQUEsSUFFYkMsQ0FBQUEsZUFBZSxHQUFHLElBQUksQ0FBQTtJQUFBLElBRXRCQyxDQUFBQSxTQUFTLEdBQUcsSUFBSSxDQUFBO0lBQUEsSUFFaEJDLENBQUFBLFlBQVksR0FBR0MsY0FBYyxDQUFB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
